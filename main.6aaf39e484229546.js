"use strict";(self.webpackChunkangular_webxr_gallery=self.webpackChunkangular_webxr_gallery||[]).push([[179],{524:()=>{function Qt(n){return"function"==typeof n}function Wf(n){const t=n(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const R_=Wf(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function $f(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class zi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Qt(r))try{r()}catch(s){e=s instanceof R_?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{SP(s)}catch(o){e=e??[],o instanceof R_?e=[...e,...o.errors]:e.push(o)}}if(e)throw new R_(e)}}add(e){var t;if(e&&e!==this)if(this.closed)SP(e);else{if(e instanceof zi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&$f(t,e)}remove(e){const{_finalizers:t}=this;t&&$f(t,e),e instanceof zi&&e._removeParent(this)}}zi.EMPTY=(()=>{const n=new zi;return n.closed=!0,n})();const bP=zi.EMPTY;function TP(n){return n instanceof zi||n&&"closed"in n&&Qt(n.remove)&&Qt(n.add)&&Qt(n.unsubscribe)}function SP(n){Qt(n)?n():n.unsubscribe()}const Wc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},P_={setTimeout(n,e,...t){const{delegate:r}=P_;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=P_;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function AP(n){P_.setTimeout(()=>{const{onUnhandledError:e}=Wc;if(!e)throw n;e(n)})}function Cx(){}const z8=Mx("C",void 0,void 0);function Mx(n,e,t){return{kind:n,value:e,error:t}}let $c=null;function N_(n){if(Wc.useDeprecatedSynchronousErrorHandling){const e=!$c;if(e&&($c={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:r}=$c;if($c=null,t)throw r}}else n()}class Ix extends zi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,TP(e)&&e.add(this)):this.destination=X8}static create(e,t,r){return new qf(e,t,r)}next(e){this.isStopped?Rx(function G8(n){return Mx("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Rx(function H8(n){return Mx("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Rx(z8,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const W8=Function.prototype.bind;function Dx(n,e){return W8.call(n,e)}class $8{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){L_(r)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){L_(r)}else L_(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){L_(t)}}}class qf extends Ix{constructor(e,t,r){let i;if(super(),Qt(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&Wc.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Dx(e.next,s),error:e.error&&Dx(e.error,s),complete:e.complete&&Dx(e.complete,s)}):i=e}this.destination=new $8(i)}}function L_(n){Wc.useDeprecatedSynchronousErrorHandling?function j8(n){Wc.useDeprecatedSynchronousErrorHandling&&$c&&($c.errorThrown=!0,$c.error=n)}(n):AP(n)}function Rx(n,e){const{onStoppedNotification:t}=Wc;t&&P_.setTimeout(()=>t(n,e))}const X8={closed:!0,next:Cx,error:function q8(n){throw n},complete:Cx},Px="function"==typeof Symbol&&Symbol.observable||"@@observable";function Fa(n){return n}function CP(n){return 0===n.length?Fa:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}let cr=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const s=function Q8(n){return n&&n instanceof Ix||function K8(n){return n&&Qt(n.next)&&Qt(n.error)&&Qt(n.complete)}(n)&&TP(n)}(t)?t:new qf(t,r,i);return N_(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=MP(r))((i,s)=>{const o=new qf({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Px](){return this}pipe(...t){return CP(t)(this)}toPromise(t){return new(t=MP(t))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function MP(n){var e;return null!==(e=n??Wc.Promise)&&void 0!==e?e:Promise}const Z8=Wf(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ls=(()=>{class n extends cr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new IP(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new Z8}next(t){N_(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){N_(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){N_(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:s}=this;return r||i?bP:(this.currentObservers=null,s.push(t),new zi(()=>{this.currentObservers=null,$f(s,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){const t=new cr;return t.source=this,t}}return n.create=(e,t)=>new IP(e,t),n})();class IP extends Ls{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)}error(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:bP}}function DP(n){return Qt(n?.lift)}function lr(n){return e=>{if(DP(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ur(n,e,t,r,i){return new J8(n,e,t,r,i)}class J8 extends Ix{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function tn(n,e){return lr((t,r)=>{let i=0;t.subscribe(ur(r,s=>{r.next(n.call(e,s,i++))}))})}function ka(n){return this instanceof ka?(this.v=n,this):new ka(n)}function LP(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Fx(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){!function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}(a,c,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const OP=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function FP(n){return Qt(n?.then)}function kP(n){return Qt(n[Px])}function VP(n){return Symbol.asyncIterator&&Qt(n?.[Symbol.asyncIterator])}function UP(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const BP=function E9(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function zP(n){return Qt(n?.[BP])}function HP(n){return function NP(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(n,e||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,m){s.push([d,f,p,m])>1||a(d,f)})})}function a(d,f){try{!function c(d){d.value instanceof ka?Promise.resolve(d.value.v).then(l,u):h(s[0][2],d)}(r[d](f))}catch(p){h(s[0][3],p)}}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:r,done:i}=yield ka(t.read());if(i)return yield ka(void 0);yield yield ka(r)}}finally{t.releaseLock()}})}function GP(n){return Qt(n?.getReader)}function fs(n){if(n instanceof cr)return n;if(null!=n){if(kP(n))return function x9(n){return new cr(e=>{const t=n[Px]();if(Qt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(OP(n))return function b9(n){return new cr(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(FP(n))return function T9(n){return new cr(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,AP)})}(n);if(VP(n))return jP(n);if(zP(n))return function S9(n){return new cr(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(GP(n))return function A9(n){return jP(HP(n))}(n)}throw UP(n)}function jP(n){return new cr(e=>{(function C9(n,e){var t,r,i,s;return function RP(n,e,t,r){return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):function i(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=LP(n);!(r=yield t.next()).done;)if(e.next(r.value),e.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function jo(n,e,t,r=0,i=!1){const s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Ur(n,e,t=1/0){return Qt(e)?Ur((r,i)=>tn((s,o)=>e(r,s,i,o))(fs(n(r,i))),t):("number"==typeof e&&(t=e),lr((r,i)=>function M9(n,e,t,r,i,s,o,a){const c=[];let l=0,u=0,h=!1;const d=()=>{h&&!c.length&&!l&&e.complete()},f=m=>l<r?p(m):c.push(m),p=m=>{s&&e.next(m),l++;let _=!1;fs(t(m,u++)).subscribe(ur(e,g=>{i?.(g),s?f(g):e.next(g)},()=>{_=!0},void 0,()=>{if(_)try{for(l--;c.length&&l<r;){const g=c.shift();o?jo(e,o,()=>p(g)):p(g)}d()}catch(g){e.error(g)}}))};return n.subscribe(ur(e,f,()=>{h=!0,d()})),()=>{a?.()}}(r,i,n,t)))}function Tu(n=1/0){return Ur(Fa,n)}const to=new cr(n=>n.complete());function kx(n){return n[n.length-1]}function Xf(n){return function D9(n){return n&&Qt(n.schedule)}(kx(n))?n.pop():void 0}function WP(n,e=0){return lr((t,r)=>{t.subscribe(ur(r,i=>jo(r,n,()=>r.next(i),e),()=>jo(r,n,()=>r.complete(),e),i=>jo(r,n,()=>r.error(i),e)))})}function $P(n,e=0){return lr((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function qP(n,e){if(!n)throw new Error("Iterable cannot be null");return new cr(t=>{jo(t,e,()=>{const r=n[Symbol.asyncIterator]();jo(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function yr(n,e){return e?function V9(n,e){if(null!=n){if(kP(n))return function N9(n,e){return fs(n).pipe($P(e),WP(e))}(n,e);if(OP(n))return function O9(n,e){return new cr(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}(n,e);if(FP(n))return function L9(n,e){return fs(n).pipe($P(e),WP(e))}(n,e);if(VP(n))return qP(n,e);if(zP(n))return function F9(n,e){return new cr(t=>{let r;return jo(t,e,()=>{r=n[BP](),jo(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void t.error(o)}s?t.complete():t.next(i)},0,!0)}),()=>Qt(r?.return)&&r.return()})}(n,e);if(GP(n))return function k9(n,e){return qP(HP(n),e)}(n,e)}throw UP(n)}(n,e):fs(n)}class ps extends Ls{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}function ot(...n){return yr(n,Xf(n))}function XP(n={}){const{connector:e=(()=>new Ls),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let o,a,c,l=0,u=!1,h=!1;const d=()=>{a?.unsubscribe(),a=void 0},f=()=>{d(),o=c=void 0,u=h=!1},p=()=>{const m=o;f(),m?.unsubscribe()};return lr((m,_)=>{l++,!h&&!u&&d();const g=c=c??e();_.add(()=>{l--,0===l&&!h&&!u&&(a=Vx(p,i))}),g.subscribe(_),!o&&l>0&&(o=new qf({next:y=>g.next(y),error:y=>{h=!0,d(),a=Vx(f,t,y),g.error(y)},complete:()=>{u=!0,d(),a=Vx(f,r),g.complete()}}),fs(m).subscribe(o))})(s)}}function Vx(n,e,...t){if(!0===e)return void n();if(!1===e)return;const r=new qf({next:()=>{r.unsubscribe(),n()}});return fs(e(...t)).subscribe(r)}function Os(n,e){return lr((t,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();t.subscribe(ur(r,c=>{i?.unsubscribe();let l=0;const u=s++;fs(n(c,u)).subscribe(i=ur(r,h=>r.next(e?e(c,h,u,l++):h),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function z9(n,e){return n===e}function qt(n){for(let e in n)if(n[e]===qt)return e;throw Error("Could not find renamed property on target object.")}function Jn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Jn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Ux(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const H9=qt({__forward_ref__:qt});function Bx(n){return n.__forward_ref__=Bx,n.toString=function(){return Jn(this())},n}function Je(n){return F_(n)?n():n}function F_(n){return"function"==typeof n&&n.hasOwnProperty(H9)&&n.__forward_ref__===Bx}function zx(n){return n&&!!n.\u0275providers}const YP="https://g.co/ng/security#xss";class pe extends Error{constructor(e,t){super(function k_(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function ut(n){return"string"==typeof n?n:null==n?"":String(n)}function Hx(n,e){throw new pe(-201,!1)}function Gi(n,e){null==n&&function et(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function Le(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function no(n){return{providers:n.providers||[],imports:n.imports||[]}}function V_(n){return KP(n,B_)||KP(n,QP)}function KP(n,e){return n.hasOwnProperty(e)?n[e]:null}function U_(n){return n&&(n.hasOwnProperty(Gx)||n.hasOwnProperty(K9))?n[Gx]:null}const B_=qt({\u0275prov:qt}),Gx=qt({\u0275inj:qt}),QP=qt({ngInjectableDef:qt}),K9=qt({ngInjectorDef:qt});var Ct=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Ct||{});let jx;function ZP(){return jx}function bi(n){const e=jx;return jx=n,e}function JP(n,e,t){const r=V_(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Ct.Optional?null:void 0!==e?e:void Hx(Jn(n))}const cn=globalThis,Yf={},Yx="__NG_DI_FLAG__",z_="ngTempTokenPath",J9=/\n/gm,tN="__source";let Su;function Ua(n){const e=Su;return Su=n,e}function nq(n,e=Ct.Default){if(void 0===Su)throw new pe(-203,!1);return null===Su?JP(n,void 0,e):Su.get(n,e&Ct.Optional?null:void 0,e)}function De(n,e=Ct.Default){return(ZP()||nq)(Je(n),e)}function Ae(n,e=Ct.Default){return De(n,H_(e))}function H_(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Kx(n){const e=[];for(let t=0;t<n.length;t++){const r=Je(n[t]);if(Array.isArray(r)){if(0===r.length)throw new pe(900,!1);let i,s=Ct.Default;for(let o=0;o<r.length;o++){const a=r[o],c=rq(a);"number"==typeof c?-1===c?i=a.token:s|=c:i=a}e.push(De(i,s))}else e.push(De(r))}return e}function Kf(n,e){return n[Yx]=e,n.prototype[Yx]=e,n}function rq(n){return n[Yx]}function Wo(n){return{toString:n}.toString()}var G_=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(G_||{}),Fs=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Fs||{});const ro={},zt=[],j_=qt({\u0275cmp:qt}),Qx=qt({\u0275dir:qt}),Zx=qt({\u0275pipe:qt}),rN=qt({\u0275mod:qt}),$o=qt({\u0275fac:qt}),Qf=qt({__NG_ELEMENT_ID__:qt}),iN=qt({__NG_ENV_ID__:qt});function sN(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}function Jx(n,e,t){let r=0;for(;r<t.length;){const i=t[r];if("number"==typeof i){if(0!==i)break;r++;const s=t[r++],o=t[r++],a=t[r++];n.setAttribute(e,o,a,s)}else{const s=i,o=t[++r];aN(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),r++}}return r}function oN(n){return 3===n||4===n||6===n}function aN(n){return 64===n.charCodeAt(0)}function Zf(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||cN(n,t,i,null,-1===t||2===t?e[++r]:null)}}return n}function cN(n,e,t,r,i){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==i&&(n[s+1]=i));if(r===n[s+1])return void(n[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==r&&n.splice(s++,0,r),null!==i&&n.splice(s++,0,i)}const lN="ng-template";function oq(n,e,t){let r=0,i=!0;for(;r<n.length;){let s=n[r++];if("string"==typeof s&&i){const o=n[r++];if(t&&"class"===s&&-1!==sN(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;r<n.length&&"string"==typeof(s=n[r++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(i=!1)}}return!1}function uN(n){return 4===n.type&&n.value!==lN}function aq(n,e,t){return e===(4!==n.type||t?n.value:lN)}function cq(n,e,t){let r=4;const i=n.attrs||[],s=function hq(n){for(let e=0;e<n.length;e++)if(oN(n[e]))return e;return n.length}(i);let o=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!o)if(4&r){if(r=2|1&r,""!==c&&!aq(n,c,t)||""===c&&1===e.length){if(ks(r))return!1;o=!0}}else{const l=8&r?c:e[++a];if(8&r&&null!==n.attrs){if(!oq(n.attrs,l,t)){if(ks(r))return!1;o=!0}continue}const h=lq(8&r?"class":c,i,uN(n),t);if(-1===h){if(ks(r))return!1;o=!0;continue}if(""!==l){let d;d=h>s?"":i[h+1].toLowerCase();const f=8&r?d:null;if(f&&-1!==sN(f,l,0)||2&r&&l!==d){if(ks(r))return!1;o=!0}}}}else{if(!o&&!ks(r)&&!ks(c))return!1;if(o&&ks(c))continue;o=!1,r=c|1&r}}return ks(r)||o}function ks(n){return 0==(1&n)}function lq(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){const o=e[i];if(o===n)return i;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=s?1:2}return-1}return function dq(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function hN(n,e,t=!1){for(let r=0;r<e.length;r++)if(cq(n,e[r],t))return!0;return!1}function dN(n,e){return n?":not("+e.trim()+")":e}function pq(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&r){const a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!ks(o)&&(e+=dN(s,i),i=""),r=o,s=s||!ks(r);t++}return""!==i&&(e+=dN(s,i)),e}function Au(n){return Wo(()=>{const e=pN(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===G_.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Fs.Emulated,styles:n.styles||zt,_:null,schemas:n.schemas||null,tView:null,id:""};mN(t);const r=n.dependencies;return t.directiveDefs=W_(r,!1),t.pipeDefs=W_(r,!0),t.id=function wq(n){let e=0;const t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const i of t)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(t),t})}function _q(n){return Mt(n)||hr(n)}function yq(n){return null!==n}function qo(n){return Wo(()=>({type:n.type,bootstrap:n.bootstrap||zt,declarations:n.declarations||zt,imports:n.imports||zt,exports:n.exports||zt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function fN(n,e){if(null==n)return ro;const t={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),t[i]=r,e&&(e[i]=s)}return t}function oi(n){return Wo(()=>{const e=pN(n);return mN(e),e})}function Mt(n){return n[j_]||null}function hr(n){return n[Qx]||null}function Mr(n){return n[Zx]||null}function Br(n,e){const t=n[rN]||null;if(!t&&!0===e)throw new Error(`Type ${Jn(n)} does not have '\u0275mod' property.`);return t}function pN(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||ro,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||zt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:fN(n.inputs,e),outputs:fN(n.outputs)}}function mN(n){n.features?.forEach(e=>e(n))}function W_(n,e){if(!n)return null;const t=e?Mr:_q;return()=>("function"==typeof n?n():n).map(r=>t(r)).filter(yq)}const bn=0,he=1,ht=2,gn=3,Vs=4,Jf=5,zr=6,Cu=7,nn=8,Hr=9,Mu=10,dt=11,ep=12,gN=13,Iu=14,Cn=15,tp=16,Du=17,io=18,np=19,_N=20,za=21,so=22,rp=23,ip=24,rt=25,eb=1,yN=2,oo=7,Ru=9,Mn=11;function Gr(n){return Array.isArray(n)&&"object"==typeof n[eb]}function jr(n){return Array.isArray(n)&&!0===n[eb]}function tb(n){return 0!=(4&n.flags)}function qc(n){return n.componentOffset>-1}function q_(n){return 1==(1&n.flags)}function Us(n){return!!n.template}function nb(n){return 0!=(512&n[ht])}function Xc(n,e){return n.hasOwnProperty($o)?n[$o]:null}const Ha=Symbol("SIGNAL");function EN(n,e){return(null===n||"object"!=typeof n)&&Object.is(n,e)}let Ir=null,op=!1;function ms(n){const e=Ir;return Ir=n,e}const rb={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function xN(n){if(op)throw new Error("");if(null===Ir)return;const e=Ir.nextProducerIndex++;Pu(Ir),e<Ir.producerNode.length&&Ir.producerNode[e]!==n&&ap(Ir)&&K_(Ir.producerNode[e],Ir.producerIndexOfThis[e]),Ir.producerNode[e]!==n&&(Ir.producerNode[e]=n,Ir.producerIndexOfThis[e]=ap(Ir)?CN(n,Ir,e):0),Ir.producerLastReadVersion[e]=n.version}function bN(n){if(!ap(n)||n.dirty){if(!n.producerMustRecompute(n)&&!function AN(n){Pu(n);for(let e=0;e<n.producerNode.length;e++){const t=n.producerNode[e],r=n.producerLastReadVersion[e];if(r!==t.version||(bN(t),r!==t.version))return!0}return!1}(n))return void(n.dirty=!1);n.producerRecomputeValue(n),n.dirty=!1}}function TN(n){if(void 0===n.liveConsumerNode)return;const e=op;op=!0;try{for(const t of n.liveConsumerNode)t.dirty||SN(t)}finally{op=e}}function ib(){return!1!==Ir?.consumerAllowSignalWrites}function SN(n){n.dirty=!0,TN(n),n.consumerMarkedDirty?.(n)}function X_(n){return n&&(n.nextProducerIndex=0),ms(n)}function Y_(n,e){if(ms(e),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(ap(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)K_(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function sb(n){if(Pu(n),ap(n))for(let e=0;e<n.producerNode.length;e++)K_(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function CN(n,e,t){if(MN(n),Pu(n),0===n.liveConsumerNode.length)for(let r=0;r<n.producerNode.length;r++)n.producerIndexOfThis[r]=CN(n.producerNode[r],n,r);return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function K_(n,e){if(MN(n),Pu(n),1===n.liveConsumerNode.length)for(let r=0;r<n.producerNode.length;r++)K_(n.producerNode[r],n.producerIndexOfThis[r]);const t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){const r=n.liveConsumerIndexOfThis[e],i=n.liveConsumerNode[e];Pu(i),i.producerIndexOfThis[r]=e}}function ap(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Pu(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function MN(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}const ob=Symbol("UNSET"),ab=Symbol("COMPUTING"),Q_=Symbol("ERRORED"),Iq=(()=>({...rb,value:ob,dirty:!0,error:null,equal:EN,producerMustRecompute:n=>n.value===ob||n.value===ab,producerRecomputeValue(n){if(n.value===ab)throw new Error("Detected cycle in computations.");const e=n.value;n.value=ab;const t=X_(n);let r;try{r=n.computation()}catch(i){r=Q_,n.error=i}finally{Y_(n,t)}e!==ob&&e!==Q_&&r!==Q_&&n.equal(e,r)?n.value=e:(n.value=r,n.version++)}}))();let IN=function Dq(){throw new Error};function cb(){IN()}let lb=null;function Z_(n,e){const t=Object.create(Pq);function r(){return xN(t),t.value}return t.value=n,e?.equal&&(t.equal=e.equal),r.set=RN,r.update=Nq,r.mutate=Lq,r.asReadonly=Oq,r[Ha]=t,r}const Pq=(()=>({...rb,equal:EN,readonlyFn:void 0}))();function DN(n){n.version++,TN(n),lb?.()}function RN(n){const e=this[Ha];ib()||cb(),e.equal(e.value,n)||(e.value=n,DN(e))}function Nq(n){ib()||cb(),RN.call(this,n(this[Ha].value))}function Lq(n){const e=this[Ha];ib()||cb(),n(e.value),DN(e)}function Oq(){const n=this[Ha];if(void 0===n.readonlyFn){const e=()=>this();e[Ha]=n,n.readonlyFn=e}return n.readonlyFn}class Vq{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Yc(){return LN}function LN(n){return n.type.prototype.ngOnChanges&&(n.setInput=Bq),Uq}function Uq(){const n=FN(this),e=n?.current;if(e){const t=n.previous;if(t===ro)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function Bq(n,e,t,r){const i=this.declaredInputs[t],s=FN(n)||function zq(n,e){return n[ON]=e}(n,{previous:ro,current:null}),o=s.current||(s.current={}),a=s.previous,c=a[i];o[i]=new Vq(c&&c.currentValue,e,a===ro),n[r]=e}Yc.ngInherit=!0;const ON="__ngSimpleChanges__";function FN(n){return n[ON]||null}const ao=function(n,e,t){};function ln(n){for(;Array.isArray(n);)n=n[bn];return n}function Si(n,e){return ln(e[n.index])}function lp(n,e){return n.data[e]}function ji(n,e){const t=e[n];return Gr(t)?t:t[bn]}function co(n,e){return null==e?null:n[e]}function UN(n){n[Du]=0}function qq(n){1024&n[ht]||(n[ht]|=1024,HN(n,1))}function BN(n){1024&n[ht]&&(n[ht]&=-1025,HN(n,-1))}function HN(n,e){let t=n[gn];if(null===t)return;t[Jf]+=e;let r=t;for(t=t[gn];null!==t&&(1===e&&1===r[Jf]||-1===e&&0===r[Jf]);)t[Jf]+=e,r=t,t=t[gn]}function up(n,e){if(256==(256&n[ht]))throw new pe(911,!1);null===n[za]&&(n[za]=[]),n[za].push(e)}const it={lFrame:ZN(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function jN(){return it.bindingsEnabled}function Y(){return it.lFrame.lView}function Ot(){return it.lFrame.tView}function Zt(){let n=WN();for(;null!==n&&64===n.type;)n=n.parent;return n}function WN(){return it.lFrame.currentTNode}function lo(n,e){const t=it.lFrame;t.currentTNode=n,t.isParent=e}function db(){return it.lFrame.isParent}function uo(){return it.lFrame.bindingIndex++}function o7(n,e){const t=it.lFrame;t.bindingIndex=t.bindingRootIndex=n,pb(e)}function pb(n){it.lFrame.currentDirectiveIndex=n}function YN(){return it.lFrame.currentQueryIndex}function gb(n){it.lFrame.currentQueryIndex=n}function c7(n){const e=n[he];return 2===e.type?e.declTNode:1===e.type?n[zr]:null}function KN(n,e,t){if(t&Ct.SkipSelf){let i=e,s=n;for(;!(i=i.parent,null!==i||t&Ct.Host||(i=c7(s),null===i||(s=s[Iu],10&i.type))););if(null===i)return!1;e=i,n=s}const r=it.lFrame=QN();return r.currentTNode=e,r.lView=n,!0}function _b(n){const e=QN(),t=n[he];it.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function QN(){const n=it.lFrame,e=null===n?null:n.child;return null===e?ZN(n):e}function ZN(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function JN(){const n=it.lFrame;return it.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const eL=JN;function yb(){const n=JN();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function ci(){return it.lFrame.selectedIndex}function Kc(n){it.lFrame.selectedIndex=n}function _n(){const n=it.lFrame;return lp(n.tView,n.selectedIndex)}let rL=!0;function ey(){return rL}function Ga(n){rL=n}function ty(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),null!=u&&(n.destroyHooks??=[]).push(t,u)}}function ny(n,e,t){iL(n,e,3,t)}function ry(n,e,t,r){(3&n[ht])===t&&iL(n,e,t,r)}function vb(n,e){let t=n[ht];(3&t)===e&&(t&=8191,t+=1,n[ht]=t)}function iL(n,e,t,r){const s=r??-1,o=e.length-1;let a=0;for(let c=void 0!==r?65535&n[Du]:0;c<o;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=r&&a>=r)break}else e[c]<0&&(n[Du]+=65536),(a<s||-1==s)&&(p7(n,t,e,c),n[Du]=(4294901760&n[Du])+c+2),c++}function sL(n,e){ao(4,n,e);const t=ms(null);try{e.call(n)}finally{ms(t),ao(5,n,e)}}function p7(n,e,t,r){const i=t[r]<0,s=t[r+1],a=n[i?-t[r]:t[r]];i?n[ht]>>13<n[Du]>>16&&(3&n[ht])===e&&(n[ht]+=8192,sL(a,s)):sL(a,s)}const Ou=-1;class dp{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Eb(n){return n!==Ou}function fp(n){return 32767&n}function pp(n,e){let t=function v7(n){return n>>16}(n),r=e;for(;t>0;)r=r[Iu],t--;return r}let xb=!0;function iy(n){const e=xb;return xb=n,e}const oL=255,aL=5;let w7=0;const ho={};function sy(n,e){const t=cL(n,e);if(-1!==t)return t;const r=e[he];r.firstCreatePass&&(n.injectorIndex=e.length,bb(r.data,n),bb(e,null),bb(r.blueprint,null));const i=oy(n,e),s=n.injectorIndex;if(Eb(i)){const o=fp(i),a=pp(i,e),c=a[he].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=i,s}function bb(n,e){n.push(0,0,0,0,0,0,0,0,e)}function cL(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function oy(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){if(r=_L(i),null===r)return Ou;if(t++,i=i[Iu],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return Ou}function Tb(n,e,t){!function E7(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Qf)&&(r=t[Qf]),null==r&&(r=t[Qf]=w7++);const i=r&oL;e.data[n+(i>>aL)]|=1<<i}(n,e,t)}function lL(n,e,t){if(t&Ct.Optional||void 0!==n)return n;Hx()}function uL(n,e,t,r){if(t&Ct.Optional&&void 0===r&&(r=null),!(t&(Ct.Self|Ct.Host))){const i=n[Hr],s=bi(void 0);try{return i?i.get(e,r,t&Ct.Optional):JP(e,r,t&Ct.Optional)}finally{bi(s)}}return lL(r,0,t)}function hL(n,e,t,r=Ct.Default,i){if(null!==n){if(2048&e[ht]&&!(r&Ct.Self)){const o=function A7(n,e,t,r,i){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[ht]&&!(512&o[ht]);){const a=dL(s,o,t,r|Ct.Self,ho);if(a!==ho)return a;let c=s.parent;if(!c){const l=o[_N];if(l){const u=l.get(t,ho,r);if(u!==ho)return u}c=_L(o),o=o[Iu]}s=c}return i}(n,e,t,r,ho);if(o!==ho)return o}const s=dL(n,e,t,r,ho);if(s!==ho)return s}return uL(e,t,r,i)}function dL(n,e,t,r,i){const s=function T7(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Qf)?n[Qf]:void 0;return"number"==typeof e?e>=0?e&oL:S7:e}(t);if("function"==typeof s){if(!KN(e,n,r))return r&Ct.Host?lL(i,0,r):uL(e,t,r,i);try{let o;if(o=s(r),null!=o||r&Ct.Optional)return o;Hx()}finally{eL()}}else if("number"==typeof s){let o=null,a=cL(n,e),c=Ou,l=r&Ct.Host?e[Cn][zr]:null;for((-1===a||r&Ct.SkipSelf)&&(c=-1===a?oy(n,e):e[a+8],c!==Ou&&pL(r,!1)?(o=e[he],a=fp(c),e=pp(c,e)):a=-1);-1!==a;){const u=e[he];if(fL(s,a,u.data)){const h=b7(a,e,t,o,r,l);if(h!==ho)return h}c=e[a+8],c!==Ou&&pL(r,e[he].data[a+8]===l)&&fL(s,a,e)?(o=u,a=fp(c),e=pp(c,e)):a=-1}}return i}function b7(n,e,t,r,i,s){const o=e[he],a=o.data[n+8],u=ay(a,o,t,null==r?qc(a)&&xb:r!=o&&0!=(3&a.type),i&Ct.Host&&s===a);return null!==u?Qc(e,o,u,a):ho}function ay(n,e,t,r,i){const s=n.providerIndexes,o=e.data,a=1048575&s,c=n.directiveStart,u=s>>20,d=i?a+u:n.directiveEnd;for(let f=r?a:a+u;f<d;f++){const p=o[f];if(f<c&&t===p||f>=c&&p.type===t)return f}if(i){const f=o[c];if(f&&Us(f)&&f.type===t)return c}return null}function Qc(n,e,t,r){let i=n[t];const s=e.data;if(function m7(n){return n instanceof dp}(i)){const o=i;o.resolving&&function G9(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new pe(-200,`Circular dependency in DI detected for ${n}${t}`)}(function Wt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ut(n)}(s[t]));const a=iy(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?bi(o.injectImpl):null;KN(n,r,Ct.Default);try{i=n[t]=o.factory(void 0,s,n,r),e.firstCreatePass&&t>=r.directiveStart&&function f7(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const o=LN(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}i&&(t.preOrderHooks??=[]).push(0-n,i),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,s[t],e)}finally{null!==l&&bi(l),iy(a),o.resolving=!1,eL()}}return i}function fL(n,e,t){return!!(t[e+(n>>aL)]&1<<n)}function pL(n,e){return!(n&Ct.Self||n&Ct.Host&&e)}class Wr{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return hL(this._tNode,this._lView,e,H_(r),t)}}function S7(){return new Wr(Zt(),Y())}function Sb(n){return F_(n)?()=>{const e=Sb(Je(n));return e&&e()}:Xc(n)}function _L(n){const e=n[he],t=e.type;return 2===t?e.declTNode:1===t?n[zr]:null}const Vu="__parameters__";function Bu(n,e,t){return Wo(()=>{const r=function Ab(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;const o=new i(...s);return a.annotation=o,a;function a(c,l,u){const h=c.hasOwnProperty(Vu)?c[Vu]:Object.defineProperty(c,Vu,{value:[]})[Vu];for(;h.length<=u;)h.push(null);return(h[u]=h[u]||[]).push(o),c}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}function Hu(n,e){n.forEach(t=>Array.isArray(t)?Hu(t,e):e(t))}function vL(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function ly(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const hy=Kf(Bu("Optional"),8),dy=Kf(Bu("SkipSelf"),4);class Ge{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Le({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const yp=new Ge("ENVIRONMENT_INITIALIZER"),SL=new Ge("INJECTOR",-1),AL=new Ge("INJECTOR_DEF_TYPES");class py{get(e,t=Yf){if(t===Yf){const r=new Error(`NullInjectorError: No provider for ${Jn(e)}!`);throw r.name="NullInjectorError",r}return t}}function X7(...n){return{\u0275providers:ML(0,n),\u0275fromNgModule:!0}}function ML(n,...e){const t=[],r=new Set;let i;const s=o=>{t.push(o)};return Hu(e,o=>{const a=o;my(a,s,[],r)&&(i||=[],i.push(a))}),void 0!==i&&IL(i,s),t}function IL(n,e){for(let t=0;t<n.length;t++){const{ngModule:r,providers:i}=n[t];Rb(i,s=>{e(s,r)})}}function my(n,e,t,r){if(!(n=Je(n)))return!1;let i=null,s=U_(n);const o=!s&&Mt(n);if(s||o){if(o&&!o.standalone)return!1;i=n}else{const c=n.ngModule;if(s=U_(c),!s)return!1;i=c}const a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){const c="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const l of c)my(l,e,t,r)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let l;r.add(i);try{Hu(s.imports,u=>{my(u,e,t,r)&&(l||=[],l.push(u))})}finally{}void 0!==l&&IL(l,e)}if(!a){const l=Xc(i)||(()=>new i);e({provide:i,useFactory:l,deps:zt},i),e({provide:AL,useValue:i,multi:!0},i),e({provide:yp,useValue:()=>De(i),multi:!0},i)}const c=s.providers;if(null!=c&&!a){const l=n;Rb(c,u=>{e(u,l)})}}}return i!==n&&void 0!==n.providers}function Rb(n,e){for(let t of n)zx(t)&&(t=t.\u0275providers),Array.isArray(t)?Rb(t,e):e(t)}const Y7=qt({provide:String,useValue:qt});function Pb(n){return null!==n&&"object"==typeof n&&Y7 in n}function Zc(n){return"function"==typeof n}const Nb=new Ge("Set Injector scope."),gy={},Q7={};let Lb;function _y(){return void 0===Lb&&(Lb=new py),Lb}class gs{}class vp extends gs{get destroyed(){return this._destroyed}constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Fb(e,o=>this.processProvider(o)),this.records.set(SL,Wu(void 0,this)),i.has("environment")&&this.records.set(gs,Wu(void 0,this));const s=this.records.get(Nb);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(AL,zt,Ct.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of e)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const t=Ua(this),r=bi(void 0);try{return e()}finally{Ua(t),bi(r)}}get(e,t=Yf,r=Ct.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(iN))return e[iN](this);r=H_(r);const s=Ua(this),o=bi(void 0);try{if(!(r&Ct.SkipSelf)){let c=this.records.get(e);if(void 0===c){const l=function nX(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ge}(e)&&V_(e);c=l&&this.injectableDefInScope(l)?Wu(Ob(e),gy):null,this.records.set(e,c)}if(null!=c)return this.hydrate(e,c)}return(r&Ct.Self?_y():this.parent).get(e,t=r&Ct.Optional&&t===Yf?null:t)}catch(a){if("NullInjectorError"===a.name){if((a[z_]=a[z_]||[]).unshift(Jn(e)),s)throw a;return function iq(n,e,t,r){const i=n[z_];throw e[tN]&&i.unshift(e[tN]),n.message=function sq(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let i=Jn(e);if(Array.isArray(e))i=e.map(Jn).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Jn(a)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(J9,"\n  ")}`}("\n"+n.message,i,t,r),n.ngTokenPath=i,n[z_]=null,n}(a,e,"R3InjectorError",this.source)}throw a}finally{bi(o),Ua(s)}}resolveInjectorInitializers(){const e=Ua(this),t=bi(void 0);try{const i=this.get(yp,zt,Ct.Self);for(const s of i)s()}finally{Ua(e),bi(t)}}toString(){const e=[],t=this.records;for(const r of t.keys())e.push(Jn(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new pe(205,!1)}processProvider(e){let t=Zc(e=Je(e))?e:Je(e&&e.provide);const r=function J7(n){return Pb(n)?Wu(void 0,n.useValue):Wu(function PL(n,e,t){let r;if(Zc(n)){const i=Je(n);return Xc(i)||Ob(i)}if(Pb(n))r=()=>Je(n.useValue);else if(function RL(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...Kx(n.deps||[]));else if(function DL(n){return!(!n||!n.useExisting)}(n))r=()=>De(Je(n.useExisting));else{const i=Je(n&&(n.useClass||n.provide));if(!function eX(n){return!!n.deps}(n))return Xc(i)||Ob(i);r=()=>new i(...Kx(n.deps))}return r}(n),gy)}(e);if(Zc(e)||!0!==e.multi)this.records.get(t);else{let i=this.records.get(t);i||(i=Wu(void 0,gy,!0),i.factory=()=>Kx(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t){return t.value===gy&&(t.value=Q7,t.value=t.factory()),"object"==typeof t.value&&t.value&&function tX(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Je(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Ob(n){const e=V_(n),t=null!==e?e.factory:Xc(n);if(null!==t)return t;if(n instanceof Ge)throw new pe(204,!1);if(n instanceof Function)return function Z7(n){const e=n.length;if(e>0)throw function gp(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?"),new pe(204,!1);const t=function Y9(n){return n&&(n[B_]||n[QP])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new pe(204,!1)}function Wu(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Fb(n,e){for(const t of n)Array.isArray(t)?Fb(t,e):t&&zx(t)?Fb(t.\u0275providers,e):e(t)}function FL(n,e=null,t=null,r){const i=kL(n,e,t,r);return i.resolveInjectorInitializers(),i}function kL(n,e=null,t=null,r,i=new Set){const s=[t||zt,X7(n)];return r=r||("object"==typeof n?void 0:Jn(n)),new vp(s,e||_y(),r||null,i)}let Ub,_s=(()=>{var n;class e{static create(r,i){if(Array.isArray(r))return FL({name:""},i,r,"");{const s=r.name??"";return FL({name:s},r.parent,r.providers,s)}}}return(n=e).THROW_IF_NOT_FOUND=Yf,n.NULL=new py,n.\u0275prov=Le({token:n,providedIn:"any",factory:()=>De(SL)}),n.__NG_ELEMENT_ID__=-1,e})();const vy=new Ge("AppId",{providedIn:"root",factory:()=>hX}),hX="ng",UL=new Ge("Platform Initializer"),qu=new Ge("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),BL=new Ge("CSP nonce",{providedIn:"root",factory:()=>function $u(){if(void 0!==Ub)return Ub;if(typeof document<"u")return document;throw new pe(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Bb(n){return n.ownerDocument.defaultView}function $i(n){return n instanceof Function?n():n}function jb(n){return 128==(128&n.flags)}var $a=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}($a||{});const Wb=new Map;let EX=0;const qb="__ngContext__";function $r(n,e){Gr(e)?(n[qb]=e[np],function bX(n){Wb.set(n[np],n)}(e)):n[qb]=e}let Xb;function Yb(n,e){return Xb(n,e)}function bp(n){const e=n[gn];return jr(e)?e[gn]:e}function sO(n){return aO(n[ep])}function oO(n){return aO(n[Vs])}function aO(n){for(;null!==n&&!jr(n);)n=n[Vs];return n}function Ku(n,e,t,r,i){if(null!=r){let s,o=!1;jr(r)?s=r:Gr(r)&&(o=!0,r=r[bn]);const a=ln(r);0===n&&null!==t?null==i?hO(e,t,a):el(e,t,a,i||null,!0):1===n&&null!==t?el(e,t,a,i||null,!0):2===n?function Iy(n,e,t){const r=Cy(n,e);r&&function HX(n,e,t,r){n.removeChild(e,t,r)}(n,r,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function WX(n,e,t,r,i){const s=t[oo];s!==ln(t)&&Ku(e,n,r,s,i);for(let a=Mn;a<t.length;a++){const c=t[a];Ap(c[he],c,n,e,r,s)}}(e,n,s,t,i)}}function Sy(n,e,t){return n.createElement(e,t)}function lO(n,e){const t=n[Ru],r=t.indexOf(e);BN(e),t.splice(r,1)}function Tp(n,e){if(n.length<=Mn)return;const t=Mn+e,r=n[t];if(r){const i=r[tp];null!==i&&i!==n&&lO(i,r),e>0&&(n[t-1][Vs]=r[Vs]);const s=ly(n,Mn+e);!function LX(n,e){Ap(n,e,e[dt],2,null,null),e[bn]=null,e[zr]=null}(r[he],r);const o=s[io];null!==o&&o.detachView(s[he]),r[gn]=null,r[Vs]=null,r[ht]&=-129}return r}function Ay(n,e){if(!(256&e[ht])){const t=e[dt];e[rp]&&sb(e[rp]),e[ip]&&sb(e[ip]),t.destroyNode&&Ap(n,e,t,3,null,null),function kX(n){let e=n[ep];if(!e)return Qb(n[he],n);for(;e;){let t=null;if(Gr(e))t=e[ep];else{const r=e[Mn];r&&(t=r)}if(!t){for(;e&&!e[Vs]&&e!==n;)Gr(e)&&Qb(e[he],e),e=e[gn];null===e&&(e=n),Gr(e)&&Qb(e[he],e),t=e&&e[Vs]}e=t}}(e)}}function Qb(n,e){if(!(256&e[ht])){e[ht]&=-129,e[ht]|=256,function zX(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof dp)){const s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],c=s[o+1];ao(4,a,c);try{c.call(a)}finally{ao(5,a,c)}}else{ao(4,i,s);try{s.call(i)}finally{ao(5,i,s)}}}}}(n,e),function BX(n,e){const t=n.cleanup,r=e[Cu];if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?r[o]():r[-o].unsubscribe(),s+=2}else t[s].call(r[t[s+1]]);null!==r&&(e[Cu]=null);const i=e[za];if(null!==i){e[za]=null;for(let s=0;s<i.length;s++)(0,i[s])()}}(n,e),1===e[he].type&&e[dt].destroy();const t=e[tp];if(null!==t&&jr(e[gn])){t!==e[gn]&&lO(t,e);const r=e[io];null!==r&&r.detachView(n)}!function TX(n){Wb.delete(n[np])}(e)}}function Zb(n,e,t){return function uO(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[bn];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:s}=n.data[r.directiveStart+i];if(s===Fs.None||s===Fs.Emulated)return null}return Si(r,t)}}(n,e.parent,t)}function el(n,e,t,r,i){n.insertBefore(e,t,r,i)}function hO(n,e,t){n.appendChild(e,t)}function dO(n,e,t,r,i){null!==r?el(n,e,t,r,i):hO(n,e,t)}function Cy(n,e){return n.parentNode(e)}let Jb,mO=function pO(n,e,t){return 40&n.type?Si(n,t):null};function My(n,e,t,r){const i=Zb(n,r,e),s=e[dt],a=function fO(n,e,t){return mO(n,e,t)}(r.parent||e[zr],r,e);if(null!=i)if(Array.isArray(t))for(let c=0;c<t.length;c++)dO(s,i,t[c],a,!1);else dO(s,i,t,a,!1);void 0!==Jb&&Jb(s,r,e,t,i)}function Sp(n,e){if(null!==e){const t=e.type;if(3&t)return Si(e,n);if(4&t)return eT(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return Sp(n,r);{const i=n[e.index];return jr(i)?eT(-1,i):ln(i)}}if(32&t)return Yb(e,n)()||ln(n[e.index]);{const r=_O(n,e);return null!==r?Array.isArray(r)?r[0]:Sp(bp(n[Cn]),r):Sp(n,e.next)}}return null}function _O(n,e){return null!==e?n[Cn][zr].projection[e.projection]:null}function eT(n,e){const t=Mn+n+1;if(t<e.length){const r=e[t],i=r[he].firstChild;if(null!==i)return Sp(r,i)}return e[oo]}function tT(n,e,t,r,i,s,o){for(;null!=t;){const a=r[t.index],c=t.type;if(o&&0===e&&(a&&$r(ln(a),r),t.flags|=2),32!=(32&t.flags))if(8&c)tT(n,e,t.child,r,i,s,!1),Ku(e,n,i,a,s);else if(32&c){const l=Yb(t,r);let u;for(;u=l();)Ku(e,n,i,u,s);Ku(e,n,i,a,s)}else 16&c?vO(n,e,r,t,i,s):Ku(e,n,i,a,s);t=o?t.projectionNext:t.next}}function Ap(n,e,t,r,i,s){tT(t,r,n.firstChild,e,i,s,!1)}function vO(n,e,t,r,i,s){const o=t[Cn],c=o[zr].projection[r.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)Ku(e,n,i,c[l],s);else{let l=c;const u=o[gn];jb(r)&&(l.flags|=128),tT(n,e,l,u,i,s,!0)}}function wO(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function EO(n,e,t){const{mergedAttrs:r,classes:i,styles:s}=t;null!==r&&Jx(n,e,r),null!==i&&wO(n,e,i),null!==s&&function qX(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class SO{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${YP})`}}const oY=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Zu=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(Zu||{});function cT(n){const e=function Ip(){const n=Y();return n&&n[Mu].sanitizer}();return e?e.sanitize(Zu.URL,n)||"":function Cp(n,e){const t=function nY(n){return n instanceof SO&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${YP})`)}return t===e}(n,"URL")?function qa(n){return n instanceof SO?n.changingThisBreaksApplicationSecurity:n}(n):function iT(n){return(n=String(n)).match(oY)?n:"unsafe:"+n}(ut(n))}let LO=(n,e,t)=>null;function gT(n,e,t=!1){return LO(n,e,t)}class CY{}class kO{}class IY{resolveComponentFactory(e){throw function MY(n){const e=Error(`No component factory found for ${Jn(n)}.`);return e.ngComponent=n,e}(e)}}let Vy=(()=>{class e{}return e.NULL=new IY,e})();function DY(){return th(Zt(),Y())}function th(n,e){return new Xa(Si(n,e))}let Xa=(()=>{class e{constructor(r){this.nativeElement=r}}return e.__NG_ELEMENT_ID__=DY,e})();function RY(n){return n instanceof Xa?n.nativeElement:n}class UO{}let NY=(()=>{var n;class e{}return(n=e).\u0275prov=Le({token:n,providedIn:"root",factory:()=>null}),e})();class By{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const LY=new By("17.0.0-next.7"),vT={};function wT(n){return n.ngOriginalError}class fo{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&wT(e);for(;t&&wT(t);)t=wT(t);return t||null}}let zy=(()=>{var n;class e{}return(n=e).__NG_ELEMENT_ID__=FY,n.__NG_ENV_ID__=t=>t,e})();class OY extends zy{constructor(e){super(),this._lView=e}onDestroy(e){return up(this._lView,e),()=>function J_(n,e){if(null===n[za])return;const t=n[za].indexOf(e);-1!==t&&n[za].splice(t,1)}(this._lView,e)}}function FY(){return new OY(Y())}function ET(n){return e=>{setTimeout(n,void 0,e)}}const li=class kY extends Ls{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){let i=e,s=t||(()=>null),o=r;if(e&&"object"==typeof e){const c=e;i=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=ET(s),i&&(i=ET(i)),o&&(o=ET(o)));const a=super.subscribe({next:i,error:s,complete:o});return e instanceof zi&&e.add(a),a}};function zO(...n){}class Ht{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new li(!1),this.onMicrotaskEmpty=new li(!1),this.onStable=new li(!1),this.onError=new li(!1),typeof Zone>"u")throw new pe(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function VY(){const n="function"==typeof cn.requestAnimationFrame;let e=cn[n?"requestAnimationFrame":"setTimeout"],t=cn[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function zY(n){const e=()=>{!function BY(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(cn,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,bT(n),n.isCheckStableRunning=!0,xT(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),bT(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,o,a)=>{if(function GY(n){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0].data?.__ignore_ng_zone__}(a))return t.invokeTask(i,s,o,a);try{return HO(n),t.invokeTask(i,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),GO(n)}},onInvoke:(t,r,i,s,o,a,c)=>{try{return HO(n),t.invoke(i,s,o,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),GO(n)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,bT(n),xT(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ht.isInAngularZone())throw new pe(909,!1)}static assertNotInAngularZone(){if(Ht.isInAngularZone())throw new pe(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,UY,zO,zO);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const UY={};function xT(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function bT(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function HO(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function GO(n){n._nesting--,xT(n)}class HY{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new li,this.onMicrotaskEmpty=new li,this.onStable=new li,this.onError=new li}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}const jO=new Ge("",{providedIn:"root",factory:WO});function WO(){const n=Ae(Ht);let e=!0;return function U9(...n){const e=Xf(n),t=function P9(n,e){return"number"==typeof kx(n)?n.pop():e}(n,1/0),r=n;return r.length?1===r.length?fs(r[0]):Tu(t)(yr(r,e)):to}(new cr(i=>{e=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{i.next(e),i.complete()})}),new cr(i=>{let s;n.runOutsideAngular(()=>{s=n.onStable.subscribe(()=>{Ht.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(e=!0,i.next(!0))})})});const o=n.onUnstable.subscribe(()=>{Ht.assertInAngularZone(),e&&(e=!1,n.runOutsideAngular(()=>{i.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(XP()))}var tl=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(tl||{});function qO(n,e){!e&&function kb(n){if(!ZP()&&!function tq(){return Su}())throw new pe(-203,!1)}();const t=e?.injector??Ae(_s);if(!function Jc(n){return"browser"===(n??Ae(_s)).get(qu)}(t))return{destroy(){}};let r;const i=t.get(zy).onDestroy(()=>r?.()),s=t.get(TT),o=s.handler??=new YO,a=t.get(Ht),c=t.get(fo,null,{optional:!0}),u=new XO(a,c,e?.phase??tl.MixedReadWrite,()=>{r?.(),n()});return r=()=>{o.unregister(u),i()},o.register(u),{destroy:r}}class XO{constructor(e,t,r,i){this.zone=e,this.errorHandler=t,this.phase=r,this.callbackFn=i}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(e){this.errorHandler?.handleError(e)}}}class YO{constructor(){this.executingCallbacks=!1,this.buckets={[tl.EarlyRead]:new Set,[tl.Write]:new Set,[tl.MixedReadWrite]:new Set,[tl.Read]:new Set},this.deferredCallbacks=new Set}validateBegin(){if(this.executingCallbacks)throw new pe(102,!1)}register(e){(this.executingCallbacks?this.deferredCallbacks:this.buckets[e.phase]).add(e)}unregister(e){this.buckets[e.phase].delete(e),this.deferredCallbacks.delete(e)}execute(){this.executingCallbacks=!0;for(const e of Object.values(this.buckets))for(const t of e)t.invoke();this.executingCallbacks=!1;for(const e of this.deferredCallbacks)this.buckets[e.phase].add(e);this.deferredCallbacks.clear()}destroy(){for(const e of Object.values(this.buckets))e.clear();this.deferredCallbacks.clear()}}let TT=(()=>{var n;class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}}return(n=e).\u0275prov=Le({token:n,providedIn:"root",factory:()=>new n}),e})();function Pp(n){for(;n;){n[ht]|=64;const e=bp(n);if(nb(n)&&!e)return n;n=e}return null}const QO=new Ge("",{providedIn:"root",factory:()=>!1});let Gy=null;function t2(n,e){return n[e]??i2()}function n2(n,e){const t=i2();t.producerNode?.length&&(n[e]=Gy,t.lView=n,Gy=r2())}const YY={...rb,consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{Pp(n.lView)},lView:null};function r2(){return Object.create(YY)}function i2(){return Gy??=r2(),Gy}const gt={};function o2(n,e,t,r){if(!r)if(3==(3&e[ht])){const s=n.preOrderCheckHooks;null!==s&&ny(e,s,t)}else{const s=n.preOrderHooks;null!==s&&ry(e,s,0,t)}Kc(t)}function Xe(n,e=Ct.Default){const t=Y();return null===t?De(n,e):hL(Zt(),t,Je(n),e)}function jy(n,e,t,r,i,s,o,a,c,l,u){const h=e.blueprint.slice();return h[bn]=i,h[ht]=140|r,(null!==l||n&&2048&n[ht])&&(h[ht]|=2048),UN(h),h[gn]=h[Iu]=n,h[nn]=t,h[Mu]=o||n&&n[Mu],h[dt]=a||n&&n[dt],h[Hr]=c||n&&n[Hr]||null,h[zr]=s,h[np]=function xX(){return EX++}(),h[so]=u,h[_N]=l,h[Cn]=2==e.type?n[Cn]:h,h}function nh(n,e,t,r,i){let s=n.data[e];if(null===s)s=function ST(n,e,t,r,i){const s=WN(),o=db(),c=n.data[e]=function rK(n,e,t,r,i,s){let o=e?e.injectorIndex:-1,a=0;return function Lu(){return null!==it.skipHydrationRootTNode}()&&(a|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,r,i);return null===n.firstChild&&(n.firstChild=c),null!==s&&(o?null==s.child&&null!==c.parent&&(s.child=c):null===s.next&&(s.next=c,c.prev=s)),c}(n,e,t,r,i),function s7(){return it.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=r,s.attrs=i;const o=function hp(){const n=it.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return lo(s,!0),s}function Np(n,e,t,r){if(0===t)return-1;const i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function c2(n,e,t,r,i){const s=t2(e,rp),o=ci(),a=2&r;try{Kc(-1),a&&e.length>rt&&o2(n,e,rt,!1),ao(a?2:0,i);const l=a?s:null,u=X_(l);try{null!==l&&(l.dirty=!1),t(r,i)}finally{Y_(l,u)}}finally{a&&null===e[rp]&&n2(e,rp),Kc(o),ao(a?3:1,i)}}function AT(n,e,t){if(tb(e)){const r=ms(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{ms(r)}}}function l2(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=IT(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function IT(n,e,t,r,i,s,o,a,c,l,u){const h=rt+r,d=h+i,f=function QY(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:gt);return t}(h,d),p="function"==typeof l?l():l;return f[he]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1,ssrId:u}}let u2=n=>null;function h2(n,e,t,r){for(let i in n)if(n.hasOwnProperty(i)){t=null===t?{}:t;const s=n[i];null===r?d2(t,e,i,s):r.hasOwnProperty(i)&&d2(t,e,r[i],s)}return t}function d2(n,e,t,r){n.hasOwnProperty(t)?n[t].push(e,r):n[t]=[e,r]}function f2(n,e,t,r,i,s){for(let l=0;l<r.length;l++)Tb(sy(t,e),n,r[l].type);!function mK(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,r.length);for(let l=0;l<r.length;l++){const u=r[l];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,c=Np(n,e,r.length,null);for(let l=0;l<r.length;l++){const u=r[l];t.mergedAttrs=Zf(t.mergedAttrs,u.hostAttrs),gK(n,t,e,c,u),pK(c,u,i),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const h=u.type.prototype;!o&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(h.ngOnChanges||h.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),c++}!function iK(n,e,t){const i=e.directiveEnd,s=n.data,o=e.attrs,a=[];let c=null,l=null;for(let u=e.directiveStart;u<i;u++){const h=s[u],d=t?t.get(h):null,p=d?d.outputs:null;c=h2(h.inputs,u,c,d?d.inputs:null),l=h2(h.outputs,u,l,p);const m=null===c||null===o||uN(e)?null:vK(c,u,o);a.push(m)}null!==c&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}(n,t,s)}function p2(n,e,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,o=function a7(){return it.lFrame.currentDirectiveIndex}();try{Kc(s);for(let a=r;a<i;a++){const c=n.data[a],l=e[a];pb(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&hK(c,l)}}finally{Kc(-1),pb(o)}}function hK(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function RT(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function pK(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Us(e)&&(t[""]=n)}}function gK(n,e,t,r,i){n.data[r]=i;const s=i.factory||(i.factory=Xc(i.type)),o=new dp(s,Us(i),Xe);n.blueprint[r]=o,t[r]=o,function cK(n,e,t,r,i){const s=i.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function lK(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,r,s)}}(n,e,r,Np(n,t,i.hostVars,gt),i)}function po(n,e,t,r,i,s){const o=Si(n,e);!function PT(n,e,t,r,i,s,o){if(null==s)n.removeAttribute(e,i,t);else{const a=null==o?ut(s):o(s,r||"",i);n.setAttribute(e,i,a,t)}}(e[dt],o,s,n.value,t,r,i)}function yK(n,e,t,r,i,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;)m2(r,t,o[a++],o[a++],o[a++])}function m2(n,e,t,r,i){const s=ms(null);try{const o=n.inputTransforms;null!==o&&o.hasOwnProperty(r)&&(i=o[r].call(e,i)),null!==n.setInput?n.setInput(e,i,t,r):e[r]=i}finally{ms(s)}}function vK(n,e,t){let r=null,i=0;for(;i<t.length;){const s=t[i];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===r&&(r=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){r.push(s,o[a+1],t[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function _2(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const s=t[r+1];if(-1!==s){const o=n.data[s];gb(t[r]),o.contentQueries(2,e[s],s)}}}function Wy(n,e){return n[ep]?n[gN][Vs]=e:n[ep]=e,n[gN]=e,e}function NT(n,e,t){gb(0);const r=ms(null);try{e(n,t)}finally{ms(r)}}function y2(n){return n[Cu]||(n[Cu]=[])}function v2(n){return n.cleanup||(n.cleanup=[])}function E2(n,e){const t=n[Hr],r=t?t.get(fo,null):null;r&&r.handleError(e)}function LT(n,e,t,r,i){for(let s=0;s<t.length;){const o=t[s++],a=t[s++];m2(n.data[o],e[o],r,a,i)}}function wK(n,e){const t=ji(e,n),r=t[he];!function EK(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(r,t);const i=t[bn];null!==i&&null===t[so]&&(t[so]=gT(i,t[Hr])),OT(r,t,t[nn])}function OT(n,e,t){_b(e);try{const r=n.viewQuery;null!==r&&NT(1,r,t);const i=n.template;null!==i&&c2(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&_2(n,e),n.staticViewQueries&&NT(2,n.viewQuery,t);const s=n.components;null!==s&&function xK(n,e){for(let t=0;t<e.length;t++)wK(n,e[t])}(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[ht]&=-5,yb()}}function $y(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=Ux(i,a):2==s&&(r=Ux(r,a+": "+e[++o]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}function Lp(n,e,t,r,i=!1){for(;null!==t;){const s=e[t.index];null!==s&&r.push(ln(s)),jr(s)&&x2(s,r);const o=t.type;if(8&o)Lp(n,e,t.child,r);else if(32&o){const a=Yb(t,e);let c;for(;c=a();)r.push(c)}else if(16&o){const a=_O(e,t);if(Array.isArray(a))r.push(...a);else{const c=bp(e[Cn]);Lp(c[he],c,a,r,!0)}}t=i?t.projectionNext:t.next}return r}function x2(n,e){for(let t=Mn;t<n.length;t++){const r=n[t],i=r[he].firstChild;null!==i&&Lp(r[he],r,i,e)}n[oo]!==n[bn]&&e.push(n[oo])}function qy(n,e,t,r=!0){const i=e[Mu],s=i.rendererFactory,o=i.afterRenderEventManager;s.begin?.(),o?.begin();try{b2(n,e,n.template,t)}catch(c){throw r&&E2(e,c),c}finally{s.end?.(),i.inlineEffectRunner?.flush(),o?.end()}}function b2(n,e,t,r){const i=e[ht];if(256!=(256&i)){e[Mu].inlineEffectRunner?.flush(),_b(e);try{UN(e),function qN(n){return it.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&c2(n,e,t,2,r);const o=3==(3&i);if(o){const l=n.preOrderCheckHooks;null!==l&&ny(e,l,null)}else{const l=n.preOrderHooks;null!==l&&ry(e,l,0,null),vb(e,0)}if(function TK(n){for(let e=sO(n);null!==e;e=oO(e)){if(!e[yN])continue;const t=e[Ru];for(let r=0;r<t.length;r++){qq(t[r])}}}(e),T2(e,0),null!==n.contentQueries&&_2(n,e),o){const l=n.contentCheckHooks;null!==l&&ny(e,l)}else{const l=n.contentHooks;null!==l&&ry(e,l,1),vb(e,1)}!function KY(n,e){const t=n.hostBindingOpCodes;if(null===t)return;const r=t2(e,ip);try{for(let i=0;i<t.length;i++){const s=t[i];if(s<0)Kc(~s);else{const o=s,a=t[++i],c=t[++i];o7(a,o),r.dirty=!1;const l=X_(r);try{c(2,e[o])}finally{Y_(r,l)}}}}finally{null===e[ip]&&n2(e,ip),Kc(-1)}}(n,e);const a=n.components;null!==a&&A2(e,a,0);const c=n.viewQuery;if(null!==c&&NT(2,c,r),o){const l=n.viewCheckHooks;null!==l&&ny(e,l)}else{const l=n.viewHooks;null!==l&&ry(e,l,2),vb(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[ht]&=-73,BN(e)}finally{yb()}}}function T2(n,e){for(let t=sO(n);null!==t;t=oO(t))for(let r=Mn;r<t.length;r++)S2(t[r],e)}function SK(n,e,t){S2(ji(e,n),t)}function S2(n,e){if(!function Wq(n){return 128==(128&n[ht])}(n))return;const t=n[he],r=n[ht];if(80&r&&0===e||1024&r)b2(t,n,t.template,n[nn]);else if(n[Jf]>0){T2(n,1);const i=t.components;null!==i&&A2(n,i,1)}}function A2(n,e,t){for(let r=0;r<e.length;r++)SK(n,e[r],t)}class Op{get rootNodes(){const e=this._lView,t=e[he];return Lp(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[nn]}set context(e){this._lView[nn]=e}get destroyed(){return 256==(256&this._lView[ht])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[gn];if(jr(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(Tp(e,r),ly(t,r))}this._attachedToViewContainer=!1}Ay(this._lView[he],this._lView)}onDestroy(e){up(this._lView,e)}markForCheck(){Pp(this._cdRefInjectingView||this._lView)}detach(){this._lView[ht]&=-129}reattach(){this._lView[ht]|=128}detectChanges(){qy(this._lView[he],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new pe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function FX(n,e){Ap(n,e,e[dt],2,null,null)}(this._lView[he],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new pe(902,!1);this._appRef=e}}class AK extends Op{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;qy(e[he],e,e[nn],!1)}checkNoChanges(){}get context(){return null}}class C2 extends Vy{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Mt(e);return new Fp(t,this.ngModule)}}function M2(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class MK{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=H_(r);const i=this.injector.get(e,vT,r);return i!==vT||t===vT?i:this.parentInjector.get(e,t,r)}}class Fp extends kO{get inputs(){const e=this.componentDef,t=e.inputTransforms,r=M2(e.inputs);if(null!==t)for(const i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return M2(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function mq(n){return n.map(pq).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,i){let s=(i=i||this.ngModule)instanceof gs?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new MK(e,s):e,a=o.get(UO,null);if(null===a)throw new pe(407,!1);const u={rendererFactory:a,sanitizer:o.get(NY,null),inlineEffectRunner:null,afterRenderEventManager:o.get(TT,null)},h=a.createRenderer(null,this.componentDef),d=this.componentDef.selectors[0][0]||"div",f=r?function ZY(n,e,t,r){const s=r.get(QO,!1)||t===Fs.ShadowDom,o=n.selectRootElement(e,s);return function JY(n){u2(n)}(o),o}(h,r,this.componentDef.encapsulation,o):Sy(h,d,function CK(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(d)),_=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let g=null;null!==f&&(g=gT(f,o,!0));const y=IT(0,null,null,1,0,null,null,null,null,null,null),v=jy(null,y,null,_,null,null,u,h,o,null,g);let w,E;_b(v);try{const b=this.componentDef;let T,S=null;b.findHostDirectiveDefs?(T=[],S=new Map,b.findHostDirectiveDefs(b,T,S),T.push(b)):T=[b];const x=function DK(n,e){const t=n[he],r=rt;return n[r]=e,nh(t,r,2,"#host",null)}(v,f),A=function RK(n,e,t,r,i,s,o){const a=i[he];!function PK(n,e,t,r){for(const i of n)e.mergedAttrs=Zf(e.mergedAttrs,i.hostAttrs);null!==e.mergedAttrs&&($y(e,e.mergedAttrs,!0),null!==t&&EO(r,t,e))}(r,n,e,o);let c=null;null!==e&&(c=gT(e,i[Hr]));const l=s.rendererFactory.createRenderer(e,t);let u=16;t.signals?u=4096:t.onPush&&(u=64);const h=jy(i,l2(t),null,u,i[n.index],n,s,l,null,null,c);return a.firstCreatePass&&RT(a,n,r.length-1),Wy(i,h),i[n.index]=h}(x,f,b,T,v,u,h);E=lp(y,rt),f&&function LK(n,e,t,r){if(r)Jx(n,t,["ng-version",LY.full]);else{const{attrs:i,classes:s}=function gq(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let s=n[r];if("string"==typeof s)2===i?""!==s&&e.push(s,n[++r]):8===i&&t.push(s);else{if(!ks(i))break;i=s}r++}return{attrs:e,classes:t}}(e.selectors[0]);i&&Jx(n,t,i),s&&s.length>0&&wO(n,t,s.join(" "))}}(h,b,f,r),void 0!==t&&function OK(n,e,t){const r=n.projection=[];for(let i=0;i<e.length;i++){const s=t[i];r.push(null!=s?Array.from(s):null)}}(E,this.ngContentSelectors,t),w=function NK(n,e,t,r,i,s){const o=Zt(),a=i[he],c=Si(o,i);f2(a,i,o,t,null,r);for(let u=0;u<t.length;u++)$r(Qc(i,a,o.directiveStart+u,o),i);p2(a,i,o),c&&$r(c,i);const l=Qc(i,a,o.directiveStart+o.componentOffset,o);if(n[nn]=i[nn]=l,null!==s)for(const u of s)u(l,e);return AT(a,o,n),l}(A,b,T,S,v,[FK]),OT(y,v,null)}finally{yb()}return new IK(this.componentType,w,th(E,v),v,E)}}class IK extends CY{constructor(e,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new AK(i),this.componentType=e}setInput(e,t){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const s=this._rootLView;LT(s[he],s,i,e,t),this.previousInputValues.set(e,t),Pp(ji(this._tNode.index,s))}}get injector(){return new Wr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function FK(){const n=Zt();ty(Y()[he],n)}function er(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Qy(n,e,t,r){const i=Y();return er(i,uo(),e)&&(Ot(),po(_n(),i,n,e,t,r)),Qy}function BT(n,e,t,r,i){const o=i?"class":"style";LT(n,t,e.inputs[o],o,r)}function ph(n,e){return!e||jb(n)}function Gp(n,e,t,r=!0){const i=e[he];if(function VX(n,e,t,r){const i=Mn+r,s=t.length;r>0&&(t[i-1][Vs]=e),r<s-Mn?(e[Vs]=t[i],vL(t,Mn+r,e)):(t.push(e),e[Vs]=null),e[gn]=t;const o=e[tp];null!==o&&t!==o&&function UX(n,e){const t=n[Ru];e[Cn]!==e[gn][gn][Cn]&&(n[yN]=!0),null===t?n[Ru]=[e]:t.push(e)}(o,e);const a=e[io];null!==a&&a.insertView(n),e[ht]|=128}(i,e,n,t),r){const s=eT(t,n),o=e[dt],a=Cy(o,n[oo]);null!==a&&function OX(n,e,t,r,i,s){r[bn]=i,r[zr]=e,Ap(n,r,t,1,i,s)}(i,n[zr],o,e,a,s)}}let Hs=(()=>{class e{}return e.__NG_ELEMENT_ID__=KQ,e})();function KQ(){return yF(Zt(),Y())}const QQ=Hs,gF=class extends QQ{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return th(this._hostTNode,this._hostLView)}get injector(){return new Wr(this._hostTNode,this._hostLView)}get parentInjector(){const e=oy(this._hostTNode,this._hostLView);if(Eb(e)){const t=pp(e,this._hostLView),r=fp(e);return new Wr(t[he].data[r+8],t)}return new Wr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=_F(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Mn}createEmbeddedView(e,t,r){let i,s;"number"==typeof r?i=r:null!=r&&(i=r.index,s=r.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,i,ph(this._hostTNode,null)),a}createComponent(e,t,r,i,s){const o=e&&!function mp(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const p=t||{};a=p.index,r=p.injector,i=p.projectableNodes,s=p.environmentInjector||p.ngModuleRef}const c=o?e:new Fp(Mt(e)),l=r||this.parentInjector;if(!s&&null==c.ngModule){const m=(o?l:this.parentInjector).get(gs,null);m&&(s=m)}Mt(c.componentType??{});const f=c.create(l,i,null,s);return this.insertImpl(f.hostView,a,ph(this._hostTNode,null)),f}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,r){const i=e._lView;if(function $q(n){return jr(n[gn])}(i)){const a=this.indexOf(e);if(-1!==a)this.detach(a);else{const c=i[gn],l=new gF(c,c[zr],c[gn]);l.detach(l.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;return Gp(o,i,s,r),e.attachToViewContainerRef(),vL(YT(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=_F(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=Tp(this._lContainer,t);r&&(ly(YT(this._lContainer),t),Ay(r[he],r))}detach(e){const t=this._adjustIndex(e,-1),r=Tp(this._lContainer,t);return r&&null!=ly(YT(this._lContainer),t)?new Op(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function _F(n){return n[8]}function YT(n){return n[8]||(n[8]=[])}function yF(n,e){let t;const r=e[n.index];return jr(r)?t=r:(t=function g2(n,e,t,r){return[n,!0,!1,e,null,0,r,t,null,null,null]}(r,e,null,n),e[n.index]=t,Wy(e,t)),vF(t,e,n,r),new gF(t,n,e)}let vF=function EF(n,e,t,r){if(n[oo])return;let i;i=8&t.type?ln(r):function ZQ(n,e){const t=n[dt],r=t.createComment(""),i=Si(e,n);return el(t,Cy(t,i),r,function GX(n,e){return n.nextSibling(e)}(t,i),!1),r}(e,t),n[oo]=i};function Ka(n,e,t,r){const i=Y(),s=Ot(),o=rt+n,a=i[dt],c=s.firstCreatePass?function $Z(n,e,t,r,i,s){const o=e.consts,c=nh(e,n,2,r,co(o,i));return function DT(n,e,t,r){if(jN()){const i=null===r?null:{"":-1},s=function dK(n,e){const t=n.directiveRegistry;let r=null,i=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(hN(e,o.selectors,!1))if(r||(r=[]),Us(o))if(null!==o.findHostDirectiveDefs){const a=[];i=i||new Map,o.findHostDirectiveDefs(o,a,i),r.unshift(...a,o),RT(n,e,a.length)}else r.unshift(o),RT(n,e,0);else i=i||new Map,o.findHostDirectiveDefs?.(o,r,i),r.push(o)}return null===r?null:[r,i]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&f2(n,e,t,o,i,a),i&&function fK(n,e,t){if(e){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const s=t[e[i+1]];if(null==s)throw new pe(-301,!1);r.push(e[i],s)}}}(t,r,i)}t.mergedAttrs=Zf(t.mergedAttrs,t.attrs)}(e,t,c,co(o,s)),null!==c.attrs&&$y(c,c.attrs,!1),null!==c.mergedAttrs&&$y(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,i,e,t,r):s.data[o],l=UF(s,i,c,a,e,n);i[o]=l;const u=q_(c);return lo(c,!0),EO(a,l,c),32!=(32&c.flags)&&ey()&&My(s,i,l,c),0===function Xq(){return it.lFrame.elementDepthCount}()&&$r(l,i),function Yq(){it.lFrame.elementDepthCount++}(),u&&(function CT(n,e,t){jN()&&(function uK(n,e,t,r){const i=t.directiveStart,s=t.directiveEnd;qc(t)&&function _K(n,e,t){const r=Si(e,n),i=l2(t);let o=16;t.signals?o=4096:t.onPush&&(o=64);const a=Wy(n,jy(n,i,null,o,r,e,null,n[Mu].rendererFactory.createRenderer(r,t),null,null,null));n[e.index]=a}(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||sy(t,e),$r(r,e);const o=t.initialInputs;for(let a=i;a<s;a++){const c=n.data[a],l=Qc(e,n,a,t);$r(l,e),null!==o&&yK(0,a-i,l,c,0,o),Us(c)&&(ji(t.index,e)[nn]=Qc(e,n,a,t))}}(n,e,t,Si(t,e)),64==(64&t.flags)&&p2(n,e,t))}(s,i,c),AT(s,c,i)),null!==r&&function MT(n,e,t=Si){const r=e.localNames;if(null!==r){let i=e.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?t(e,n):n[o];n[i++]=a}}}(i,c),Ka}function il(){let n=Zt();db()?function fb(){it.lFrame.isParent=!1}():(n=n.parent,lo(n,!1));const e=n;(function Qq(n){return it.skipHydrationRootTNode===n})(e)&&function t7(){it.skipHydrationRootTNode=null}(),function Kq(){it.lFrame.elementDepthCount--}();const t=Ot();return t.firstCreatePass&&(ty(t,n),tb(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function _7(n){return 0!=(8&n.flags)}(e)&&BT(t,e,Y(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function y7(n){return 0!=(16&n.flags)}(e)&&BT(t,e,Y(),e.stylesWithoutHost,!1),il}function vh(n,e,t,r){return Ka(n,e,t,r),il(),vh}let UF=(n,e,t,r,i,s)=>(Ga(!0),Sy(r,i,function nL(){return it.lFrame.currentNamespace}()));const Eh="en-US";let $F=Eh;function uv(n){return!!n&&"function"==typeof n.then}function _k(n){return!!n&&"function"==typeof n.subscribe}function Jp(n,e,t,r){const i=Y(),s=Ot(),o=Zt();return function vk(n,e,t,r,i,s,o){const a=q_(r),l=n.firstCreatePass&&v2(n),u=e[nn],h=y2(e);let d=!0;if(3&r.type||o){const m=Si(r,e),_=o?o(m):m,g=h.length,y=o?w=>o(ln(w[r.index])):r.index;let v=null;if(!o&&a&&(v=function YJ(n,e,t,r){const i=n.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const o=i[s];if(o===t&&i[s+1]===r){const a=e[Cu],c=i[s+2];return a.length>c?a[c]:null}"string"==typeof o&&(s+=2)}return null}(n,e,i,r.index)),null!==v)(v.__ngLastListenerFn__||v).__ngNextListenerFn__=s,v.__ngLastListenerFn__=s,d=!1;else{s=Ek(r,e,u,s,!1);const w=t.listen(_,i,s);h.push(s,w),l&&l.push(i,y,g,g+1)}}else s=Ek(r,e,u,s,!1);const f=r.outputs;let p;if(d&&null!==f&&(p=f[i])){const m=p.length;if(m)for(let _=0;_<m;_+=2){const E=e[p[_]][p[_+1]].subscribe(s),b=h.length;h.push(s,E),l&&l.push(i,r.index,b,-(b+1))}}}(s,i,i[dt],o,n,e,r),Jp}function wk(n,e,t,r){try{return ao(6,e,t),!1!==t(r)}catch(i){return E2(n,i),!1}finally{ao(7,e,t)}}function Ek(n,e,t,r,i){return function s(o){if(o===Function)return r;Pp(n.componentOffset>-1?ji(n.index,e):e);let c=wk(e,t,r,o),l=s.__ngNextListenerFn__;for(;l;)c=wk(e,t,l,o)&&c,l=l.__ngNextListenerFn__;return i&&!1===c&&o.preventDefault(),c}}function lS(n,e,t){return uS(n,"",e,"",t),lS}function uS(n,e,t,r,i){const s=Y(),o=function ih(n,e,t,r){return er(n,uo(),t)?e+ut(t)+r:gt}(s,e,t,r);return o!==gt&&function qi(n,e,t,r,i,s,o,a){const c=Si(e,t);let u,l=e.inputs;!a&&null!=l&&(u=l[r])?(LT(n,t,u,r,i),qc(e)&&function oK(n,e){const t=ji(e,n);16&t[ht]||(t[ht]|=64)}(t,e.index)):3&e.type&&(r=function sK(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=o?o(i,e.value||"",r):i,s.setProperty(c,r,i))}(Ot(),_n(),s,n,o,s[dt],i,!1),uS}let zk=(n,e,t,r,i)=>(Ga(!0),function Ty(n,e){return n.createText(e)}(e[dt],r));class ol{}class Zk{}class gS extends ol{constructor(e,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new C2(this);const i=Br(e);this._bootstrapComponents=$i(i.bootstrap),this._r3Injector=kL(e,t,[{provide:ol,useValue:this},{provide:Vy,useValue:this.componentFactoryResolver},...r],Jn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class _S extends Zk{constructor(e){super(),this.moduleType=e}create(e){return new gS(this.moduleType,e,[])}}class Jk extends ol{constructor(e){super(),this.componentFactoryResolver=new C2(this),this.instance=null;const t=new vp([...e.providers,{provide:ol,useValue:this},{provide:Vy,useValue:this.componentFactoryResolver}],e.parent||_y(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function yS(n,e,t=null){return new Jk({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}let vee=(()=>{var n;class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){const i=ML(0,r.type),s=i.length>0?yS([i],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,s)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(const r of this.cachedInjectors.values())null!==r&&r.destroy()}finally{this.cachedInjectors.clear()}}}return(n=e).\u0275prov=Le({token:n,providedIn:"environment",factory:()=>new n(De(gs))}),e})();function eV(n){n.getStandaloneInjector=e=>e.get(vee).getOrCreateStandaloneInjector(n)}function qee(){return this._results[Symbol.iterator]()}class wS{get changes(){return this._changes||(this._changes=new li)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=wS.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=qee)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;const r=function Ai(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function R7(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],s=e[r];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(this._results,r,t))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Zo=(()=>{class e{}return e.__NG_ELEMENT_ID__=Kee,e})();const Xee=Zo,Yee=class extends Xee{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,r){const i=function Hp(n,e,t,r){const i=e.tView,a=jy(n,i,t,4096&n[ht]?4096:16,null,e,null,null,null,r?.injector??null,r?.dehydratedView??null);a[tp]=n[e.index];const l=n[io];return null!==l&&(a[io]=l.createEmbeddedView(i)),OT(i,a,t),a}(this._declarationLView,this._declarationTContainer,e,{injector:t,dehydratedView:r});return new Op(i)}};function Kee(){return fv(Zt(),Y())}function fv(n,e){return 4&n.type?new Yee(e,n,th(n,e)):null}class ES{constructor(e){this.queryList=e,this.matches=null}clone(){return new ES(this.queryList)}setDirty(){this.queryList.setDirty()}}class xS{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let s=0;s<r;s++){const o=t.getByIndex(s);i.push(this.queries[o.indexInDeclarationView].clone())}return new xS(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==vV(e,t).matches&&this.queries[t].setDirty()}}class fV{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class bS{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,s=this.getByIndex(r).embeddedTView(e,i);s&&(s.indexInDeclarationView=r,null!==t?t.push(s):t=[s])}return null!==t?new bS(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class TS{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new TS(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(e,t,Qee(t,s)),this.matchTNodeWithReadOption(e,t,ay(t,e,s,!1,!1))}else r===Zo?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ay(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Xa||i===Hs||i===Zo&&4&t.type)this.addMatch(t.index,-2);else{const s=ay(t,e,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function Qee(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function Jee(n,e,t,r){return-1===t?function Zee(n,e){return 11&n.type?th(n,e):4&n.type?fv(n,e):null}(e,n):-2===t?function ete(n,e,t){return t===Xa?th(e,n):t===Zo?fv(e,n):t===Hs?yF(e,n):void 0}(n,e,r):Qc(n,n[he],t,e)}function pV(n,e,t,r){const i=e[io].queries[r];if(null===i.matches){const s=n.data,o=t.matches,a=[];for(let c=0;c<o.length;c+=2){const l=o[c];a.push(l<0?null:Jee(e,s[l],o[c+1],t.metadata.read))}i.matches=a}return i.matches}function SS(n,e,t,r){const i=n.queries.getByIndex(t),s=i.matches;if(null!==s){const o=pV(n,e,i,t);for(let a=0;a<s.length;a+=2){const c=s[a];if(c>0)r.push(o[a/2]);else{const l=s[a+1],u=e[-c];for(let h=Mn;h<u.length;h++){const d=u[h];d[tp]===d[gn]&&SS(d[he],d,l,r)}if(null!==u[Ru]){const h=u[Ru];for(let d=0;d<h.length;d++){const f=h[d];SS(f[he],f,l,r)}}}}}return r}function AS(n){const e=Y(),t=Ot(),r=YN();gb(r+1);const i=vV(t,r);if(n.dirty&&function jq(n){return 4==(4&n[ht])}(e)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const s=i.crossesNgTemplate?SS(t,e,r,[]):pV(t,e,i,r);n.reset(s,RY),n.notifyOnChanges()}return!0}return!1}function mV(n,e,t){const r=Ot();r.firstCreatePass&&(function yV(n,e,t){null===n.queries&&(n.queries=new bS),n.queries.track(new TS(e,t))}(r,new fV(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function _V(n,e,t){const r=new wS(4==(4&t));(function nK(n,e,t,r){const i=y2(e);i.push(t),n.firstCreatePass&&v2(n).push(r,i.length-1)})(n,e,r,r.destroy),null===e[io]&&(e[io]=new xS),e[io].queries.push(new ES(r))}(r,Y(),e)}function vV(n,e){return n.queries.getByIndex(e)}const PS=new Ge("Application Initializer");let NS=(()=>{var n;class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i}),this.appInits=Ae(PS,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const r=[];for(const s of this.appInits){const o=s();if(uv(o))r.push(o);else if(_k(o)){const a=new Promise((c,l)=>{o.subscribe({complete:c,error:l})});r.push(a)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{i()}).catch(s=>{this.reject(s)}),0===r.length&&i(),this.initialized=!0}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),OV=(()=>{var n;class e{log(r){console.log(r)}warn(r){console.warn(r)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();const Jo=new Ge("LocaleId",{providedIn:"root",factory:()=>Ae(Jo,Ct.Optional|Ct.SkipSelf)||function Tte(){return typeof $localize<"u"&&$localize.locale||Eh}()});let FV=(()=>{var n;class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ps(!1)}add(){this.hasPendingTasks.next(!0);const r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class Cte{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let kV=(()=>{var n;class e{compileModuleSync(r){return new _S(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){const i=this.compileModuleSync(r),o=$i(Br(r).declarations).reduce((a,c)=>{const l=Mt(c);return l&&a.push(new Fp(l)),a},[]);return new Cte(i,o)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const zV=new Ge(""),gv=new Ge("");let VS,FS=(()=>{var n;class e{constructor(r,i,s){this._ngZone=r,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,VS||(function Xte(n){VS=n}(s),s.addToWindow(i)),this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ht.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(r)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,i,s){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==o),r(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:r,timeoutId:o,updateCb:s})}whenStable(r,i,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,i,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(r){this.registry.registerApplication(r,this)}unregisterApplication(r){this.registry.unregisterApplication(r)}findProviders(r,i,s){return[]}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ht),De(kS),De(gv))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})(),kS=(()=>{var n;class e{constructor(){this._applications=new Map}registerApplication(r,i){this._applications.set(r,i)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,i=!0){return VS?.findTestabilityInTree(this,r,i)??null}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})(),Qa=null;const HV=new Ge("AllowMultipleToken"),US=new Ge("PlatformDestroyListeners"),BS=new Ge("appBootstrapListener");class jV{constructor(e,t){this.name=e,this.token=t}}function $V(n,e,t=[]){const r=`Platform: ${e}`,i=new Ge(r);return(s=[])=>{let o=zS();if(!o||o.injector.get(HV,!1)){const a=[...t,...s,{provide:i,useValue:!0}];n?n(a):function Qte(n){if(Qa&&!Qa.get(HV,!1))throw new pe(400,!1);(function GV(){!function Rq(n){IN=n}(()=>{throw new pe(600,!1)})})(),Qa=n;const e=n.get(XV);(function WV(n){n.get(UL,null)?.forEach(t=>t())})(n)}(function qV(n=[],e){return _s.create({name:e,providers:[{provide:Nb,useValue:"platform"},{provide:US,useValue:new Set([()=>Qa=null])},...n]})}(a,r))}return function Jte(n){const e=zS();if(!e)throw new pe(401,!1);return e}()}}function zS(){return Qa?.get(XV)??null}let XV=(()=>{var n;class e{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,i){const s=function ene(n="zone.js",e){return"noop"===n?new HY:"zone.js"===n?new Ht(e):n}(i?.ngZone,function YV(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return s.run(()=>{const o=function yee(n,e,t){return new gS(n,e,t)}(r.moduleType,this.injector,function eU(n){return[{provide:Ht,useFactory:n},{provide:yp,multi:!0,useFactory:()=>{const e=Ae(nne,{optional:!0});return()=>e.initialize()}},{provide:JV,useFactory:tne},{provide:jO,useFactory:WO}]}(()=>s)),a=o.injector.get(fo,null);return s.runOutsideAngular(()=>{const c=s.onError.subscribe({next:l=>{a.handleError(l)}});o.onDestroy(()=>{_v(this._modules,o),c.unsubscribe()})}),function KV(n,e,t){try{const r=t();return uv(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(a,s,()=>{const c=o.injector.get(NS);return c.runInitializers(),c.donePromise.then(()=>(function qF(n){Gi(n,"Expected localeId to be defined"),"string"==typeof n&&($F=n.toLowerCase().replace(/_/g,"-"))}(o.injector.get(Jo,Eh)||Eh),this._moduleDoBootstrap(o),o))})})}bootstrapModule(r,i=[]){const s=QV({},i);return function Yte(n,e,t){const r=new _S(t);return Promise.resolve(r)}(0,0,r).then(o=>this.bootstrapModuleFactory(o,s))}_moduleDoBootstrap(r){const i=r.injector.get(Th);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(s=>i.bootstrap(s));else{if(!r.instance.ngDoBootstrap)throw new pe(-403,!1);r.instance.ngDoBootstrap(i)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new pe(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const r=this._injector.get(US,null);r&&(r.forEach(i=>i()),r.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(n=e).\u0275fac=function(r){return new(r||n)(De(_s))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();function QV(n,e){return Array.isArray(e)?e.reduce(QV,n):{...n,...e}}let Th=(()=>{var n;class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ae(JV),this.zoneIsStable=Ae(jO),this.componentTypes=[],this.components=[],this.isStable=Ae(FV).hasPendingTasks.pipe(Os(r=>r?ot(!1):this.zoneIsStable),function B9(n,e=Fa){return n=n??z9,lr((t,r)=>{let i,s=!0;t.subscribe(ur(r,o=>{const a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}(),XP()),this._injector=Ae(gs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,i){const s=r instanceof kO;if(!this._injector.get(NS).done)throw!s&&function Ba(n){const e=Mt(n)||hr(n)||Mr(n);return null!==e&&e.standalone}(r),new pe(405,!1);let a;a=s?r:this._injector.get(Vy).resolveComponentFactory(r),this.componentTypes.push(a.componentType);const c=function Kte(n){return n.isBoundToModule}(a)?void 0:this._injector.get(ol),u=a.create(_s.NULL,[],i||a.selector,c),h=u.location.nativeElement,d=u.injector.get(zV,null);return d?.registerApplication(h),u.onDestroy(()=>{this.detachView(u.hostView),_v(this.components,u),d?.unregisterApplication(h)}),this._loadComponent(u),u}tick(){if(this._runningTick)throw new pe(101,!1);try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1}}attachView(r){const i=r;this._views.push(i),i.attachToAppRef(this)}detachView(r){const i=r;_v(this._views,i),i.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);const i=this._injector.get(BS,[]);[...this._bootstrapListeners,...i].forEach(s=>s(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>_v(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new pe(406,!1);const r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function _v(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const JV=new Ge("",{providedIn:"root",factory:()=>Ae(fo).handleError.bind(void 0)});function tne(){const n=Ae(Ht),e=Ae(fo);return t=>n.runOutsideAngular(()=>e.handleError(t))}let nne=(()=>{var n;class e{constructor(){this.zone=Ae(Ht),this.applicationRef=Ae(Th)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();let HS=(()=>{class e{}return e.__NG_ELEMENT_ID__=sne,e})();function sne(n){return function one(n,e,t){if(qc(n)&&!t){const r=ji(n.index,e);return new Op(r,r)}return 47&n.type?new Op(e[Cn],e):null}(Zt(),Y(),16==(16&n))}const vne=$V(null,"core",[]);let wne=(()=>{var n;class e{constructor(r){}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Th))},n.\u0275mod=qo({type:n}),n.\u0275inj=no({}),e})(),YS=null;function Sh(){return YS}class Bne{}const Ii=new Ge("DocumentToken");let KS=(()=>{var n;class e{historyGo(r){throw new Error("Not implemented")}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>Ae(Hne),providedIn:"platform"}),e})();const zne=new Ge("Location Initialized");let Hne=(()=>{var n;class e extends KS{constructor(){super(),this._doc=Ae(Ii),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Sh().getBaseHref(this._doc)}onPopState(r){const i=Sh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",r,!1),()=>i.removeEventListener("popstate",r)}onHashChange(r){const i=Sh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",r,!1),()=>i.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,i,s){this._history.pushState(r,i,s)}replaceState(r,i,s){this._history.replaceState(r,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>new n,providedIn:"platform"}),e})();function QS(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function yU(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function ea(n){return n&&"?"!==n[0]?"?"+n:n}let cl=(()=>{var n;class e{historyGo(r){throw new Error("Not implemented")}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>Ae(wU),providedIn:"root"}),e})();const vU=new Ge("appBaseHref");let wU=(()=>{var n;class e extends cl{constructor(r,i){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Ae(Ii).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return QS(this._baseHref,r)}path(r=!1){const i=this._platformLocation.pathname+ea(this._platformLocation.search),s=this._platformLocation.hash;return s&&r?`${i}${s}`:i}pushState(r,i,s,o){const a=this.prepareExternalUrl(s+ea(o));this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){const a=this.prepareExternalUrl(s+ea(o));this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(KS),De(vU,8))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Gne=(()=>{var n;class e extends cl{constructor(r,i){super(),this._platformLocation=r,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}path(r=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(r){const i=QS(this._baseHref,r);return i.length>0?"#"+i:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+ea(o));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+ea(o));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(KS),De(vU,8))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})(),sm=(()=>{var n;class e{constructor(r){this._subject=new li,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;const i=this._locationStrategy.getBaseHref();this._basePath=function $ne(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(yU(EU(i))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,i=""){return this.path()==this.normalize(r+ea(i))}normalize(r){return e.stripTrailingSlash(function Wne(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,EU(r)))}prepareExternalUrl(r){return r&&"/"!==r[0]&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,i="",s=null){this._locationStrategy.pushState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+ea(i)),s)}replaceState(r,i="",s=null){this._locationStrategy.replaceState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+ea(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",i){this._urlChangeListeners.forEach(s=>s(r,i))}subscribe(r,i,s){return this._subject.subscribe({next:r,error:i,complete:s})}}return(n=e).normalizeQueryParams=ea,n.joinWithSlash=QS,n.stripTrailingSlash=yU,n.\u0275fac=function(r){return new(r||n)(De(cl))},n.\u0275prov=Le({token:n,factory:()=>function jne(){return new sm(De(cl))}(),providedIn:"root"}),e})();function EU(n){return n.replace(/\/index.html$/,"")}let FU=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=qo({type:n}),n.\u0275inj=no({}),e})();function VU(n){return"server"===n}let uie=(()=>{var n;class e{}return(n=e).\u0275prov=Le({token:n,providedIn:"root",factory:()=>new hie(De(Ii),window)}),e})();class hie{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function die(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&"function"==typeof n.body.attachShadow){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.supportsScrolling()&&(this.window.history.scrollRestoration=e)}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Fie extends Bne{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class pA extends Fie{static makeCurrent(){!function Une(n){YS||(YS=n)}(new pA)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function kie(){return lm=lm||document.querySelector("base"),lm?lm.getAttribute("href"):null}();return null==t?null:function Vie(n){Ov=Ov||document.createElement("a"),Ov.setAttribute("href",n);const e=Ov.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){lm=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function Dre(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Ov,lm=null,Bie=(()=>{var n;class e{build(){return new XMLHttpRequest}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();const mA=new Ge("EventManagerPlugins");let GU=(()=>{var n;class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new pe(5101,!1);return this._eventNameToPlugin.set(r,i),i}}return(n=e).\u0275fac=function(r){return new(r||n)(De(mA),De(Ht))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();class jU{constructor(e){this._doc=e}}const gA="ng-app-id";let WU=(()=>{var n;class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=VU(o),this.resetHostNodes()}addStyles(r){for(const i of r)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}disableStyles(r){for(const i of r)0===this.changeUsageCount(i,-1)&&this.visitStyleElement(i,$U)}visitStyleElement(r,i){this.styleRef.get(r)?.elements?.forEach(i)}ngOnDestroy(){const r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(const i of this.getAllStyles())this.visitStyleElement(i,s=>s.remove()),this.styleRef.delete(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(const i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(const i of this.hostNodes)this.addStyleToHost(i,r)}collectServerRenderedStyles(){const r=this.doc.head?.querySelectorAll(`style[${gA}="${this.appId}"]`);if(r?.length){const i=new Map;return r.forEach(s=>{null!=s.textContent&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){const s=this.styleRef;if(s.has(r)){const a=s.get(r);return a.usage=qU(a.usage+i),a.usage}const o=qU(i);return s.set(r,{usage:o,elements:[]}),o}getStyleElement(r,i){const s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(gA),o;{const a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(gA,this.appId),a}}addStyleToHost(r,i){const s=this.getStyleElement(r,i);r.appendChild(s);const o=this.styleRef,a=o.get(i);a?(0===a.usage?$U(s):function zie(n){n.disabled=!1}(s),a.elements.push(s)):o.set(i,{elements:[s],usage:1})}resetHostNodes(){const r=this.hostNodes;r.clear(),r.add(this.doc.head)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ii),De(vy),De(BL,8),De(qu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();function $U(n){n.disabled=!0}function qU(n){return n<0?0:n}const _A={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},yA=/%COMP%/g,Wie=new Ge("",{providedIn:"root",factory:()=>!0});function YU(n,e){return e.map(t=>t.replace(yA,n))}let KU=(()=>{var n;class e{constructor(r,i,s,o,a,c,l,u=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.disableStylesOnCompDestroy=o,this.doc=a,this.platformId=c,this.ngZone=l,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=VU(c),this.defaultRenderer=new vA(r,a,l,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Fs.ShadowDom&&(i={...i,encapsulation:Fs.Emulated});const s=this.getOrCreateRenderer(r,i);return s instanceof ZU?s.applyToHost(r):s instanceof wA&&s.applyStyles(),s}getOrCreateRenderer(r,i){const s=this.rendererByCompId;let o=s.get(i.id);if(!o){const a=this.doc,c=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,h=this.disableStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case Fs.Emulated:o=new ZU(l,u,i,this.appId,h,a,c,d);break;case Fs.ShadowDom:return new Yie(l,u,r,i,a,c,this.nonce,d);default:o=new wA(l,u,i,h,a,c,d)}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}}return(n=e).\u0275fac=function(r){return new(r||n)(De(GU),De(WU),De(vy),De(Wie),De(Ii),De(qu),De(Ht),De(BL))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();class vA{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(_A[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(QU(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(QU(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?this.doc.querySelector(e):e;if(!r)throw new pe(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const s=_A[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=_A[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&($a.DashCase|$a.Important)?e.style.setProperty(t,r,i&$a.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&$a.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){if("string"==typeof e&&!(e=Sh().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))&&t.preventDefault()}}}function QU(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Yie extends vA{constructor(e,t,r,i,s,o,a,c){super(e,s,o,c),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const l=YU(i.id,i.styles);for(const u of l){const h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=u,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class wA extends vA{constructor(e,t,r,i,s,o,a){super(e,s,o,a),this.sharedStylesHost=t,this.disableStylesOnCompDestroy=i,this.styles=r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.disableStylesOnCompDestroy&&this.sharedStylesHost.disableStyles(this.styles)}}class ZU extends wA{constructor(e,t,r,i,s,o,a,c){super(e,t,r,s,o,a,c);const l=i+"-"+r.id;this.styles=YU(l,r.styles),this.contentAttr=function $ie(n){return"_ngcontent-%COMP%".replace(yA,n)}(l),this.hostAttr=function qie(n){return"_nghost-%COMP%".replace(yA,n)}(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}let Kie=(()=>{var n;class e extends jU{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ii))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();const JU=["alt","control","meta","shift"],Qie={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Zie={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Jie=(()=>{var n;class e extends jU{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,i,s){const o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Sh().onAndCancel(r,o.domEventName,a))}static parseEventName(r){const i=r.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const o=e._normalizeKey(i.pop());let a="",c=i.indexOf("code");if(c>-1&&(i.splice(c,1),a="code."),JU.forEach(u=>{const h=i.indexOf(u);h>-1&&(i.splice(h,1),a+=u+".")}),a+=o,0!=i.length||0===o.length)return null;const l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(r,i){let s=Qie[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),JU.forEach(a=>{a!==s&&(0,Zie[a])(r)&&(o+=a+".")}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ii))},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();const tB=[{provide:qu,useValue:"browser"},{provide:UL,useValue:function ese(){pA.makeCurrent()},multi:!0},{provide:Ii,useFactory:function nse(){return function uX(n){Ub=n}(document),document},deps:[]}],rse=$V(vne,"browser",tB),ise=new Ge(""),nB=[{provide:gv,useClass:class Uie{addToWindow(e){cn.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new pe(5103,!1);return s},cn.getAllAngularTestabilities=()=>e.getAllTestabilities(),cn.getAllAngularRootElements=()=>e.getAllRootElements(),cn.frameworkStabilizers||(cn.frameworkStabilizers=[]),cn.frameworkStabilizers.push(r=>{const i=cn.getAllAngularTestabilities();let s=i.length,o=!1;const a=function(c){o=o||c,s--,0==s&&r(o)};i.forEach(c=>{c.whenStable(a)})})}findTestabilityInTree(e,t,r){return null==t?null:e.getTestability(t)??(r?Sh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:zV,useClass:FS,deps:[Ht,kS,gv]},{provide:FS,useClass:FS,deps:[Ht,kS,gv]}],rB=[{provide:Nb,useValue:"root"},{provide:fo,useFactory:function tse(){return new fo},deps:[]},{provide:mA,useClass:Kie,multi:!0,deps:[Ii,Ht,qu]},{provide:mA,useClass:Jie,multi:!0,deps:[Ii]},KU,WU,GU,{provide:UO,useExisting:KU},{provide:class fie{},useClass:Bie,deps:[]},[]];let sse=(()=>{var n;class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:vy,useValue:r.appId}]}}}return(n=e).\u0275fac=function(r){return new(r||n)(De(ise,12))},n.\u0275mod=qo({type:n}),n.\u0275inj=no({providers:[...rB,...nB],imports:[FU,wne]}),e})(),EA=(()=>{var n;class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ii))},n.\u0275prov=Le({token:n,factory:function(r){let i=null;return i=r?new r:function ase(){return new EA(De(Ii))}(),i},providedIn:"root"}),e})();typeof window<"u"&&window;const{isArray:fse}=Array,{getPrototypeOf:pse,prototype:mse,keys:gse}=Object;const{isArray:vse}=Array;function bA(...n){const e=Xf(n),t=function R9(n){return Qt(kx(n))?n.pop():void 0}(n),{args:r,keys:i}=function _se(n){if(1===n.length){const e=n[0];if(fse(e))return{args:e,keys:null};if(function yse(n){return n&&"object"==typeof n&&pse(n)===mse}(e)){const t=gse(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}(n);if(0===r.length)return yr([],e);const s=new cr(function bse(n,e,t=Fa){return r=>{aB(e,()=>{const{length:i}=n,s=new Array(i);let o=i,a=i;for(let c=0;c<i;c++)aB(e,()=>{const l=yr(n[c],e);let u=!1;l.subscribe(ur(r,h=>{s[c]=h,u||(u=!0,a--),a||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,e,i?o=>function xse(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}(i,o):Fa));return t?s.pipe(function Ese(n){return tn(e=>function wse(n,e){return vse(e)?n(...e):n(e)}(n,e))}(t)):s}function aB(n,e,t){n?jo(t,n,e):e()}const Fv=Wf(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function TA(...n){return function Tse(){return Tu(1)}()(yr(n,Xf(n)))}function cB(n){return new cr(e=>{fs(n()).subscribe(e)})}function kv(n,e){const t=Qt(n)?n:()=>n,r=i=>i.error(t());return new cr(e?i=>e.schedule(r,0,i):r)}function SA(){return lr((n,e)=>{let t=null;n._refCount++;const r=ur(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}class lB extends cr{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,DP(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new zi;const t=this.getSubject();e.add(this.source.subscribe(ur(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=zi.EMPTY)}return e}refCount(){return SA()(this)}}function Ch(n){return n<=0?()=>to:lr((e,t)=>{let r=0;e.subscribe(ur(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Ja(n,e){return lr((t,r)=>{let i=0;t.subscribe(ur(r,s=>n.call(e,s,i++)&&r.next(s)))})}function Vv(n){return lr((e,t)=>{let r=!1;e.subscribe(ur(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function uB(n=Ase){return lr((e,t)=>{let r=!1;e.subscribe(ur(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function Ase(){return new Fv}function ll(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Ja((i,s)=>n(i,s,r)):Fa,Ch(1),t?Vv(e):uB(()=>new Fv))}function um(n,e){return Qt(e)?Ur(n,e,1):Ur(n,1)}function qr(n,e,t){const r=Qt(n)||e||t?{next:n,error:e,complete:t}:n;return r?lr((i,s)=>{var o;null===(o=r.subscribe)||void 0===o||o.call(r);let a=!0;i.subscribe(ur(s,c=>{var l;null===(l=r.next)||void 0===l||l.call(r,c),s.next(c)},()=>{var c;a=!1,null===(c=r.complete)||void 0===c||c.call(r),s.complete()},c=>{var l;a=!1,null===(l=r.error)||void 0===l||l.call(r,c),s.error(c)},()=>{var c,l;a&&(null===(c=r.unsubscribe)||void 0===c||c.call(r)),null===(l=r.finalize)||void 0===l||l.call(r)}))}):Fa}function Mh(n){return lr((e,t)=>{let s,r=null,i=!1;r=e.subscribe(ur(t,void 0,void 0,o=>{s=fs(n(o,Mh(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function AA(n){return n<=0?()=>to:lr((e,t)=>{let r=[];e.subscribe(ur(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function CA(n){return lr((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const vt="primary",hm=Symbol("RouteTitle");class Pse{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Ih(n){return new Pse(n)}function Nse(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const i={};for(let s=0;s<r.length;s++){const o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function vo(n,e){const t=n?MA(n):void 0,r=e?MA(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!hB(n[i],e[i]))return!1;return!0}function MA(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function hB(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}return n===e}function dB(n){return n.length>0?n[n.length-1]:null}function ec(n){return function dse(n){return!!n&&(n instanceof cr||Qt(n.lift)&&Qt(n.subscribe))}(n)?n:uv(n)?yr(Promise.resolve(n)):ot(n)}const Ose={exact:function mB(n,e,t){if(!ul(n.segments,e.segments)||!Uv(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!mB(n.children[r],e.children[r],t))return!1;return!0},subset:gB},fB={exact:function Fse(n,e){return vo(n,e)},subset:function kse(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>hB(n[t],e[t]))},ignored:()=>!0};function pB(n,e,t){return Ose[t.paths](n.root,e.root,t.matrixParams)&&fB[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function gB(n,e,t){return _B(n,e,e.segments,t)}function _B(n,e,t,r){if(n.segments.length>t.length){const i=n.segments.slice(0,t.length);return!(!ul(i,t)||e.hasChildren()||!Uv(i,t,r))}if(n.segments.length===t.length){if(!ul(n.segments,t)||!Uv(n.segments,t,r))return!1;for(const i in e.children)if(!n.children[i]||!gB(n.children[i],e.children[i],r))return!1;return!0}{const i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(ul(n.segments,i)&&Uv(n.segments,i,r)&&n.children[vt])&&_B(n.children[vt],e,s,r)}}function Uv(n,e,t){return e.every((r,i)=>fB[t](n[i].parameters,r.parameters))}class Dh{constructor(e=new Jt([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ih(this.queryParams)),this._queryParamMap}toString(){return Bse.serialize(this)}}class Jt{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Bv(this)}}class dm{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Ih(this.parameters)),this._parameterMap}toString(){return wB(this)}}function ul(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}let Rh=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>new IA,providedIn:"root"}),e})();class IA{parse(e){const t=new Qse(e);return new Dh(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${fm(e.root,!0)}`,r=function Gse(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(i=>`${zv(t)}=${zv(i)}`).join("&"):`${zv(t)}=${zv(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${r}${"string"==typeof e.fragment?`#${function zse(n){return encodeURI(n)}(e.fragment)}`:""}`}}const Bse=new IA;function Bv(n){return n.segments.map(e=>wB(e)).join("/")}function fm(n,e){if(!n.hasChildren())return Bv(n);if(e){const t=n.children[vt]?fm(n.children[vt],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==vt&&r.push(`${i}:${fm(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function Use(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===vt&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==vt&&(t=t.concat(e(i,r)))}),t}(n,(r,i)=>i===vt?[fm(n.children[vt],!1)]:[`${i}:${fm(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[vt]?`${Bv(n)}/${t[0]}`:`${Bv(n)}/(${t.join("//")})`}}function yB(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zv(n){return yB(n).replace(/%3B/gi,";")}function DA(n){return yB(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Hv(n){return decodeURIComponent(n)}function vB(n){return Hv(n.replace(/\+/g,"%20"))}function wB(n){return`${DA(n.path)}${function Hse(n){return Object.keys(n).map(e=>`;${DA(e)}=${DA(n[e])}`).join("")}(n.parameters)}`}const jse=/^[^\/()?;#]+/;function RA(n){const e=n.match(jse);return e?e[0]:""}const Wse=/^[^\/()?;=#]+/,qse=/^[^=?&#]+/,Yse=/^[^&#]+/;class Qse{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Jt([],{}):new Jt([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[vt]=new Jt(e,t)),r}parseSegment(){const e=RA(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new pe(4009,!1);return this.capture(e),new dm(Hv(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=function $se(n){const e=n.match(Wse);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=RA(this.remaining);i&&(r=i,this.capture(r))}e[Hv(t)]=Hv(r)}parseQueryParam(e){const t=function Xse(n){const e=n.match(qse);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=function Kse(n){const e=n.match(Yse);return e?e[0]:""}(this.remaining);o&&(r=o,this.capture(r))}const i=vB(t),s=vB(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=RA(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new pe(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=vt);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[vt]:new Jt([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new pe(4011,!1)}}function EB(n){return n.segments.length>0?new Jt([],{[vt]:n}):n}function xB(n){const e={};for(const r of Object.keys(n.children)){const s=xB(n.children[r]);if(r===vt&&0===s.segments.length&&s.hasChildren())for(const[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}return function Zse(n){if(1===n.numberOfChildren&&n.children[vt]){const e=n.children[vt];return new Jt(n.segments.concat(e.segments),e.children)}return n}(new Jt(n.segments,e))}function hl(n){return n instanceof Dh}function bB(n){let e;const i=EB(function t(s){const o={};for(const c of s.children){const l=t(c);o[c.outlet]=l}const a=new Jt(s.url,o);return s===n&&(e=a),a}(n.root));return e??i}function TB(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(0===e.length)return PA(i,i,i,t,r);const s=function eoe(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new AB(!0,0,n);let e=0,t=!1;const r=n.reduce((i,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]="string"==typeof l?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===o?(s.split("/").forEach((a,c)=>{0==c&&"."===a||(0==c&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,s]},[]);return new AB(t,e,r)}(e);if(s.toRoot())return PA(i,i,new Jt([],{}),t,r);const o=function toe(n,e,t){if(n.isAbsolute)return new jv(e,!0,0);if(!t)return new jv(e,!1,NaN);if(null===t.parent)return new jv(t,!0,0);const r=Gv(n.commands[0])?0:1;return function noe(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new pe(4005,!1);i=r.segments.length}return new jv(r,!1,i-s)}(t,t.segments.length-1+r,n.numberOfDoubleDots)}(s,i,n),a=o.processChildren?mm(o.segmentGroup,o.index,s.commands):CB(o.segmentGroup,o.index,s.commands);return PA(i,o.segmentGroup,a,t,r)}function Gv(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function pm(n){return"object"==typeof n&&null!=n&&n.outlets}function PA(n,e,t,r,i){let o,s={};r&&Object.entries(r).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:SB(n,e,t);const a=EB(xB(o));return new Dh(a,s,i)}function SB(n,e,t){const r={};return Object.entries(n.children).forEach(([i,s])=>{r[i]=s===e?t:SB(s,e,t)}),new Jt(n.segments,r)}class AB{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Gv(r[0]))throw new pe(4003,!1);const i=r.find(pm);if(i&&i!==dB(r))throw new pe(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class jv{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function CB(n,e,t){if(n||(n=new Jt([],{})),0===n.segments.length&&n.hasChildren())return mm(n,e,t);const r=function ioe(n,e,t){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;const o=n.segments[i],a=t[r];if(pm(a))break;const c=`${a}`,l=r<t.length-1?t[r+1]:null;if(i>0&&void 0===c)break;if(c&&l&&"object"==typeof l&&void 0===l.outlets){if(!IB(c,l,o))return s;r+=2}else{if(!IB(c,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const s=new Jt(n.segments.slice(0,r.pathIndex),{});return s.children[vt]=new Jt(n.segments.slice(r.pathIndex),n.children),mm(s,0,i)}return r.match&&0===i.length?new Jt(n.segments,{}):r.match&&!n.hasChildren()?NA(n,e,t):r.match?mm(n,0,i):NA(n,e,t)}function mm(n,e,t){if(0===t.length)return new Jt(n.segments,{});{const r=function roe(n){return pm(n[0])?n[0].outlets:{[vt]:n}}(t),i={};if(Object.keys(r).some(s=>s!==vt)&&n.children[vt]&&1===n.numberOfChildren&&0===n.children[vt].segments.length){const s=mm(n.children[vt],e,t);return new Jt(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(i[s]=CB(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{void 0===r[s]&&(i[s]=o)}),new Jt(n.segments,i)}}function NA(n,e,t){const r=n.segments.slice(0,e);let i=0;for(;i<t.length;){const s=t[i];if(pm(s)){const c=soe(s.outlets);return new Jt(r,c)}if(0===i&&Gv(t[0])){r.push(new dm(n.segments[e].path,MB(t[0]))),i++;continue}const o=pm(s)?s.outlets[vt]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Gv(a)?(r.push(new dm(o,MB(a))),i+=2):(r.push(new dm(o,{})),i++)}return new Jt(r,{})}function soe(n){const e={};return Object.entries(n).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(e[t]=NA(new Jt([],{}),0,r))}),e}function MB(n){const e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function IB(n,e,t){return n==t.path&&vo(e,t.parameters)}const gm="imperative";class wo{constructor(e,t){this.id=e,this.url=t}}class Wv extends wo{constructor(e,t,r="imperative",i=null){super(e,t),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Eo extends wo{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ph extends wo{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Nh extends wo{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=16}}class $v extends wo{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class DB extends wo{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ooe extends wo{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class aoe extends wo{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class coe extends wo{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class loe extends wo{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class uoe{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class hoe{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class doe{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class foe{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class poe{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class moe{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class RB{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class LA{}class OA{constructor(e){this.url=e}}class goe{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new _m,this.attachRef=null}}let _m=(()=>{var n;class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){const s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){const i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new goe,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class PB{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=FA(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=FA(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=kA(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return kA(e,this._root).map(t=>t.value)}}function FA(n,e){if(n===e.value)return e;for(const t of e.children){const r=FA(n,t);if(r)return r}return null}function kA(n,e){if(n===e.value)return[e];for(const t of e.children){const r=kA(n,t);if(r.length)return r.unshift(e),r}return[]}class Ws{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Lh(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class NB extends PB{constructor(e,t){super(e),this.snapshot=t,UA(this,e)}toString(){return this.snapshot.toString()}}function LB(n,e){const t=function _oe(n,e){const o=new VA([],{},{},"",{},vt,e,null,{});return new FB("",new Ws(o,[]))}(0,e),r=new ps([new dm("",{})]),i=new ps({}),s=new ps({}),o=new ps({}),a=new ps(""),c=new Oh(r,i,o,a,s,vt,e,t.root);return c.snapshot=t.root,new NB(new Ws(c,[]),t)}class Oh{constructor(e,t,r,i,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(tn(l=>l[hm]))??ot(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(tn(e=>Ih(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(tn(e=>Ih(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function OB(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const i=t[r],s=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function yoe(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class VA{get title(){return this.data?.[hm]}constructor(e,t,r,i,s,o,a,c,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ih(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ih(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class FB extends PB{constructor(e,t){super(t),this.url=e,UA(this,t)}toString(){return kB(this._root)}}function UA(n,e){e.value._routerState=n,e.children.forEach(t=>UA(n,t))}function kB(n){const e=n.children.length>0?` { ${n.children.map(kB).join(", ")} } `:"";return`${n.value}${e}`}function BA(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,vo(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),vo(e.params,t.params)||n.paramsSubject.next(t.params),function Lse(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!vo(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.urlSubject.next(t.url),vo(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function zA(n,e){const t=vo(n.params,e.params)&&function Vse(n,e){return ul(n,e)&&n.every((t,r)=>vo(t.parameters,e[r].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||zA(n.parent,e.parent))}let HA=(()=>{var n;class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=vt,this.activateEvents=new li,this.deactivateEvents=new li,this.attachEvents=new li,this.detachEvents=new li,this.parentContexts=Ae(_m),this.location=Ae(Hs),this.changeDetector=Ae(HS),this.environmentInjector=Ae(gs),this.inputBinder=Ae(qv,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){const{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new pe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new pe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new pe(4012,!1);this.location.detach();const r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){const r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new pe(4013,!1);this._activatedRoute=r;const s=this.location,a=r.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,l=new voe(r,c,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275dir=oi({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Yc]}),e})();class voe{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Oh?this.route:e===_m?this.childContexts:this.parent.get(e,t)}}const qv=new Ge("");let VB=(()=>{var n;class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){const{activatedRoute:i}=r,s=bA([i.queryParams,i.params,i.data]).pipe(Os(([o,a,c],l)=>(c={...o,...a,...c},0===l?ot(c):Promise.resolve(c)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(r);const a=function Vne(n){const e=Mt(n);if(!e)return null;const t=new Fp(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}(i.component);if(a)for(const{templateName:c}of a.inputs)r.activatedComponentRef.setInput(c,o[c]);else this.unsubscribeFromRouteData(r)});this.outletDataSubscriptions.set(r,s)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();function ym(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const i=function Eoe(n,e,t){return e.children.map(r=>{for(const i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return ym(n,r,i);return ym(n,r)})}(n,e,t);return new Ws(r,i)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>ym(n,a)),o}}const r=function xoe(n){return new Oh(new ps(n.url),new ps(n.params),new ps(n.queryParams),new ps(n.fragment),new ps(n.data),n.outlet,n.component,n)}(e.value),i=e.children.map(s=>ym(n,s));return new Ws(r,i)}}const GA="ngNavigationCancelingError";function UB(n,e){const{redirectTo:t,navigationBehaviorOptions:r}=hl(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=BB(!1,0,e);return i.url=t,i.navigationBehaviorOptions=r,i}function BB(n,e,t){const r=new Error("NavigationCancelingError: "+(n||""));return r[GA]=!0,r.cancellationCode=e,t&&(r.url=t),r}function zB(n){return n&&n[GA]}let HB=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=Au({type:n,selectors:[["ng-component"]],standalone:!0,features:[eV],decls:1,vars:0,template:function(r,i){1&r&&vh(0,"router-outlet")},dependencies:[HA],encapsulation:2}),e})();function jA(n){const e=n.children&&n.children.map(jA),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==vt&&(t.component=HB),t}function xo(n){return n.outlet||vt}function vm(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class Doe{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),BA(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const i=Lh(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(i===s)if(i.component){const o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Lh(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);if(r&&r.outlet){const o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Lh(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){const i=Lh(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new moe(s.value.snapshot))}),e.children.length&&this.forwardEvent(new foe(e.value.snapshot))}activateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(BA(i),i===s)if(i.component){const o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){const o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),BA(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=vm(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}}class GB{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Xv{constructor(e,t){this.component=e,this.route=t}}function Roe(n,e,t){const r=n._root;return wm(r,e?e._root:null,t,[r.value])}function Fh(n,e){const t=Symbol(),r=e.get(n,t);return r===t?"function"!=typeof n||function X9(n){return null!==V_(n)}(n)?e.get(n):n:r}function wm(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=Lh(e);return n.children.forEach(o=>{(function Noe(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const c=function Loe(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!ul(n.url,e.url);case"pathParamsOrQueryParamsChange":return!ul(n.url,e.url)||!vo(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!zA(n,e)||!vo(n.queryParams,e.queryParams);default:return!zA(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new GB(r)):(s.data=o.data,s._resolvedData=o._resolvedData),wm(n,e,s.component?a?a.children:null:t,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Xv(a.outlet.component,o))}else o&&Em(e,a,i),i.canActivateChecks.push(new GB(r)),wm(n,null,s.component?a?a.children:null:t,r,i)})(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Em(a,t.getContext(o),i)),i}function Em(n,e,t){const r=Lh(n),i=n.value;Object.entries(r).forEach(([s,o])=>{Em(o,i.component?e?e.children.getContext(s):null:e,t)}),t.canDeactivateChecks.push(new Xv(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function xm(n){return"function"==typeof n}function jB(n){return n instanceof Fv||"EmptyError"===n?.name}const Yv=Symbol("INITIAL_VALUE");function kh(){return Os(n=>bA(n.map(e=>e.pipe(Ch(1),function Sse(...n){const e=Xf(n);return lr((t,r)=>{(e?TA(n,t,e):TA(n,t)).subscribe(r)})}(Yv)))).pipe(tn(e=>{for(const t of e)if(!0!==t){if(t===Yv)return Yv;if(!1===t||t instanceof Dh)return t}return!0}),Ja(e=>e!==Yv),Ch(1)))}function WB(n){return function Y8(...n){return CP(n)}(qr(e=>{if(hl(e))throw UB(0,e)}),tn(e=>!0===e))}class WA{constructor(e){this.segmentGroup=e||null}}class $A extends Error{constructor(e){super(),this.urlTree=e}}function Vh(n){return kv(new WA(n))}class eae{constructor(e,t){this.urlSerializer=e,this.urlTree=t}noMatchError(e){return new pe(4002,!1)}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return ot(r);if(i.numberOfChildren>1||!i.children[vt])return kv(new pe(4e3,!1));i=i.children[vt]}}applyRedirectCommands(e,t,r){const i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new $A(i);return i}applyRedirectCreateUrlTree(e,t,r,i){const s=this.createSegmentGroup(e,t.root,r,i);return new Dh(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return Object.entries(e).forEach(([i,s])=>{if("string"==typeof s&&s.startsWith(":")){const a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){const s=this.createSegments(e,t.segments,r,i);let o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,r,i)}),new Jt(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){const i=r[t.path.substring(1)];if(!i)throw new pe(4001,!1);return i}findOrReturn(e,t){let r=0;for(const i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}}const qA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function tae(n,e,t,r,i){const s=XA(n,e,t);return s.matched?(r=function Toe(n,e){return n.providers&&!n._injector&&(n._injector=yS(n.providers,e,`Route: ${n.path}`)),n._injector??e}(e,r),function Qoe(n,e,t,r){const i=e.canMatch;return i&&0!==i.length?ot(i.map(o=>{const a=Fh(o,n);return ec(function Boe(n){return n&&xm(n.canMatch)}(a)?a.canMatch(e,t):n.runInContext(()=>a(e,t)))})).pipe(kh(),WB()):ot(!0)}(r,e,t).pipe(tn(o=>!0===o?s:{...qA}))):ot(s)}function XA(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...qA}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(e.matcher||Nse)(t,n,e);if(!i)return{...qA};const s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});const o=i.consumed.length>0?{...s,...i.consumed[i.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function $B(n,e,t,r){return t.length>0&&function iae(n,e,t){return t.some(r=>Kv(n,e,r)&&xo(r)!==vt)}(n,t,r)?{segmentGroup:new Jt(e,rae(r,new Jt(t,n.children))),slicedSegments:[]}:0===t.length&&function sae(n,e,t){return t.some(r=>Kv(n,e,r))}(n,t,r)?{segmentGroup:new Jt(n.segments,nae(n,0,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Jt(n.segments,n.children),slicedSegments:t}}function nae(n,e,t,r,i){const s={};for(const o of r)if(Kv(n,t,o)&&!i[xo(o)]){const a=new Jt([],{});s[xo(o)]=a}return{...i,...s}}function rae(n,e){const t={};t[vt]=e;for(const r of n)if(""===r.path&&xo(r)!==vt){const i=new Jt([],{});t[xo(r)]=i}return t}function Kv(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}class cae{}class hae{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new eae(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new pe(4002,!1)}recognize(){const e=$B(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(tn(t=>{const r=new VA([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vt,this.rootComponentType,null,{}),i=new Ws(r,t),s=new FB("",i),o=function Jse(n,e,t=null,r=null){return TB(bB(n),e,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,vt).pipe(Mh(r=>{if(r instanceof $A)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof WA?this.noMatchError(r):r}))}inheritParamsAndData(e){const t=e.value,r=OB(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(tn(s=>s instanceof Ws?[s]:[]))}processChildren(e,t,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return yr(i).pipe(um(s=>{const o=r.children[s],a=function Moe(n,e){const t=n.filter(r=>xo(r)===e);return t.push(...n.filter(r=>xo(r)!==e)),t}(t,s);return this.processSegmentGroup(e,a,o,s)}),function Mse(n,e){return lr(function Cse(n,e,t,r,i){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(ur(o,u=>{const h=l++;c=a?n(c,u,h):(a=!0,u),r&&o.next(c)},i&&(()=>{a&&o.next(c),o.complete()})))}}(n,e,arguments.length>=2,!0))}((s,o)=>(s.push(...o),s)),Vv(null),function Ise(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Ja((i,s)=>n(i,s,r)):Fa,AA(1),t?Vv(e):uB(()=>new Fv))}(),Ur(s=>{if(null===s)return Vh(r);const o=qB(s);return function dae(n){n.sort((e,t)=>e.value.outlet===vt?-1:t.value.outlet===vt?1:e.value.outlet.localeCompare(t.value.outlet))}(o),ot(o)}))}processSegment(e,t,r,i,s,o){return yr(t).pipe(um(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Mh(c=>{if(c instanceof WA)return ot(null);throw c}))),ll(a=>!!a),Mh(a=>{if(jB(a))return function aae(n,e,t){return 0===e.length&&!n.children[t]}(r,i,s)?ot(new cae):Vh(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return function oae(n,e,t,r){return!!(xo(n)===r||r!==vt&&Kv(e,t,n))&&("**"===n.path||XA(e,n,t).matched)}(r,i,s,o)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Vh(i):Vh(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){const{matched:a,consumedSegments:c,positionalParamSegments:l,remainingSegments:u}="**"===i.path?XB(s):XA(t,i,s);if(!a)return Vh(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const h=this.applyRedirects.applyRedirectCommands(c,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,h).pipe(Ur(d=>this.processSegment(e,r,t,d.concat(u),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o;return"**"===r.path?(o=ot(XB(i)),t.children={}):o=tae(t,r,i,e),o.pipe(Os(a=>a.matched?this.getChildConfig(e=r._injector??e,r,i).pipe(Os(({routes:c})=>{const l=r._loadedInjector??e,{consumedSegments:u,remainingSegments:h,parameters:d}=a,f=new VA(u,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function pae(n){return n.data||{}}(r),xo(r),r.component??r._loadedComponent??null,r,function mae(n){return n.resolve||{}}(r)),{segmentGroup:p,slicedSegments:m}=$B(t,u,h,c);if(0===m.length&&p.hasChildren())return this.processChildren(l,c,p).pipe(tn(g=>null===g?null:new Ws(f,g)));if(0===c.length&&0===m.length)return ot(new Ws(f,[]));const _=xo(r)===s;return this.processSegment(l,c,p,m,_?vt:s,!0).pipe(tn(g=>new Ws(f,g instanceof Ws?[g]:[])))})):Vh(t)))}getChildConfig(e,t,r){return t.children?ot({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?ot({routes:t._loadedRoutes,injector:t._loadedInjector}):function Koe(n,e,t,r){const i=e.canLoad;return void 0===i||0===i.length?ot(!0):ot(i.map(o=>{const a=Fh(o,n);return ec(function Foe(n){return n&&xm(n.canLoad)}(a)?a.canLoad(e,t):n.runInContext(()=>a(e,t)))})).pipe(kh(),WB())}(e,t,r).pipe(Ur(i=>i?this.configLoader.loadChildren(e,t).pipe(qr(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function Joe(n){return kv(BB(!1,3))}())):ot({routes:[],injector:e})}}function fae(n){const e=n.value.routeConfig;return e&&""===e.path}function qB(n){const e=[],t=new Set;for(const r of n){if(!fae(r)){e.push(r);continue}const i=e.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):e.push(r)}for(const r of t){const i=qB(r.children);e.push(new Ws(r.value,i))}return e.filter(r=>!t.has(r))}function XB(n){return{matched:!0,parameters:n.length>0?dB(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function YB(n){return"string"==typeof n.title||null===n.title}function YA(n){return Os(e=>{const t=n(e);return t?yr(t).pipe(tn(()=>e)):ot(e)})}let KB=(()=>{var n;class e{buildTitle(r){let i,s=r.root;for(;void 0!==s;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===vt);return i}getResolvedTitleForRoute(r){return r.data[hm]}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>Ae(Eae),providedIn:"root"}),e})(),Eae=(()=>{var n;class e extends KB{constructor(r){super(),this.title=r}updateTitle(r){const i=this.buildTitle(r);void 0!==i&&this.title.setTitle(i)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(EA))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const Uh=new Ge("",{providedIn:"root",factory:()=>({})}),Bh=new Ge("ROUTES");let KA=(()=>{var n;class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ae(kV)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return ot(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);const i=ec(r.loadComponent()).pipe(tn(QB),qr(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),CA(()=>{this.componentLoaders.delete(r)})),s=new lB(i,()=>new Ls).pipe(SA());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ot({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const o=function xae(n,e,t,r){return ec(n.loadChildren()).pipe(tn(QB),Ur(i=>i instanceof Zk||Array.isArray(i)?ot(i):yr(e.compileModuleAsync(i))),tn(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,!0):(s=i.create(t).injector,o=s.get(Bh,[],{optional:!0,self:!0}).flat()),{routes:o.map(jA),injector:s}}))}(i,this.compiler,r,this.onLoadEndListener).pipe(CA(()=>{this.childrenLoaders.delete(i)})),a=new lB(o,()=>new Ls).pipe(SA());return this.childrenLoaders.set(i,a),a}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function QB(n){return function bae(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let QA=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>Ae(Tae),providedIn:"root"}),e})(),Tae=(()=>{var n;class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const ZB=new Ge(""),JB=new Ge("");function Sae(n){const e=n.get(JB),t=n.get(Ii);return n.get(Ht).runOutsideAngular(()=>{if(!t.startViewTransition||e.skipNextTransition)return e.skipNextTransition=!1,Promise.resolve();let r;const i=new Promise(s=>{r=s});return t.startViewTransition(()=>(r(),function Aae(n){return new Promise(e=>{qO(e,{injector:n})})}(n))),i})}let Qv=(()=>{var n;class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ls,this.transitionAbortSubject=new Ls,this.configLoader=Ae(KA),this.environmentInjector=Ae(gs),this.urlSerializer=Ae(Rh),this.rootContexts=Ae(_m),this.location=Ae(sm),this.inputBindingEnabled=null!==Ae(qv,{optional:!0}),this.titleStrategy=Ae(KB),this.options=Ae(Uh,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ae(QA),this.createViewTransition=Ae(ZB,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ot(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new hoe(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new uoe(s))}complete(){this.transitions?.complete()}handleNavigationRequest(r){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...r,id:i})}setupNavigations(r,i,s){return this.transitions=new ps({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:gm,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ja(o=>0!==o.id),tn(o=>({...o,extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Os(o=>{this.currentTransition=o;let a=!1,c=!1;return ot(o).pipe(qr(l=>{this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Os(l=>{const u=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!u&&"reload"!==(l.extras.onSameUrlNavigation??r.onSameUrlNavigation)){const d="";return this.events.next(new Nh(l.id,this.urlSerializer.serialize(l.rawUrl),d,0)),l.resolve(null),to}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ot(l).pipe(Os(d=>{const f=this.transitions?.getValue();return this.events.next(new Wv(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?to:Promise.resolve(d)}),function gae(n,e,t,r,i,s){return Ur(o=>function lae(n,e,t,r,i,s,o="emptyOnly"){return new hae(n,e,t,r,i,o,s).recognize()}(n,e,t,r,o.extractedUrl,i,s).pipe(tn(({state:a,tree:c})=>({...o,targetSnapshot:a,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),qr(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:d.urlAfterRedirects};const f=new DB(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(u&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){const{id:d,extractedUrl:f,source:p,restoredState:m,extras:_}=l,g=new Wv(d,this.urlSerializer.serialize(f),p,m);this.events.next(g);const y=LB(0,this.rootComponentType).snapshot;return this.currentTransition=o={...l,targetSnapshot:y,urlAfterRedirects:f,extras:{..._,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=f,ot(o)}{const d="";return this.events.next(new Nh(l.id,this.urlSerializer.serialize(l.extractedUrl),d,1)),l.resolve(null),to}}),qr(l=>{const u=new ooe(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),tn(l=>(this.currentTransition=o={...l,guards:Roe(l.targetSnapshot,l.currentSnapshot,this.rootContexts)},o)),function Hoe(n,e){return Ur(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?ot({...t,guardsResult:!0}):function Goe(n,e,t,r){return yr(n).pipe(Ur(i=>function Yoe(n,e,t,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?ot(s.map(a=>{const c=vm(e)??i,l=Fh(a,c);return ec(function Uoe(n){return n&&xm(n.canDeactivate)}(l)?l.canDeactivate(n,e,t,r):c.runInContext(()=>l(n,e,t,r))).pipe(ll())})).pipe(kh()):ot(!0)}(i.component,i.route,t,e,r)),ll(i=>!0!==i,!0))}(o,r,i,n).pipe(Ur(a=>a&&function Ooe(n){return"boolean"==typeof n}(a)?function joe(n,e,t,r){return yr(e).pipe(um(i=>TA(function $oe(n,e){return null!==n&&e&&e(new doe(n)),ot(!0)}(i.route.parent,r),function Woe(n,e){return null!==n&&e&&e(new poe(n)),ot(!0)}(i.route,r),function Xoe(n,e,t){const r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function Poe(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>cB(()=>ot(o.guards.map(c=>{const l=vm(o.node)??t,u=Fh(c,l);return ec(function Voe(n){return n&&xm(n.canActivateChild)}(u)?u.canActivateChild(r,n):l.runInContext(()=>u(r,n))).pipe(ll())})).pipe(kh())));return ot(s).pipe(kh())}(n,i.path,t),function qoe(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return ot(!0);const i=r.map(s=>cB(()=>{const o=vm(e)??t,a=Fh(s,o);return ec(function koe(n){return n&&xm(n.canActivate)}(a)?a.canActivate(e,n):o.runInContext(()=>a(e,n))).pipe(ll())}));return ot(i).pipe(kh())}(n,i.route,t))),ll(i=>!0!==i,!0))}(r,s,n,e):ot(a)),tn(a=>({...t,guardsResult:a})))})}(this.environmentInjector,l=>this.events.next(l)),qr(l=>{if(o.guardsResult=l.guardsResult,hl(l.guardsResult))throw UB(0,l.guardsResult);const u=new aoe(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(u)}),Ja(l=>!!l.guardsResult||(this.cancelNavigationTransition(l,"",3),!1)),YA(l=>{if(l.guards.canActivateChecks.length)return ot(l).pipe(qr(u=>{const h=new coe(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(h)}),Os(u=>{let h=!1;return ot(u).pipe(function _ae(n,e){return Ur(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return ot(t);let s=0;return yr(i).pipe(um(o=>function yae(n,e,t,r){const i=n.routeConfig,s=n._resolve;return void 0!==i?.title&&!YB(i)&&(s[hm]=i.title),function vae(n,e,t,r){const i=MA(n);if(0===i.length)return ot({});const s={};return yr(i).pipe(Ur(o=>function wae(n,e,t,r){const i=vm(e)??r,s=Fh(n,i);return ec(s.resolve?s.resolve(e,t):i.runInContext(()=>s(e,t)))}(n[o],e,t,r).pipe(ll(),qr(a=>{s[o]=a}))),AA(1),function Dse(n){return tn(()=>n)}(s),Mh(o=>jB(o)?to:kv(o)))}(s,n,e,r).pipe(tn(o=>(n._resolvedData=o,n.data=OB(n,t).resolve,i&&YB(i)&&(n.data[hm]=i.title),null)))}(o.route,r,n,e)),qr(()=>s++),AA(1),Ur(o=>s===i.length?ot(t):to))})}(this.paramsInheritanceStrategy,this.environmentInjector),qr({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(u,"",2)}}))}),qr(u=>{const h=new loe(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(h)}))}),YA(l=>{const u=h=>{const d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(qr(f=>{h.component=f}),tn(()=>{})));for(const f of h.children)d.push(...u(f));return d};return bA(u(l.targetSnapshot.root)).pipe(Vv(),Ch(1))}),YA(()=>this.afterPreactivation()),Os(()=>{const l=this.createViewTransition?.(this.environmentInjector);return l?yr(l).pipe(tn(()=>o)):ot(o)}),tn(l=>{const u=function woe(n,e,t){const r=ym(n,e._root,t?t._root:void 0);return new NB(r,e)}(r.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o={...l,targetRouterState:u},this.currentNavigation.targetRouterState=u,o}),qr(()=>{this.events.next(new LA)}),((n,e,t,r)=>tn(i=>(new Doe(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)))(this.rootContexts,r.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Ch(1),qr({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Eo(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),function Rse(n){return lr((e,t)=>{fs(n).subscribe(ur(t,()=>t.complete(),Cx)),!t.closed&&e.subscribe(t)})}(this.transitionAbortSubject.pipe(qr(l=>{throw l}))),CA(()=>{a||c||this.cancelNavigationTransition(o,"",1),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),Mh(l=>{if(c=!0,zB(l))this.events.next(new Ph(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),function boe(n){return zB(n)&&hl(n.url)}(l)?this.events.next(new OA(l.url)):o.resolve(!1);else{this.events.next(new $v(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(l))}catch(u){o.reject(u)}}return to}))}))}cancelNavigationTransition(r,i,s){const o=new Ph(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function Cae(n){return n!==gm}let Mae=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:()=>Ae(Dae),providedIn:"root"}),e})();class Iae{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let Dae=(()=>{var n;class e extends Iae{}return(n=e).\u0275fac=(()=>{let t;return function(i){return(t||(t=function gL(n){return Wo(()=>{const e=n.prototype.constructor,t=e[$o]||Sb(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const s=i[$o]||Sb(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}(n)))(i||n)}})(),n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Rae=(()=>{var n;class e{constructor(){this.location=Ae(sm),this.urlSerializer=Ae(Rh),this.options=Ae(Uh,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ae(QA),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Dh,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=LB(0,null),this.stateMemento=this.createStateMemento()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}handleNavigationEvent(r,i){if(r instanceof Wv)this.stateMemento=this.createStateMemento();else if(r instanceof Nh)this.rawUrlTree=i.initialUrl;else if(r instanceof DB){if("eager"===this.urlUpdateStrategy&&!i.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof LA?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,"deferred"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Ph&&(3===r.code||2===r.code)?this.restoreHistory(i):r instanceof $v?this.restoreHistory(i,!0):r instanceof Eo&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){const s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){const a={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(s,"",a)}else{const o={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(s,"",o)}}restoreHistory(r,i=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-this.browserPageId;0!==o?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&0===o&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return"computed"===this.canceledNavigationResolution?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var bm=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(bm||{});function e3(n,e){n.events.pipe(Ja(t=>t instanceof Eo||t instanceof Ph||t instanceof $v||t instanceof Nh),tn(t=>t instanceof Eo||t instanceof Nh?bm.COMPLETE:t instanceof Ph&&(0===t.code||1===t.code)?bm.REDIRECTING:bm.FAILED),Ja(t=>t!==bm.REDIRECTING),Ch(1)).subscribe(()=>{e()})}function Pae(n){throw n}const Nae={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Lae={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ki=(()=>{var n;class e{get currentUrlTree(){return this.stateManager.currentUrlTree}get rawUrlTree(){return this.stateManager.rawUrlTree}get events(){return this._events}get routerState(){return this.stateManager.routerState}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Ae(OV),this.stateManager=Ae(Rae),this.options=Ae(Uh,{optional:!0})||{},this.pendingTasks=Ae(FV),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ae(Qv),this.urlSerializer=Ae(Rh),this.location=Ae(sm),this.urlHandlingStrategy=Ae(QA),this._events=new Ls,this.errorHandler=this.options.errorHandler||Pae,this.navigated=!1,this.routeReuseStrategy=Ae(Mae),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ae(Bh,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ae(qv,{optional:!0}),this.eventsSubscription=new zi,this.isNgZoneEnabled=Ae(Ht)instanceof Ht&&Ht.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const r=this.navigationTransitions.events.subscribe(i=>{try{const s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(null!==s&&null!==o)if(this.stateManager.handleNavigationEvent(i,o),i instanceof Ph&&0!==i.code&&1!==i.code)this.navigated=!0;else if(i instanceof Eo)this.navigated=!0;else if(i instanceof OA){const a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),c={skipLocationChange:s.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Cae(s.source)};this.scheduleNavigation(a,gm,null,c,{resolve:s.resolve,reject:s.reject,promise:s.promise})}(function Fae(n){return!(n instanceof LA||n instanceof OA)})(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const r=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),gm,r)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(r=>{const i="popstate"===r.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(r.url,i,r.state)},0)}))}navigateToSyncWithBrowser(r,i,s){const o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){const l={...s};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(o.state=l)}const c=this.parseUrl(r);this.scheduleNavigation(c,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(jA),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){const{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:c,preserveFragment:l}=i,u=l?this.currentUrlTree.fragment:a;let d,h=null;switch(c){case"merge":h={...this.currentUrlTree.queryParams,...o};break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}null!==h&&(h=this.removeEmptyProps(h));try{d=bB(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof r[0]||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return TB(d,r,h,u??null)}navigateByUrl(r,i={skipLocationChange:!1}){const s=hl(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,gm,null,i)}navigate(r,i={skipLocationChange:!1}){return function Oae(n){for(let e=0;e<n.length;e++)if(null==n[e])throw new pe(4008,!1)}(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(s=!0===i?{...Nae}:!1===i?{...Lae}:i,hl(r))return pB(this.currentUrlTree,r,s);const o=this.parseUrl(r);return pB(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.keys(r).reduce((i,s)=>{const o=r[s];return null!=o&&(i[s]=o),i},{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let c,l,u;a?(c=a.resolve,l=a.reject,u=a.promise):u=new Promise((d,f)=>{c=d,l=f});const h=this.pendingTasks.add();return e3(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:c,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(d=>Promise.reject(d))}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class t3{}let Uae=(()=>{var n;class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Ja(r=>r instanceof Eo),um(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){const s=[];for(const o of i){o.providers&&!o._injector&&(o._injector=yS(o.providers,r,`Route: ${o.path}`));const a=o._injector??r,c=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(c,o.children??o._loadedRoutes))}return yr(s).pipe(Tu())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;s=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(r,i):ot(null);const o=s.pipe(Ur(a=>null===a?ot(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));return i.loadComponent&&!i._loadedComponent?yr([o,this.loader.loadComponent(i)]).pipe(Tu()):o})}}return(n=e).\u0275fac=function(r){return new(r||n)(De(Ki),De(kV),De(gs),De(t3),De(KA))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const JA=new Ge("");let n3=(()=>{var n;class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Wv?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof Eo?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Nh&&0===r.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof RB&&(r.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(r.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new RB(r,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(n=e).\u0275fac=function(r){!function a2(){throw new Error("invalid")}()},n.\u0275prov=Le({token:n,factory:n.\u0275fac}),e})();function bo(n,e){return{\u0275kind:n,\u0275providers:e}}function i3(){const n=Ae(_s);return e=>{const t=n.get(Th);if(e!==t.components[0])return;const r=n.get(Ki),i=n.get(s3);1===n.get(eC)&&r.initialNavigation(),n.get(o3,null,Ct.Optional)?.setUpPreloading(),n.get(JA,null,Ct.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const s3=new Ge("",{factory:()=>new Ls}),eC=new Ge("",{providedIn:"root",factory:()=>1}),o3=new Ge("");function Gae(n){return bo(0,[{provide:o3,useExisting:Uae},{provide:t3,useExisting:n}])}function Wae(n){return bo(9,[{provide:ZB,useValue:Sae},{provide:JB,useValue:{skipNextTransition:!!n?.skipInitialTransition}}])}const a3=new Ge("ROUTER_FORROOT_GUARD"),$ae=[sm,{provide:Rh,useClass:IA},Ki,_m,{provide:Oh,useFactory:function r3(n){return n.routerState.root},deps:[Ki]},KA,[]];function qae(){return new jV("Router",Ki)}let c3=(()=>{var n;class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[$ae,[],{provide:Bh,multi:!0,useValue:r},{provide:a3,useFactory:Qae,deps:[[Ki,new hy,new dy]]},{provide:Uh,useValue:i||{}},i?.useHash?{provide:cl,useClass:Gne}:{provide:cl,useClass:wU},{provide:JA,useFactory:()=>{const n=Ae(uie),e=Ae(Ht),t=Ae(Uh),r=Ae(Qv),i=Ae(Rh);return t.scrollOffset&&n.setOffset(t.scrollOffset),new n3(i,r,n,e,t)}},i?.preloadingStrategy?Gae(i.preloadingStrategy).\u0275providers:[],{provide:jV,multi:!0,useFactory:qae},i?.initialNavigation?Zae(i):[],i?.bindToComponentInputs?bo(8,[VB,{provide:qv,useExisting:VB}]).\u0275providers:[],i?.enableViewTransitions?Wae().\u0275providers:[],[{provide:l3,useFactory:i3},{provide:BS,multi:!0,useExisting:l3}]]}}static forChild(r){return{ngModule:e,providers:[{provide:Bh,multi:!0,useValue:r}]}}}return(n=e).\u0275fac=function(r){return new(r||n)(De(a3,8))},n.\u0275mod=qo({type:n}),n.\u0275inj=no({}),e})();function Qae(n){return"guarded"}function Zae(n){return["disabled"===n.initialNavigation?bo(3,[{provide:PS,multi:!0,useFactory:()=>{const e=Ae(Ki);return()=>{e.setUpLocationChangeListener()}}},{provide:eC,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?bo(2,[{provide:eC,useValue:0},{provide:PS,multi:!0,deps:[_s],useFactory:e=>{const t=e.get(zne,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const i=e.get(Ki),s=e.get(s3);e3(i,()=>{r(!0)}),e.get(Qv).afterPreactivation=()=>(r(!0),s.closed?ot(void 0):s),i.initialNavigation()}))}}]).\u0275providers:[]]}const l3=new Ge(""),ece={apiKey:"AIzaSyAZtsaXYC5VSw1qssHszoLzOjgtDEM_kIc",authDomain:"art-3d-exhibit.firebaseapp.com",projectId:"art-3d-exhibit",storageBucket:"art-3d-exhibit.appspot.com",messagingSenderId:"652122924025",appId:"1:652122924025:web:8753742d36068d00149328"};function u3(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function Pe(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){u3(s,r,i,o,a,"next",c)}function a(c){u3(s,r,i,o,a,"throw",c)}o(void 0)})}}const h3=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=63&i|128):55296==(64512&i)&&r+1<n.length&&56320==(64512&n.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&n.charCodeAt(++r)),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=63&i|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=63&i|128)}return e},d3={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0;let d=(15&a)<<2|l>>6,f=63&l;c||(f=64,o||(d=64)),r.push(t[s>>2],t[(3&s)<<4|a>>4],t[d],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(h3(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const c=((7&i)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(1023&c))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,null==s||null==a||null==l||null==h)throw new ice;r.push(s<<2|a>>4),64!==l&&(r.push(a<<4&240|l>>2),64!==h&&r.push(l<<6&192|h))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class ice extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Zv=function(n){return function(n){const e=h3(n);return d3.encodeByteArray(e,!0)}(n).replace(/\./g,"")},Jv=()=>{try{return function ace(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&function(n){try{return d3.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},p3=()=>{var n;return null===(n=Jv())||void 0===n?void 0:n.config};class m3{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}class zh extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,zh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,g3.prototype.create)}}class g3{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?function yce(n,e){return n.replace(vce,(t,r)=>{const i=e[r];return null!=i?String(i):`<${r}?>`})}(s,r):"Error";return new zh(i,`${this.serviceName}: ${o} (${i}).`,r)}}const vce=/\{\$([^}]+)}/g;function rC(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(y3(s)&&y3(o)){if(!rC(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function y3(n){return null!==n&&"object"==typeof n}function Tm(n){return n&&n._delegate?n._delegate:n}class Sm{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const dl="[DEFAULT]";class Cce{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new m3;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function Ice(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:dl})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=dl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return Pe(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=dl){return this.instances.has(e)}getOptions(e=dl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(s)&&o.resolve(i);return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(i))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===dl?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var n;return r||null}normalizeInstanceIdentifier(e=dl){return this.component?this.component.multipleInstances?e:dl:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Dce{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Cce(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const oC=[];var Bt=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(Bt||{});const v3={debug:Bt.DEBUG,verbose:Bt.VERBOSE,info:Bt.INFO,warn:Bt.WARN,error:Bt.ERROR,silent:Bt.SILENT},Rce=Bt.INFO,Pce={[Bt.DEBUG]:"log",[Bt.VERBOSE]:"log",[Bt.INFO]:"info",[Bt.WARN]:"warn",[Bt.ERROR]:"error"},Nce=(n,e,...t)=>{if(e<n.logLevel)return;const r=(new Date).toISOString(),i=Pce[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${n.name}:`,...t)};class w3{constructor(e){this.name=e,this._logLevel=Rce,this._logHandler=Nce,this._userLogHandler=null,oC.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Bt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?v3[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Bt.DEBUG,...e),this._logHandler(this,Bt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Bt.VERBOSE,...e),this._logHandler(this,Bt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Bt.INFO,...e),this._logHandler(this,Bt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Bt.WARN,...e),this._logHandler(this,Bt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Bt.ERROR,...e),this._logHandler(this,Bt.ERROR,...e)}}const Lce=(n,e)=>e.some(t=>n instanceof t);let E3,x3;const b3=new WeakMap,aC=new WeakMap,T3=new WeakMap,cC=new WeakMap,lC=new WeakMap;let uC={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return aC.get(n);if("objectStoreNames"===e)return n.objectStoreNames||T3.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return tc(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function zce(n){return"function"==typeof n?function Bce(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Fce(){return x3||(x3=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(hC(this),e),tc(b3.get(this))}:function(...e){return tc(n.apply(hC(this),e))}:function(e,...t){const r=n.call(hC(this),e,...t);return T3.set(r,e.sort?e.sort():[e]),tc(r)}}(n):(n instanceof IDBTransaction&&function Vce(n){if(aC.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});aC.set(n,e)}(n),Lce(n,function Oce(){return E3||(E3=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,uC):n)}function tc(n){if(n instanceof IDBRequest)return function kce(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(tc(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&b3.set(t,n)}).catch(()=>{}),lC.set(e,n),e}(n);if(cC.has(n))return cC.get(n);const e=zce(n);return e!==n&&(cC.set(n,e),lC.set(e,n)),e}const hC=n=>lC.get(n),Gce=["get","getKey","getAll","getAllKeys","count"],jce=["put","add","delete","clear"],dC=new Map;function S3(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(dC.get(e))return dC.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=jce.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Gce.includes(t))return;const s=function(){var o=Pe(function*(a,...c){const l=this.transaction(a,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(c.shift())),(yield Promise.all([u[t](...c),i&&l.done]))[0]});return function(c){return o.apply(this,arguments)}}();return dC.set(e,s),s}!function Uce(n){uC=n(uC)}(n=>({...n,get:(e,t,r)=>S3(e,t)||n.get(e,t,r),has:(e,t)=>!!S3(e,t)||n.has(e,t)}));class Wce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function $ce(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const fC="@firebase/app",fl=new w3("@firebase/app"),n0="[DEFAULT]",yle={[fC]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},pl=new Map,r0=new Map;function vle(n,e){try{n.container.addComponent(e)}catch(t){fl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function s0(n){const e=n.name;if(r0.has(e))return fl.debug(`There were multiple attempts to register component ${e}.`),!1;r0.set(e,n);for(const t of pl.values())vle(t,n);return!0}const ra=new g3("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Ele{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Sm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ra.create("app-deleted",{appName:this._name})}}function M3(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:n0,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw ra.create("bad-app-name",{appName:String(i)});if(t||(t=p3()),!t)throw ra.create("no-options");const s=pl.get(i);if(s){if(rC(t,s.options)&&rC(r,s.config))return s;throw ra.create("duplicate-app",{appName:i})}const o=new Dce(i);for(const c of r0.values())o.addComponent(c);const a=new Ele(t,r,o);return pl.set(i,a),a}function Hh(n,e,t){var r;let i=null!==(r=yle[n])&&void 0!==r?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];return s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void fl.warn(a.join(" "))}s0(new Sm(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Tle="firebase-heartbeat-database",Sle=1,Am="firebase-heartbeat-store";let mC=null;function I3(){return mC||(mC=function Hce(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=tc(o);return r&&o.addEventListener("upgradeneeded",c=>{r(tc(o.result),c.oldVersion,c.newVersion,tc(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}(Tle,Sle,{upgrade:(n,e)=>{0===e&&n.createObjectStore(Am)}}).catch(n=>{throw ra.create("idb-open",{originalErrorMessage:n.message})})),mC}function gC(){return(gC=Pe(function*(n){try{return yield(yield I3()).transaction(Am).objectStore(Am).get(R3(n))}catch(e){if(e instanceof zh)fl.warn(e.message);else{const t=ra.create("idb-get",{originalErrorMessage:e?.message});fl.warn(t.message)}}})).apply(this,arguments)}function D3(n,e){return _C.apply(this,arguments)}function _C(){return(_C=Pe(function*(n,e){try{const r=(yield I3()).transaction(Am,"readwrite");yield r.objectStore(Am).put(e,R3(n)),yield r.done}catch(t){if(t instanceof zh)fl.warn(t.message);else{const r=ra.create("idb-set",{originalErrorMessage:t?.message});fl.warn(r.message)}}})).apply(this,arguments)}function R3(n){return`${n.name}!${n.options.appId}`}class Ile{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Rle(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return Pe(function*(){const r=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=P3();if(null===e._heartbeatsCache&&(e._heartbeatsCache=yield e._heartbeatsCachePromise),e._heartbeatsCache.lastSentHeartbeatDate!==i&&!e._heartbeatsCache.heartbeats.some(s=>s.date===i))return e._heartbeatsCache.heartbeats.push({date:i,agent:r}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(s=>{const o=new Date(s.date).valueOf();return Date.now()-o<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return Pe(function*(){if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null===e._heartbeatsCache||0===e._heartbeatsCache.heartbeats.length)return"";const t=P3(),{heartbeatsToSend:r,unsentEntries:i}=function Dle(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),N3(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),N3(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),s=Zv(JSON.stringify({version:2,heartbeats:r}));return e._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(e._heartbeatsCache.heartbeats=i,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),s})()}}function P3(){return(new Date).toISOString().substring(0,10)}class Rle{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return Pe(function*(){return!!function mce(){try{return"object"==typeof indexedDB}catch{return!1}}()&&function gce(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e((null===(s=i.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return Pe(function*(){return(yield e._canUseIndexedDBPromise)&&(yield function Ale(n){return gC.apply(this,arguments)}(e.app))||{heartbeats:[]}})()}overwrite(e){var t=this;return Pe(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return D3(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return Pe(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return D3(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function N3(n){return Zv(JSON.stringify({version:2,heartbeats:n})).length}!function Ple(n){s0(new Sm("platform-logger",e=>new Wce(e),"PRIVATE")),s0(new Sm("heartbeat",e=>new Ile(e),"PRIVATE")),Hh(fC,"0.9.19",n),Hh(fC,"0.9.19","esm2017"),Hh("fire-js","")}(""),Hh("firebase","10.4.0","app");var Ce,Ole=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$s={},yC=yC||{},ft=Ole||self;function o0(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Cm(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var vC="closure_uid_"+(1e9*Math.random()>>>0),kle=0;function Vle(n,e,t){return n.call.apply(n.bind,arguments)}function Ule(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Xr(n,e,t){return(Xr=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Vle:Ule).apply(null,arguments)}function a0(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function vr(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function nc(){this.s=this.s,this.o=this.o}nc.prototype.s=!1,nc.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Fle(n){Object.prototype.hasOwnProperty.call(n,vC)&&n[vC]||(n[vC]=++kle)}(this)},nc.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const L3=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function wC(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function O3(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(o0(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Yr(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Yr.prototype.h=function(){this.defaultPrevented=!0};var zle=function(){if(!ft.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{ft.addEventListener("test",()=>{},e),ft.removeEventListener("test",()=>{},e)}catch{}return n}();function Mm(n){return/^[\s\xa0]*$/.test(n)}function c0(){var n=ft.navigator;return n&&(n=n.userAgent)?n:""}function To(n){return-1!=c0().indexOf(n)}function EC(n){return EC[" "](n),n}EC[" "]=function(){};var bC,n,Gle=To("Opera"),Gh=To("Trident")||To("MSIE"),F3=To("Edge"),xC=F3||Gh,k3=To("Gecko")&&!(-1!=c0().toLowerCase().indexOf("webkit")&&!To("Edge"))&&!(To("Trident")||To("MSIE"))&&!To("Edge"),jle=-1!=c0().toLowerCase().indexOf("webkit")&&!To("Edge");function V3(){var n=ft.document;return n?n.documentMode:void 0}e:{var TC="",SC=(n=c0(),k3?/rv:([^\);]+)(\)|;)/.exec(n):F3?/Edge\/([\d\.]+)/.exec(n):Gh?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):jle?/WebKit\/(\S+)/.exec(n):Gle?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(SC&&(TC=SC?SC[1]:""),Gh){var AC=V3();if(null!=AC&&AC>parseFloat(TC)){bC=String(AC);break e}}bC=TC}var Wle=ft.document&&Gh&&(V3()||parseInt(bC,10))||void 0;function Im(n,e){if(Yr.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(k3){e:{try{EC(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:$le[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Im.$.h.call(this)}}vr(Im,Yr);var $le={2:"touch",3:"pen",4:"mouse"};Im.prototype.h=function(){Im.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Dm="closure_listenable_"+(1e6*Math.random()|0),qle=0;function Xle(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++qle,this.fa=this.ia=!1}function l0(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function MC(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function B3(n){const e={};for(const t in n)e[t]=n[t];return e}const z3="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function H3(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<z3.length;s++)t=z3[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function u0(n){this.src=n,this.g={},this.h=0}function IC(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=L3(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(l0(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function DC(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}u0.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=DC(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Xle(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var RC="closure_lm_"+(1e6*Math.random()|0),PC={};function G3(n,e,t,r,i){if(r&&r.once)return W3(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)G3(n,e[s],t,r,i);return null}return t=FC(t),n&&n[Dm]?n.O(e,t,Cm(r)?!!r.capture:!!r,i):j3(n,e,t,!1,r,i)}function j3(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Cm(i)?!!i.capture:!!i,a=LC(n);if(a||(n[RC]=a=new u0(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function Kle(){const e=Qle;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)zle||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(q3(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function W3(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)W3(n,e[s],t,r,i);return null}return t=FC(t),n&&n[Dm]?n.P(e,t,Cm(r)?!!r.capture:!!r,i):j3(n,e,t,!0,r,i)}function $3(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)$3(n,e[s],t,r,i);else r=Cm(r)?!!r.capture:!!r,t=FC(t),n&&n[Dm]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=DC(s=n.g[e],t,r,i))&&(l0(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=LC(n))&&(e=n.g[e.toString()],n=-1,e&&(n=DC(e,t,r,i)),(t=-1<n?e[n]:null)&&NC(t))}function NC(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[Dm])IC(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(q3(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=LC(e))?(IC(t,n),0==t.h&&(t.src=null,e[RC]=null)):l0(n)}}}function q3(n){return n in PC?PC[n]:PC[n]="on"+n}function Qle(n,e){if(n.fa)n=!0;else{e=new Im(e,this);var t=n.listener,r=n.la||n.src;n.ia&&NC(n),n=t.call(r,e)}return n}function LC(n){return(n=n[RC])instanceof u0?n:null}var OC="__closure_events_fn_"+(1e9*Math.random()>>>0);function FC(n){return"function"==typeof n?n:(n[OC]||(n[OC]=function(e){return n.handleEvent(e)}),n[OC])}function wr(){nc.call(this),this.i=new u0(this),this.S=this,this.J=null}function Dr(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Yr(e,n);else if(e instanceof Yr)e.target=e.target||n;else{var i=e;H3(e=new Yr(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=h0(o,r,!0,e)&&i}if(i=h0(o=e.g=n,r,!0,e)&&i,i=h0(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=h0(o=e.g=t[s],r,!1,e)&&i}function h0(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&IC(n.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}vr(wr,nc),wr.prototype[Dm]=!0,wr.prototype.removeEventListener=function(n,e,t,r){$3(this,n,e,t,r)},wr.prototype.N=function(){if(wr.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)l0(t[r]);delete n.g[e],n.h--}}this.J=null},wr.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},wr.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var kC=ft.JSON.stringify;function Jle(){var n=VC;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var X3=new class Zle{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new tue,n=>n.reset());class tue{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function nue(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function rue(n){ft.setTimeout(()=>{throw n},0)}let Rm,Pm=!1,VC=new class eue{constructor(){this.h=this.g=null}add(e,t){const r=X3.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Y3=()=>{const n=ft.Promise.resolve(void 0);Rm=()=>{n.then(iue)}};var iue=()=>{for(var n;n=Jle();){try{n.h.call(n.g)}catch(t){rue(t)}var e=X3;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Pm=!1};function d0(n,e){wr.call(this),this.h=n||1,this.g=e||ft,this.j=Xr(this.qb,this),this.l=Date.now()}function UC(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function BC(n,e,t){if("function"==typeof n)t&&(n=Xr(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Xr(n.handleEvent,n)}return 2147483647<Number(e)?-1:ft.setTimeout(n,e||0)}function K3(n){n.g=BC(()=>{n.g=null,n.i&&(n.i=!1,K3(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}vr(d0,wr),(Ce=d0.prototype).ga=!1,Ce.T=null,Ce.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Dr(this,"tick"),this.ga&&(UC(this),this.start()))}},Ce.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ce.N=function(){d0.$.N.call(this),UC(this),delete this.g};class sue extends nc{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:K3(this)}N(){super.N(),this.g&&(ft.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Nm(n){nc.call(this),this.h=n,this.g={}}vr(Nm,nc);var Q3=[];function Z3(n,e,t,r){Array.isArray(t)||(t&&(Q3[0]=t.toString()),t=Q3);for(var i=0;i<t.length;i++){var s=G3(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function J3(n){MC(n.g,function(e,t){this.g.hasOwnProperty(t)&&NC(e)},n),n.g={}}function f0(){this.g=!0}function jh(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function lue(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return kC(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Nm.prototype.N=function(){Nm.$.N.call(this),J3(this)},Nm.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},f0.prototype.Ea=function(){this.g=!1},f0.prototype.info=function(){};var ml={},ez=null;function p0(){return ez=ez||new wr}function tz(n){Yr.call(this,ml.Ta,n)}function Lm(n){const e=p0();Dr(e,new tz(e))}function nz(n,e){Yr.call(this,ml.STAT_EVENT,n),this.stat=e}function pi(n){const e=p0();Dr(e,new nz(e,n))}function rz(n,e){Yr.call(this,ml.Ua,n),this.size=e}function Om(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return ft.setTimeout(function(){n()},e)}ml.Ta="serverreachability",vr(tz,Yr),ml.STAT_EVENT="statevent",vr(nz,Yr),ml.Ua="timingevent",vr(rz,Yr);var m0={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},iz={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function zC(){}function oz(){}zC.prototype.h=null;var jC,Fm={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function HC(){Yr.call(this,"d")}function GC(){Yr.call(this,"c")}function g0(){}function km(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Nm(this),this.P=uue,this.V=new d0(n=xC?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new az}function az(){this.i=null,this.g="",this.h=!1}vr(HC,Yr),vr(GC,Yr),vr(g0,zC),g0.prototype.g=function(){return new XMLHttpRequest},g0.prototype.i=function(){return{}},jC=new g0;var uue=45e3,WC={},_0={};function $C(n,e,t){n.L=1,n.v=E0(ia(e)),n.s=t,n.S=!0,cz(n,null)}function cz(n,e){n.G=Date.now(),Vm(n),n.A=ia(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),yz(t.i,"t",r),n.C=0,t=n.l.J,n.h=new az,n.g=Hz(n.l,t?e:null,!n.s),0<n.O&&(n.M=new sue(Xr(n.Pa,n,n.g),n.O)),Z3(n.U,n.g,"readystatechange",n.nb),e=n.I?B3(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),Lm(),function oue(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function lz(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function uz(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=hue(n,t),i==_0){4==e&&(n.o=4,pi(14),r=!1),jh(n.j,n.m,null,"[Incomplete Response]");break}if(i==WC){n.o=4,pi(15),jh(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}jh(n.j,n.m,i,null),qC(n,i)}lz(n)&&i!=_0&&i!=WC&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,pi(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),eM(e),e.M=!0,pi(11))):(jh(n.j,n.m,t,"[Invalid Chunked Response]"),gl(n),Um(n))}function hue(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?_0:(t=Number(e.substring(t,r)),isNaN(t)?WC:(r+=1)+t>e.length?_0:(e=e.slice(r,r+t),n.C=r+t,e))}function Vm(n){n.Y=Date.now()+n.P,hz(n,n.P)}function hz(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Om(Xr(n.lb,n),e)}function y0(n){n.B&&(ft.clearTimeout(n.B),n.B=null)}function Um(n){0==n.l.H||n.J||Vz(n.l,n)}function gl(n){y0(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,UC(n.V),J3(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function qC(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||XC(t.i,n)))if(!n.K&&XC(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;C0(t),S0(t)}JC(t),pi(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=Om(Xr(t.ib,t),6e3));if(1>=Ez(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else yl(t,11)}else if((n.K||t.g==n)&&C0(t),!Mm(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let l=i[e];if(t.V=l[0],l=l[1],2==t.H)if("c"==l[0]){t.K=l[1],t.pa=l[2];const u=l[3];null!=u&&(t.ra=u,t.l.info("VER="+t.ra));const h=l[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=l[5];null!=d&&"number"==typeof d&&0<d&&(t.L=r=1.5*d,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const f=n.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=r.i;s.g||-1==p.indexOf("spdy")&&-1==p.indexOf("quic")&&-1==p.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(YC(s,s.h),s.h=null))}if(r.F){const m=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;m&&(r.Da=m,yn(r.I,r.F,m))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=zz(r,r.J?r.pa:null,r.Y),o.K){xz(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(y0(a),Vm(a)),r.g=o}else Fz(r);0<t.j.length&&A0(t)}else"stop"!=l[0]&&"close"!=l[0]||yl(t,7);else 3==t.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?yl(t,7):ZC(t):"noop"!=l[0]&&t.h&&t.h.Aa(l),t.A=0)}Lm()}catch{}}function dz(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(o0(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function fue(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(o0(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function due(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(o0(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(Ce=km.prototype).setTimeout=function(n){this.P=n},Ce.nb=function(n){n=n.target;const e=this.M;e&&3==So(n)?e.l():this.Pa(n)},Ce.Pa=function(n){try{if(n==this.g)e:{const u=So(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||xC||this.g&&(this.h.h||this.g.ja()||Dz(this.g)))){this.J||4!=u||7==e||Lm(),y0(this);var t=this.g.da();this.ca=t;t:if(lz(this)){var r=Dz(this.g);n="";var i=r.length,s=4==So(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){gl(this),Um(this);var o="";break t}this.h.i=new ft.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function aue(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Mm(a)){var l=a;break t}}l=null}if(!(t=l)){this.i=!1,this.o=3,pi(12),gl(this),Um(this);break e}jh(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qC(this,t)}this.S?(uz(this,u,o),xC&&this.i&&3==u&&(Z3(this.U,this.V,"tick",this.mb),this.V.start())):(jh(this.j,this.m,o,null),qC(this,o)),4==u&&gl(this),this.i&&!this.J&&(4==u?Vz(this.l,this):(this.i=!1,Vm(this)))}else(function Rue(n){const e={};n=(n.g&&2<=So(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Mm(n[r]))continue;var t=nue(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Yle(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,pi(12)):(this.o=0,pi(13)),gl(this),Um(this)}}}catch{}},Ce.mb=function(){if(this.g){var n=So(this.g),e=this.g.ja();this.C<e.length&&(y0(this),uz(this,n,e),this.i&&4!=n&&Vm(this))}},Ce.cancel=function(){this.J=!0,gl(this)},Ce.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function cue(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(Lm(),pi(17)),gl(this),this.o=2,Um(this)):hz(this,this.Y-n)};var fz=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _l(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof _l){this.h=n.h,v0(this,n.j),this.s=n.s,this.g=n.g,w0(this,n.m),this.l=n.l;var e=n.i,t=new Hm;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),pz(this,t),this.o=n.o}else n&&(e=String(n).match(fz))?(this.h=!1,v0(this,e[1]||"",!0),this.s=Bm(e[2]||""),this.g=Bm(e[3]||"",!0),w0(this,e[4]),this.l=Bm(e[5]||"",!0),pz(this,e[6]||"",!0),this.o=Bm(e[7]||"")):(this.h=!1,this.i=new Hm(null,this.h))}function ia(n){return new _l(n)}function v0(n,e,t){n.j=t?Bm(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function w0(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function pz(n,e,t){e instanceof Hm?(n.i=e,function wue(n,e){e&&!n.j&&(rc(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(gz(this,r),yz(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=zm(e,yue)),n.i=new Hm(e,n.h))}function yn(n,e,t){n.i.set(e,t)}function E0(n){return yn(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Bm(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function zm(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,mue),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function mue(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}_l.prototype.toString=function(){var n=[],e=this.j;e&&n.push(zm(e,mz,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(zm(e,mz,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(zm(t,"/"==t.charAt(0)?_ue:gue,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",zm(t,vue)),n.join("")};var mz=/[#\/\?@]/g,gue=/[#\?:]/g,_ue=/[#\?]/g,yue=/[#\?@]/g,vue=/#/g;function Hm(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function rc(n){n.g||(n.g=new Map,n.h=0,n.i&&function pue(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function gz(n,e){rc(n),e=Wh(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function _z(n,e){return rc(n),e=Wh(n,e),n.g.has(e)}function yz(n,e,t){gz(n,e),0<t.length&&(n.i=null,n.g.set(Wh(n,e),wC(t)),n.h+=t.length)}function Wh(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(Ce=Hm.prototype).add=function(n,e){rc(this),this.i=null,n=Wh(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},Ce.forEach=function(n,e){rc(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},Ce.ta=function(){rc(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},Ce.Z=function(n){rc(this);let e=[];if("string"==typeof n)_z(this,n)&&(e=e.concat(this.g.get(Wh(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},Ce.set=function(n,e){return rc(this),this.i=null,_z(this,n=Wh(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},Ce.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},Ce.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Eue=class{constructor(n,e){this.g=n,this.map=e}};function vz(n){this.l=n||xue,n=ft.PerformanceNavigationTiming?0<(n=ft.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(ft.g&&ft.g.Ka&&ft.g.Ka()&&ft.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var xue=10;function wz(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Ez(n){return n.h?1:n.g?n.g.size:0}function XC(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function YC(n,e){n.g?n.g.add(e):n.h=e}function xz(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function bz(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return wC(n.i)}vz.prototype.cancel=function(){if(this.i=bz(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var bue=class{stringify(n){return ft.JSON.stringify(n,void 0)}parse(n){return ft.JSON.parse(n,void 0)}};function Tue(){this.g=new bue}function Sue(n,e,t){const r=t||"";try{dz(n,function(i,s){let o=i;Cm(i)&&(o=kC(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function x0(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Gm(n){this.l=n.ec||null,this.j=n.ob||!1}function b0(n,e){wr.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=KC,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}vr(Gm,zC),Gm.prototype.g=function(){return new b0(this.l,this.j)},Gm.prototype.i=function(n){return function(){return n}}({}),vr(b0,wr);var KC=0;function Tz(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function jm(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Wm(n)}function Wm(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(Ce=b0.prototype).open=function(n,e){if(this.readyState!=KC)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Wm(this)},Ce.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||ft).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},Ce.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jm(this)),this.readyState=KC},Ce.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Wm(this)),this.g&&(this.readyState=3,Wm(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof ft.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tz(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},Ce.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jm(this):Wm(this),3==this.readyState&&Tz(this)}},Ce.Za=function(n){this.g&&(this.response=this.responseText=n,jm(this))},Ce.Ya=function(n){this.g&&(this.response=n,jm(this))},Ce.ka=function(){this.g&&jm(this)},Ce.setRequestHeader=function(n,e){this.v.append(n,e)},Ce.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},Ce.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(b0.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Cue=ft.JSON.parse;function Ln(n){wr.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Sz,this.L=this.M=!1}vr(Ln,wr);var Sz="",Mue=/^https?$/i,Iue=["POST","PUT"];function Az(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Cz(n),T0(n)}function Cz(n){n.F||(n.F=!0,Dr(n,"complete"),Dr(n,"error"))}function Mz(n){if(n.h&&typeof yC<"u"&&(!n.C[1]||4!=So(n)||2!=n.da()))if(n.v&&4==So(n))BC(n.La,0,n);else if(Dr(n,"readystatechange"),4==So(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(fz)[1]||null;!i&&ft.self&&ft.self.location&&(i=ft.self.location.protocol.slice(0,-1)),r=!Mue.test(i?i.toLowerCase():"")}t=r}if(t)Dr(n,"complete"),Dr(n,"success");else{n.m=6;try{var s=2<So(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Cz(n)}}finally{T0(n)}}}function T0(n,e){if(n.g){Iz(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Dr(n,"ready");try{t.onreadystatechange=r}catch{}}}function Iz(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(ft.clearTimeout(n.A),n.A=null)}function So(n){return n.g?n.g.readyState:0}function Dz(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Sz:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Rz(n){let e="";return MC(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function QC(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Rz(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):yn(n,e,t))}function $m(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Pz(n){this.Ga=0,this.j=[],this.l=new f0,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=$m("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=$m("baseRetryDelayMs",5e3,n),this.hb=$m("retryDelaySeedMs",1e4,n),this.eb=$m("forwardChannelMaxRetries",2,n),this.xa=$m("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new vz(n&&n.concurrentRequestLimit),this.Ja=new Tue,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ZC(n){if(Nz(n),3==n.H){var e=n.W++,t=ia(n.I);if(yn(t,"SID",n.K),yn(t,"RID",e),yn(t,"TYPE","terminate"),qm(n,t),(e=new km(n,n.l,e)).L=2,e.v=E0(ia(t)),t=!1,ft.navigator&&ft.navigator.sendBeacon)try{t=ft.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&ft.Image&&((new Image).src=e.v,t=!0),t||(e.g=Hz(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Vm(e)}Bz(n)}function S0(n){n.g&&(eM(n),n.g.cancel(),n.g=null)}function Nz(n){S0(n),n.u&&(ft.clearTimeout(n.u),n.u=null),C0(n),n.i.cancel(),n.m&&("number"==typeof n.m&&ft.clearTimeout(n.m),n.m=null)}function A0(n){if(!wz(n.i)&&!n.m){n.m=!0;var e=n.Na;Rm||Y3(),Pm||(Rm(),Pm=!0),VC.add(e,n),n.C=0}}function Lz(n,e){var t;t=e?e.m:n.W++;const r=ia(n.I);yn(r,"SID",n.K),yn(r,"RID",t),yn(r,"AID",n.V),qm(n,r),n.o&&n.s&&QC(r,n.o,n.s),t=new km(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Oz(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),YC(n.i,t),$C(t,r,e)}function qm(n,e){n.na&&MC(n.na,function(t,r){yn(e,r,t)}),n.h&&dz({},function(t,r){yn(e,r,t)})}function Oz(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Xr(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let l=i[c].g;const u=i[c].map;if(l-=s,0>l)s=Math.max(0,i[c].g-100),a=!1;else try{Sue(u,o,"req"+l+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Fz(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Rm||Y3(),Pm||(Rm(),Pm=!0),VC.add(e,n),n.A=0}}function JC(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=Om(Xr(n.Ma,n),Uz(n,n.A)),n.A++,0))}function eM(n){null!=n.B&&(ft.clearTimeout(n.B),n.B=null)}function kz(n){n.g=new km(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=ia(n.wa);yn(e,"RID","rpc"),yn(e,"SID",n.K),yn(e,"AID",n.V),yn(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&yn(e,"TO",n.qa),yn(e,"TYPE","xmlhttp"),qm(n,e),n.o&&n.s&&QC(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=E0(ia(e)),t.s=null,t.S=!0,cz(t,n)}function C0(n){null!=n.v&&(ft.clearTimeout(n.v),n.v=null)}function Vz(n,e){var t=null;if(n.g==e){C0(n),eM(n),n.g=null;var r=2}else{if(!XC(n.i,e))return;t=e.F,xz(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Dr(r=p0(),new rz(r,t)),A0(n)}else Fz(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function Pue(n,e){return!(Ez(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=Om(Xr(n.Na,n,e),Uz(n,n.C)),n.C++,0)))}(n,e)||2==r&&JC(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:yl(n,5);break;case 4:yl(n,10);break;case 3:yl(n,6);break;default:yl(n,2)}}function Uz(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function yl(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Xr(n.pb,n);t||(t=new _l("//www.google.com/images/cleardot.gif"),ft.location&&"http"==ft.location.protocol||v0(t,"https"),E0(t)),function Aue(n,e){const t=new f0;if(ft.Image){const r=new Image;r.onload=a0(x0,t,r,"TestLoadImage: loaded",!0,e),r.onerror=a0(x0,t,r,"TestLoadImage: error",!1,e),r.onabort=a0(x0,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=a0(x0,t,r,"TestLoadImage: timeout",!1,e),ft.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else pi(2);n.H=0,n.h&&n.h.za(e),Bz(n),Nz(n)}function Bz(n){if(n.H=0,n.ma=[],n.h){const e=bz(n.i);(0!=e.length||0!=n.j.length)&&(O3(n.ma,e),O3(n.ma,n.j),n.i.i.length=0,wC(n.j),n.j.length=0),n.h.ya()}}function zz(n,e,t){var r=t instanceof _l?ia(t):new _l(t);if(""!=r.g)e&&(r.g=e+"."+r.g),w0(r,r.m);else{var i=ft.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new _l(null);r&&v0(s,r),e&&(s.g=e),i&&w0(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&yn(r,t,e),yn(r,"VER",n.ra),qm(n,r),r}function Hz(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ln(t&&n.Ha&&!n.va?new Gm({ob:!0}):n.va)).Oa(n.J),e}function Gz(){}function M0(){if(Gh&&!(10<=Number(Wle)))throw Error("Environmental error: no available transport.")}function Qi(n,e){wr.call(this),this.g=new Pz(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Mm(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Mm(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new $h(this)}function jz(n){HC.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Wz(){GC.call(this),this.status=1}function $h(n){this.g=n}function qs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function tM(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function Xt(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(Ce=Ln.prototype).Oa=function(n){this.M=n},Ce.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():jC.g(),this.C=function sz(n){return n.h||(n.h=n.i())}(this.u?this.u:jC),this.g.onreadystatechange=Xr(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Az(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=ft.FormData&&n instanceof ft.FormData,!(0<=L3(Iue,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Iz(this),0<this.B&&((this.L=function Due(n){return Gh&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Xr(this.ua,this)):this.A=BC(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Az(this,s)}},Ce.ua=function(){typeof yC<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Dr(this,"timeout"),this.abort(8))},Ce.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Dr(this,"complete"),Dr(this,"abort"),T0(this))},Ce.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),T0(this,!0)),Ln.$.N.call(this)},Ce.La=function(){this.s||(this.G||this.v||this.l?Mz(this):this.kb())},Ce.kb=function(){Mz(this)},Ce.isActive=function(){return!!this.g},Ce.da=function(){try{return 2<So(this)?this.g.status:-1}catch{return-1}},Ce.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},Ce.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Cue(e)}},Ce.Ia=function(){return this.m},Ce.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ce=Pz.prototype).ra=8,Ce.H=1,Ce.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new km(this,this.l,n);let s=this.s;if(this.U&&(s?(s=B3(s),H3(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Oz(this,i,e),yn(t=ia(this.I),"RID",n),yn(t,"CVER",22),this.F&&yn(t,"X-HTTP-Session-Id",this.F),qm(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Rz(s)))+"&"+e:this.o&&QC(t,this.o,s)),YC(this.i,i),this.bb&&yn(t,"TYPE","init"),this.P?(yn(t,"$req",e),yn(t,"SID","null"),i.aa=!0,$C(i,t,null)):$C(i,t,e),this.H=2}}else 3==this.H&&(n?Lz(this,n):0==this.j.length||wz(this.i)||Lz(this))},Ce.Ma=function(){if(this.u=null,kz(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Om(Xr(this.jb,this),n)}},Ce.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,pi(10),S0(this),kz(this))},Ce.ib=function(){null!=this.v&&(this.v=null,S0(this),JC(this),pi(19))},Ce.pb=function(n){n?(this.l.info("Successfully pinged google.com"),pi(2)):(this.l.info("Failed to ping google.com"),pi(1))},Ce.isActive=function(){return!!this.h&&this.h.isActive(this)},(Ce=Gz.prototype).Ba=function(){},Ce.Aa=function(){},Ce.za=function(){},Ce.ya=function(){},Ce.isActive=function(){return!0},Ce.Va=function(){},M0.prototype.g=function(n,e){return new Qi(n,e)},vr(Qi,wr),Qi.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;pi(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=zz(n,null,n.Y),A0(n)},Qi.prototype.close=function(){ZC(this.g)},Qi.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=kC(n),n=t);e.j.push(new Eue(e.fb++,n)),3==e.H&&A0(e)},Qi.prototype.N=function(){this.g.h=null,delete this.j,ZC(this.g),delete this.g,Qi.$.N.call(this)},vr(jz,HC),vr(Wz,GC),vr($h,Gz),$h.prototype.Ba=function(){Dr(this.g,"a")},$h.prototype.Aa=function(n){Dr(this.g,new jz(n))},$h.prototype.za=function(n){Dr(this.g,new Wz)},$h.prototype.ya=function(){Dr(this.g,"b")},vr(qs,function Nue(){this.blockSize=-1}),qs.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},qs.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)tM(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){tM(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){tM(this,r),i=0;break}}this.h=i,this.i+=e},qs.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Lue={};function nM(n){return-128<=n&&128>n?function Hle(n,e){var t=Lue;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new Xt([0|e],0>e?-1:0)}):new Xt([0|n],0>n?-1:0)}function Ao(n){if(isNaN(n)||!isFinite(n))return qh;if(0>n)return Rr(Ao(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=rM;return new Xt(e,0)}var rM=4294967296,qh=nM(0),iM=nM(1),qz=nM(16777216);function sa(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Es(n){return-1==n.h}function Rr(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Xt(t,~n.h).add(iM)}function I0(n,e){return n.add(Rr(e))}function D0(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Xm(n,e){this.g=n,this.h=e}function R0(n,e){if(sa(e))throw Error("division by zero");if(sa(n))return new Xm(qh,qh);if(Es(n))return e=R0(Rr(n),e),new Xm(Rr(e.g),Rr(e.h));if(Es(e))return e=R0(n,Rr(e)),new Xm(Rr(e.g),e.h);if(30<n.g.length){if(Es(n)||Es(e))throw Error("slowDivide_ only works with positive integers.");for(var t=iM,r=e;0>=r.X(n);)t=Xz(t),r=Xz(r);var i=Xh(t,1),s=Xh(r,1);for(r=Xh(r,2),t=Xh(t,2);!sa(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Xh(r,1),t=Xh(t,1)}return e=I0(n,i.R(e)),new Xm(i,e)}for(i=qh;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Ao(t)).R(e);Es(o)||0<o.X(n);)o=(s=Ao(t-=r)).R(e);sa(s)&&(s=iM),i=i.add(s),n=I0(n,o)}return new Xm(i,n)}function Xz(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Xt(t,n.h)}function Xh(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new Xt(i,n.h)}(Ce=Xt.prototype).ea=function(){if(Es(this))return-Rr(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:rM+r)*e,e*=rM}return n},Ce.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(sa(this))return"0";if(Es(this))return"-"+Rr(this).toString(n);for(var e=Ao(Math.pow(n,6)),t=this,r="";;){var i=R0(t,e).g,s=((0<(t=I0(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(sa(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},Ce.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},Ce.X=function(n){return Es(n=I0(this,n))?-1:sa(n)?0:1},Ce.abs=function(){return Es(this)?Rr(this):this},Ce.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new Xt(t,-2147483648&t[t.length-1]?-1:0)},Ce.R=function(n){if(sa(this)||sa(n))return qh;if(Es(this))return Es(n)?Rr(this).R(Rr(n)):Rr(Rr(this).R(n));if(Es(n))return Rr(this.R(Rr(n)));if(0>this.X(qz)&&0>n.X(qz))return Ao(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,c=65535&n.D(i);t[2*r+2*i]+=o*c,D0(t,2*r+2*i),t[2*r+2*i+1]+=s*c,D0(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,D0(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,D0(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Xt(t,0)},Ce.gb=function(n){return R0(this,n).h},Ce.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Xt(t,this.h&n.h)},Ce.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Xt(t,this.h|n.h)},Ce.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Xt(t,this.h^n.h)},M0.prototype.createWebChannel=M0.prototype.g,Qi.prototype.send=Qi.prototype.u,Qi.prototype.open=Qi.prototype.m,Qi.prototype.close=Qi.prototype.close,m0.NO_ERROR=0,m0.TIMEOUT=8,m0.HTTP_ERROR=6,iz.COMPLETE="complete",oz.EventType=Fm,Fm.OPEN="a",Fm.CLOSE="b",Fm.ERROR="c",Fm.MESSAGE="d",wr.prototype.listen=wr.prototype.O,Ln.prototype.listenOnce=Ln.prototype.P,Ln.prototype.getLastError=Ln.prototype.Sa,Ln.prototype.getLastErrorCode=Ln.prototype.Ia,Ln.prototype.getStatus=Ln.prototype.da,Ln.prototype.getResponseJson=Ln.prototype.Wa,Ln.prototype.getResponseText=Ln.prototype.ja,Ln.prototype.send=Ln.prototype.ha,Ln.prototype.setWithCredentials=Ln.prototype.Oa,qs.prototype.digest=qs.prototype.l,qs.prototype.reset=qs.prototype.reset,qs.prototype.update=qs.prototype.j,Xt.prototype.add=Xt.prototype.add,Xt.prototype.multiply=Xt.prototype.R,Xt.prototype.modulo=Xt.prototype.gb,Xt.prototype.compare=Xt.prototype.X,Xt.prototype.toNumber=Xt.prototype.ea,Xt.prototype.toString=Xt.prototype.toString,Xt.prototype.getBits=Xt.prototype.D,Xt.fromNumber=Ao,Xt.fromString=function $z(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return Rr($z(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Ao(Math.pow(e,8)),r=qh,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Ao(Math.pow(e,s)),r=r.R(s).add(Ao(o))):r=(r=r.R(t)).add(Ao(o))}return r};var Oue=$s.createWebChannelTransport=function(){return new M0},Fue=$s.getStatEventTarget=function(){return p0()},sM=$s.ErrorCode=m0,kue=$s.EventType=iz,Vue=$s.Event=ml,Yz=$s.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},P0=($s.FetchXmlHttpFactory=Gm,$s.WebChannel=oz),Uue=$s.XhrIo=Ln,Bue=$s.Md5=qs,Yh=$s.Integer=Xt;const Kz="@firebase/firestore";class Er{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Er.UNAUTHENTICATED=new Er(null),Er.GOOGLE_CREDENTIALS=new Er("google-credentials-uid"),Er.FIRST_PARTY=new Er("first-party-uid"),Er.MOCK_USER=new Er("mock-user");let Kh="10.4.0";const ic=new w3("@firebase/firestore");function Qh(){return ic.logLevel}function se(n,...e){if(ic.logLevel<=Bt.DEBUG){const t=e.map(oM);ic.debug(`Firestore (${Kh}): ${n}`,...t)}}function jn(n,...e){if(ic.logLevel<=Bt.ERROR){const t=e.map(oM);ic.error(`Firestore (${Kh}): ${n}`,...t)}}function Zi(n,...e){if(ic.logLevel<=Bt.WARN){const t=e.map(oM);ic.warn(`Firestore (${Kh}): ${n}`,...t)}}function oM(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function Oe(n="Unexpected state"){const e=`FIRESTORE (${Kh}) INTERNAL ASSERTION FAILED: `+n;throw jn(e),new Error(e)}function Be(n,e){n||Oe()}function be(n,e){return n}const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class re extends zh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class pr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Qz{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zue{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Er.UNAUTHENTICATED))}shutdown(){}}class Hue{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Gue{constructor(e){this.t=e,this.currentUser=Er.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let o=new pr;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new pr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const l=o;e.enqueueRetryable(Pe(function*(){yield l.promise,yield s(r.currentUser)}))},c=l=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new pr)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Be("string"==typeof r.accessToken),new Qz(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Be(null===e||"string"==typeof e),new Er(e)}}class jue{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Er.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Wue{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new jue(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Er.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Zz{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $ue{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,se("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Be("string"==typeof t.token),this.R=t.token,new Zz(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function que(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Jz{static V(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=que(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function ct(n,e){return n<e?-1:n>e?1:0}function Zh(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}class In{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new re(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new re(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new re(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new re(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return In.fromMillis(Date.now())}static fromDate(e){return In.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new In(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ct(this.nanoseconds,e.nanoseconds):ct(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class je{constructor(e){this.timestamp=e}static fromTimestamp(e){return new je(e)}static min(){return new je(new In(0,0))}static max(){return new je(new In(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ym{constructor(e,t,r){void 0===t?t=0:t>e.length&&Oe(),void 0===r?r=e.length-t:r>e.length-t&&Oe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Ym.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ym?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Vt extends Ym{construct(e,t,r){return new Vt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new re(G.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Vt(t)}static emptyPath(){return new Vt([])}}const Xue=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class On extends Ym{construct(e,t,r){return new On(e,t,r)}static isValidIdentifier(e){return Xue.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),On.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new On(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new re(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new re(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new re(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new re(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new On(t)}static emptyPath(){return new On([])}}class Te{constructor(e){this.path=e}static fromPath(e){return new Te(Vt.fromString(e))}static fromName(e){return new Te(Vt.fromString(e).popFirst(5))}static empty(){return new Te(Vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Vt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Vt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new Vt(e.slice()))}}function nH(n){return new Ji(n.readTime,n.key,-1)}class Ji{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ji(je.min(),Te.empty(),-1)}static max(){return new Ji(je.max(),Te.empty(),-1)}}function cM(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=Te.comparator(n.documentKey,e.documentKey),0!==t?t:ct(n.largestBatchId,e.largestBatchId))}const rH="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Que{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function sc(n){return lM.apply(this,arguments)}function lM(){return lM=Pe(function*(n){if(n.code!==G.FAILED_PRECONDITION||n.message!==rH)throw n;se("LocalStore","Unexpectedly lost primary lease")}),lM.apply(this,arguments)}class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Oe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,r)=>{t(e)})}static reject(e){return new V((t,r)=>{r(e)})}static waitFor(e){return new V((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next(i=>i?V.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new V((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new V((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}function oc(n){return"IndexedDbTransactionError"===n.name}let es=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.oe(i),this._e=i=>r.writeSequenceNumber(i))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}return n.ae=-1,n})();function Qm(n){return null==n}function Zm(n){return 0===n&&1/n==-1/0}function dH(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ac(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fH(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class dn{constructor(e,t){this.comparator=e,this.root=t||Pr.EMPTY}insert(e,t){return new dn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pr.BLACK,null,null))}remove(e){return new dn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new O0(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new O0(this.root,e,this.comparator,!1)}getReverseIterator(){return new O0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new O0(this.root,e,this.comparator,!0)}}class O0{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pr{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Pr.RED,this.left=i??Pr.EMPTY,this.right=s??Pr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Pr(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Pr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Pr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Oe();const e=this.left.check();if(e!==this.right.check())throw Oe();return e+(this.isRed()?0:1)}}Pr.EMPTY=null,Pr.RED=!0,Pr.BLACK=!1,Pr.EMPTY=new class{constructor(){this.size=0}get key(){throw Oe()}get value(){throw Oe()}get color(){throw Oe()}get left(){throw Oe()}get right(){throw Oe()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Pr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fn{constructor(e){this.comparator=e,this.data=new dn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pH(this.data.getIterator())}getIteratorFrom(e){return new pH(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof fn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new fn(this.comparator);return t.data=e,t}}class pH{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Di{constructor(e){this.fields=e,e.sort(On.comparator)}static empty(){return new Di([])}unionWith(e){let t=new fn(On.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Di(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zh(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class mH extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class mr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new mH("Invalid base64 string: "+s):s}}(e);return new mr(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new mr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ct(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mr.EMPTY_BYTE_STRING=new mr("");const whe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cc(n){if(Be(!!n),"string"==typeof n){let e=0;const t=whe.exec(n);if(Be(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Fn(n.seconds),nanos:Fn(n.nanos)}}function Fn(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function oa(n){return"string"==typeof n?mr.fromBase64String(n):mr.fromUint8Array(n)}function F0(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function k0(n){const e=n.mapValue.fields.__previous_value__;return F0(e)?k0(e):e}function Jm(n){const e=cc(n.mapValue.fields.__local_write_time__.timestampValue);return new In(e.seconds,e.nanos)}class Ehe{constructor(e,t,r,i,s,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}}class xl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new xl("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xl&&e.projectId===this.projectId&&e.database===this.database}}const lc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function uc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?F0(n)?4:vH(n)?9007199254740991:10:Oe()}function Mo(n,e){if(n===e)return!0;const t=uc(n);if(t!==uc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Jm(n).isEqual(Jm(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=cc(i.timestampValue),a=cc(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,oa(n.bytesValue).isEqual(oa(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Fn(i.geoPointValue.latitude)===Fn(s.geoPointValue.latitude)&&Fn(i.geoPointValue.longitude)===Fn(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Fn(i.integerValue)===Fn(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Fn(i.doubleValue),a=Fn(s.doubleValue);return o===a?Zm(o)===Zm(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Zh(n.arrayValue.values||[],e.arrayValue.values||[],Mo);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(dH(o)!==dH(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(void 0===a[c]||!Mo(o[c],a[c])))return!1;return!0}(n,e);default:return Oe()}var s}function eg(n,e){return void 0!==(n.values||[]).find(t=>Mo(t,e))}function hc(n,e){if(n===e)return 0;const t=uc(n),r=uc(e);if(t!==r)return ct(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ct(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Fn(s.integerValue||s.doubleValue),c=Fn(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return gH(n.timestampValue,e.timestampValue);case 4:return gH(Jm(n),Jm(e));case 5:return ct(n.stringValue,e.stringValue);case 6:return function(s,o){const a=oa(s),c=oa(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){const u=ct(a[l],c[l]);if(0!==u)return u}return ct(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=ct(Fn(s.latitude),Fn(o.latitude));return 0!==a?a:ct(Fn(s.longitude),Fn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],c=o.values||[];for(let l=0;l<a.length&&l<c.length;++l){const u=hc(a[l],c[l]);if(u)return u}return ct(a.length,c.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===lc.mapValue&&o===lc.mapValue)return 0;if(s===lc.mapValue)return 1;if(o===lc.mapValue)return-1;const a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let h=0;h<c.length&&h<u.length;++h){const d=ct(c[h],u[h]);if(0!==d)return d;const f=hc(a[c[h]],l[u[h]]);if(0!==f)return f}return ct(c.length,u.length)}(n.mapValue,e.mapValue);default:throw Oe()}}function gH(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return ct(n,e);const t=cc(n),r=cc(e),i=ct(t.seconds,r.seconds);return 0!==i?i:ct(t.nanos,r.nanos)}function nd(n){return dM(n)}function dM(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=cc(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?oa(n.bytesValue).toBase64():"referenceValue"in n?Te.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=dM(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${dM(t.fields[o])}`;return i+"}"}(n.mapValue):Oe()}function fM(n){return!!n&&"integerValue"in n}function tg(n){return!!n&&"arrayValue"in n}function _H(n){return!!n&&"nullValue"in n}function yH(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function B0(n){return!!n&&"mapValue"in n}function ng(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ac(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ng(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ng(n.arrayValue.values[t]);return e}return Object.assign({},n)}function vH(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}class Nr{constructor(e){this.value=e}static empty(){return new Nr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!B0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ng(t)}setAll(e){let t=On.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ng(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());B0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];B0(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ac(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Nr(ng(this.value))}}function xH(n){const e=[];return ac(n.fields,(t,r)=>{const i=new On([t]);if(B0(r)){const s=xH(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Di(e)}class vn{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new vn(e,0,je.min(),je.min(),je.min(),Nr.empty(),0)}static newFoundDocument(e,t,r,i){return new vn(e,1,t,je.min(),r,i,0)}static newNoDocument(e,t){return new vn(e,2,t,je.min(),je.min(),Nr.empty(),0)}static newUnknownDocument(e,t){return new vn(e,3,t,je.min(),je.min(),Nr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(je.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof vn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new vn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class dc{constructor(e,t){this.position=e,this.inclusive=t}}function bH(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?Te.comparator(Te.fromName(o.referenceValue),t.key):hc(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function TH(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Mo(n.position[t],e.position[t]))return!1;return!0}class rd{constructor(e,t="asc"){this.field=e,this.dir=t}}function The(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class SH{}class Rt extends SH{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new She(e,t,r):"array-contains"===t?new Mhe(e,r):"in"===t?new RH(e,r):"not-in"===t?new Ihe(e,r):"array-contains-any"===t?new Dhe(e,r):new Rt(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Ahe(e,r):new Che(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(hc(t,this.value)):null!==t&&uc(this.value)===uc(t)&&this.matchesComparison(hc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Oe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Yt extends SH{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Yt(e,t)}matches(e){return id(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function id(n){return"and"===n.op}function mM(n){return function AH(n){for(const e of n.filters)if(e instanceof Yt)return!1;return!0}(n)&&id(n)}function gM(n){if(n instanceof Rt)return n.field.canonicalString()+n.op.toString()+nd(n.value);if(mM(n))return n.filters.map(e=>gM(e)).join(",");{const e=n.filters.map(t=>gM(t)).join(",");return`${n.op}(${e})`}}function CH(n,e){return n instanceof Rt?(r=n,(i=e)instanceof Rt&&r.op===i.op&&r.field.isEqual(i.field)&&Mo(r.value,i.value)):n instanceof Yt?function(r,i){return i instanceof Yt&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&CH(o,i.filters[a]),!0)}(n,e):void Oe();var r,i}function IH(n){return n instanceof Rt?`${(t=n).field.canonicalString()} ${t.op} ${nd(t.value)}`:n instanceof Yt?function(t){return t.op.toString()+" {"+t.getFilters().map(IH).join(" ,")+"}"}(n):"Filter";var t}class She extends Rt{constructor(e,t,r){super(e,t,r),this.key=Te.fromName(r.referenceValue)}matches(e){const t=Te.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ahe extends Rt{constructor(e,t){super(e,"in",t),this.keys=DH(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Che extends Rt{constructor(e,t){super(e,"not-in",t),this.keys=DH(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function DH(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>Te.fromName(r.referenceValue))}class Mhe extends Rt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return tg(t)&&eg(t.arrayValue,this.value)}}class RH extends Rt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&eg(this.value.arrayValue,t)}}class Ihe extends Rt{constructor(e,t){super(e,"not-in",t)}matches(e){if(eg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!eg(this.value.arrayValue,t)}}class Dhe extends Rt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!tg(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>eg(this.value.arrayValue,r))}}class Rhe{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.he=null}}function _M(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Rhe(n,e,t,r,i,s,o)}function Tl(n){const e=be(n);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>gM(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Qm(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>nd(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>nd(r)).join(",")),e.he=t}return e.he}function rg(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!The(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!CH(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!TH(n.startAt,e.startAt)&&TH(n.endAt,e.endAt)}function z0(n){return Te.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class aa{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.Pe=null,this.Ie=null,this.de=null}}function sd(n){return new aa(n)}function OH(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function od(n){const e=be(n);if(null===e.Pe){e.Pe=[];const t=function G0(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),r=function yM(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}(e);if(null!==t&&null===r)t.isKeyField()||e.Pe.push(new rd(t)),e.Pe.push(new rd(On.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new rd(On.keyField(),s))}}}return e.Pe}function mi(n){const e=be(n);return e.Ie||(e.Ie=function FH(n,e){if("F"===n.limitType)return _M(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new rd(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new dc(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new dc(n.startAt.position,n.startAt.inclusive):null;return _M(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,od(n))),e.Ie}function j0(n,e,t){return new aa(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ig(n,e){return rg(mi(n),mi(e))&&n.limitType===e.limitType}function kH(n){return`${Tl(mi(n))}|lt:${n.limitType}`}function ad(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>IH(i)).join(", ")}]`),Qm(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>nd(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>nd(i)).join(",")),`Target(${r})`}(mi(n))}; limitType=${n.limitType})`}function sg(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Te.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of od(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,c){const l=bH(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,od(r),i)||r.endAt&&!function(o,a,c){const l=bH(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,od(r),i)));var r,i}function UH(n){return(e,t)=>{let r=!1;for(const i of od(n)){const s=Phe(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function Phe(n,e,t){const r=n.field.isKeyField()?Te.comparator(e.key,t.key):function(s,o,a){const c=o.data.field(s),l=a.data.field(s);return null!==c&&null!==l?hc(c,l):Oe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Oe()}}class ca{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ac(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return fH(this.inner)}size(){return this.innerSize}}const Nhe=new dn(Te.comparator);function Ri(){return Nhe}const BH=new dn(Te.comparator);function og(...n){let e=BH;for(const t of n)e=e.insert(t.key,t);return e}function zH(n){let e=BH;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Io(){return ag()}function HH(){return ag()}function ag(){return new ca(n=>n.toString(),(n,e)=>n.isEqual(e))}const Lhe=new dn(Te.comparator),Ohe=new fn(Te.comparator);function yt(...n){let e=Ohe;for(const t of n)e=e.add(t);return e}const Fhe=new fn(ct);function GH(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zm(e)?"-0":e}}function jH(n){return{integerValue:""+n}}function WH(n,e){return function sH(n){return"number"==typeof n&&Number.isInteger(n)&&!Zm(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?jH(e):GH(n,e)}class W0{constructor(){this._=void 0}}function khe(n,e,t){return n instanceof cd?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&F0(s)&&(s=k0(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Sl?qH(n,e):n instanceof Al?XH(n,e):function(i,s){const o=$H(i,s),a=YH(o)+YH(i.Te);return fM(o)&&fM(i.Te)?jH(a):GH(i.serializer,a)}(n,e)}function Vhe(n,e,t){return n instanceof Sl?qH(n,e):n instanceof Al?XH(n,e):t}function $H(n,e){return n instanceof ld?fM(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class cd extends W0{}class Sl extends W0{constructor(e){super(),this.elements=e}}function qH(n,e){const t=KH(e);for(const r of n.elements)t.some(i=>Mo(i,r))||t.push(r);return{arrayValue:{values:t}}}class Al extends W0{constructor(e){super(),this.elements=e}}function XH(n,e){let t=KH(e);for(const r of n.elements)t=t.filter(i=>!Mo(i,r));return{arrayValue:{values:t}}}class ld extends W0{constructor(e,t){super(),this.serializer=e,this.Te=t}}function YH(n){return Fn(n.integerValue||n.doubleValue)}function KH(n){return tg(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class cg{constructor(e,t){this.field=e,this.transform=t}}class Bhe{constructor(e,t){this.version=e,this.transformResults=t}}class Tn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Tn}static exists(e){return new Tn(void 0,e)}static updateTime(e){return new Tn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $0(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class q0{}function QH(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new hd(n.key,Tn.none()):new ud(n.key,n.data,Tn.none());{const t=n.data,r=Nr.empty();let i=new fn(On.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new la(n.key,r,new Di(i.toArray()),Tn.none())}}function zhe(n,e,t){n instanceof ud?function(i,s,o){const a=i.value.clone(),c=eG(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof la?function(i,s,o){if(!$0(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=eG(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(JH(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function lg(n,e,t,r){return n instanceof ud?function(s,o,a,c){if(!$0(s.precondition,o))return a;const l=s.value.clone(),u=tG(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof la?function(s,o,a,c){if(!$0(s.precondition,o))return a;const l=tG(s.fieldTransforms,c,o),u=o.data;return u.setAll(JH(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,$0(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Hhe(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=$H(r.transform,i||null);null!=s&&(null===t&&(t=Nr.empty()),t.set(r.field,s))}return t||null}function ZH(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Zh(r,i,(s,o)=>function Uhe(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Sl&&i instanceof Sl||r instanceof Al&&i instanceof Al?Zh(r.elements,i.elements,Mo):r instanceof ld&&i instanceof ld?Mo(r.Te,i.Te):r instanceof cd&&i instanceof cd);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class ud extends q0{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class la extends q0{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function JH(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function eG(n,e,t){const r=new Map;Be(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Vhe(o,a,t[i]))}return r}function tG(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,khe(s,o,e))}return r}class hd extends q0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xM extends q0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class bM{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&zhe(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=lg(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=lg(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=HH();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const c=QH(o,a);null!==c&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(je.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),yt())}isEqual(e){return this.batchId===e.batchId&&Zh(this.mutations,e.mutations,(t,r)=>ZH(t,r))&&Zh(this.baseMutations,e.baseMutations,(t,r)=>ZH(t,r))}}class TM{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Be(e.mutations.length===r.length);let i=Lhe;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new TM(e,t,r,i)}}class SM{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class jhe{constructor(e,t){this.count=e,this.unchangedNames=t}}var nr,Ut;function rG(n){if(void 0===n)return jn("GRPC error has no .code"),G.UNKNOWN;switch(n){case nr.OK:return G.OK;case nr.CANCELLED:return G.CANCELLED;case nr.UNKNOWN:return G.UNKNOWN;case nr.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case nr.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case nr.INTERNAL:return G.INTERNAL;case nr.UNAVAILABLE:return G.UNAVAILABLE;case nr.UNAUTHENTICATED:return G.UNAUTHENTICATED;case nr.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case nr.NOT_FOUND:return G.NOT_FOUND;case nr.ALREADY_EXISTS:return G.ALREADY_EXISTS;case nr.PERMISSION_DENIED:return G.PERMISSION_DENIED;case nr.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case nr.ABORTED:return G.ABORTED;case nr.OUT_OF_RANGE:return G.OUT_OF_RANGE;case nr.UNIMPLEMENTED:return G.UNIMPLEMENTED;case nr.DATA_LOSS:return G.DATA_LOSS;default:return Oe()}}(Ut=nr||(nr={}))[Ut.OK=0]="OK",Ut[Ut.CANCELLED=1]="CANCELLED",Ut[Ut.UNKNOWN=2]="UNKNOWN",Ut[Ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ut[Ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ut[Ut.NOT_FOUND=5]="NOT_FOUND",Ut[Ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ut[Ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ut[Ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ut[Ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ut[Ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ut[Ut.ABORTED=10]="ABORTED",Ut[Ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ut[Ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ut[Ut.INTERNAL=13]="INTERNAL",Ut[Ut.UNAVAILABLE=14]="UNAVAILABLE",Ut[Ut.DATA_LOSS=15]="DATA_LOSS";const Whe=new Yh([4294967295,4294967295],0);function sG(n){const e=function iG(){return new TextEncoder}().encode(n),t=new Bue;return t.update(e),new Uint8Array(t.digest())}function oG(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Yh([t,r],0),new Yh([i,s],0)]}class AM{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ug(`Invalid padding: ${t}`);if(r<0)throw new ug(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new ug(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ug(`Invalid padding when bitmap length is 0: ${t}`);this.Ae=8*e.length-t,this.Re=Yh.fromNumber(this.Ae)}Ve(e,t,r){let i=e.add(t.multiply(Yh.fromNumber(r)));return 1===i.compare(Whe)&&(i=new Yh([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Re).toNumber()}me(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ae)return!1;const t=sG(e),[r,i]=oG(t);for(let s=0;s<this.hashCount;s++){const o=this.Ve(r,i,s);if(!this.me(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new AM(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Ae)return;const t=sG(e),[r,i]=oG(t);for(let s=0;s<this.hashCount;s++){const o=this.Ve(r,i,s);this.fe(o)}}fe(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ug extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hg{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,dg.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new hg(je.min(),i,new dn(ct),Ri(),yt())}}class dg{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new dg(r,t,yt(),yt(),yt())}}class Y0{constructor(e,t,r,i){this.ge=e,this.removedTargetIds=t,this.key=r,this.pe=i}}class aG{constructor(e,t){this.targetId=e,this.ye=t}}class cG{constructor(e,t,r=mr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class lG{constructor(){this.we=0,this.Se=hG(),this.be=mr.EMPTY_BYTE_STRING,this.De=!1,this.Ce=!0}get current(){return this.De}get resumeToken(){return this.be}get ve(){return 0!==this.we}get Fe(){return this.Ce}Me(e){e.approximateByteSize()>0&&(this.Ce=!0,this.be=e)}xe(){let e=yt(),t=yt(),r=yt();return this.Se.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Oe()}}),new dg(this.be,this.De,e,t,r)}Oe(){this.Ce=!1,this.Se=hG()}Ne(e,t){this.Ce=!0,this.Se=this.Se.insert(e,t)}Be(e){this.Ce=!0,this.Se=this.Se.remove(e)}Le(){this.we+=1}ke(){this.we-=1}qe(){this.Ce=!0,this.De=!0}}class $he{constructor(e){this.Qe=e,this.Ke=new Map,this.$e=Ri(),this.Ue=uG(),this.We=new dn(ct)}Ge(e){for(const t of e.ge)e.pe&&e.pe.isFoundDocument()?this.ze(t,e.pe):this.je(t,e.key,e.pe);for(const t of e.removedTargetIds)this.je(t,e.key,e.pe)}He(e){this.forEachTarget(e,t=>{const r=this.Je(t);switch(e.state){case 0:this.Ye(t)&&r.Me(e.resumeToken);break;case 1:r.ke(),r.ve||r.Oe(),r.Me(e.resumeToken);break;case 2:r.ke(),r.ve||this.removeTarget(t);break;case 3:this.Ye(t)&&(r.qe(),r.Me(e.resumeToken));break;case 4:this.Ye(t)&&(this.Ze(t),r.Me(e.resumeToken));break;default:Oe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ke.forEach((r,i)=>{this.Ye(i)&&t(i)})}Xe(e){const t=e.targetId,r=e.ye.count,i=this.et(t);if(i){const s=i.target;if(z0(s))if(0===r){const o=new Te(s.path);this.je(t,o,vn.newNoDocument(o,je.min()))}else Be(1===r);else{const o=this.tt(t);if(o!==r){const a=this.nt(e),c=a?this.rt(a,e,o):1;0!==c&&(this.Ze(t),this.We=this.We.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}nt(e){const t=e.ye.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=oa(r).toUint8Array()}catch(c){if(c instanceof mH)return Zi("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new AM(o,i,s)}catch(c){return Zi(c instanceof ug?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===a.Ae?null:a}rt(e,t,r){return t.ye.count===r-this.ot(e,t.targetId)?0:2}ot(e,t){const r=this.Qe.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Qe.st(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.je(t,s,null),i++)}),i}_t(e){const t=new Map;this.Ke.forEach((s,o)=>{const a=this.et(o);if(a){if(s.current&&z0(a.target)){const c=new Te(a.target.path);null!==this.$e.get(c)||this.ut(o,c)||this.je(o,c,vn.newNoDocument(c,e))}s.Fe&&(t.set(o,s.xe()),s.Oe())}});let r=yt();this.Ue.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.et(c);return!l||"TargetPurposeLimboResolution"===l.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.$e.forEach((s,o)=>o.setReadTime(e));const i=new hg(e,t,this.We,this.$e,r);return this.$e=Ri(),this.Ue=uG(),this.We=new dn(ct),i}ze(e,t){if(!this.Ye(e))return;const r=this.ut(e,t.key)?2:0;this.Je(e).Ne(t.key,r),this.$e=this.$e.insert(t.key,t),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}je(e,t,r){if(!this.Ye(e))return;const i=this.Je(e);this.ut(e,t)?i.Ne(t,1):i.Be(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),r&&(this.$e=this.$e.insert(t,r))}removeTarget(e){this.Ke.delete(e)}tt(e){const t=this.Je(e).xe();return this.Qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Le(e){this.Je(e).Le()}Je(e){let t=this.Ke.get(e);return t||(t=new lG,this.Ke.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new fn(ct),this.Ue=this.Ue.insert(e,t)),t}Ye(e){const t=null!==this.et(e);return t||se("WatchChangeAggregator","Detected inactive target",e),t}et(e){const t=this.Ke.get(e);return t&&t.ve?null:this.Qe.lt(e)}Ze(e){this.Ke.set(e,new lG),this.Qe.getRemoteKeysForTarget(e).forEach(t=>{this.je(e,t,null)})}ut(e,t){return this.Qe.getRemoteKeysForTarget(e).has(t)}}function uG(){return new dn(Te.comparator)}function hG(){return new dn(Te.comparator)}const qhe={asc:"ASCENDING",desc:"DESCENDING"},Xhe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yhe={and:"AND",or:"OR"};class Khe{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function CM(n,e){return n.useProto3Json||Qm(e)?e:{value:e}}function dd(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dG(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Qhe(n,e){return dd(n,e.toTimestamp())}function Wn(n){return Be(!!n),je.fromTimestamp(function(t){const r=cc(t);return new In(r.seconds,r.nanos)}(n))}function MM(n,e){return(r=n,new Vt(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function fG(n){const e=Vt.fromString(n);return Be(xG(e)),e}function fg(n,e){return MM(n.databaseId,e.path)}function Do(n,e){const t=fG(e);if(t.get(1)!==n.databaseId.projectId)throw new re(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new re(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Te(mG(t))}function IM(n,e){return MM(n.databaseId,e)}function pg(n){return new Vt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mG(n){return Be(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function gG(n,e,t){return{name:fg(n,e),fields:t.value.mapValue.fields}}function yG(n,e){return{documents:[IM(n,e.path)]}}function RM(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=IM(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=IM(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(c){if(0!==c.length)return EG(Yt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(c){if(0!==c.length)return c.map(l=>{return{field:fc((h=l).field),direction:nde(h.dir)};var h})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=CM(n,e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t;var c}function vG(n){let e=function pG(n){const e=fG(n);return 4===e.length?Vt.emptyPath():mG(e)}(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Be(1===r);const u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(h){const d=wG(h);return d instanceof Yt&&mM(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(d=>{return new rd(fd((p=d).field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction));var p}));let a=null;t.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,Qm(d)?null:d}(t.limit));let c=null;var h;t.startAt&&(c=new dc((h=t.startAt).values||[],!!h.before));let l=null;return t.endAt&&(l=function(h){return new dc(h.values||[],!h.before)}(t.endAt)),function LH(n,e,t,r,i,s,o,a){return new aa(n,e,t,r,i,s,o,a)}(e,i,o,s,a,"F",c,l)}function wG(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=fd(t.unaryFilter.field);return Rt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=fd(t.unaryFilter.field);return Rt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=fd(t.unaryFilter.field);return Rt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=fd(t.unaryFilter.field);return Rt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Oe()}}(n):void 0!==n.fieldFilter?Rt.create(fd((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Oe()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return Yt.create(t.compositeFilter.filters.map(r=>wG(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Oe()}}(t.compositeFilter.op))}(n):Oe();var t}function nde(n){return qhe[n]}function rde(n){return Xhe[n]}function ide(n){return Yhe[n]}function fc(n){return{fieldPath:n.canonicalString()}}function fd(n){return On.fromServerFormat(n.fieldPath)}function EG(n){return n instanceof Rt?function(t){if("=="===t.op){if(yH(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NAN"}};if(_H(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(yH(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NOT_NAN"}};if(_H(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fc(t.field),op:rde(t.op),value:t.value}}}(n):n instanceof Yt?function(t){const r=t.getFilters().map(i=>EG(i));return 1===r.length?r[0]:{compositeFilter:{op:ide(t.op),filters:r}}}(n):Oe()}function sde(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function xG(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class ua{constructor(e,t,r,i,s=je.min(),o=je.min(),a=mr.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new ua(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bG{constructor(e){this.ht=e}}function PM(n){const e=vG({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?j0(e,e.limit,"L"):e}class Dl{constructor(){}dt(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.At(t,5);else if("booleanValue"in e)this.At(t,10),t.Rt(e.booleanValue?1:0);else if("integerValue"in e)this.At(t,15),t.Rt(Fn(e.integerValue));else if("doubleValue"in e){const r=Fn(e.doubleValue);isNaN(r)?this.At(t,13):(this.At(t,15),Zm(r)?t.Rt(0):t.Rt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.At(t,20),"string"==typeof r?t.Vt(r):(t.Vt(`${r.seconds||""}`),t.Rt(r.nanos||0))}else if("stringValue"in e)this.ft(e.stringValue,t),this.gt(t);else if("bytesValue"in e)this.At(t,30),t.yt(oa(e.bytesValue)),this.gt(t);else if("referenceValue"in e)this.wt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.At(t,45),t.Rt(r.latitude||0),t.Rt(r.longitude||0)}else"mapValue"in e?vH(e)?this.At(t,Number.MAX_SAFE_INTEGER):(this.St(e.mapValue,t),this.gt(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.gt(t)):Oe()}ft(e,t){this.At(t,25),this.Dt(e,t)}Dt(e,t){t.Vt(e)}St(e,t){const r=e.fields||{};this.At(t,55);for(const i of Object.keys(r))this.ft(i,t),this.Tt(r[i],t)}bt(e,t){const r=e.values||[];this.At(t,50);for(const i of r)this.Tt(i,t)}wt(e,t){this.At(t,37),Te.fromName(e).path.forEach(r=>{this.At(t,60),this.Dt(r,t)})}At(e,t){e.Rt(t)}gt(e){e.Rt(2)}}Dl.Ct=new Dl;class fde{constructor(){this.an=new VM}addToCollectionParentIndex(e,t){return this.an.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.an.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(Ji.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(Ji.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class VM{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fn(Vt.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fn(Vt.comparator)).toArray()}}new Uint8Array(0);class Qr{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Qr(e,Qr.DEFAULT_COLLECTION_PERCENTILE,Qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Qr.DEFAULT_COLLECTION_PERCENTILE=10,Qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qr.DEFAULT=new Qr(41943040,Qr.DEFAULT_COLLECTION_PERCENTILE,Qr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qr.DISABLED=new Qr(-1,0,0);class Pl{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static Bn(){return new Pl(0)}static Ln(){return new Pl(-1)}}class vde{constructor(){this.changes=new ca(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,vn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xde{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class KG{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&lg(r.mutation,i,Di.empty(),In.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,yt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=yt()){const i=Io();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=og();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Io();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,yt()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ri();const o=ag(),a=ag();return t.forEach((c,l)=>{const u=r.get(l.key);i.has(l.key)&&(void 0===u||u.mutation instanceof la)?s=s.insert(l.key,l):void 0!==u?(o.set(l.key,u.mutation.getFieldMask()),lg(u.mutation,l,u.mutation.getFieldMask(),In.now())):o.set(l.key,Di.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var h;return a.set(l,new xde(u,null!==(h=o.get(l))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ag();let i=new dn((o,a)=>o-a),s=yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(null===l)return;let u=r.get(c)||Di.empty();u=a.applyToLocalView(l,u),r.set(c,u);const h=(i.get(a.batchId)||yt()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,h=HH();u.forEach(d=>{if(!s.has(d)){const f=QH(t.get(d),r.get(d));null!==f&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,h))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Te.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function vM(n){return null!==n.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):V.resolve(Io());let a=-1,c=s;return o.next(l=>V.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?V.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,yt())).next(u=>({batchId:a,changes:zH(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Te(t)).next(r=>{let i=og();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=og();return this.indexManager.getCollectionParents(e,s).next(a=>V.forEach(a,c=>{const l=(h=t,d=c.child(s),new aa(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,l)=>{const u=l.getKey();null===o.get(u)&&(o=o.insert(u,vn.newInvalidDocument(u)))});let a=og();return o.forEach((c,l)=>{const u=s.get(c);void 0!==u&&lg(u.mutation,l,Di.empty(),In.now()),sg(t,l)&&(a=a.insert(c,l))}),a})}}class bde{constructor(e){this.serializer=e,this.lr=new Map,this.hr=new Map}getBundleMetadata(e,t){return V.resolve(this.lr.get(t))}saveBundleMetadata(e,t){return this.lr.set(t.id,{id:(i=t).id,version:i.version,createTime:Wn(i.createTime)}),V.resolve();var i}getNamedQuery(e,t){return V.resolve(this.hr.get(t))}saveNamedQuery(e,t){return this.hr.set(t.name,{name:(i=t).name,query:PM(i.bundledQuery),readTime:Wn(i.readTime)}),V.resolve();var i}}class Tde{constructor(){this.overlays=new dn(Te.comparator),this.Pr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Io();return V.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.It(e,t,s)}),V.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Pr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Pr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const i=Io(),s=t.length+1,o=new Te(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return V.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new dn((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let u=s.get(l.largestBatchId);null===u&&(u=Io(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=Io(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=i)););return V.resolve(a)}It(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.Pr.get(i.largestBatchId).delete(r.key);this.Pr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new SM(t,r));let s=this.Pr.get(t);void 0===s&&(s=yt(),this.Pr.set(t,s)),this.Pr.set(t,s.add(r.key))}}class UM{constructor(){this.Ir=new fn(br.dr),this.Tr=new fn(br.Er)}isEmpty(){return this.Ir.isEmpty()}addReference(e,t){const r=new br(e,t);this.Ir=this.Ir.add(r),this.Tr=this.Tr.add(r)}Ar(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Rr(new br(e,t))}Vr(e,t){e.forEach(r=>this.removeReference(r,t))}mr(e){const t=new Te(new Vt([])),r=new br(t,e),i=new br(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Rr(o),s.push(o.key)}),s}gr(){this.Ir.forEach(e=>this.Rr(e))}Rr(e){this.Ir=this.Ir.delete(e),this.Tr=this.Tr.delete(e)}pr(e){const t=new Te(new Vt([])),r=new br(t,e),i=new br(t,e+1);let s=yt();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new br(e,0),r=this.Ir.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class br{constructor(e,t){this.key=e,this.yr=t}static dr(e,t){return Te.comparator(e.key,t.key)||ct(e.yr,t.yr)}static Er(e,t){return ct(e.yr,t.yr)||Te.comparator(e.key,t.key)}}class Sde{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.wr=1,this.Sr=new fn(br.dr)}checkEmpty(e){return V.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.wr;this.wr++;const o=new bM(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.Sr=this.Sr.add(new br(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.br(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Dr(t+1),s=i<0?0:i;return V.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(0===this.mutationQueue.length?-1:this.wr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new br(t,0),i=new br(t,Number.POSITIVE_INFINITY),s=[];return this.Sr.forEachInRange([r,i],o=>{const a=this.br(o.yr);s.push(a)}),V.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fn(ct);return t.forEach(i=>{const s=new br(i,0),o=new br(i,Number.POSITIVE_INFINITY);this.Sr.forEachInRange([s,o],a=>{r=r.add(a.yr)})}),V.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Te.isDocumentKey(s)||(s=s.child(""));const o=new br(new Te(s),0);let a=new fn(ct);return this.Sr.forEachWhile(c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(c.yr)),!0)},o),V.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const i=this.br(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){Be(0===this.vr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.Sr;return V.forEach(t.mutations,i=>{const s=new br(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Sr=r})}xn(e){}containsKey(e,t){const r=new br(t,0),i=this.Sr.firstAfterOrEqual(r);return V.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return V.resolve()}vr(e,t){return this.Dr(e)}Dr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}br(e){const t=this.Dr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ade{constructor(e){this.Fr=e,this.docs=new dn(Te.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Fr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():vn.newInvalidDocument(t))}getEntries(e,t){let r=Ri();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():vn.newInvalidDocument(i))}),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ri();const o=t.path,a=new Te(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||cM(nH(u),r)<=0||(i.has(u.key)||sg(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return V.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Oe()}Mr(e,t){return V.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Cde(this)}getSize(e){return V.resolve(this.size)}}class Cde extends vde{constructor(e){super(),this.ur=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ur.addEntry(e,i)):this.ur.removeEntry(r)}),V.waitFor(t)}getFromCache(e,t){return this.ur.getEntry(e,t)}getAllFromCache(e,t){return this.ur.getEntries(e,t)}}class Mde{constructor(e){this.persistence=e,this.Or=new ca(t=>Tl(t),rg),this.lastRemoteSnapshotVersion=je.min(),this.highestTargetId=0,this.Nr=0,this.Br=new UM,this.targetCount=0,this.Lr=Pl.Bn()}forEachTarget(e,t){return this.Or.forEach((r,i)=>t(i)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.Nr)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Nr&&(this.Nr=t),V.resolve()}Qn(e){this.Or.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Pl(t),this.highestTargetId=t),e.sequenceNumber>this.Nr&&(this.Nr=e.sequenceNumber)}addTargetData(e,t){return this.Qn(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Qn(t),V.resolve()}removeTargetData(e,t){return this.Or.delete(t.target),this.Br.mr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Or.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Or.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),V.waitFor(s).next(()=>i)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.Or.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Ar(t,r),V.resolve()}removeMatchingKeys(e,t,r){this.Br.Vr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),V.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.mr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.pr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this.Br.containsKey(t))}}class BM{constructor(e,t){this.kr={},this.overlays={},this.qr=new es(0),this.Qr=!1,this.Qr=!0,this.referenceDelegate=e(this),this.Kr=new Mde(this),this.indexManager=new fde,this.remoteDocumentCache=new Ade(r=>this.referenceDelegate.$r(r)),this.serializer=new bG(t),this.Ur=new bde(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Qr=!1,Promise.resolve()}get started(){return this.Qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Tde,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.kr[e.toKey()];return r||(r=new Sde(t,this.referenceDelegate),this.kr[e.toKey()]=r),r}getTargetCache(){return this.Kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ur}runTransaction(e,t,r){se("MemoryPersistence","Starting transaction:",e);const i=new Ide(this.qr.next());return this.referenceDelegate.Wr(),r(i).next(s=>this.referenceDelegate.Gr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}zr(e,t){return V.or(Object.values(this.kr).map(r=>()=>r.containsKey(e,t)))}}class Ide extends Que{constructor(e){super(),this.currentSequenceNumber=e}}class rw{constructor(e){this.persistence=e,this.jr=new UM,this.Hr=null}static Jr(e){return new rw(e)}get Yr(){if(this.Hr)return this.Hr;throw Oe()}addReference(e,t,r){return this.jr.addReference(r,t),this.Yr.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.jr.removeReference(r,t),this.Yr.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.Yr.add(t.toString()),V.resolve()}removeTarget(e,t){this.jr.mr(t.targetId).forEach(i=>this.Yr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Yr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Wr(){this.Hr=new Set}Gr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.Yr,r=>{const i=Te.fromPath(r);return this.Zr(e,i).next(s=>{s||t.removeEntry(i,je.min())})}).next(()=>(this.Hr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Zr(e,t).next(r=>{r?this.Yr.delete(t.toString()):this.Yr.add(t.toString())})}$r(e){return 0}Zr(e,t){return V.or([()=>V.resolve(this.jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.zr(e,t)])}}class jM{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Qi=r,this.Ki=i}static $i(e,t){let r=yt(),i=yt();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new jM(e,t.fromCache,r,i)}}class Rde{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ZG{constructor(){this.Ui=!1,this.Wi=!1,this.Gi=100,this.zi=8}initialize(e,t){this.ji=e,this.indexManager=t,this.Ui=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.Hi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Rde;return this.Yi(e,t,o).next(a=>{if(s.result=a,this.Wi)return this.Zi(e,t,o,a.size)})}).next(()=>s.result)}Zi(e,t,r,i){return r.documentReadCount<this.Gi?(Qh()<=Bt.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",ad(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Gi,"documents"),V.resolve()):(Qh()<=Bt.DEBUG&&se("QueryEngine","Query:",ad(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.zi*i?(Qh()<=Bt.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",ad(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mi(t))):V.resolve())}Hi(e,t){if(OH(t))return V.resolve(null);let r=mi(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=j0(t,null,"F"),r=mi(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=yt(...s);return this.ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const l=this.Xi(t,a);return this.es(t,l,o,c.readTime)?this.Hi(e,j0(t,null,"F")):this.ts(e,l,t,c)}))})))}Ji(e,t,r,i){return OH(t)||i.isEqual(je.min())?V.resolve(null):this.ji.getDocuments(e,r).next(s=>{const o=this.Xi(t,s);return this.es(t,o,r,i)?V.resolve(null):(Qh()<=Bt.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ad(t)),this.ts(e,o,t,function tH(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=je.fromTimestamp(1e9===r?new In(t+1,0):new In(t,r));return new Ji(i,Te.empty(),e)}(i,-1)).next(a=>a))})}Xi(e,t){let r=new fn(UH(e));return t.forEach((i,s)=>{sg(e,s)&&(r=r.add(s))}),r}es(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Yi(e,t,r){return Qh()<=Bt.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",ad(t)),this.ji.getDocumentsMatchingQuery(e,t,Ji.min(),r)}ts(e,t,r,i){return this.ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Pde{constructor(e,t,r,i){this.persistence=e,this.ns=t,this.serializer=i,this.rs=new dn(ct),this.ss=new ca(s=>Tl(s),rg),this.os=new Map,this._s=e.getRemoteDocumentCache(),this.Kr=e.getTargetCache(),this.Ur=e.getBundleCache(),this.us(r)}us(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KG(this._s,this.mutationQueue,this.documentOverlayCache,this.indexManager),this._s.setIndexManager(this.indexManager),this.ns.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.rs))}}function e4(n,e){return WM.apply(this,arguments)}function WM(){return WM=Pe(function*(n,e){const t=be(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.us(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let c=yt();for(const l of i){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next(l=>({cs:l,removedBatchIds:o,addedBatchIds:a}))})})}),WM.apply(this,arguments)}function t4(n){const e=be(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Kr.getLastRemoteSnapshotVersion(t))}function Ode(n,e){const t=be(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function vd(n,e,t){return $M.apply(this,arguments)}function $M(){return $M=Pe(function*(n,e,t){const r=be(n),i=r.rs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!oc(o))throw o;se("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.rs=r.rs.remove(e),r.ss.delete(i.target)}),$M.apply(this,arguments)}function ow(n,e,t){const r=be(n);let i=je.min(),s=yt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){const h=be(c),d=h.ss.get(u);return void 0!==d?V.resolve(h.rs.get(d)):h.Kr.getTargetData(l,u)}(r,o,mi(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Kr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ns.getDocumentsMatchingQuery(o,e,t?i:je.min(),t?s:yt())).next(a=>(function s4(n,e,t){let r=n.os.get(e)||je.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.os.set(e,r)}(r,function VH(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,Ps:s})))}class QM{constructor(){this.activeTargetIds=function EM(){return Fhe}()}Rs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}As(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class c4{constructor(){this.ro=new QM,this.io={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.ro.Rs(e),this.io[e]||"not-current"}updateQueryState(e,t,r){this.io[e]=t}removeLocalQueryTarget(e){this.ro.Vs(e)}isLocalQueryTarget(e){return this.ro.activeTargetIds.has(e)}clearQueryState(e){delete this.io[e]}getAllActiveQueryTargets(){return this.ro.activeTargetIds}isActiveQueryTarget(e){return this.ro.activeTargetIds.has(e)}start(){return this.ro=new QM,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Vde{so(e){}shutdown(){}}class l4{constructor(){this.oo=()=>this._o(),this.ao=()=>this.uo(),this.co=[],this.lo()}so(e){this.co.push(e)}shutdown(){window.removeEventListener("online",this.oo),window.removeEventListener("offline",this.ao)}lo(){window.addEventListener("online",this.oo),window.addEventListener("offline",this.ao)}_o(){se("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.co)e(0)}uo(){se("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.co)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lw=null;function JM(){return null===lw?lw=268435456+Math.round(2147483648*Math.random()):lw++,"0x"+lw.toString(16)}const Ude={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bde{constructor(e){this.ho=e.ho,this.Po=e.Po}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.Po()}send(e){this.ho(e)}Vo(){this.To()}mo(e){this.Ao(e)}fo(e){this.Ro(e)}}const Zr="WebChannelConnection";class zde extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.po=r+"://"+t.host,this.yo=`projects/${i}/databases/${s}`,this.wo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get So(){return!1}bo(t,r,i,s,o){const a=JM(),c=this.Do(t,r);se("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);const l={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Co(l,s,o),this.vo(t,c,l,i).then(u=>(se("RestConnection",`Received RPC '${t}' ${a}: `,u),u),u=>{throw Zi("RestConnection",`RPC '${t}' ${a} failed with error: `,u,"url: ",c,"request:",i),u})}Fo(t,r,i,s,o,a){return this.bo(t,r,i,s,o)}Co(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Kh,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Do(t,r){return`${this.po}/v1/${r}:${Ude[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,i){const s=JM();return new Promise((o,a)=>{const c=new Uue;c.setWithCredentials(!0),c.listenOnce(kue.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case sM.NO_ERROR:const u=c.getResponseJson();se(Zr,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(u)),o(u);break;case sM.TIMEOUT:se(Zr,`RPC '${e}' ${s} timed out`),a(new re(G.DEADLINE_EXCEEDED,"Request time out"));break;case sM.HTTP_ERROR:const h=c.getStatus();if(se(Zr,`RPC '${e}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d?.error;if(f&&f.status&&f.message){const p=function(_){const g=_.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(g)>=0?g:G.UNKNOWN}(f.status);a(new re(p,f.message))}else a(new re(G.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new re(G.UNAVAILABLE,"Connection failed."));break;default:Oe()}}finally{se(Zr,`RPC '${e}' ${s} completed.`)}});const l=JSON.stringify(i);se(Zr,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",l,r,15)})}Mo(e,t,r){const i=JM(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Oue(),a=Fue(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Co(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const u=s.join("");se(Zr,`Creating RPC '${e}' stream ${i}: ${u}`,c);const h=o.createWebChannel(u,c);let d=!1,f=!1;const p=new Bde({ho:_=>{f?se(Zr,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(d||(se(Zr,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),se(Zr,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},Po:()=>h.close()}),m=(_,g,y)=>{_.listen(g,v=>{try{y(v)}catch(w){setTimeout(()=>{throw w},0)}})};return m(h,P0.EventType.OPEN,()=>{f||se(Zr,`RPC '${e}' stream ${i} transport opened.`)}),m(h,P0.EventType.CLOSE,()=>{f||(f=!0,se(Zr,`RPC '${e}' stream ${i} transport closed`),p.mo())}),m(h,P0.EventType.ERROR,_=>{f||(f=!0,Zi(Zr,`RPC '${e}' stream ${i} transport errored:`,_),p.mo(new re(G.UNAVAILABLE,"The operation could not be completed")))}),m(h,P0.EventType.MESSAGE,_=>{var g;if(!f){const y=_.data[0];Be(!!y);const w=y.error||(null===(g=y[0])||void 0===g?void 0:g.error);if(w){se(Zr,`RPC '${e}' stream ${i} received error:`,w);const E=w.status;let b=function(x){const A=nr[x];if(void 0!==A)return rG(A)}(E),T=w.message;void 0===b&&(b=G.INTERNAL,T="Unknown error status: "+E+" with message "+w.message),f=!0,p.mo(new re(b,T)),h.close()}else se(Zr,`RPC '${e}' stream ${i} received:`,y),p.fo(y)}}),m(a,Vue.STAT_EVENT,_=>{_.stat===Yz.PROXY?se(Zr,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Yz.NOPROXY&&se(Zr,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{p.Vo()},0),p}}function uw(){return typeof document<"u"?document:null}function bg(n){return new Khe(n,!0)}class eI{constructor(e,t,r=1e3,i=1.5,s=6e4){this._i=e,this.timerId=t,this.xo=r,this.Oo=i,this.No=s,this.Bo=0,this.Lo=null,this.ko=Date.now(),this.reset()}reset(){this.Bo=0}qo(){this.Bo=this.No}Qo(e){this.cancel();const t=Math.floor(this.Bo+this.Ko()),r=Math.max(0,Date.now()-this.ko),i=Math.max(0,t-r);i>0&&se("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this._i.enqueueAfterDelay(this.timerId,i,()=>(this.ko=Date.now(),e())),this.Bo*=this.Oo,this.Bo<this.xo&&(this.Bo=this.xo),this.Bo>this.No&&(this.Bo=this.No)}$o(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Ko(){return(Math.random()-.5)*this.Bo}}class h4{constructor(e,t,r,i,s,o,a,c){this._i=e,this.Uo=r,this.Wo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Go=0,this.zo=null,this.jo=null,this.stream=null,this.Ho=new eI(e,t)}Jo(){return 1===this.state||5===this.state||this.Yo()}Yo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Zo()}stop(){var e=this;return Pe(function*(){e.Jo()&&(yield e.close(0))})()}Xo(){this.state=0,this.Ho.reset()}e_(){this.Yo()&&null===this.zo&&(this.zo=this._i.enqueueAfterDelay(this.Uo,6e4,()=>this.t_()))}n_(e){this.r_(),this.stream.send(e)}t_(){var e=this;return Pe(function*(){if(e.Yo())return e.close(0)})()}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}close(e,t){var r=this;return Pe(function*(){r.r_(),r.i_(),r.Ho.cancel(),r.Go++,4!==e?r.Ho.reset():t&&t.code===G.RESOURCE_EXHAUSTED?(jn(t.toString()),jn("Using maximum backoff delay to prevent overloading the backend."),r.Ho.qo()):t&&t.code===G.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.s_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Eo(t)})()}s_(){}auth(){this.state=1;const e=this.o_(this.Go),t=this.Go;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Go===t&&this.__(r,i)},r=>{e(()=>{const i=new re(G.UNKNOWN,"Fetching auth token failed: "+r.message);return this.a_(i)})})}__(e,t){const r=this.o_(this.Go);this.stream=this.u_(e,t),this.stream.Io(()=>{r(()=>(this.state=2,this.jo=this._i.enqueueAfterDelay(this.Wo,1e4,()=>(this.Yo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.a_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Zo(){var e=this;this.state=5,this.Ho.Qo(Pe(function*(){e.state=0,e.start()}))}a_(e){return se("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}o_(e){return t=>{this._i.enqueueAndForget(()=>this.Go===e?t():(se("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Hde extends h4{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}u_(e,t){return this.connection.Mo("Listen",e,t)}onMessage(e){this.Ho.reset();const t=function Jhe(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(l=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:Oe(),i=e.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?(Be(void 0===u||"string"==typeof u),mr.fromBase64String(u||"")):(Be(void 0===u||u instanceof Uint8Array),mr.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const u=void 0===l.code?G.UNKNOWN:rG(l.code);return new re(u,l.message||"")}(o);t=new cG(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=Do(n,r.document.name),s=Wn(r.document.updateTime),o=r.document.createTime?Wn(r.document.createTime):je.min(),a=new Nr({mapValue:{fields:r.document.fields}}),c=vn.newFoundDocument(i,s,o,a);t=new Y0(r.targetIds||[],r.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const r=e.documentDelete,i=Do(n,r.document),s=r.readTime?Wn(r.readTime):je.min(),o=vn.newNoDocument(i,s);t=new Y0([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Do(n,r.document);t=new Y0([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return Oe();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new jhe(i,s);t=new aG(r.targetId,o)}}var l;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return je.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?je.min():o.readTime?Wn(o.readTime):je.min()}(e);return this.listener.c_(t,r)}l_(e){const t={};t.database=pg(this.serializer),t.addTarget=function(s,o){let a;const c=o.target;if(a=z0(c)?{documents:yG(s,c)}:{query:RM(s,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=dG(s,o.resumeToken);const l=CM(s,o.expectedCount);null!==l&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(je.min())>0){a.readTime=dd(s,o.snapshotVersion.toTimestamp());const l=CM(s,o.expectedCount);null!==l&&(a.expectedCount=l)}return a}(this.serializer,e);const r=function tde(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Oe()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.n_(t)}h_(e){const t={};t.database=pg(this.serializer),t.removeTarget=e,this.n_(t)}}class Gde extends h4{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.P_=!1}get I_(){return this.P_}start(){this.P_=!1,this.lastStreamToken=void 0,super.start()}s_(){this.P_&&this.d_([])}u_(e,t){return this.connection.Mo("Write",e,t)}onMessage(e){if(Be(!!e.streamToken),this.lastStreamToken=e.streamToken,this.P_){this.Ho.reset();const t=function ede(n,e){return n&&n.length>0?(Be(void 0!==e),n.map(t=>function(i,s){let o=Wn(i.updateTime?i.updateTime:s);return o.isEqual(je.min())&&(o=Wn(s)),new Bhe(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Wn(e.commitTime);return this.listener.T_(r,t)}return Be(!e.writeResults||0===e.writeResults.length),this.P_=!0,this.listener.E_()}A_(){const e={};e.database=pg(this.serializer),this.n_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>function mg(n,e){let t;if(e instanceof ud)t={update:gG(n,e.key,e.value)};else if(e instanceof hd)t={delete:fg(n,e.key)};else if(e instanceof la)t={update:gG(n,e.key,e.data),updateMask:sde(e.fieldMask)};else{if(!(e instanceof xM))return Oe();t={verify:fg(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof cd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Sl)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Al)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ld)return{fieldPath:o.field.canonicalString(),increment:a.Te};throw Oe()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Qhe(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:Oe()),t;var s}(this.serializer,r))};this.n_(t)}}class jde extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.R_=!1}V_(){if(this.R_)throw new re(G.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,r){return this.V_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.bo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new re(G.UNKNOWN,i.toString())})}Fo(e,t,r,i){return this.V_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Fo(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new re(G.UNKNOWN,s.toString())})}terminate(){this.R_=!0}}class $de{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.f_=0,this.g_=null,this.p_=!0}y_(){0===this.f_&&(this.w_("Unknown"),this.g_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.g_=null,this.S_("Backend didn't respond within 10 seconds."),this.w_("Offline"),Promise.resolve())))}b_(e){"Online"===this.state?this.w_("Unknown"):(this.f_++,this.f_>=1&&(this.D_(),this.S_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.w_("Offline")))}set(e){this.D_(),this.f_=0,"Online"===e&&(this.p_=!1),this.w_(e)}w_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}S_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.p_?(jn(t),this.p_=!1):se("OnlineStateTracker",t)}D_(){null!==this.g_&&(this.g_.cancel(),this.g_=null)}}class qde{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.C_=[],this.v_=new Map,this.F_=new Set,this.M_=[],this.x_=s,this.x_.so(a=>{r.enqueueAndForget(Pe(function*(){var c;_c(o)&&(se("RemoteStore","Restarting streams for network reachability change."),yield(c=Pe(function*(u){const h=be(u);h.F_.add(4),yield wd(h),h.O_.set("Unknown"),h.F_.delete(4),yield Tg(h)}),function l(u){return c.apply(this,arguments)})(o))}))}),this.O_=new $de(r,i)}}function Tg(n){return nI.apply(this,arguments)}function nI(){return nI=Pe(function*(n){if(_c(n))for(const e of n.M_)yield e(!0)}),nI.apply(this,arguments)}function wd(n){return rI.apply(this,arguments)}function rI(){return rI=Pe(function*(n){for(const e of n.M_)yield e(!1)}),rI.apply(this,arguments)}function hw(n,e){const t=be(n);t.v_.has(e.targetId)||(t.v_.set(e.targetId,e),oI(t)?sI(t):xd(t).Yo()&&iI(t,e))}function Sg(n,e){const t=be(n),r=xd(t);t.v_.delete(e),r.Yo()&&d4(t,e),0===t.v_.size&&(r.Yo()?r.e_():_c(t)&&t.O_.set("Unknown"))}function iI(n,e){if(n.N_.Le(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(je.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xd(n).l_(e)}function d4(n,e){n.N_.Le(e),xd(n).h_(e)}function sI(n){n.N_=new $he({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.v_.get(e)||null,st:()=>n.datastore.serializer.databaseId}),xd(n).start(),n.O_.y_()}function oI(n){return _c(n)&&!xd(n).Jo()&&n.v_.size>0}function _c(n){return 0===be(n).F_.size}function f4(n){n.N_=void 0}function Xde(n){return aI.apply(this,arguments)}function aI(){return aI=Pe(function*(n){n.v_.forEach((e,t)=>{iI(n,e)})}),aI.apply(this,arguments)}function Yde(n,e){return cI.apply(this,arguments)}function cI(){return cI=Pe(function*(n,e){f4(n),oI(n)?(n.O_.b_(e),sI(n)):n.O_.set("Unknown")}),cI.apply(this,arguments)}function Kde(n,e,t){return lI.apply(this,arguments)}function lI(){return lI=Pe(function*(n,e,t){if(n.O_.set("Online"),e instanceof cG&&2===e.state&&e.cause)try{yield(r=Pe(function*(s,o){const a=o.cause;for(const c of o.targetIds)s.v_.has(c)&&(yield s.remoteSyncer.rejectListen(c,a),s.v_.delete(c),s.N_.removeTarget(c))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){se("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield dw(n,r)}else if(e instanceof Y0?n.N_.Ge(e):e instanceof aG?n.N_.Xe(e):n.N_.He(e),!t.isEqual(je.min()))try{const r=yield t4(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.N_._t(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const u=s.v_.get(l);u&&s.v_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{const u=s.v_.get(c);if(!u)return;s.v_.set(c,u.withResumeToken(mr.EMPTY_BYTE_STRING,u.snapshotVersion)),d4(s,c);const h=new ua(u.target,c,l,u.sequenceNumber);iI(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){se("RemoteStore","Failed to raise snapshot:",r),yield dw(n,r)}var r}),lI.apply(this,arguments)}function dw(n,e,t){return uI.apply(this,arguments)}function uI(){return uI=Pe(function*(n,e,t){if(!oc(e))throw e;n.F_.add(1),yield wd(n),n.O_.set("Offline"),t||(t=()=>t4(n.localStore)),n.asyncQueue.enqueueRetryable(Pe(function*(){se("RemoteStore","Retrying IndexedDB access"),yield t(),n.F_.delete(1),yield Tg(n)}))}),uI.apply(this,arguments)}function p4(n,e){return e().catch(t=>dw(n,t,e))}function Ed(n){return hI.apply(this,arguments)}function hI(){return hI=Pe(function*(n){const e=be(n),t=yc(e);let r=e.C_.length>0?e.C_[e.C_.length-1].batchId:-1;for(;Qde(e);)try{const i=yield Ode(e.localStore,r);if(null===i){0===e.C_.length&&t.e_();break}r=i.batchId,Zde(e,i)}catch(i){yield dw(e,i)}m4(e)&&g4(e)}),hI.apply(this,arguments)}function Qde(n){return _c(n)&&n.C_.length<10}function Zde(n,e){n.C_.push(e);const t=yc(n);t.Yo()&&t.I_&&t.d_(e.mutations)}function m4(n){return _c(n)&&!yc(n).Jo()&&n.C_.length>0}function g4(n){yc(n).start()}function Jde(n){return dI.apply(this,arguments)}function dI(){return dI=Pe(function*(n){yc(n).A_()}),dI.apply(this,arguments)}function efe(n){return fI.apply(this,arguments)}function fI(){return fI=Pe(function*(n){const e=yc(n);for(const t of n.C_)e.d_(t.mutations)}),fI.apply(this,arguments)}function tfe(n,e,t){return pI.apply(this,arguments)}function pI(){return pI=Pe(function*(n,e,t){const r=n.C_.shift(),i=TM.from(r,e,t);yield p4(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ed(n)}),pI.apply(this,arguments)}function nfe(n,e){return mI.apply(this,arguments)}function mI(){return mI=Pe(function*(n,e){var t;e&&yc(n).I_&&(yield(t=Pe(function*(i,s){if(function nG(n){switch(n){default:return Oe();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0}}(a=s.code)&&a!==G.ABORTED){const o=i.C_.shift();yc(i).Xo(),yield p4(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Ed(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),m4(n)&&g4(n)}),mI.apply(this,arguments)}function _4(n,e){return gI.apply(this,arguments)}function gI(){return gI=Pe(function*(n,e){const t=be(n);t.asyncQueue.verifyOperationInProgress(),se("RemoteStore","RemoteStore received new credentials");const r=_c(t);t.F_.add(3),yield wd(t),r&&t.O_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.F_.delete(3),yield Tg(t)}),gI.apply(this,arguments)}function yI(){return yI=Pe(function*(n,e){const t=be(n);e?(t.F_.delete(2),yield Tg(t)):e||(t.F_.add(2),yield wd(t),t.O_.set("Unknown"))}),yI.apply(this,arguments)}function xd(n){return n.B_||(n.B_=function(t,r,i){const s=be(t);return s.V_(),new Hde(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Io:Xde.bind(null,n),Eo:Yde.bind(null,n),c_:Kde.bind(null,n)}),n.M_.push(function(){var e=Pe(function*(t){t?(n.B_.Xo(),oI(n)?sI(n):n.O_.set("Unknown")):(yield n.B_.stop(),f4(n))});return function(t){return e.apply(this,arguments)}}())),n.B_}function yc(n){return n.L_||(n.L_=function(t,r,i){const s=be(t);return s.V_(),new Gde(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Io:Jde.bind(null,n),Eo:nfe.bind(null,n),E_:efe.bind(null,n),T_:tfe.bind(null,n)}),n.M_.push(function(){var e=Pe(function*(t){t?(n.L_.Xo(),yield Ed(n)):(yield n.L_.stop(),n.C_.length>0&&(se("RemoteStore",`Stopping write stream with ${n.C_.length} pending writes`),n.C_=[]))});return function(t){return e.apply(this,arguments)}}())),n.L_}class vI{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new pr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new vI(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new re(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bd(n,e){if(jn("AsyncQueue",`${e}: ${n}`),oc(n))return new re(G.UNAVAILABLE,`${e}: ${n}`);throw n}class Td{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Te.comparator(t.key,r.key):(t,r)=>Te.comparator(t.key,r.key),this.keyedMap=og(),this.sortedSet=new dn(this.comparator)}static emptySet(e){return new Td(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Td)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Td;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class y4{constructor(){this.k_=new dn(Te.comparator)}track(e){const t=e.doc.key,r=this.k_.get(t);r?0!==e.type&&3===r.type?this.k_=this.k_.insert(t,e):3===e.type&&1!==r.type?this.k_=this.k_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.k_=this.k_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.k_=this.k_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.k_=this.k_.remove(t):1===e.type&&2===r.type?this.k_=this.k_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.k_=this.k_.insert(t,{type:2,doc:e.doc}):Oe():this.k_=this.k_.insert(t,e)}q_(){const e=[];return this.k_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Sd{constructor(e,t,r,i,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Sd(e,t,Td.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ig(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class rfe{constructor(){this.Q_=void 0,this.listeners=[]}}class ife{constructor(){this.queries=new ca(e=>kH(e),ig),this.onlineState="Unknown",this.K_=new Set}}function EI(){return EI=Pe(function*(n,e){const t=be(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new rfe),i)try{s.Q_=yield t.onListen(r)}catch(o){const a=bd(o,`Initialization of query '${ad(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.listeners.push(e),e.U_(t.onlineState),s.Q_&&e.W_(s.Q_)&&TI(t)}),EI.apply(this,arguments)}function bI(){return bI=Pe(function*(n,e){const t=be(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),bI.apply(this,arguments)}function sfe(n,e){const t=be(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.listeners)a.W_(i)&&(r=!0);o.Q_=i}}r&&TI(t)}function ofe(n,e,t){const r=be(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function TI(n){n.K_.forEach(e=>{e.next()})}class SI{constructor(e,t,r){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Sd(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){return!e.fromCache||(!this.options.Z_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Y_(e){e=Sd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class E4{constructor(e){this.key=e}}class x4{constructor(e){this.key=e}}class b4{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=yt(),this.mutatedKeys=yt(),this.ua=UH(e),this.ca=new Td(this.ua)}get la(){return this.oa}ha(e,t){const r=t?t.Pa:new y4,i=t?t.ca:this.ca;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{const d=i.get(u),f=sg(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),m=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let _=!1;d&&f?d.data.isEqual(f.data)?p!==m&&(r.track({type:3,doc:f}),_=!0):this.Ia(d,f)||(r.track({type:2,doc:f}),_=!0,(c&&this.ua(f,c)>0||l&&this.ua(f,l)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),_=!0):d&&!f&&(r.track({type:1,doc:d}),_=!0,(c||l)&&(a=!0)),_&&(f?(o=o.add(f),s=m?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const u="F"===this.query.limitType?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{ca:o,Pa:r,es:a,mutatedKeys:s}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.q_();s.sort((l,u)=>function(d,f){const p=m=>{switch(m){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Oe()}};return p(d)-p(f)}(l.type,u.type)||this.ua(l.doc,u.doc)),this.da(r);const o=t?this.Ta():[],a=0===this.aa.size&&this.current?1:0,c=a!==this._a;return this._a=a,0!==s.length||c?{snapshot:new Sd(this.query,e.ca,i,s,e.mutatedKeys,0===a,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ea:o}:{Ea:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new y4,mutatedKeys:this.mutatedKeys,es:!1},!1)):{Ea:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}da(e){e&&(e.addedDocuments.forEach(t=>this.oa=this.oa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.oa=this.oa.delete(t)),this.current=e.current)}Ta(){if(!this.current)return[];const e=this.aa;this.aa=yt(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});const t=[];return e.forEach(r=>{this.aa.has(r)||t.push(new x4(r))}),this.aa.forEach(r=>{e.has(r)||t.push(new E4(r))}),t}Ra(e){this.oa=e.Ps,this.aa=yt();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Sd.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class lfe{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ufe{constructor(e){this.key=e,this.ma=!1}}class hfe{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new ca(a=>kH(a),ig),this.pa=new Map,this.ya=new Set,this.wa=new dn(Te.comparator),this.Sa=new Map,this.ba=new UM,this.Da={},this.Ca=new Map,this.va=Pl.Ln(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}function dfe(n,e){return AI.apply(this,arguments)}function AI(){return AI=Pe(function*(n,e){const t=function YI(n){const e=be(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=T4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Efe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=mfe.bind(null,e),e.fa.c_=sfe.bind(null,e.eventManager),e.fa.xa=ofe.bind(null,e.eventManager),e}(n);let r,i;const s=t.ga.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const o=yield function yd(n,e){const t=be(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Kr.getTargetData(r,e).next(s=>s?(i=s,V.resolve(i)):t.Kr.allocateTargetId(r).next(o=>(i=new ua(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Kr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.rs.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.rs=t.rs.insert(r.targetId,r),t.ss.set(e,r.targetId)),r})}(t.localStore,mi(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield function CI(n,e,t,r,i){return MI.apply(this,arguments)}(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&hw(t.remoteStore,o)}return i}),AI.apply(this,arguments)}function MI(){return MI=Pe(function*(n,e,t,r,i){n.Ma=(h,d,f)=>{return(p=Pe(function*(_,g,y,v){let w=g.view.ha(y);w.es&&(w=yield ow(_.localStore,g.query,!1).then(({documents:T})=>g.view.ha(T,w)));const E=v&&v.targetChanges.get(g.targetId),b=g.view.applyChanges(w,_.isPrimaryClient,E);return VI(_,g.targetId,b.Ea),b.snapshot}),function m(_,g,y,v){return p.apply(this,arguments)})(n,h,d,f);var p};const s=yield ow(n.localStore,e,!0),o=new b4(e,s.Ps),a=o.ha(s.documents),c=dg.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=o.applyChanges(a,n.isPrimaryClient,c);VI(n,t,l.Ea);const u=new lfe(e,t,o);return n.ga.set(e,u),n.pa.has(t)?n.pa.get(t).push(e):n.pa.set(t,[e]),l.snapshot}),MI.apply(this,arguments)}function ffe(n,e){return II.apply(this,arguments)}function II(){return II=Pe(function*(n,e){const t=be(n),r=t.ga.get(e),i=t.pa.get(r.targetId);if(i.length>1)return t.pa.set(r.targetId,i.filter(s=>!ig(s,e))),void t.ga.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield vd(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Sg(t.remoteStore,r.targetId),Ad(t,r.targetId)}).catch(sc))):(Ad(t,r.targetId),yield vd(t.localStore,r.targetId,!0))}),II.apply(this,arguments)}function DI(){return DI=Pe(function*(n,e,t){const r=function KI(n){const e=be(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=gfe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_fe.bind(null,e),e}(n);try{const i=yield function(o,a){const c=be(o),l=In.now(),u=a.reduce((f,p)=>f.add(p.key),yt());let h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let p=Ri(),m=yt();return c._s.getEntries(f,u).next(_=>{p=_,p.forEach((g,y)=>{y.isValidDocument()||(m=m.add(g))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,p)).next(_=>{h=_;const g=[];for(const y of a){const v=Hhe(y,h.get(y.key).overlayedDocument);null!=v&&g.push(new la(y.key,v,xH(v.value.mapValue),Tn.exists(!0)))}return c.mutationQueue.addMutationBatch(f,l,g,a)}).next(_=>{d=_;const g=_.applyToLocalDocumentSet(h,m);return c.documentOverlayCache.saveOverlays(f,_.batchId,g)})}).then(()=>({batchId:d.batchId,changes:zH(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let l=o.Da[o.currentUser.toKey()];l||(l=new dn(ct)),l=l.insert(a,c),o.Da[o.currentUser.toKey()]=l}(r,i.batchId,t),yield ha(r,i.changes),yield Ed(r.remoteStore)}catch(i){const s=bd(i,"Failed to persist write");t.reject(s)}}),DI.apply(this,arguments)}function T4(n,e){return RI.apply(this,arguments)}function RI(){return RI=Pe(function*(n,e){const t=be(n);try{const r=yield function Lde(n,e){const t=be(n),r=e.snapshotVersion;let i=t.rs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t._s.newChangeBuffer({trackRemovals:!0});i=t.rs;const a=[];e.targetChanges.forEach((u,h)=>{const d=i.get(h);if(!d)return;a.push(t.Kr.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.Kr.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);var m,_,g;null!==e.targetMismatches.get(h)?f=f.withResumeToken(mr.EMPTY_BYTE_STRING,je.min()).withLastLimboFreeSnapshotVersion(je.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(h,f),_=f,g=u,(0===(m=d).resumeToken.approximateByteSize()||_.snapshotVersion.toMicroseconds()-m.snapshotVersion.toMicroseconds()>=3e8||g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size>0)&&a.push(t.Kr.updateTargetData(s,f))});let c=Ri(),l=yt();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(function n4(n,e,t){let r=yt(),i=yt();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ri();return t.forEach((a,c)=>{const l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(je.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||0===c.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):se("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{ls:o,hs:i}})}(s,o,e.documentUpdates).next(u=>{c=u.ls,l=u.hs})),!r.isEqual(je.min())){const u=t.Kr.getLastRemoteSnapshotVersion(s).next(h=>t.Kr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return V.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.rs=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Sa.get(s);o&&(Be(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?Be(o.ma):i.removedDocuments.size>0&&(Be(o.ma),o.ma=!1))}),yield ha(t,r,e)}catch(r){yield sc(r)}}),RI.apply(this,arguments)}function S4(n,e,t){const r=be(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ga.forEach((s,o)=>{const a=o.view.U_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const c=be(o);c.onlineState=a;let l=!1;c.queries.forEach((u,h)=>{for(const d of h.listeners)d.U_(a)&&(l=!0)}),l&&TI(c)}(r.eventManager,e),i.length&&r.fa.c_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function mfe(n,e,t){return PI.apply(this,arguments)}function PI(){return PI=Pe(function*(n,e,t){const r=be(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Sa.get(e),s=i&&i.key;if(s){let o=new dn(Te.comparator);o=o.insert(s,vn.newNoDocument(s,je.min()));const a=yt().add(s),c=new hg(je.min(),new Map,new dn(ct),o,a);yield T4(r,c),r.wa=r.wa.remove(s),r.Sa.delete(e),UI(r)}else yield vd(r.localStore,e,!1).then(()=>Ad(r,e,t)).catch(sc)}),PI.apply(this,arguments)}function gfe(n,e){return NI.apply(this,arguments)}function NI(){return NI=Pe(function*(n,e){const t=be(n),r=e.batch.batchId;try{const i=yield function Nde(n,e){const t=be(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t._s.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){const h=l.batch,d=h.keys();let f=V.resolve();return d.forEach(p=>{f=f.next(()=>u.getEntry(c,p)).next(m=>{const _=l.docVersions.get(p);Be(null!==_),m.version.compareTo(_)<0&&(h.applyToRemoteDocument(m,l),m.isValidDocument()&&(m.setReadTime(l.commitVersion),u.addEntry(m)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=yt();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);kI(t,r,null),FI(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ha(t,i)}catch(i){yield sc(i)}}),NI.apply(this,arguments)}function _fe(n,e,t){return LI.apply(this,arguments)}function LI(){return LI=Pe(function*(n,e,t){const r=be(n);try{const i=yield function(o,a){const c=be(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(h=>(Be(null!==h),u=h.keys(),c.mutationQueue.removeMutationBatch(l,h))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(r.localStore,e);kI(r,e,t),FI(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ha(r,i)}catch(i){yield sc(i)}}),LI.apply(this,arguments)}function FI(n,e){(n.Ca.get(e)||[]).forEach(t=>{t.resolve()}),n.Ca.delete(e)}function kI(n,e,t){const r=be(n);let i=r.Da[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function Ad(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.pa.get(e))n.ga.delete(r),t&&n.fa.xa(r,t);n.pa.delete(e),n.isPrimaryClient&&n.ba.mr(e).forEach(r=>{n.ba.containsKey(r)||A4(n,r)})}function A4(n,e){n.ya.delete(e.path.canonicalString());const t=n.wa.get(e);null!==t&&(Sg(n.remoteStore,t),n.wa=n.wa.remove(e),n.Sa.delete(t),UI(n))}function VI(n,e,t){for(const r of t)r instanceof E4?(n.ba.addReference(r.key,e),vfe(n,r)):r instanceof x4?(se("SyncEngine","Document no longer in limbo: "+r.key),n.ba.removeReference(r.key,e),n.ba.containsKey(r.key)||A4(n,r.key)):Oe()}function vfe(n,e){const t=e.key,r=t.path.canonicalString();n.wa.get(t)||n.ya.has(r)||(se("SyncEngine","New document in limbo: "+t),n.ya.add(r),UI(n))}function UI(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){const e=n.ya.values().next().value;n.ya.delete(e);const t=new Te(Vt.fromString(e)),r=n.va.next();n.Sa.set(r,new ufe(t)),n.wa=n.wa.insert(t,r),hw(n.remoteStore,new ua(mi(sd(t.path)),r,"TargetPurposeLimboResolution",es.ae))}}function ha(n,e,t){return BI.apply(this,arguments)}function BI(){return BI=Pe(function*(n,e,t){const r=be(n),i=[],s=[],o=[];var a;r.ga.isEmpty()||(r.ga.forEach((a,c)=>{o.push(r.Ma(c,e,t).then(l=>{if((l||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,l?.fromCache?"not-current":"current"),l){i.push(l);const u=jM.$i(c.targetId,l);s.push(u)}}))}),yield Promise.all(o),r.fa.c_(i),yield(a=Pe(function*(l,u){const h=be(l);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>V.forEach(u,f=>V.forEach(f.Qi,p=>h.persistence.referenceDelegate.addReference(d,f.targetId,p)).next(()=>V.forEach(f.Ki,p=>h.persistence.referenceDelegate.removeReference(d,f.targetId,p)))))}catch(d){if(!oc(d))throw d;se("LocalStore","Failed to update sequence numbers: "+d)}for(const d of u){const f=d.targetId;if(!d.fromCache){const p=h.rs.get(f),_=p.withLastLimboFreeSnapshotVersion(p.snapshotVersion);h.rs=h.rs.insert(f,_)}}}),function c(l,u){return a.apply(this,arguments)})(r.localStore,s))}),BI.apply(this,arguments)}function wfe(n,e){return zI.apply(this,arguments)}function zI(){return zI=Pe(function*(n,e){const t=be(n);if(!t.currentUser.isEqual(e)){se("SyncEngine","User change. New user:",e.toKey());const r=yield e4(t.localStore,e);t.currentUser=e,(s=t).Ca.forEach(a=>{a.forEach(c=>{c.reject(new re(G.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ca.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ha(t,r.cs)}var s}),zI.apply(this,arguments)}function Efe(n,e){const t=be(n),r=t.Sa.get(e);if(r&&r.ma)return yt().add(r.key);{let i=yt();const s=t.pa.get(e);if(!s)return i;for(const o of s){const a=t.ga.get(o);i=i.unionWith(a.view.la)}return i}}class fw{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return Pe(function*(){t.serializer=bg(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function JG(n,e,t,r){return new Pde(n,e,t,r)}(this.persistence,new ZG,e.initialUser,this.serializer)}createPersistence(e){return new BM(rw.Jr,this.serializer)}createSharedClientState(e){return new c4}terminate(){var e=this;return Pe(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Cd{initialize(e,t){var r=this;return Pe(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>S4(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=wfe.bind(null,r.syncEngine),yield function _I(n,e){return yI.apply(this,arguments)}(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new ife}createDatastore(e){const t=bg(e.databaseInfo.databaseId),r=new zde(e.databaseInfo);return new jde(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>S4(this.syncEngine,t,0),a=l4.C()?new l4:new Vde,new qde(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,c,l,u){const h=new hfe(i,s,o,a,c,l);return u&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=Pe(function*(r){const i=be(r);se("RemoteStore","RemoteStore shutting down."),i.F_.add(5),yield wd(i),i.x_.shutdown(),i.O_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}class pw{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):jn("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Lfe{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Er.UNAUTHENTICATED,this.clientId=Jz.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=Pe(function*(a){se("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(se("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return Pe(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new re(G.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new pr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Pe(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=bd(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function mw(n,e){return QI.apply(this,arguments)}function QI(){return QI=Pe(function*(n,e){n.asyncQueue.verifyOperationInProgress(),se("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=Pe(function*(s){r.isEqual(s)||(yield e4(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),QI.apply(this,arguments)}function ZI(n,e){return JI.apply(this,arguments)}function JI(){return JI=Pe(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield function e1(n){return t1.apply(this,arguments)}(n);se("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>_4(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>_4(e.remoteStore,s)),n._onlineComponents=e}),JI.apply(this,arguments)}function t1(){return t1=Pe(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){se("FirestoreClient","Using user provided OfflineComponentProvider");try{yield mw(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function P4(n){return"FirebaseError"===n.name?n.code===G.FAILED_PRECONDITION||n.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}(t))throw t;Zi("Error using user provided cache. Falling back to memory cache: "+t),yield mw(n,new fw)}}else se("FirestoreClient","Using default OfflineComponentProvider"),yield mw(n,new fw);return n._offlineComponents}),t1.apply(this,arguments)}function gw(n){return n1.apply(this,arguments)}function n1(){return n1=Pe(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(se("FirestoreClient","Using user provided OnlineComponentProvider"),yield ZI(n,n._uninitializedComponentsProvider._online)):(se("FirestoreClient","Using default OnlineComponentProvider"),yield ZI(n,new Cd))),n._onlineComponents}),n1.apply(this,arguments)}function i1(){return i1=Pe(function*(n){const e=yield gw(n),t=e.eventManager;return t.onListen=dfe.bind(null,e.syncEngine),t.onUnlisten=ffe.bind(null,e.syncEngine),t}),i1.apply(this,arguments)}function k4(n,e,t={}){const r=new pr;return n.asyncQueue.enqueueAndForget(Pe(function*(){return function(s,o,a,c,l){const u=new pw({next:d=>{o.enqueueAndForget(()=>function xI(n,e){return bI.apply(this,arguments)}(s,h)),d.fromCache&&"server"===c.source?l.reject(new re(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:d=>l.reject(d)}),h=new SI(a,u,{includeMetadataChanges:!0,Z_:!0});return function wI(n,e){return EI.apply(this,arguments)}(s,h)}(yield function Id(n){return i1.apply(this,arguments)}(n),n.asyncQueue,e,t,r)})),r.promise}function V4(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const U4=new Map;function s1(n,e,t){if(!t)throw new re(G.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function B4(n){if(!Te.isDocumentKey(n))throw new re(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function z4(n){if(Te.isDocumentKey(n))throw new re(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _w(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":Oe()}function Pt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new re(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_w(n);throw new re(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}class G4{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new re(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new re(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function Wfe(n,e,t,r){if(!0===e&&!0===r)throw new re(G.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=V4(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new re(G.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ag{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new G4({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new re(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new re(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new G4(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new zue;switch(r.type){case"firstParty":return new Wue(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new re(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=U4.get(t);r&&(se("ComponentProvider","Removing Datastore"),U4.delete(t),r.terminate())}(this),Promise.resolve()}}class Lr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Lr(this.firestore,e,this._query)}}class $n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ro(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $n(this.firestore,e,this._key)}}class Ro extends Lr{constructor(e,t,r){super(e,t,sd(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $n(this.firestore,null,new Te(e))}withConverter(e){return new Ro(this.firestore,e,this._path)}}class Xfe{constructor(){this.Za=Promise.resolve(),this.Xa=[],this.eu=!1,this.tu=[],this.nu=null,this.ru=!1,this.iu=!1,this.su=[],this.Ho=new eI(this,"async_queue_retry"),this.ou=()=>{const t=uw();t&&se("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ho.$o()};const e=uw();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ou)}get isShuttingDown(){return this.eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this._u(),this.au(e)}enterRestrictedMode(e){if(!this.eu){this.eu=!0,this.iu=e||!1;const t=uw();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ou)}}enqueue(e){if(this._u(),this.eu)return new Promise(()=>{});const t=new pr;return this.au(()=>this.eu&&this.iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xa.push(e),this.uu()))}uu(){var e=this;return Pe(function*(){if(0!==e.Xa.length){try{yield e.Xa[0](),e.Xa.shift(),e.Ho.reset()}catch(t){if(!oc(t))throw t;se("AsyncQueue","Operation failed with retryable error: "+t)}e.Xa.length>0&&e.Ho.Qo(()=>e.uu())}})()}au(e){const t=this.Za.then(()=>(this.ru=!0,e().catch(r=>{throw this.nu=r,this.ru=!1,jn("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.ru=!1,r))));return this.Za=t,t}enqueueAfterDelay(e,t,r){this._u(),this.su.indexOf(e)>-1&&(t=0);const i=vI.createAndSchedule(this,e,t,r,s=>this.cu(s));return this.tu.push(i),i}_u(){this.nu&&Oe()}verifyOperationInProgress(){}lu(){var e=this;return Pe(function*(){let t;do{t=e.Za,yield t}while(t!==e.Za)})()}hu(e){for(const t of this.tu)if(t.timerId===e)return!0;return!1}Pu(e){return this.lu().then(()=>{this.tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lu()})}Iu(e){this.su.push(e)}cu(e){const t=this.tu.indexOf(e);this.tu.splice(t,1)}}class pn extends Ag{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Xfe,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||$4(this),this._firestoreClient.terminate()}}function Kfe(n,e){const t="object"==typeof n?n:function ble(n=n0){const e=pl.get(n);if(!e&&n===n0&&p3())return M3();if(!e)throw ra.create("no-app",{appName:n});return e}(),r="string"==typeof n?n:e||"(default)",i=function C3(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(n=>{const e=(n=>{var e,t;return null===(t=null===(e=Jv())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]})(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})("firestore");s&&function $fe(n,e,t,r={}){var i;const s=(n=Pt(n,Ag))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Zi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if("string"==typeof r.mockUserToken)a=r.mockUserToken,c=Er.MOCK_USER;else{a=function fce(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Zv(JSON.stringify({alg:"none",type:"JWT"})),Zv(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new re(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Er(l)}n._authCredentials=new Hue(new Qz(a,c))}}(i,...s)}return i}function qn(n){return n._firestoreClient||$4(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function $4(n){var e,t,r;const i=n._freezeSettings(),s=(c=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Ehe(n._databaseId,c,n._persistenceKey,(u=i).host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,V4(u.experimentalLongPollingOptions),u.useFetchStreams));var c,u;n._firestoreClient=new Lfe(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ll{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ll(mr.fromBase64String(e))}catch(t){throw new re(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ll(mr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Dd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new re(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new On(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class a1{constructor(e){this._methodName=e}}class c1{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ct(this._lat,e._lat)||ct(this._long,e._long)}}const Zfe=/^__.*__$/;class Jfe{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new la(e,this.data,this.fieldMask,t,this.fieldTransforms):new ud(e,this.data,t,this.fieldTransforms)}}function K4(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Oe()}}class yw{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.du(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Tu(){return this.settings.Tu}Eu(e){return new yw(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Au(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Eu({path:r,Ru:!1});return i.Vu(e),i}mu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Eu({path:r,Ru:!1});return i.du(),i}fu(e){return this.Eu({path:void 0,Ru:!0})}gu(e){return ww(e,this.settings.methodName,this.settings.pu||!1,this.path,this.settings.yu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}du(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vu(this.path.get(e))}Vu(e){if(0===e.length)throw this.gu("Document fields must not be empty");if(K4(this.Tu)&&Zfe.test(e))throw this.gu('Document fields cannot begin and end with "__"')}}class epe{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||bg(e)}wu(e,t,r,i=!1){return new yw({Tu:e,methodName:t,yu:r,path:On.emptyPath(),Ru:!1,pu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rd(n){const e=n._freezeSettings(),t=bg(n._databaseId);return new epe(n._databaseId,!!e.ignoreUndefinedProperties,t)}function l1(n,e,t,r,i,s={}){const o=n.wu(s.merge||s.mergeFields?2:0,e,t,i);h1("Data must be an object, but it was:",o,r);const a=t5(r,o);let c,l;if(s.merge)c=new Di(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=Ig(e,h,t);if(!o.contains(d))throw new re(G.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);r5(u,d)||u.push(d)}c=new Di(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new Jfe(new Nr(a),c,l)}class rpe extends a1{constructor(e,t){super(e),this.bu=t}_toFieldTransform(e){const t=new ld(e.serializer,WH(e.serializer,this.bu));return new cg(e.path,t)}isEqual(e){return this===e}}function Ol(n,e){if(n5(n=Tm(n)))return h1("Unsupported field value:",e,n),t5(n,e);if(n instanceof a1)return function(r,i){if(!K4(i.Tu))throw i.gu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Ru&&4!==e.Tu)throw e.gu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let c=Ol(a,i.fu(o));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=Tm(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return WH(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=In.fromDate(r);return{timestampValue:dd(i.serializer,s)}}if(r instanceof In){const s=new In(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:dd(i.serializer,s)}}if(r instanceof c1)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ll)return{bytesValue:dG(i.serializer,r._byteString)};if(r instanceof $n){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.gu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:MM(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.gu(`Unsupported field value: ${_w(r)}`)}(n,e)}function t5(n,e){const t={};return fH(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ac(n,(r,i)=>{const s=Ol(i,e.Au(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function n5(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof In||n instanceof c1||n instanceof Ll||n instanceof $n||n instanceof a1)}function h1(n,e,t){if(!n5(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=_w(t);throw e.gu("an object"===r?n+" a custom object":n+" "+r)}var i}function Ig(n,e,t){if((e=Tm(e))instanceof Dd)return e._internalPath;if("string"==typeof e)return vw(n,e);throw ww("Field path arguments must be of type string or ",n,!1,void 0,t)}const ipe=new RegExp("[~\\*/\\[\\]]");function vw(n,e,t){if(e.search(ipe)>=0)throw ww(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Dd(...e.split("."))._internalPath}catch{throw ww(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ww(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new re(G.INVALID_ARGUMENT,a+n+c)}function r5(n,e){return n.some(t=>t.isEqual(e))}class d1{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new $n(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new spe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ew("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class spe extends d1{data(){return super.data()}}function Ew(n,e){return"string"==typeof e?vw(n,e):e instanceof Dd?e._internalPath:e._delegate._internalPath}class ape{convertValue(e,t="none"){switch(uc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Fn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(oa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Oe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ac(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new c1(Fn(e.latitude),Fn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=k0(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Jm(e));default:return null}}convertTimestamp(e){const t=cc(e);return new In(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Vt.fromString(e);Be(xG(r));const i=new xl(r.get(1),r.get(3)),s=new Te(r.popFirst(5));return i.isEqual(t)||jn(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Fl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nd extends d1{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Sw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ew("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Sw extends Nd{data(e={}){return super.data(e)}}class Ld{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Fl(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Sw(this._firestore,this._userDataWriter,r.key,r,new Fl(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new Sw(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Fl(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const c=new Sw(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Fl(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,u=-1;return 0!==a.type&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:lpe(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function lpe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Oe()}}class vc extends ape{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ll(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $n(this.firestore,null,t)}}function Rg(n,e){return function(r,i){const s=new pr;return r.asyncQueue.enqueueAndForget(Pe(function*(){return function pfe(n,e,t){return DI.apply(this,arguments)}(yield function r1(n){return gw(n).then(e=>e.syncEngine)}(r),i,s)})),s.promise}(qn(n),e)}function bpe(n){return new rpe("increment",n)}!function(e,t=!0){Kh="10.4.0",s0(new Sm("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new pn(new Gue(r.getProvider("auth-internal")),new $ue(r.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new re(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xl(l.options.projectId,u)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Hh(Kz,"4.2.0",e),Hh(Kz,"4.2.0","esm2017")}();let Spe=(()=>{var n;class e{constructor(){this.artworks=Z_([{id:0,title:"Self Portrait",audio:"assets/audio/1.mp3",date:"1887",description:"This self-portrait was one of about 32 produced over a 10-year period, and these were an important part of his work as a painter; he painted himself because he often lacked the money to pay for models. Art historians are divided as to whether this painting is Van Gogh's final self-portrait or not. It is considered that it was painted in Arles following Van Gogh's admission to hospital after mutilating his ear. Van Gogh sent the picture to his younger brother, the art dealer Theo; an accompanying letter read: 'I hope you will notice that my facial expressions have become much calmer, although my eyes have the same insecure look as before, or so it appears to me.'",height:65,textureUrl:"assets/artworks/selfportrait.webp",votes:0,width:54,wiki:"https://wikipedia.org/wiki/Van_Gogh_self-portrait_(1889)"},{id:1,title:"Almond Blossom",audio:"assets/audio/2.mp3",date:"1890",description:"In mid-March 1888 van Gogh writes that the almond trees are coming into full flower, weather there is changeable, often windy with turbulent skies. Later on Theo wrote to his brother Vincent on January 31, 1890, to announce the birth of his son, Vincent Willem van Gogh. He was very close to his brother and he sought to symbolize new life in the flowers of the almond tree for the birth of baby Vincent.",height:73.5,textureUrl:"assets/artworks/almond_blossom.webp",votes:34,width:92,wiki:"https://en.wikipedia.org/wiki/Almond_Blossoms"},{id:2,title:"The Bedroom",audio:"assets/audio/3.mp3",date:"1887",description:"The painting depicts van Gogh's bedroom at 2, Place Lamartine in Arles, Bouches-du-Rhone, France, known as the Yellow House. The door to the right opened on to the upper floor and the staircase; the door to the left was that of the guest room he held prepared for Gauguin; the window in the front wall looked on to Place Lamartine and its public gardens. This room was not rectangular but trapezoid with an obtuse angle in the left hand corner of the front wall and an acute angle at the right.",height:72.4,textureUrl:"assets/artworks/bedroom.webp",votes:65,width:91.3,wiki:"https://wikipedia.org/wiki/Bedroom_in_Arles"},{id:3,title:"Sunflowers",audio:"assets/audio/1.mp3",date:"1887",description:"This is one of five versions of Sunflowers on display in museums and galleries across the world. Van Gogh made the paintings to decorate his house in Arles in readiness for a visit from his friend and fellow artist, Paul Gauguin.'The sunflower is mine', Van Gogh once declared, and it is clear that the flower had various meanings for him. The different stages in the sunflower's life cycle shown here, from young bud through to maturity and eventual decay, follow in the vanitas tradition of Dutch seventeenth-century flower paintings, which emphasise the transient nature of human actions. The sunflowers were perhaps also intended to be a symbol of friendship and a celebration of the beauty and vitality of nature.",height:95,textureUrl:"assets/artworks/sunflowers.webp",votes:72,width:73,download:"https://en.wikipedia.org/wiki/File:Vincent_van_Gogh_-_Sunflowers_-_VGM_F458.jpg",wiki:"https://wikipedia.org/wiki/Sunflowers_(Van_Gogh_series)"},{id:4,title:"Irises",audio:"assets/audio/1.mp3",date:"1889",description:"Van Gogh painted this still life in the psychiatric hospital in Saint-Remy. For him, the painting was mainly a study in color. He set out to achieve a powerful color contrast. By placing the purple flowers against a yellow background, he made the decorative forms stand out even more strongly. The irises were originally purple. But as the red pigment has faded, they have turned blue. Van Gogh made two paintings of this bouquet. In the other still life, he contrasted purple and pink with green.",height:93,textureUrl:"assets/artworks/irises.webp",votes:56,width:74,wiki:"https://en.wikipedia.org/wiki/Vase_with_Irises_Against_a_Yellow_Background"}]),this.config=ece,this.app=M3(this.config),this.db=Kfe(this.app),this.upvoted=[],this.artworksLength=this.artworks.length,this.dbArtworks=function qfe(n,e,...t){if(n=Tm(n),s1("collection","path",e),n instanceof Ag){const r=Vt.fromString(e,...t);return z4(r),new Ro(n,null,r)}{if(!(n instanceof $n||n instanceof Ro))throw new re(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Vt.fromString(e,...t));return z4(r),new Ro(n.firestore,null,r)}}(this.db,"artworks"),this.getArtworksFb()}getArtworks(){return this.artworks()}getArtworksFb(){(function upe(n){n=Pt(n,Lr);const e=Pt(n.firestore,pn),t=qn(e),r=new vc(e);return function i5(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new re(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(n._query),k4(t,n._query).then(i=>new Ld(e,r,n,i))})(this.dbArtworks).then(i=>{this.artworks.mutate(s=>{s.forEach((o,a)=>{o.votes=i.docs[a].data().votes})}),console.log("Data after fb update ",this.artworks())})}upvoteArtwork(r){return-1===this.upvoted.indexOf(r)?(this.upvoted.push(r),this.artworks.mutate(i=>{i[r].votes+=1}),this.updateUpvote(r),console.log("Mutated",r,this.artworks()[r].votes)):console.log("Upvoted already!"),this.artworks()[r].votes}updateUpvote(r){(function hpe(n,e,t){n=Pt(n,$n);const r=Pt(n.firestore,pn),i=function p1(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}(n.converter,e,t);return Rg(r,[l1(Rd(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Tn.none())])})(function j4(n,e,...t){if(n=Tm(n),1===arguments.length&&(e=Jz.V()),s1("doc","path",e),n instanceof Ag){const r=Vt.fromString(e,...t);return B4(r),new $n(n,null,new Te(r))}{if(!(n instanceof $n||n instanceof Ro))throw new re(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Vt.fromString(e,...t));return B4(r),new $n(n.firestore,n instanceof Ro?n.converter:null,new Te(r))}}(this.db,"artworks",r.toString()),{votes:bpe(1)},{merge:!0}).then(()=>{console.log("Incremented vote count field by 1.")}).catch(s=>{console.error("Error incrementing count field:",s)})}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();function da(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function p5(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var _1,Jr,kn,Dn,bs,b1,T1,w5,b5,Bd,Ug,ts={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Od={duration:.5,overwrite:!1,delay:0},xs=1e8,sn=1e-8,y1=2*Math.PI,Ape=y1/4,Cpe=0,m5=Math.sqrt,Mpe=Math.cos,Ipe=Math.sin,Tr=function(e){return"string"==typeof e},Vn=function(e){return"function"==typeof e},fa=function(e){return"number"==typeof e},v1=function(e){return typeof e>"u"},Po=function(e){return"object"==typeof e},Pi=function(e){return!1!==e},w1=function(){return typeof window<"u"},Mw=function(e){return Vn(e)||Tr(e)},g5="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},ei=Array.isArray,E1=/(?:-?\.?\d|\.)+/gi,_5=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Fd=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,x1=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,y5=/[+-]=-?[.\d]+/,v5=/[^,'"\[\]\s]+/gi,Dpe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ns={},Iw={},E5=function(e){return(Iw=Vl(e,ns))&&Fi},S1=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Dw=function(e,t){return!t&&console.warn(e)},x5=function(e,t){return e&&(ns[e]=t)&&Iw&&(Iw[e]=t)||ns},Pg=function(){return 0},Rpe={suppressEvents:!0,isStart:!0,kill:!1},Rw={suppressEvents:!0,kill:!1},Ppe={suppressEvents:!0},A1={},wc=[],C1={},rs={},M1={},T5=30,Pw=[],I1="",D1=function(e){var r,i,t=e[0];if(Po(t)||Vn(t)||(e=[e]),!(r=(t._gsap||{}).harness)){for(i=Pw.length;i--&&!Pw[i].targetTest(t););r=Pw[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new J5(e[i],r)))||e.splice(i,1);return e},kl=function(e){return e._gsap||D1(As(e))[0]._gsap},S5=function(e,t,r){return(r=e[t])&&Vn(r)?e[t]():v1(r)&&e.getAttribute&&e.getAttribute(t)||r},Ni=function(e,t){return(e=e.split(",")).forEach(t)||e},Xn=function(e){return Math.round(1e5*e)/1e5||0},Or=function(e){return Math.round(1e7*e)/1e7||0},kd=function(e,t){var r=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===r?e+i:"-"===r?e-i:"*"===r?e*i:e/i},Npe=function(e,t){for(var r=t.length,i=0;e.indexOf(t[i])<0&&++i<r;);return i<r},Nw=function(){var r,i,e=wc.length,t=wc.slice(0);for(C1={},wc.length=0,r=0;r<e;r++)(i=t[r])&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},A5=function(e,t,r,i){wc.length&&!Jr&&Nw(),e.render(t,r,i||Jr&&t<0&&(e._initted||e._startAt)),wc.length&&!Jr&&Nw()},C5=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(v5).length<2?t:Tr(e)?e.trim():e},M5=function(e){return e},Ts=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},Vl=function(e,t){for(var r in t)e[r]=t[r];return e},I5=function n(e,t){for(var r in t)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(e[r]=Po(t[r])?n(e[r]||(e[r]={}),t[r]):t[r]);return e},Lw=function(e,t){var i,r={};for(i in e)i in t||(r[i]=e[i]);return r},Ng=function(e){var t=e.parent||Dn,r=e.keyframes?function(e){return function(t,r){for(var i in r)i in t||"duration"===i&&e||"ease"===i||(t[i]=r[i])}}(ei(e.keyframes)):Ts;if(Pi(e.inherit))for(;t;)r(e,t.vars.defaults),t=t.parent||t._dp;return e},D5=function(e,t,r,i,s){void 0===r&&(r="_first"),void 0===i&&(i="_last");var a,o=e[i];if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[r],e[r]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},Ow=function(e,t,r,i){void 0===r&&(r="_first"),void 0===i&&(i="_last");var s=t._prev,o=t._next;s?s._next=o:e[r]===t&&(e[r]=o),o?o._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},Ec=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ul=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var r=e;r;)r._dirty=1,r=r.parent;return e},R1=function(e,t,r,i){return e._startAt&&(Jr?e._startAt.revert(Rw):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},kpe=function n(e){return!e||e._ts&&n(e.parent)},R5=function(e){return e._repeat?Vd(e._tTime,e=e.duration()+e._rDelay)*e:0},Vd=function(e,t){var r=Math.floor(e/=t);return e&&r===e?r-1:r},Fw=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},kw=function(e){return e._end=Or(e._start+(e._tDur/Math.abs(e._ts||e._rts||sn)||0))},Vw=function(e,t){var r=e._dp;return r&&r.smoothChildTiming&&e._ts&&(e._start=Or(r._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),kw(e),r._dirty||Ul(r,e)),e},P5=function(e,t){var r;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(r=Fw(e.rawTime(),t),(!t._dur||Og(0,t.totalDuration(),r)-t._tTime>sn)&&t.render(r,!0)),Ul(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(r=e;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;e._zTime=-sn}},No=function(e,t,r,i){return t.parent&&Ec(t),t._start=Or((fa(r)?r:r||e!==Dn?Ss(e,r,t):e._time)+t._delay),t._end=Or(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),D5(e,t,"_first","_last",e._sort?"_start":0),P1(t)||(e._recent=t),i||P5(e,t),e._ts<0&&Vw(e,e._tTime),e},N5=function(e,t){return(ns.ScrollTrigger||S1("scrollTrigger",t))&&ns.ScrollTrigger.create(t,e)},L5=function(e,t,r,i,s){return z1(e,t,s),e._initted?!r&&e._pt&&!Jr&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&b5!==is.frame?(wc.push(e),e._lazy=[s,i],1):void 0:1},Vpe=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},P1=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Ud=function(e,t,r,i){var s=e._repeat,o=Or(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:Or(o*(s+1)+e._rDelay*s):o,a>0&&!i&&Vw(e,e._tTime=e._tDur*a),e.parent&&kw(e),r||Ul(e.parent,e),e},O5=function(e){return e instanceof Li?Ul(e):Ud(e,e._dur)},zpe={_start:0,endTime:Pg,totalDuration:Pg},Ss=function n(e,t,r){var a,c,l,i=e.labels,s=e._recent||zpe,o=e.duration()>=xs?s.endTime(!1):e._dur;return Tr(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),l="%"===t.substr(-1),a=t.indexOf("="),"<"===c||">"===c?(a>=0&&(t=t.replace(/=/,"")),("<"===c?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?s:r).totalDuration()/100:1)):a<0?(t in i||(i[t]=o),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&r&&(c=c/100*(ei(r)?r[0]:r).totalDuration()),a>1?n(e,t.substr(0,a-1),r)+c:o+c)):null==t?o:+t},Lg=function(e,t,r){var a,c,i=fa(t[1]),s=(i?2:1)+(e<2?0:1),o=t[s];if(i&&(o.duration=t[1]),o.parent=r,e){for(a=o,c=r;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=Pi(c.vars.inherit)&&c.parent;o.immediateRender=Pi(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new rr(t[0],o,t[s+1])},xc=function(e,t){return e||0===e?t(e):t},Og=function(e,t,r){return r<e?e:r>t?t:r},ti=function(e,t){return Tr(e)&&(t=Dpe.exec(e))?t[1]:""},N1=[].slice,F5=function(e,t){return e&&Po(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Po(e[0]))&&!e.nodeType&&e!==bs},As=function(e,t,r){return kn&&!t&&kn.selector?kn.selector(e):!Tr(e)||r||!b1&&zd()?ei(e)?function(e,t,r){return void 0===r&&(r=[]),e.forEach(function(i){var s;return Tr(i)&&!t||F5(i,1)?(s=r).push.apply(s,As(i)):r.push(i)})||r}(e,r):F5(e)?N1.call(e,0):e?[e]:[]:N1.call((t||T1).querySelectorAll(e),0)},L1=function(e){return e=As(e)[0]||Dw("Invalid scope")||{},function(t){var r=e.current||e.nativeElement||e;return As(t,r.querySelectorAll?r:r===e?Dw("Invalid scope")||T1.createElement("div"):e)}},k5=function(e){return e.sort(function(){return.5-Math.random()})},V5=function(e){if(Vn(e))return e;var t=Po(e)?e:{each:e},r=Bl(t.ease),i=t.from||0,s=parseFloat(t.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=t.axis,u=i,h=i;return Tr(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(u=i[0],h=i[1]),function(d,f,p){var g,y,v,w,E,b,T,S,x,m=(p||t).length,_=o[m];if(!_){if(!(x="auto"===t.grid?0:(t.grid||[1,xs])[1])){for(T=-xs;T<(T=p[x++].getBoundingClientRect().left)&&x<m;);x--}for(_=o[m]=[],g=c?Math.min(x,m)*u-.5:i%x,y=x===xs?0:c?m*h/x-.5:i/x|0,T=0,S=xs,b=0;b<m;b++)v=b%x-g,w=y-(b/x|0),_[b]=E=l?Math.abs("y"===l?w:v):m5(v*v+w*w),E>T&&(T=E),E<S&&(S=E);"random"===i&&k5(_),_.max=T-S,_.min=S,_.v=m=(parseFloat(t.amount)||parseFloat(t.each)*(x>m?m-1:l?"y"===l?m/x:x:Math.max(x,m/x))||0)*("edges"===i?-1:1),_.b=m<0?s-m:s,_.u=ti(t.amount||t.each)||0,r=r&&m<0?K5(r):r}return m=(_[d]-_.min)/_.max||0,Or(_.b+(r?r(m):m)*_.v)+_.u}},O1=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(r){var i=Or(Math.round(parseFloat(r)/e)*e*t);return(i-i%1)/t+(fa(r)?0:ti(r))}},U5=function(e,t){var i,s,r=ei(e);return!r&&Po(e)&&(i=r=e.radius||xs,e.values?(e=As(e.values),(s=!fa(e[0]))&&(i*=i)):e=O1(e.increment)),xc(t,r?Vn(e)?function(o){return s=e(o),Math.abs(s-o)<=i?s:o}:function(o){for(var d,f,a=parseFloat(s?o.x:o),c=parseFloat(s?o.y:0),l=xs,u=0,h=e.length;h--;)(d=s?(d=e[h].x-a)*d+(f=e[h].y-c)*f:Math.abs(e[h]-a))<l&&(l=d,u=h);return u=!i||l<=i?e[u]:o,s||u===o||fa(o)?u:u+ti(o)}:O1(e))},B5=function(e,t,r,i){return xc(ei(e)?!t:!0===r?!!(r=0):!i,function(){return ei(e)?e[~~(Math.random()*e.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((e-r/2+Math.random()*(t-e+.99*r))/r)*r*i)/i})},z5=function(e,t,r){return xc(r,function(i){return e[~~t(i)]})},Fg=function(e){for(var i,s,o,a,t=0,r="";~(i=e.indexOf("random(",t));)o=e.indexOf(")",i),a="["===e.charAt(i+7),s=e.substr(i+7,o-i-7).match(a?v5:E1),r+=e.substr(t,i-t)+B5(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return r+e.substr(t,e.length-t)},H5=function(e,t,r,i,s){var o=t-e,a=i-r;return xc(s,function(c){return r+((c-e)/o*a||0)})},G5=function(e,t,r){var o,a,c,i=e.labels,s=xs;for(o in i)(a=i[o]-t)<0==!!r&&a&&s>(a=Math.abs(a))&&(c=o,s=a);return c},Cs=function(e,t,r){var c,l,u,i=e.vars,s=i[t],o=kn,a=e._ctx;if(s)return c=i[t+"Params"],l=i.callbackScope||e,r&&wc.length&&Nw(),a&&(kn=a),u=c?s.apply(l,c):s.call(l),kn=o,u},kg=function(e){return Ec(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Jr),e.progress()<1&&Cs(e,"onInterrupt"),e},j5=[],W5=function(e){if(w1()&&e){var t=(e=!e.name&&e.default||e).name,r=Vn(e),i=t&&!r&&e.init?function(){this._props=[]}:e,s={init:Pg,render:j1,add:U1,kill:hme,modifier:ume,rawVars:0},o={targetTest:0,get:0,getSetter:G1,aliases:{},register:0};if(zd(),e!==i){if(rs[t])return;Ts(i,Ts(Lw(e,s),o)),Vl(i.prototype,Vl(s,Lw(e,o))),rs[i.prop=t]=i,e.targetTest&&(Pw.push(i),A1[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}x5(t,i),e.register&&e.register(Fi,i,Oi)}else e&&j5.push(e)},on=255,Vg={aqua:[0,on,on],lime:[0,on,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,on],navy:[0,0,128],white:[on,on,on],olive:[128,128,0],yellow:[on,on,0],orange:[on,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[on,0,0],pink:[on,192,203],cyan:[0,on,on],transparent:[on,on,on,0]},F1=function(e,t,r){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(r-t)*e*6:e<.5?r:3*e<2?t+(r-t)*(2/3-e)*6:t)*on+.5|0},$5=function(e,t,r){var s,o,a,c,l,u,h,d,f,p,i=e?fa(e)?[e>>16,e>>8&on,e&on]:0:Vg.black;if(!i){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),Vg[e])i=Vg[e];else if("#"===e.charAt(0)){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(i=parseInt(e.substr(1,6),16))>>16,i>>8&on,i&on,parseInt(e.substr(7),16)/255];i=[(e=parseInt(e.substr(1),16))>>16,e>>8&on,e&on]}else if("hsl"===e.substr(0,3))if(i=p=e.match(E1),t){if(~e.indexOf("="))return i=e.match(_5),r&&i.length<4&&(i[3]=1),i}else c=+i[0]%360/360,l=+i[1]/100,s=2*(u=+i[2]/100)-(o=u<=.5?u*(l+1):u+l-u*l),i.length>3&&(i[3]*=1),i[0]=F1(c+1/3,s,o),i[1]=F1(c,s,o),i[2]=F1(c-1/3,s,o);else i=e.match(E1)||Vg.transparent;i=i.map(Number)}return t&&!p&&(s=i[0]/on,o=i[1]/on,a=i[2]/on,u=((h=Math.max(s,o,a))+(d=Math.min(s,o,a)))/2,h===d?c=l=0:(f=h-d,l=u>.5?f/(2-h-d):f/(h+d),c=h===s?(o-a)/f+(o<a?6:0):h===o?(a-s)/f+2:(s-o)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(100*l+.5),i[2]=~~(100*u+.5)),r&&i.length<4&&(i[3]=1),i},q5=function(e){var t=[],r=[],i=-1;return e.split(bc).forEach(function(s){var o=s.match(Fd)||[];t.push.apply(t,o),r.push(i+=o.length+1)}),t.c=r,t},X5=function(e,t,r){var c,l,u,h,i="",s=(e+i).match(bc),o=t?"hsla(":"rgba(",a=0;if(!s)return e;if(s=s.map(function(d){return(d=$5(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),r&&(u=q5(e),(c=r.c).join(i)!==u.c.join(i)))for(h=(l=e.replace(bc,"1").split(Fd)).length-1;a<h;a++)i+=l[a]+(~c.indexOf(a)?s.shift()||o+"0,0,0,0)":(u.length?u:s.length?s:r).shift());if(!l)for(h=(l=e.split(bc)).length-1;a<h;a++)i+=l[a]+s[a];return i+l[h]},bc=function(){var e,n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in Vg)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Kpe=/hsl[a]?\(/,Y5=function(e){var r,t=e.join(" ");if(bc.lastIndex=0,bc.test(t))return r=Kpe.test(t),e[1]=X5(e[1],r),e[0]=X5(e[0],r,q5(e[1])),!0},is=function(){var c,l,u,h,d,f,n=Date.now,e=500,t=33,r=n(),i=r,s=1e3/240,o=s,a=[],p=function m(_){var v,w,E,b,g=n()-i,y=!0===_;if(g>e&&(r+=g-t),((v=(E=(i+=g)-r)-o)>0||y)&&(b=++h.frame,d=E-1e3*h.time,h.time=E/=1e3,o+=v+(v>=s?4:s-v),w=1),y||(c=l(m)),w)for(f=0;f<a.length;f++)a[f](E,d,b,_)};return h={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(_){return d/(1e3/(_||60))},wake:function(){w5&&(!b1&&w1()&&(bs=b1=window,T1=bs.document||{},ns.gsap=Fi,(bs.gsapVersions||(bs.gsapVersions=[])).push(Fi.version),E5(Iw||bs.GreenSockGlobals||!bs.gsap&&bs||{}),u=bs.requestAnimationFrame,j5.forEach(W5)),c&&h.sleep(),l=u||function(_){return setTimeout(_,o-1e3*h.time+1|0)},Ug=1,p(2))},sleep:function(){(u?bs.cancelAnimationFrame:clearTimeout)(c),Ug=0,l=Pg},lagSmoothing:function(_,g){e=_||1/0,t=Math.min(g||33,e)},fps:function(_){o=1e3*h.time+(s=1e3/(_||240))},add:function(_,g,y){var v=g?function(w,E,b,T){_(w,E,b,T),h.remove(v)}:_;return h.remove(_),a[y?"unshift":"push"](v),zd(),v},remove:function(_,g){~(g=a.indexOf(_))&&a.splice(g,1)&&f>=g&&f--},_listeners:a}}(),zd=function(){return!Ug&&is.wake()},Ft={},Qpe=/^[\d.\-M][\d.\-,\s]/,Zpe=/["']/g,Jpe=function(e){for(var a,c,l,t={},r=e.substr(1,e.length-3).split(":"),i=r[0],s=1,o=r.length;s<o;s++)c=r[s],a=s!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),t[i]=isNaN(l)?l.replace(Zpe,"").trim():+l,i=c.substr(a+1).trim();return t},K5=function(e){return function(t){return 1-e(1-t)}},Q5=function n(e,t){for(var i,r=e._first;r;)r instanceof Li?n(r,t):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==t&&(r.timeline?n(r.timeline,t):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=t)),r=r._next},Bl=function(e,t){return e&&(Vn(e)?e:Ft[e]||function(e){var t=(e+"").split("("),r=Ft[t[0]];return r&&t.length>1&&r.config?r.config.apply(null,~e.indexOf("{")?[Jpe(t[1])]:function(e){var t=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<r?e.indexOf(")",r+1):r)}(e).split(",").map(C5)):Ft._CE&&Qpe.test(e)?Ft._CE("",e):r}(e))||t},zl=function(e,t,r,i){void 0===r&&(r=function(c){return 1-t(1-c)}),void 0===i&&(i=function(c){return c<.5?t(2*c)/2:1-t(2*(1-c))/2});var o,s={easeIn:t,easeOut:r,easeInOut:i};return Ni(e,function(a){for(var c in Ft[a]=ns[a]=s,Ft[o=a.toLowerCase()]=r,s)Ft[o+("easeIn"===c?".in":"easeOut"===c?".out":".inOut")]=Ft[a+"."+c]=s[c]}),s},Z5=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},k1=function n(e,t,r){var i=t>=1?t:1,s=(r||(e?.3:.45))/(t<1?t:1),o=s/y1*(Math.asin(1/i)||0),a=function(u){return 1===u?1:i*Math.pow(2,-10*u)*Ipe((u-o)*s)+1},c="out"===e?a:"in"===e?function(l){return 1-a(1-l)}:Z5(a);return s=y1/s,c.config=function(l,u){return n(e,l,u)},c},V1=function n(e,t){void 0===t&&(t=1.70158);var r=function(o){return o?--o*o*((t+1)*o+t)+1:0},i="out"===e?r:"in"===e?function(s){return 1-r(1-s)}:Z5(r);return i.config=function(s){return n(e,s)},i};Ni("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;zl(n+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(2*r,t)/2:1-Math.pow(2*(1-r),t)/2})}),Ft.Linear.easeNone=Ft.none=Ft.Linear.easeIn,zl("Elastic",k1("in"),k1("out"),k1()),function(n,e){var s=function(a){return a<.36363636363636365?n*a*a:a<.7272727272727273?n*Math.pow(a-1.5/e,2)+.75:a<.9090909090909092?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};zl("Bounce",function(o){return 1-s(1-o)},s)}(7.5625,2.75),zl("Expo",function(n){return n?Math.pow(2,10*(n-1)):0}),zl("Circ",function(n){return-(m5(1-n*n)-1)}),zl("Sine",function(n){return 1===n?1:1-Mpe(n*Ape)}),zl("Back",V1("in"),V1("out"),V1()),Ft.SteppedEase=Ft.steps=ns.SteppedEase={config:function(e,t){void 0===e&&(e=1);var r=1/e,i=e+(t?0:1),s=t?1:0;return function(a){return((i*Og(0,.99999999,a)|0)+s)*r}}},Od.ease=Ft["quad.out"],Ni("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return I1+=n+","+n+"Params,"});var J5=function(e,t){this.id=Cpe++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:S5,this.set=t?t.getSetter:G1},Bg=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ud(this,+t.duration,1,1),this.data=t.data,kn&&(this._ctx=kn,kn.data.push(this)),Ug||is.wake()}var e=n.prototype;return e.delay=function(r){return r||0===r?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},e.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},e.totalDuration=function(r){return arguments.length?(this._dirty=0,Ud(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(r,i){if(zd(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(Vw(this,r),!s._dp||s.parent||P5(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&No(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===sn||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),A5(this,r,i)),this},e.time=function(r,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+R5(this))%(this._dur+this._rDelay)||(r?this._dur:0),i):this._time},e.totalProgress=function(r,i){return arguments.length?this.totalTime(this.totalDuration()*r,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(r,i){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?r:1-r)+R5(this),i):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(r,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*s,i):this._repeat?Vd(this._tTime,s)+1:1},e.timeScale=function(r){if(!arguments.length)return this._rts===-sn?0:this._rts;if(this._rts===r)return this;var i=this.parent&&this._ts?Fw(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-sn?0:this._rts,this.totalTime(Og(-Math.abs(this._delay),this._tDur,i),!0),kw(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},e.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(zd(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==sn&&(this._tTime-=sn)))),this):this._ps},e.startTime=function(r){if(arguments.length){this._start=r;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&No(i,this,r-this._delay),this}return this._start},e.endTime=function(r){return this._start+(Pi(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(r){var i=this.parent||this._dp;return i?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Fw(i.rawTime(r),this):this._tTime:this._tTime},e.revert=function(r){void 0===r&&(r=Ppe);var i=Jr;return Jr=r,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),"nested"!==this.data&&!1!==r.kill&&this.kill(),Jr=i,this},e.globalTime=function(r){for(var i=this,s=arguments.length?r:i.rawTime();i;)s=i._start+s/(i._ts||1),i=i._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(r):s},e.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,O5(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(r){if(arguments.length){var i=this._time;return this._rDelay=r,O5(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},e.seek=function(r,i){return this.totalTime(Ss(this,r),Pi(i))},e.restart=function(r,i){return this.play().totalTime(r?-this._delay:0,Pi(i))},e.play=function(r,i){return null!=r&&this.seek(r,i),this.reversed(!1).paused(!1)},e.reverse=function(r,i){return null!=r&&this.seek(r||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(r,i){return null!=r&&this.seek(r,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-sn:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-sn,this},e.isActive=function(){var s,r=this.parent||this._dp,i=this._start;return!(r&&!(this._ts&&this._initted&&r.isActive()&&(s=r.rawTime(!0))>=i&&s<this.endTime(!0)-sn))},e.eventCallback=function(r,i,s){var o=this.vars;return arguments.length>1?(i?(o[r]=i,s&&(o[r+"Params"]=s),"onUpdate"===r&&(this._onUpdate=i)):delete o[r],this):o[r]},e.then=function(r){var i=this;return new Promise(function(s){var o=Vn(r)?r:M5,a=function(){var l=i.then;i.then=null,Vn(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),s(o),i.then=l};i._initted&&1===i.totalProgress()&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){kg(this)},n}();Ts(Bg.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-sn,_prom:0,_ps:!1,_rts:1});var Li=function(n){function e(r,i){var s;return void 0===r&&(r={}),(s=n.call(this,r)||this).labels={},s.smoothChildTiming=!!r.smoothChildTiming,s.autoRemoveChildren=!!r.autoRemoveChildren,s._sort=Pi(r.sortChildren),Dn&&No(r.parent||Dn,da(s),i),r.reversed&&s.reverse(),r.paused&&s.paused(!0),r.scrollTrigger&&N5(da(s),r.scrollTrigger),s}p5(e,n);var t=e.prototype;return t.to=function(i,s,o){return Lg(0,arguments,this),this},t.from=function(i,s,o){return Lg(1,arguments,this),this},t.fromTo=function(i,s,o,a){return Lg(2,arguments,this),this},t.set=function(i,s,o){return s.duration=0,s.parent=this,Ng(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new rr(i,s,Ss(this,o),1),this},t.call=function(i,s,o){return No(this,rr.delayedCall(0,i,s),o)},t.staggerTo=function(i,s,o,a,c,l,u){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=u,o.parent=this,new rr(i,o,Ss(this,c)),this},t.staggerFrom=function(i,s,o,a,c,l,u){return o.runBackwards=1,Ng(o).immediateRender=Pi(o.immediateRender),this.staggerTo(i,s,o,a,c,l,u)},t.staggerFromTo=function(i,s,o,a,c,l,u,h){return a.startAt=o,Ng(a).immediateRender=Pi(a.immediateRender),this.staggerTo(i,s,a,c,l,u,h)},t.render=function(i,s,o){var d,f,p,m,_,g,y,v,w,E,b,T,a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,u=i<=0?0:Or(i),h=this._zTime<0!=i<0&&(this._initted||!l);if(this!==Dn&&u>c&&i>=0&&(u=c),u!==this._tTime||o||h){if(a!==this._time&&l&&(u+=this._time-a,i+=this._time-a),d=u,w=this._start,g=!(v=this._ts),h&&(l||(a=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(b=this._yoyo,_=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(100*_+i,s,o);if(d=Or(u%_),u===c?(m=this._repeat,d=l):((m=~~(u/_))&&m===u/_&&(d=l,m--),d>l&&(d=l)),E=Vd(this._tTime,_),!a&&this._tTime&&E!==m&&this._tTime-E*_-this._dur<=0&&(E=m),b&&1&m&&(d=l-d,T=1),m!==E&&!this._lock){var S=b&&1&E,x=S===(b&&1&m);if(m<E&&(S=!S),a=S?0:u%l?l:u,this._lock=1,this.render(a||(T?0:Or(m*_)),s,!l)._lock=0,this._tTime=u,!s&&this.parent&&Cs(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),a&&a!==this._time||g!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,x&&(this._lock=2,this.render(a=S?l:-1e-4,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!g)return this;Q5(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=function(e,t,r){var i;if(r>t)for(i=e._first;i&&i._start<=r;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=r;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,Or(a),Or(d)),y&&(u-=d-(d=y._start))),this._tTime=u,this._time=d,this._act=!v,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!s&&!m&&(Cs(this,"onStart"),this._tTime!==u))return this;if(d>=a&&i>=0)for(f=this._first;f;){if(p=f._next,(f._act||d>=f._start)&&f._ts&&y!==f){if(f.parent!==this)return this.render(i,s,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,s,o),d!==this._time||!this._ts&&!g){y=0,p&&(u+=this._zTime=-sn);break}}f=p}else{f=this._last;for(var A=i<0?i:d;f;){if(p=f._prev,(f._act||A<=f._end)&&f._ts&&y!==f){if(f.parent!==this)return this.render(i,s,o);if(f.render(f._ts>0?(A-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(A-f._start)*f._ts,s,o||Jr&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!g){y=0,p&&(u+=this._zTime=A?-sn:sn);break}}f=p}}if(y&&!s&&(this.pause(),y.render(d>=a?0:-sn)._zTime=d>=a?1:-1,this._ts))return this._start=w,kw(this),this.render(i,s,o);this._onUpdate&&!s&&Cs(this,"onUpdate",!0),(u===c&&this._tTime>=this.totalDuration()||!u&&a)&&(w===this._start||Math.abs(v)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(u===c&&this._ts>0||!u&&this._ts<0)&&Ec(this,1),!s&&(!(i<0)||a)&&(u||a||!c)&&(Cs(this,u===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,s){var o=this;if(fa(s)||(s=Ss(this,s,i)),!(i instanceof Bg)){if(ei(i))return i.forEach(function(a){return o.add(a,s)}),this;if(Tr(i))return this.addLabel(i,s);if(!Vn(i))return this;i=rr.delayedCall(0,i)}return this!==i?No(this,i,s):this},t.getChildren=function(i,s,o,a){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===o&&(o=!0),void 0===a&&(a=-xs);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof rr?s&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,s,o)))),l=l._next;return c},t.getById=function(i){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===i)return s[o]},t.remove=function(i){return Tr(i)?this.removeLabel(i):Vn(i)?this.killTweensOf(i):(Ow(this,i),i===this._recent&&(this._recent=this._last),Ul(this))},t.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Or(is.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},t.addLabel=function(i,s){return this.labels[i]=Ss(this,s),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,s,o){var a=rr.delayedCall(0,s||Pg,o);return a.data="isPause",this._hasPause=1,No(this,a,Ss(this,i))},t.removePause=function(i){var s=this._first;for(i=Ss(this,i);s;)s._start===i&&"isPause"===s.data&&Ec(s),s=s._next},t.killTweensOf=function(i,s,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)Tc!==a[c]&&a[c].kill(i,s);return this},t.getTweensOf=function(i,s){for(var u,o=[],a=As(i),c=this._first,l=fa(s);c;)c instanceof rr?Npe(c._targets,a)&&(l?(!Tc||c._initted&&c._ts)&&c.globalTime(0)<=s&&c.globalTime(c.totalDuration())>s:!s||c.isActive())&&o.push(c):(u=c.getTweensOf(a,s)).length&&o.push.apply(o,u),c=c._next;return o},t.tweenTo=function(i,s){s=s||{};var f,o=this,a=Ss(o,i),l=s.startAt,u=s.onStart,h=s.onStartParams,d=s.immediateRender,p=rr.to(o,Ts({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||sn,onStart:function(){if(o.pause(),!f){var _=s.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());p._dur!==_&&Ud(p,_,0,1).render(p._time,!0,!0),f=1}u&&u.apply(p,h||[])}},s));return d?p.render(0):p},t.tweenFromTo=function(i,s,o){return this.tweenTo(s,Ts({startAt:{time:Ss(this,i)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(i){return void 0===i&&(i=this._time),G5(this,Ss(this,i))},t.previousLabel=function(i){return void 0===i&&(i=this._time),G5(this,Ss(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+sn)},t.shiftChildren=function(i,s,o){void 0===o&&(o=0);for(var l,a=this._first,c=this.labels;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(s)for(l in c)c[l]>=o&&(c[l]+=i);return Ul(this)},t.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){void 0===i&&(i=!0);for(var o,s=this._first;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ul(this)},t.totalDuration=function(i){var l,u,h,s=0,o=this,a=o._last,c=xs;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(h=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),(u=a._start)>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,No(o,a,u-a._delay,1)._lock=0):c=u,u<0&&a._ts&&(s-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),c=0),a._end>s&&a._ts&&(s=a._end),a=l;Ud(o,o===Dn&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(i){if(Dn._ts&&(A5(Dn,Fw(i,Dn)),b5=is.frame),is.frame>=T5){T5+=ts.autoSleep||120;var s=Dn._first;if((!s||!s._ts)&&ts.autoSleep&&is._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||is.sleep()}}},e}(Bg);Ts(Li.prototype,{_lock:0,_hasPause:0,_forcing:0});var Tc,B1,nme=function(e,t,r,i,s,o,a){var h,d,f,p,m,_,g,y,c=new Oi(this._pt,e,t,0,1,sj,null,s),l=0,u=0;for(c.b=r,c.e=i,r+="",(g=~(i+="").indexOf("random("))&&(i=Fg(i)),o&&(o(y=[r,i],e,t),r=y[0],i=y[1]),d=r.match(x1)||[];h=x1.exec(i);)p=h[0],m=i.substring(l,h.index),f?f=(f+1)%5:"rgba("===m.substr(-5)&&(f=1),p!==d[u++]&&(_=parseFloat(d[u-1])||0,c._pt={_next:c._pt,p:m||1===u?m:",",s:_,c:"="===p.charAt(1)?kd(_,p)-_:parseFloat(p)-_,m:f&&f<4?Math.round:0},l=x1.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(y5.test(i)||g)&&(c.e=0),this._pt=c,c},U1=function(e,t,r,i,s,o,a,c,l,u){Vn(i)&&(i=i(s||0,e,o));var p,h=e[t],d="get"!==r?r:Vn(h)?l?e[t.indexOf("set")||!Vn(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,f=Vn(h)?l?ame:rj:H1;if(Tr(i)&&(~i.indexOf("random(")&&(i=Fg(i)),"="===i.charAt(1)&&((p=kd(d,i)+(ti(d)||0))||0===p)&&(i=p)),!u||d!==i||B1)return isNaN(d*i)||""===i?(!h&&!(t in e)&&S1(t,i),nme.call(this,e,t,d,i,f,c||ts.stringFilter,l)):(p=new Oi(this._pt,e,t,+d||0,i-(d||0),"boolean"==typeof h?lme:ij,0,f),l&&(p.fp=l),a&&p.modifier(a,this,e),this._pt=p)},ej=function(e,t,r,i,s,o){var a,c,l,u;if(rs[e]&&!1!==(a=new rs[e]).init(s,a.rawVars?t[e]:function(e,t,r,i,s){if(Vn(e)&&(e=zg(e,s,t,r,i)),!Po(e)||e.style&&e.nodeType||ei(e)||g5(e))return Tr(e)?zg(e,s,t,r,i):e;var a,o={};for(a in e)o[a]=zg(e[a],s,t,r,i);return o}(t[e],i,s,o,r),r,i,o)&&(r._pt=c=new Oi(r._pt,s,e,0,1,a.render,a,0,a.priority),r!==Bd))for(l=r._ptLookup[r._targets.indexOf(s)],u=a._props.length;u--;)l[a._props[u]]=c;return a},z1=function n(e,t,r){var T,S,x,A,O,U,H,R,k,B,W,ne,q,i=e.vars,s=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,u=i.onUpdateParams,h=i.callbackScope,d=i.runBackwards,f=i.yoyoEase,p=i.keyframes,m=i.autoRevert,_=e._dur,g=e._startAt,y=e._targets,v=e.parent,w=v&&"nested"===v.data?v.vars.targets:y,E="auto"===e._overwrite&&!_1,b=e.timeline;if(b&&(!p||!s)&&(s="none"),e._ease=Bl(s,Od.ease),e._yEase=f?K5(Bl(!0===f?s:f,Od.ease)):0,f&&e._yoyo&&!e._repeat&&(f=e._yEase,e._yEase=e._ease,e._ease=f),e._from=!b&&!!i.runBackwards,!b||p&&!i.stagger){if(ne=(R=y[0]?kl(y[0]).harness:0)&&i[R.prop],T=Lw(i,A1),g&&(g._zTime<0&&g.progress(1),t<0&&d&&a&&!m?g.render(-1,!0):g.revert(d&&_?Rw:Rpe),g._lazy=0),o){if(Ec(e._startAt=rr.set(y,Ts({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!g&&Pi(c),startAt:null,delay:0,onUpdate:l,onUpdateParams:u,callbackScope:h,stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Jr||!a&&!m)&&e._startAt.revert(Rw),a&&_&&t<=0&&r<=0)return void(t&&(e._zTime=t))}else if(d&&_&&!g)if(t&&(a=!1),x=Ts({overwrite:!1,data:"isFromStart",lazy:a&&!g&&Pi(c),immediateRender:a,stagger:0,parent:v},T),ne&&(x[R.prop]=ne),Ec(e._startAt=rr.set(y,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Jr?e._startAt.revert(Rw):e._startAt.render(-1,!0)),e._zTime=t,a){if(!t)return}else n(e._startAt,sn,sn);for(e._pt=e._ptCache=0,c=_&&Pi(c)||c&&!_,S=0;S<y.length;S++){if(H=(O=y[S])._gsap||D1(y)[S]._gsap,e._ptLookup[S]=B={},C1[H.id]&&wc.length&&Nw(),W=w===y?S:w.indexOf(O),R&&!1!==(k=new R).init(O,ne||T,e,W,w)&&(e._pt=A=new Oi(e._pt,O,k.name,0,1,k.render,k,0,k.priority),k._props.forEach(function(ee){B[ee]=A}),k.priority&&(U=1)),!R||ne)for(x in T)rs[x]&&(k=ej(x,T,e,W,O,w))?k.priority&&(U=1):B[x]=A=U1.call(e,O,x,"get",T[x],W,w,0,i.stringFilter);e._op&&e._op[S]&&e.kill(O,e._op[S]),E&&e._pt&&(Tc=e,Dn.killTweensOf(O,B,e.globalTime(t)),q=!e.parent,Tc=0),e._pt&&c&&(C1[H.id]=1)}U&&oj(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!q,p&&t<=0&&b.render(xs,!0,!0)},ome=function(e,t,r,i){var o,a,s=t.ease||i||"power1.inOut";if(ei(t))a=r[e]||(r[e]=[]),t.forEach(function(c,l){return a.push({t:l/(t.length-1)*100,v:c,e:s})});else for(o in t)a=r[o]||(r[o]=[]),"ease"===o||a.push({t:parseFloat(e),v:t[o],e:s})},zg=function(e,t,r,i,s){return Vn(e)?e.call(t,r,i,s):Tr(e)&&~e.indexOf("random(")?Fg(e):e},tj=I1+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",nj={};Ni(tj+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return nj[n]=1});var rr=function(n){function e(r,i,s,o){var a;"number"==typeof i&&(s.duration=i,i=s,s=null);var w,E,b,T,S,x,A,O,c=(a=n.call(this,o?i:Ng(i))||this).vars,l=c.duration,u=c.delay,h=c.immediateRender,d=c.stagger,f=c.overwrite,p=c.keyframes,m=c.defaults,_=c.scrollTrigger,g=c.yoyoEase,y=i.parent||Dn,v=(ei(r)||g5(r)?fa(r[0]):"length"in i)?[r]:As(r);if(a._targets=v.length?D1(v):Dw("GSAP target "+r+" not found. https://greensock.com",!ts.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,p||d||Mw(l)||Mw(u)){if(i=a.vars,(w=a.timeline=new Li({data:"nested",defaults:m||{},targets:y&&"nested"===y.data?y.vars.targets:v})).kill(),w.parent=w._dp=da(a),w._start=0,d||Mw(l)||Mw(u)){if(T=v.length,A=d&&V5(d),Po(d))for(S in d)~tj.indexOf(S)&&(O||(O={}),O[S]=d[S]);for(E=0;E<T;E++)(b=Lw(i,nj)).stagger=0,g&&(b.yoyoEase=g),O&&Vl(b,O),x=v[E],b.duration=+zg(l,da(a),E,x,v),b.delay=(+zg(u,da(a),E,x,v)||0)-a._delay,!d&&1===T&&b.delay&&(a._delay=u=b.delay,a._start+=u,b.delay=0),w.to(x,b,A?A(E,x,v):0),w._ease=Ft.none;w.duration()?l=u=0:a.timeline=0}else if(p){Ng(Ts(w.vars.defaults,{ease:"none"})),w._ease=Bl(p.ease||i.ease||"none");var H,R,k,U=0;if(ei(p))p.forEach(function(B){return w.to(v,B,">")}),w.duration();else{for(S in b={},p)"ease"===S||"easeEach"===S||ome(S,p[S],b,p.easeEach);for(S in b)for(H=b[S].sort(function(B,W){return B.t-W.t}),U=0,E=0;E<H.length;E++)(k={ease:(R=H[E]).e,duration:(R.t-(E?H[E-1].t:0))/100*l})[S]=R.v,w.to(v,k,U),U+=k.duration;w.duration()<l&&w.to({},{duration:l-w.duration()})}}l||a.duration(l=w.duration())}else a.timeline=0;return!0===f&&!_1&&(Tc=da(a),Dn.killTweensOf(v),Tc=0),No(y,da(a),s),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!p&&a._start===Or(y._time)&&Pi(h)&&kpe(da(a))&&"nested"!==y.data)&&(a._tTime=-sn,a.render(Math.max(0,-u)||0)),_&&N5(da(a),_),a}p5(e,n);var t=e.prototype;return t.render=function(i,s,o){var d,f,p,m,_,g,y,v,w,a=this._time,c=this._tDur,l=this._dur,u=i<0,h=i>c-sn&&!u?c:i<sn?0:i;if(l){if(h!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(d=h,v=this.timeline,this._repeat){if(m=l+this._rDelay,this._repeat<-1&&u)return this.totalTime(100*m+i,s,o);if(d=Or(h%m),h===c?(p=this._repeat,d=l):((p=~~(h/m))&&p===h/m&&(d=l,p--),d>l&&(d=l)),(g=this._yoyo&&1&p)&&(w=this._yEase,d=l-d),_=Vd(this._tTime,m),d===a&&!o&&this._initted)return this._tTime=h,this;p!==_&&(v&&this._yEase&&Q5(v,g),this.vars.repeatRefresh&&!g&&!this._lock&&(this._lock=o=1,this.render(Or(m*p),!0).invalidate()._lock=0))}if(!this._initted){if(L5(this,u?i:d,o,s,h))return this._tTime=0,this;if(a!==this._time)return this;if(l!==this._dur)return this.render(i,s,o)}if(this._tTime=h,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(w||this._ease)(d/l),this._from&&(this.ratio=y=1-y),d&&!a&&!s&&!p&&(Cs(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(y,f.d),f=f._next;v&&v.render(i<0?i:!d&&g?-sn:v._dur*v._ease(d/this._dur),s,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(u&&R1(this,i,0,o),Cs(this,"onUpdate")),this._repeat&&p!==_&&this.vars.onRepeat&&!s&&this.parent&&Cs(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&R1(this,i,0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Ec(this,1),!s&&(!u||a)&&(h||a||g)&&(Cs(this,h===c?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,r,i){var l,u,h,s=e.ratio,o=t<0||!t&&(!e._start&&Vpe(e)&&(e._initted||!P1(e))||(e._ts<0||e._dp._ts<0)&&!P1(e))?0:1,a=e._rDelay,c=0;if(a&&e._repeat&&(c=Og(0,e._tDur,t),u=Vd(c,a),e._yoyo&&1&u&&(o=1-o),u!==Vd(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||Jr||i||e._zTime===sn||!t&&e._zTime){if(!e._initted&&L5(e,t,i,r,c))return;for(h=e._zTime,e._zTime=t||(r?sn:0),r||(r=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=c,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&R1(e,t,0,!0),e._onUpdate&&!r&&Cs(e,"onUpdate"),c&&e._repeat&&!r&&e.parent&&Cs(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Ec(e,1),!r&&!Jr&&(Cs(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,i,s,o);return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,s,o,a){Ug||is.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||z1(this,c),function(e,t,r,i,s,o,a){var l,u,h,d,c=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!c)for(c=e._ptCache[t]=[],h=e._ptLookup,d=e._targets.length;d--;){if((l=h[d][t])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return B1=1,e.vars[t]="+=0",z1(e,a),B1=0,1;c.push(l)}for(d=c.length;d--;)(l=(u=c[d])._pt||u).s=!i&&0!==i||s?l.s+(i||0)+o*l.c:i,l.c=r-l.s,u.e&&(u.e=Xn(r)+ti(u.e)),u.b&&(u.b=l.s+ti(u.b))}(this,i,s,o,a,this._ease(c/this._dur),c)?this.resetTo(i,s,o,a):(Vw(this,0),this.parent||D5(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,s){if(void 0===s&&(s="all"),!(i||s&&"all"!==s))return this._lazy=this._pt=0,this.parent?kg(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,Tc&&!0!==Tc.vars.overwrite)._first||kg(this),this.parent&&o!==this.timeline.totalDuration()&&Ud(this,this._dur*this.timeline._tDur/o,0,1),this}var h,d,f,p,m,_,g,a=this._targets,c=i?As(i):a,l=this._ptLookup,u=this._pt;if((!s||"all"===s)&&function(e,t){for(var r=e.length,i=r===t.length;i&&r--&&e[r]===t[r];);return r<0}(a,c))return"all"===s&&(this._pt=0),kg(this);for(h=this._op=this._op||[],"all"!==s&&(Tr(s)&&(m={},Ni(s,function(y){return m[y]=1}),s=m),s=function(e,t){var s,o,a,c,r=e[0]?kl(e[0]).harness:0,i=r&&r.aliases;if(!i)return t;for(o in s=Vl({},t),i)if(o in s)for(a=(c=i[o].split(",")).length;a--;)s[c[a]]=s[o];return s}(a,s)),g=a.length;g--;)if(~c.indexOf(a[g]))for(m in d=l[g],"all"===s?(h[g]=s,p=d,f={}):(f=h[g]=h[g]||{},p=s),p)(_=d&&d[m])&&((!("kill"in _.d)||!0===_.d.kill(m))&&Ow(this,_,"_pt"),delete d[m]),"all"!==f&&(f[m]=1);return this._initted&&!this._pt&&u&&kg(this),this},e.to=function(i,s){return new e(i,s,arguments[2])},e.from=function(i,s){return Lg(1,arguments)},e.delayedCall=function(i,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(i,s,o){return Lg(2,arguments)},e.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(i,s)},e.killTweensOf=function(i,s,o){return Dn.killTweensOf(i,s,o)},e}(Bg);Ts(rr.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Ni("staggerTo,staggerFrom,staggerFromTo",function(n){rr[n]=function(){var e=new Li,t=N1.call(arguments,0);return t.splice("staggerFromTo"===n?5:4,0,0),e[n].apply(e,t)}});var H1=function(e,t,r){return e[t]=r},rj=function(e,t,r){return e[t](r)},ame=function(e,t,r,i){return e[t](i.fp,r)},cme=function(e,t,r){return e.setAttribute(t,r)},G1=function(e,t){return Vn(e[t])?rj:v1(e[t])&&e.setAttribute?cme:H1},ij=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},lme=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},sj=function(e,t){var r=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*e):Math.round(1e4*(r.s+r.c*e))/1e4)+i,r=r._next;i+=t.c}t.set(t.t,t.p,i,t)},j1=function(e,t){for(var r=t._pt;r;)r.r(e,r.d),r=r._next},ume=function(e,t,r,i){for(var o,s=this._pt;s;)o=s._next,s.p===i&&s.modifier(e,t,r),s=o},hme=function(e){for(var r,i,t=this._pt;t;)i=t._next,t.p===e&&!t.op||t.op===e?Ow(this,t,"_pt"):t.dep||(r=1),t=i;return!r},dme=function(e,t,r,i){i.mSet(e,t,i.m.call(i.tween,r,i.mt),i)},oj=function(e){for(var r,i,s,o,t=e._pt;t;){for(r=t._next,i=s;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:o)?t._prev._next=t:s=t,(t._next=i)?i._prev=t:o=t,t=r}e._pt=s},Oi=function(){function n(t,r,i,s,o,a,c,l,u){this.t=r,this.s=s,this.c=o,this.p=i,this.r=a||ij,this.d=c||this,this.set=l||H1,this.pr=u||0,this._next=t,t&&(t._prev=this)}return n.prototype.modifier=function(r,i,s){this.mSet=this.mSet||this.set,this.set=dme,this.m=r,this.mt=s,this.tween=i},n}();Ni(I1+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return A1[n]=1}),ns.TweenMax=ns.TweenLite=rr,ns.TimelineLite=ns.TimelineMax=Li,Dn=new Li({sortChildren:!1,defaults:Od,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),ts.stringFilter=Y5;var Hl=[],Uw={},fme=[],aj=0,pme=0,W1=function(e){return(Uw[e]||fme).map(function(t){return t()})},$1=function(){var e=Date.now(),t=[];e-aj>2&&(W1("matchMediaInit"),Hl.forEach(function(r){var o,a,c,l,i=r.queries,s=r.conditions;for(a in i)(o=bs.matchMedia(i[a]).matches)&&(c=1),o!==s[a]&&(s[a]=o,l=1);l&&(r.revert(),c&&t.push(r))}),W1("matchMediaRevert"),t.forEach(function(r){return r.onMatch(r)}),aj=e,W1("matchMedia"))},cj=function(){function n(t,r){this.selector=r&&L1(r),this.data=[],this._r=[],this.isReverted=!1,this.id=pme++,t&&this.add(t)}var e=n.prototype;return e.add=function(r,i,s){Vn(r)&&(s=i,i=r,r=Vn);var o=this,a=function(){var h,l=kn,u=o.selector;return l&&l!==o&&l.data.push(o),s&&(o.selector=L1(s)),kn=o,h=i.apply(o,arguments),Vn(h)&&o._r.push(h),kn=l,o.selector=u,o.isReverted=!1,h};return o.last=a,r===Vn?a(o):r?o[r]=a:a},e.ignore=function(r){var i=kn;kn=null,r(this),kn=i},e.getTweens=function(){var r=[];return this.data.forEach(function(i){return i instanceof n?r.push.apply(r,i.getTweens()):i instanceof rr&&!(i.parent&&"nested"===i.parent.data)&&r.push(i)}),r},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(r,i){var s=this;if(r){var o=this.getTweens();this.data.forEach(function(c){"isFlip"===c.data&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(l){return o.splice(o.indexOf(l),1)}))}),o.map(function(c){return{g:c.globalTime(0),t:c}}).sort(function(c,l){return l.g-c.g||-1/0}).forEach(function(c){return c.t.revert(r)}),this.data.forEach(function(c){return!(c instanceof rr)&&c.revert&&c.revert(r)}),this._r.forEach(function(c){return c(r,s)}),this.isReverted=!0}else this.data.forEach(function(c){return c.kill&&c.kill()});if(this.clear(),i)for(var a=Hl.length;a--;)Hl[a].id===this.id&&Hl.splice(a,1)},e.revert=function(r){this.kill(r||{})},n}(),mme=function(){function n(t){this.contexts=[],this.scope=t}var e=n.prototype;return e.add=function(r,i,s){Po(r)||(r={matches:r});var c,l,u,o=new cj(0,s||this.scope),a=o.conditions={};for(l in kn&&!o.selector&&(o.selector=kn.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=r,r)"all"===l?u=1:(c=bs.matchMedia(r[l]))&&(Hl.indexOf(o)<0&&Hl.push(o),(a[l]=c.matches)&&(u=1),c.addListener?c.addListener($1):c.addEventListener("change",$1));return u&&i(o),this},e.revert=function(r){this.kill(r||{})},e.kill=function(r){this.contexts.forEach(function(i){return i.kill(r,!0)})},n}(),Bw={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(function(i){return W5(i)})},timeline:function(e){return new Li(e)},getTweensOf:function(e,t){return Dn.getTweensOf(e,t)},getProperty:function(e,t,r,i){Tr(e)&&(e=As(e)[0]);var s=kl(e||{}).get,o=r?M5:C5;return"native"===r&&(r=""),e&&(t?o((rs[t]&&rs[t].get||s)(e,t,r,i)):function(a,c,l){return o((rs[a]&&rs[a].get||s)(e,a,c,l))})},quickSetter:function(e,t,r){if((e=As(e)).length>1){var i=e.map(function(u){return Fi.quickSetter(u,t,r)}),s=i.length;return function(u){for(var h=s;h--;)i[h](u)}}var o=rs[t],a=kl(e=e[0]||{}),c=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(u){var h=new o;Bd._pt=0,h.init(e,r?u+r:u,Bd,0,[e]),h.render(1,h),Bd._pt&&j1(1,Bd)}:a.set(e,c);return o?l:function(u){return l(e,c,r?u+r:u,a,1)}},quickTo:function(e,t,r){var i,s=Fi.to(e,Vl(((i={})[t]="+=0.1",i.paused=!0,i),r||{})),o=function(c,l,u){return s.resetTo(t,c,l,u)};return o.tween=s,o},isTweening:function(e){return Dn.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Bl(e.ease,Od.ease)),I5(Od,e||{})},config:function(e){return I5(ts,e||{})},registerEffect:function(e){var t=e.name,r=e.effect,s=e.defaults,o=e.extendTimeline;(e.plugins||"").split(",").forEach(function(a){return a&&!rs[a]&&!ns[a]&&Dw(t+" effect requires "+a+" plugin.")}),M1[t]=function(a,c,l){return r(As(a),Ts(c||{},s),l)},o&&(Li.prototype[t]=function(a,c,l){return this.add(M1[t](a,Po(c)?c:(l=c)&&{},this),l)})},registerEase:function(e,t){Ft[e]=Bl(t)},parseEase:function(e,t){return arguments.length?Bl(e,t):Ft},getById:function(e){return Dn.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var i,s,r=new Li(e);for(r.smoothChildTiming=Pi(e.smoothChildTiming),Dn.remove(r),r._dp=0,r._time=r._tTime=Dn._time,i=Dn._first;i;)s=i._next,(t||!(!i._dur&&i instanceof rr&&i.vars.onComplete===i._targets[0]))&&No(r,i,i._start-i._delay),i=s;return No(Dn,r,0),r},context:function(e,t){return e?new cj(e,t):kn},matchMedia:function(e){return new mme(e)},matchMediaRefresh:function(){return Hl.forEach(function(e){var r,i,t=e.conditions;for(i in t)t[i]&&(t[i]=!1,r=1);r&&e.revert()})||$1()},addEventListener:function(e,t){var r=Uw[e]||(Uw[e]=[]);~r.indexOf(t)||r.push(t)},removeEventListener:function(e,t){var r=Uw[e],i=r&&r.indexOf(t);i>=0&&r.splice(i,1)},utils:{wrap:function n(e,t,r){var i=t-e;return ei(e)?z5(e,n(0,e.length),t):xc(r,function(s){return(i+(s-e)%i)%i+e})},wrapYoyo:function n(e,t,r){var i=t-e,s=2*i;return ei(e)?z5(e,n(0,e.length-1),t):xc(r,function(o){return e+((o=(s+(o-e)%s)%s||0)>i?s-o:o)})},distribute:V5,random:B5,snap:U5,normalize:function(e,t,r){return H5(e,t,0,1,r)},getUnit:ti,clamp:function(e,t,r){return xc(r,function(i){return Og(e,t,i)})},splitColor:$5,toArray:As,selector:L1,mapRange:H5,pipe:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return t.reduce(function(s,o){return o(s)},i)}},unitize:function(e,t){return function(r){return e(parseFloat(r))+(t||ti(r))}},interpolate:function n(e,t,r,i){var s=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!s){var c,l,u,h,d,o=Tr(e),a={};if(!0===r&&(i=1)&&(r=null),o)e={p:e},t={p:t};else if(ei(e)&&!ei(t)){for(u=[],d=(h=e.length)-2,l=1;l<h;l++)u.push(n(e[l-1],e[l]));h--,s=function(p){p*=h;var m=Math.min(d,~~p);return u[m](p-m)},r=t}else i||(e=Vl(ei(e)?[]:{},e));if(!u){for(c in t)U1.call(a,e,c,"get",t[c]);s=function(p){return j1(p,a)||(o?e.p:e)}}}return xc(r,s)},shuffle:k5},install:E5,effects:M1,ticker:is,updateRoot:Li.updateRoot,plugins:rs,globalTimeline:Dn,core:{PropTween:Oi,globals:x5,Tween:rr,Timeline:Li,Animation:Bg,getCache:kl,_removeLinkedListItem:Ow,reverting:function(){return Jr},context:function(e){return e&&kn&&(kn.data.push(e),e._ctx=kn),kn},suppressOverwrites:function(e){return _1=e}}};Ni("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Bw[n]=rr[n]}),is.add(Li.updateRoot),Bd=Bw.to({},{duration:0});var gme=function(e,t){for(var r=e._pt;r&&r.p!==t&&r.op!==t&&r.fp!==t;)r=r._next;return r},q1=function(e,t){return{name:e,rawVars:1,init:function(i,s,o){o._onInit=function(a){var c,l;if(Tr(s)&&(c={},Ni(s,function(u){return c[u]=1}),s=c),t){for(l in c={},s)c[l]=t(s[l]);s=c}!function(e,t){var i,s,o,r=e._targets;for(i in t)for(s=r.length;s--;)(o=e._ptLookup[s][i])&&(o=o.d)&&(o._pt&&(o=gme(o,i)),o&&o.modifier&&o.modifier(t[i],e,r[s],i))}(a,s)}}}},Fi=Bw.registerPlugin({name:"attr",init:function(e,t,r,i,s){var o,a,c;for(o in this.tween=r,t)c=e.getAttribute(o)||"",(a=this.add(e,"setAttribute",(c||0)+"",t[o],i,s,0,0,o)).op=o,a.b=c,this._props.push(o)},render:function(e,t){for(var r=t._pt;r;)Jr?r.set(r.t,r.p,r.b,r):r.r(e,r.d),r=r._next}},{name:"endArray",init:function(e,t){for(var r=t.length;r--;)this.add(e,r,e[r]||0,t[r],0,0,0,0,0,1)}},q1("roundProps",O1),q1("modifiers"),q1("snap",U5))||Bw;rr.version=Li.version=Fi.version="3.12.2",w5=1,w1()&&zd();var lj,Sc,Hd,X1,Gl,uj,Y1,gj,pa={},jl=180/Math.PI,Gd=Math.PI/180,jd=Math.atan2,hj=1e8,K1=/([A-Z])/g,wme=/(left|right|width|margin|padding|x)/i,Eme=/[\s,\(]\S/,Lo={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Q1=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},xme=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},bme=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Tme=function(e,t){var r=t.s+t.c*e;t.set(t.t,t.p,~~(r+(r<0?-.5:.5))+t.u,t)},dj=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},fj=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Sme=function(e,t,r){return e.style[t]=r},Ame=function(e,t,r){return e.style.setProperty(t,r)},Cme=function(e,t,r){return e._gsap[t]=r},Mme=function(e,t,r){return e._gsap.scaleX=e._gsap.scaleY=r},Ime=function(e,t,r,i,s){var o=e._gsap;o.scaleX=o.scaleY=r,o.renderTransform(s,o)},Dme=function(e,t,r,i,s){var o=e._gsap;o[t]=r,o.renderTransform(s,o)},Rn="transform",Ys=Rn+"Origin",Rme=function n(e,t){var r=this,i=this.target,s=i.style;if(e in pa&&s){if(this.tfm=this.tfm||{},"transform"===e)return Lo.transform.split(",").forEach(function(o){return n.call(r,o,t)});if(~(e=Lo[e]||e).indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=ma(i,o)}):this.tfm[e]=i._gsap.x?i._gsap[e]:ma(i,e),this.props.indexOf(Rn)>=0)return;i._gsap.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(Ys,t,"")),e=Rn}(s||t)&&this.props.push(e,t,s[e])},pj=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Pme=function(){var s,o,e=this.props,t=this.target,r=t.style,i=t._gsap;for(s=0;s<e.length;s+=3)e[s+1]?t[e[s]]=e[s+2]:e[s+2]?r[e[s]]=e[s+2]:r.removeProperty("--"===e[s].substr(0,2)?e[s]:e[s].replace(K1,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),(!(s=Y1())||!s.isStart)&&!r[Rn]&&(pj(r),i.uncache=1)}},mj=function(e,t){var r={target:e,props:[],revert:Pme,save:Rme};return e._gsap||Fi.core.getCache(e),t&&t.split(",").forEach(function(i){return r.save(i)}),r},Z1=function(e,t){var r=Sc.createElementNS?Sc.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Sc.createElement(e);return r.style?r:Sc.createElement(e)},Oo=function n(e,t,r){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(K1,"-$1").toLowerCase())||i.getPropertyValue(t)||!r&&n(e,Wd(t)||t,1)||""},_j="O,Moz,ms,Ms,Webkit".split(","),Wd=function(e,t,r){var s=(t||Gl).style,o=5;if(e in s&&!r)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(_j[o]+e in s););return o<0?null:(3===o?"ms":o>=0?_j[o]:"")+e},J1=function(){typeof window<"u"&&window.document&&(lj=window,Hd=(Sc=lj.document).documentElement,Gl=Z1("div")||{style:{}},Z1("div"),Rn=Wd(Rn),Ys=Rn+"Origin",Gl.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",gj=!!Wd("perspective"),Y1=Fi.core.reverting,X1=1)},eD=function n(e){var o,t=Z1("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,i=this.nextSibling,s=this.style.cssText;if(Hd.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(o=this._gsapBBox());return r&&(i?r.insertBefore(this,i):r.appendChild(this)),Hd.removeChild(t),this.style.cssText=s,o},yj=function(e,t){for(var r=t.length;r--;)if(e.hasAttribute(t[r]))return e.getAttribute(t[r])},vj=function(e){var t;try{t=e.getBBox()}catch{t=eD.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===eD||(t=eD.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+yj(e,["x","cx","x1"])||0,y:+yj(e,["y","cy","y1"])||0,width:0,height:0}},wj=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!vj(e))},Hg=function(e,t){if(t){var r=e.style;t in pa&&t!==Ys&&(t=Rn),r.removeProperty?(("ms"===t.substr(0,2)||"webkit"===t.substr(0,6))&&(t="-"+t),r.removeProperty(t.replace(K1,"-$1").toLowerCase())):r.removeAttribute(t)}},Ac=function(e,t,r,i,s,o){var a=new Oi(e._pt,t,r,0,1,o?fj:dj);return e._pt=a,a.b=i,a.e=s,e._props.push(r),a},Ej={deg:1,rad:1,turn:1},Nme={grid:1,flex:1},Cc=function n(e,t,r,i){var p,m,_,g,s=parseFloat(r)||0,o=(r+"").trim().substr((s+"").length)||"px",a=Gl.style,c=wme.test(t),l="svg"===e.tagName.toLowerCase(),u=(l?"client":"offset")+(c?"Width":"Height"),h=100,d="px"===i,f="%"===i;return i===o||!s||Ej[i]||Ej[o]?s:("px"!==o&&!d&&(s=n(e,t,r,"px")),g=e.getCTM&&wj(e),!f&&"%"!==o||!pa[t]&&!~t.indexOf("adius")?(a[c?"width":"height"]=h+(d?o:i),m=~t.indexOf("adius")||"em"===i&&e.appendChild&&!l?e:e.parentNode,g&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===Sc||!m.appendChild)&&(m=Sc.body),(_=m._gsap)&&f&&_.width&&c&&_.time===is.time&&!_.uncache?Xn(s/_.width*h):((f||"%"===o)&&!Nme[Oo(m,"display")]&&(a.position=Oo(e,"position")),m===e&&(a.position="static"),m.appendChild(Gl),p=Gl[u],m.removeChild(Gl),a.position="absolute",c&&f&&((_=kl(m)).time=is.time,_.width=m[u]),Xn(d?p*s/h:p&&s?h/p*s:0))):(p=g?e.getBBox()[c?"width":"height"]:e[u],Xn(f?s/p*h:s/100*p)))},ma=function(e,t,r,i){var s;return X1||J1(),t in Lo&&"transform"!==t&&~(t=Lo[t]).indexOf(",")&&(t=t.split(",")[0]),pa[t]&&"transform"!==t?(s=jg(e,i),s="transformOrigin"!==t?s[t]:s.svg?s.origin:Hw(Oo(e,Ys))+" "+s.zOrigin+"px"):(!(s=e.style[t])||"auto"===s||i||~(s+"").indexOf("calc("))&&(s=zw[t]&&zw[t](e,t,r)||Oo(e,t)||S5(e,t)||("opacity"===t?1:0)),r&&!~(s+"").trim().indexOf(" ")?Cc(e,t,s,r)+r:s},Lme=function(e,t,r,i){if(!r||"none"===r){var s=Wd(t,e,1),o=s&&Oo(e,s,1);o&&o!==r?(t=s,r=o):"borderColor"===t&&(r=Oo(e,"borderTopColor"))}var u,h,d,f,p,m,_,g,y,v,w,a=new Oi(this._pt,e.style,t,0,1,sj),c=0,l=0;if(a.b=r,a.e=i,r+="","auto"==(i+="")&&(e.style[t]=i,i=Oo(e,t)||i,e.style[t]=r),Y5(u=[r,i]),i=u[1],d=(r=u[0]).match(Fd)||[],(i.match(Fd)||[]).length){for(;h=Fd.exec(i);)_=h[0],y=i.substring(c,h.index),p?p=(p+1)%5:("rgba("===y.substr(-5)||"hsla("===y.substr(-5))&&(p=1),_!==(m=d[l++]||"")&&(f=parseFloat(m)||0,w=m.substr((f+"").length),"="===_.charAt(1)&&(_=kd(f,_)+w),g=parseFloat(_),v=_.substr((g+"").length),c=Fd.lastIndex-v.length,v||(v=v||ts.units[t]||w,c===i.length&&(i+=v,a.e+=v)),w!==v&&(f=Cc(e,t,m,v)||0),a._pt={_next:a._pt,p:y||1===l?y:",",s:f,c:g-f,m:p&&p<4||"zIndex"===t?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r="display"===t&&"none"===i?fj:dj;return y5.test(i)&&(a.e=0),this._pt=a,a},xj={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Ome=function(e){var t=e.split(" "),r=t[0],i=t[1]||"50%";return("top"===r||"bottom"===r||"left"===i||"right"===i)&&(e=r,r=i,i=e),t[0]=xj[r]||r,t[1]=xj[i]||i,t.join(" ")},Fme=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var a,c,l,r=t.t,i=r.style,s=t.u,o=r._gsap;if("all"===s||!0===s)i.cssText="",c=1;else for(l=(s=s.split(",")).length;--l>-1;)pa[a=s[l]]&&(c=1,a="transformOrigin"===a?Ys:Rn),Hg(r,a);c&&(Hg(r,Rn),o&&(o.svg&&r.removeAttribute("transform"),jg(r,1),o.uncache=1,pj(i)))}},zw={clearProps:function(e,t,r,i,s){if("isFromStart"!==s.data){var o=e._pt=new Oi(e._pt,t,r,0,0,Fme);return o.u=i,o.pr=-10,o.tween=s,e._props.push(r),1}}},Gg=[1,0,0,1,0,0],bj={},Tj=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},Sj=function(e){var t=Oo(e,Rn);return Tj(t)?Gg:t.substr(7).match(_5).map(Xn)},tD=function(e,t){var o,a,c,l,r=e._gsap||kl(e),i=e.style,s=Sj(e);return r.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(s=[(c=e.transform.baseVal.consolidate().matrix).a,c.b,c.c,c.d,c.e,c.f]).join(",")?Gg:s:(s===Gg&&!e.offsetParent&&e!==Hd&&!r.svg&&(c=i.display,i.display="block",(!(o=e.parentNode)||!e.offsetParent)&&(l=1,a=e.nextElementSibling,Hd.appendChild(e)),s=Sj(e),c?i.display=c:Hg(e,"display"),l&&(a?o.insertBefore(e,a):o?o.appendChild(e):Hd.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},nD=function(e,t,r,i,s,o){var b,T,x,a=e._gsap,c=s||tD(e,!0),l=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,d=a.yOffset||0,f=c[0],p=c[1],m=c[2],_=c[3],g=c[4],y=c[5],v=t.split(" "),w=parseFloat(v[0])||0,E=parseFloat(v[1])||0;r?c!==Gg&&(T=f*_-p*m)&&(x=w*(-p/T)+E*(f/T)-(f*y-p*g)/T,w=w*(_/T)+E*(-m/T)+(m*y-_*g)/T,E=x):(w=(b=vj(e)).x+(~v[0].indexOf("%")?w/100*b.width:w),E=b.y+(~(v[1]||v[0]).indexOf("%")?E/100*b.height:E)),i||!1!==i&&a.smooth?(a.xOffset=h+((g=w-l)*f+(y=E-u)*m)-g,a.yOffset=d+(g*p+y*_)-y):a.xOffset=a.yOffset=0,a.xOrigin=w,a.yOrigin=E,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!r,e.style[Ys]="0px 0px",o&&(Ac(o,a,"xOrigin",l,w),Ac(o,a,"yOrigin",u,E),Ac(o,a,"xOffset",h,a.xOffset),Ac(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",w+" "+E)},jg=function(e,t){var r=e._gsap||new J5(e);if("x"in r&&!t&&!r.uncache)return r;var u,h,d,f,p,m,_,g,y,v,w,E,b,T,S,x,A,O,U,H,R,k,B,W,ne,q,ee,F,X,ue,le,de,i=e.style,s=r.scaleX<0,o="px",a="deg",c=getComputedStyle(e),l=Oo(e,Ys)||"0";return u=h=d=m=_=g=y=v=w=0,f=p=1,r.svg=!(!e.getCTM||!wj(e)),c.translate&&(("none"!==c.translate||"none"!==c.scale||"none"!==c.rotate)&&(i[Rn]=("none"!==c.translate?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==c.rotate?"rotate("+c.rotate+") ":"")+("none"!==c.scale?"scale("+c.scale.split(" ").join(",")+") ":"")+("none"!==c[Rn]?c[Rn]:"")),i.scale=i.rotate=i.translate="none"),T=tD(e,r.svg),r.svg&&(r.uncache?(ne=e.getBBox(),l=r.xOrigin-ne.x+"px "+(r.yOrigin-ne.y)+"px",W=""):W=!t&&e.getAttribute("data-svg-origin"),nD(e,W||l,!!W||r.originIsAbsolute,!1!==r.smooth,T)),E=r.xOrigin||0,b=r.yOrigin||0,T!==Gg&&(O=T[0],U=T[1],H=T[2],R=T[3],u=k=T[4],h=B=T[5],6===T.length?(f=Math.sqrt(O*O+U*U),p=Math.sqrt(R*R+H*H),m=O||U?jd(U,O)*jl:0,(y=H||R?jd(H,R)*jl+m:0)&&(p*=Math.abs(Math.cos(y*Gd))),r.svg&&(u-=E-(E*O+b*H),h-=b-(E*U+b*R))):(ue=T[7],ee=T[8],F=T[9],le=T[11],u=T[12],h=T[13],d=T[14],_=(S=jd(de=T[6],X=T[10]))*jl,S&&(W=k*(x=Math.cos(-S))+ee*(A=Math.sin(-S)),ne=B*x+F*A,q=de*x+X*A,ee=k*-A+ee*x,F=B*-A+F*x,X=de*-A+X*x,le=ue*-A+le*x,k=W,B=ne,de=q),g=(S=jd(-H,X))*jl,S&&(x=Math.cos(-S),le=R*(A=Math.sin(-S))+le*x,O=W=O*x-ee*A,U=ne=U*x-F*A,H=q=H*x-X*A),m=(S=jd(U,O))*jl,S&&(W=O*(x=Math.cos(S))+U*(A=Math.sin(S)),ne=k*x+B*A,U=U*x-O*A,B=B*x-k*A,O=W,k=ne),_&&Math.abs(_)+Math.abs(m)>359.9&&(_=m=0,g=180-g),f=Xn(Math.sqrt(O*O+U*U+H*H)),p=Xn(Math.sqrt(B*B+de*de)),S=jd(k,B),y=Math.abs(S)>2e-4?S*jl:0,w=le?1/(le<0?-le:le):0),r.svg&&(W=e.getAttribute("transform"),r.forceCSS=e.setAttribute("transform","")||!Tj(Oo(e,Rn)),W&&e.setAttribute("transform",W))),Math.abs(y)>90&&Math.abs(y)<270&&(s?(f*=-1,y+=m<=0?180:-180,m+=m<=0?180:-180):(p*=-1,y+=y<=0?180:-180)),t=t||r.uncache,r.x=u-((r.xPercent=u&&(!t&&r.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*r.xPercent/100:0)+o,r.y=h-((r.yPercent=h&&(!t&&r.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*r.yPercent/100:0)+o,r.z=d+o,r.scaleX=Xn(f),r.scaleY=Xn(p),r.rotation=Xn(m)+a,r.rotationX=Xn(_)+a,r.rotationY=Xn(g)+a,r.skewX=y+a,r.skewY=v+a,r.transformPerspective=w+o,(r.zOrigin=parseFloat(l.split(" ")[2])||0)&&(i[Ys]=Hw(l)),r.xOffset=r.yOffset=0,r.force3D=ts.force3D,r.renderTransform=r.svg?Vme:gj?Aj:kme,r.uncache=0,r},Hw=function(e){return(e=e.split(" "))[0]+" "+e[1]},rD=function(e,t,r){var i=ti(t);return Xn(parseFloat(t)+parseFloat(Cc(e,"x",r+"px",i)))+i},kme=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Aj(e,t)},Wl="0deg",Wg="0px",$l=") ",Aj=function(e,t){var r=t||this,i=r.xPercent,s=r.yPercent,o=r.x,a=r.y,c=r.z,l=r.rotation,u=r.rotationY,h=r.rotationX,d=r.skewX,f=r.skewY,p=r.scaleX,m=r.scaleY,_=r.transformPerspective,g=r.force3D,y=r.target,v=r.zOrigin,w="",E="auto"===g&&e&&1!==e||!0===g;if(v&&(h!==Wl||u!==Wl)){var x,b=parseFloat(u)*Gd,T=Math.sin(b),S=Math.cos(b);b=parseFloat(h)*Gd,x=Math.cos(b),o=rD(y,o,T*x*-v),a=rD(y,a,-Math.sin(b)*-v),c=rD(y,c,S*x*-v+v)}_!==Wg&&(w+="perspective("+_+$l),(i||s)&&(w+="translate("+i+"%, "+s+"%) "),(E||o!==Wg||a!==Wg||c!==Wg)&&(w+=c!==Wg||E?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+$l),l!==Wl&&(w+="rotate("+l+$l),u!==Wl&&(w+="rotateY("+u+$l),h!==Wl&&(w+="rotateX("+h+$l),(d!==Wl||f!==Wl)&&(w+="skew("+d+", "+f+$l),(1!==p||1!==m)&&(w+="scale("+p+", "+m+$l),y.style[Rn]=w||"translate(0, 0)"},Vme=function(e,t){var E,b,T,S,x,r=t||this,i=r.xPercent,s=r.yPercent,o=r.x,a=r.y,c=r.rotation,l=r.skewX,u=r.skewY,h=r.scaleX,d=r.scaleY,f=r.target,p=r.xOrigin,m=r.yOrigin,_=r.xOffset,g=r.yOffset,y=r.forceCSS,v=parseFloat(o),w=parseFloat(a);c=parseFloat(c),l=parseFloat(l),(u=parseFloat(u))&&(l+=u=parseFloat(u),c+=u),c||l?(c*=Gd,l*=Gd,E=Math.cos(c)*h,b=Math.sin(c)*h,T=Math.sin(c-l)*-d,S=Math.cos(c-l)*d,l&&(u*=Gd,x=Math.tan(l-u),T*=x=Math.sqrt(1+x*x),S*=x,u&&(x=Math.tan(u),E*=x=Math.sqrt(1+x*x),b*=x)),E=Xn(E),b=Xn(b),T=Xn(T),S=Xn(S)):(E=h,S=d,b=T=0),(v&&!~(o+"").indexOf("px")||w&&!~(a+"").indexOf("px"))&&(v=Cc(f,"x",o,"px"),w=Cc(f,"y",a,"px")),(p||m||_||g)&&(v=Xn(v+p-(p*E+m*T)+_),w=Xn(w+m-(p*b+m*S)+g)),(i||s)&&(x=f.getBBox(),v=Xn(v+i/100*x.width),w=Xn(w+s/100*x.height)),f.setAttribute("transform",x="matrix("+E+","+b+","+T+","+S+","+v+","+w+")"),y&&(f.style[Rn]=x)},Ume=function(e,t,r,i,s){var h,d,o=360,a=Tr(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?jl:1)-i,u=i+l+"deg";return a&&("short"===(h=s.split("_")[1])&&(l%=o)!=l%180&&(l+=l<0?o:-o),"cw"===h&&l<0?l=(l+o*hj)%o-~~(l/o)*o:"ccw"===h&&l>0&&(l=(l-o*hj)%o-~~(l/o)*o)),e._pt=d=new Oi(e._pt,t,r,i,l,xme),d.e=u,d.u="deg",e._props.push(r),d},Cj=function(e,t){for(var r in t)e[r]=t[r];return e},Bme=function(e,t,r){var a,c,l,u,h,d,p,i=Cj({},r._gsap),o=r.style;for(c in i.svg?(l=r.getAttribute("transform"),r.setAttribute("transform",""),o[Rn]=t,a=jg(r,1),Hg(r,Rn),r.setAttribute("transform",l)):(l=getComputedStyle(r)[Rn],o[Rn]=t,a=jg(r,1),o[Rn]=l),pa)(l=i[c])!==(u=a[c])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(c)<0&&(h=ti(l)!==(p=ti(u))?Cc(r,c,l,p):parseFloat(l),d=parseFloat(u),e._pt=new Oi(e._pt,a,c,h,d-h,Q1),e._pt.u=p||0,e._props.push(c));Cj(a,i)};Ni("padding,margin,Width,Radius",function(n,e){var t="Top",r="Right",i="Bottom",s="Left",o=(e<3?[t,r,i,s]:[t+s,t+r,i+r,i+s]).map(function(a){return e<2?n+a:"border"+a+n});zw[e>1?"border"+n:n]=function(a,c,l,u,h){var d,f;if(arguments.length<4)return d=o.map(function(p){return ma(a,p,l)}),5===(f=d.join(" ")).split(d[0]).length?d[0]:f;d=(u+"").split(" "),f={},o.forEach(function(p,m){return f[p]=d[m]=d[m]||d[(m-1)/2|0]}),a.init(c,f,h)}});var Mj={name:"css",register:J1,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,r,i,s){var l,u,h,d,f,p,m,_,g,y,v,w,E,b,T,S,o=this._props,a=e.style,c=r.vars.startAt;for(m in X1||J1(),this.styles=this.styles||mj(e),S=this.styles.props,this.tween=r,t)if("autoRound"!==m&&(u=t[m],!rs[m]||!ej(m,t,r,i,e,s)))if(p=zw[m],"function"==(f=typeof u)&&(f=typeof(u=u.call(r,i,e,s))),"string"===f&&~u.indexOf("random(")&&(u=Fg(u)),p)p(this,e,m,u,r)&&(T=1);else if("--"===m.substr(0,2))l=(getComputedStyle(e).getPropertyValue(m)+"").trim(),u+="",bc.lastIndex=0,bc.test(l)||(_=ti(l),g=ti(u)),g?_!==g&&(l=Cc(e,m,l,g)+g):_&&(u+=_),this.add(a,"setProperty",l,u,i,s,0,0,m),o.push(m),S.push(m,0,a[m]);else if("undefined"!==f){if(c&&m in c?(l="function"==typeof c[m]?c[m].call(r,i,e,s):c[m],Tr(l)&&~l.indexOf("random(")&&(l=Fg(l)),ti(l+"")||(l+=ts.units[m]||ti(ma(e,m))||""),"="===(l+"").charAt(1)&&(l=ma(e,m))):l=ma(e,m),d=parseFloat(l),(y="string"===f&&"="===u.charAt(1)&&u.substr(0,2))&&(u=u.substr(2)),h=parseFloat(u),m in Lo&&("autoAlpha"===m&&(1===d&&"hidden"===ma(e,"visibility")&&h&&(d=0),S.push("visibility",0,a.visibility),Ac(this,a,"visibility",d?"inherit":"hidden",h?"inherit":"hidden",!h)),"scale"!==m&&"transform"!==m&&~(m=Lo[m]).indexOf(",")&&(m=m.split(",")[0])),v=m in pa)if(this.styles.save(m),w||((E=e._gsap).renderTransform&&!t.parseTransform||jg(e,t.parseTransform),b=!1!==t.smoothOrigin&&E.smooth,(w=this._pt=new Oi(this._pt,a,Rn,0,1,E.renderTransform,E,0,-1)).dep=1),"scale"===m)this._pt=new Oi(this._pt,E,"scaleY",E.scaleY,(y?kd(E.scaleY,y+h):h)-E.scaleY||0,Q1),this._pt.u=0,o.push("scaleY",m),m+="X";else{if("transformOrigin"===m){S.push(Ys,0,a[Ys]),u=Ome(u),E.svg?nD(e,u,0,b,0,this):((g=parseFloat(u.split(" ")[2])||0)!==E.zOrigin&&Ac(this,E,"zOrigin",E.zOrigin,g),Ac(this,a,m,Hw(l),Hw(u)));continue}if("svgOrigin"===m){nD(e,u,1,b,0,this);continue}if(m in bj){Ume(this,E,m,d,y?kd(d,y+u):u);continue}if("smoothOrigin"===m){Ac(this,E,"smooth",E.smooth,u);continue}if("force3D"===m){E[m]=u;continue}if("transform"===m){Bme(this,u,e);continue}}else m in a||(m=Wd(m)||m);if(v||(h||0===h)&&(d||0===d)&&!Eme.test(u)&&m in a)h||(h=0),(_=(l+"").substr((d+"").length))!==(g=ti(u)||(m in ts.units?ts.units[m]:_))&&(d=Cc(e,m,l,g)),this._pt=new Oi(this._pt,v?E:a,m,d,(y?kd(d,y+h):h)-d,v||"px"!==g&&"zIndex"!==m||!1===t.autoRound?Q1:Tme),this._pt.u=g||0,_!==g&&"%"!==g&&(this._pt.b=l,this._pt.r=bme);else if(m in a)Lme.call(this,e,m,l,y?y+u:u);else if(m in e)this.add(e,m,l||e[m],y?y+u:u,i,s);else if("parseTransform"!==m){S1(m,u);continue}v||(m in a?S.push(m,0,a[m]):S.push(m,1,l||e[m])),o.push(m)}T&&oj(this)},render:function(e,t){if(t.tween._time||!Y1())for(var r=t._pt;r;)r.r(e,r.d),r=r._next;else t.styles.revert()},get:ma,aliases:Lo,getSetter:function(e,t,r){var i=Lo[t];return i&&i.indexOf(",")<0&&(t=i),t in pa&&t!==Ys&&(e._gsap.x||ma(e,"x"))?r&&uj===r?"scale"===t?Mme:Cme:(uj=r||{})&&("scale"===t?Ime:Dme):e.style&&!v1(e.style[t])?Sme:~t.indexOf("-")?Ame:G1(e,t)},core:{_removeProperty:Hg,_getMatrix:tD}};Fi.utils.checkPrefix=Wd,Fi.core.getStyleSaver=mj,function(n,e,t,r){var i=Ni(n+","+e+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(s){pa[s]=1});Ni(e,function(s){ts.units[s]="deg",bj[s]=1}),Lo[i[13]]=n+","+e,Ni("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(s){var o=s.split(":");Lo[o[1]]=i[o[0]]})}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),Ni("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){ts.units[n]="px"}),Fi.registerPlugin(Mj);var $d=Fi.registerPlugin(Mj)||Fi;const Dj=1,Rj=2,_a=3,Gw=0,cge=1,lge=2,va=0,Uj=1,Bj=2,zj=3,oD=4,Hj=5,Dc=301,ql=302,$g=306,ss=1e3,ni=1001,Yn=1003,Sn=1006,wa=1008,Rc=1009,Pc=1014,Ea=1015,Yg=1016,Xl=1020,Ms=1023,Yl=1026,Yd=1027,Kg=2300,Kd=2301,Kl=3001,an="srgb",Sr="srgb-linear",_D="display-p3",Yw="display-p3-linear",Kw="linear",wn="srgb",Qw="rec709",Zw="p3",bW="300 es",xa=2e3;class Zl{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const s=i.indexOf(t);-1!==s&&i.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const r=this._listeners[e.type];if(void 0!==r){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const ri=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const Jl=Math.PI/180,Jd=180/Math.PI;function os(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ri[255&n]+ri[n>>8&255]+ri[n>>16&255]+ri[n>>24&255]+"-"+ri[255&e]+ri[e>>8&255]+"-"+ri[e>>16&15|64]+ri[e>>24&255]+"-"+ri[63&t|128]+ri[t>>8&255]+"-"+ri[t>>16&255]+ri[t>>24&255]+ri[255&r]+ri[r>>8&255]+ri[r>>16&255]+ri[r>>24&255]).toLowerCase()}function Un(n,e,t){return Math.max(e,Math.min(t,n))}function wD(n,e){return(n%e+e)%e}function Qg(n,e,t){return(1-t)*n+t*e}function ED(n){return 0==(n&n-1)&&0!==n}function SW(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function tE(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ki(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function wt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const ef_DEG2RAD=Jl,ef_degToRad=function Wge(n){return n*Jl},ef_radToDeg=function $ge(n){return n*Jd};class Z{constructor(e=0,t=0){Z.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Un(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class St{constructor(e,t,r,i,s,o,a,c,l){St.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,s,o,a,c,l)}set(e,t,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],_=i[3],g=i[6],y=i[1],v=i[4],w=i[7],E=i[2],b=i[5],T=i[8];return s[0]=o*m+a*y+c*E,s[3]=o*_+a*v+c*b,s[6]=o*g+a*w+c*T,s[1]=l*m+u*y+h*E,s[4]=l*_+u*v+h*b,s[7]=l*g+u*w+h*T,s[2]=d*m+f*y+p*E,s[5]=d*_+f*v+p*b,s[8]=d*g+f*w+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=t*h+r*d+i*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*t-i*c)*m,e[5]=(i*s-a*t)*m,e[6]=f*m,e[7]=(r*c-l*t)*m,e[8]=(o*t-r*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(xD.makeScale(e,t)),this}rotate(e){return this.premultiply(xD.makeRotation(-e)),this}translate(e,t){return this.premultiply(xD.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const xD=new St;function AW(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const Xge={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function tf(n,e){return new Xge[n](e)}function Zg(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Yge(){const n=Zg("canvas");return n.style.display="block",n}const CW={};function Jg(n){n in CW||(CW[n]=!0,console.warn(n))}const MW=(new St).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),IW=(new St).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),nE={[Sr]:{transfer:Kw,primaries:Qw,toReference:n=>n,fromReference:n=>n},[an]:{transfer:wn,primaries:Qw,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Yw]:{transfer:Kw,primaries:Zw,toReference:n=>n.applyMatrix3(IW),fromReference:n=>n.applyMatrix3(MW)},[_D]:{transfer:wn,primaries:Zw,toReference:n=>n.convertSRGBToLinear().applyMatrix3(IW),fromReference:n=>n.applyMatrix3(MW).convertLinearToSRGB()}},Kge=new Set([Sr,Yw]),$t={enabled:!0,_workingColorSpace:Sr,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!Kge.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){return!1!==this.enabled&&e!==t&&e&&t?(0,nE[t].fromReference)((0,nE[e].toReference)(n)):n},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return nE[n].primaries},getTransfer:function(n){return""===n?Kw:nE[n].transfer}};function nf(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function bD(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}let rf;class DW{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===rf&&(rf=Zg("canvas")),rf.width=e.width,rf.height=e.height;const r=rf.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=rf}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Zg("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=255*nf(s[o]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t[r]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*nf(t[r]/255)):nf(t[r]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Qge=0;class sf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Qge++}),this.uuid=os(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)s.push(TD(i[o].isDataTexture?i[o].image:i[o]))}else s=TD(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function TD(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?DW.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Zge=0,Ds=(()=>{class n extends Zl{constructor(t=n.DEFAULT_IMAGE,r=n.DEFAULT_MAPPING,i=ni,s=ni,o=Sn,a=wa,c=Ms,l=Rc,u=n.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Zge++}),this.uuid=os(),this.name="",this.source=new sf(t),this.mipmaps=[],this.mapping=r,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=l,this.offset=new Z(0,0),this.repeat=new Z(1,1),this.center=new Z(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new St,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof h?this.colorSpace=h:(Jg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===Kl?an:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),r||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ss:t.x=t.x-Math.floor(t.x);break;case ni:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ss:t.y=t.y-Math.floor(t.y);break;case ni:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Jg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===an?Kl:3e3}set encoding(t){Jg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Kl?an:""}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class en{constructor(e=0,t=0,r=0,i=1){en.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],f=c[5],p=c[9],m=c[2],_=c[6],g=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-m)<.01&&Math.abs(p-_)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+m)<.1&&Math.abs(p+_)<.1&&Math.abs(l+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(l+1)/2,w=(f+1)/2,E=(g+1)/2,b=(u+d)/4,T=(h+m)/4,S=(p+_)/4;return v>w&&v>E?v<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(v),i=b/r,s=T/r):w>E?w<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(w),r=b/i,s=S/i):E<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(E),r=T/s,i=S/s),this.set(r,i,s,t),this}let y=Math.sqrt((_-p)*(_-p)+(h-m)*(h-m)+(d-u)*(d-u));return Math.abs(y)<.001&&(y=1),this.x=(_-p)/y,this.y=(h-m)/y,this.z=(d-u)/y,this.w=Math.acos((l+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Jge extends Zl{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new en(0,0,e,t),this.scissorTest=!1,this.viewport=new en(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==r.encoding&&(Jg("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===Kl?an:""),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Sn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new Ds(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new sf(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class eu extends Jge{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class SD extends Ds{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Yn,this.minFilter=Yn,this.wrapR=ni,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class RW extends Ds{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Yn,this.minFilter=Yn,this.wrapR=ni,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Fr{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const d=s[o+0],f=s[o+1],p=s[o+2],m=s[o+3];if(0===a)return e[t+0]=c,e[t+1]=l,e[t+2]=u,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=f,e[t+2]=p,void(e[t+3]=m);if(h!==m||c!==d||l!==f||u!==p){let _=1-a;const g=c*d+l*f+u*p+h*m,y=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){const E=Math.sqrt(v),b=Math.atan2(E,g*y);_=Math.sin(_*b)/E,a=Math.sin(a*b)/E}const w=a*y;if(c=c*_+d*w,l=l*_+f*w,u=u*_+p*w,h=h*_+m*w,_===1-a){const E=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=E,l*=E,u*=E,h*=E}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],d=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*h+c*f-l*d,e[t+1]=c*p+u*d+l*h-a*f,e[t+2]=l*p+u*f+a*d-c*h,e[t+3]=u*p-a*h-c*d-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),d=c(r/2),f=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=d*u*h+l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h+d*f*p;break;case"YZX":this._x=d*u*h+l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h-d*f*p;break;case"XZY":this._x=d*u*h-l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],h=t[10],d=r+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(o-i)*f}else if(r>a&&r>h){const f=2*Math.sqrt(1+r-a-h);this._w=(u-c)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(s+l)/f}else if(a>h){const f=2*Math.sqrt(1+a-r-h);this._w=(s-l)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+h-r-a);this._w=(o-i)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Un(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*r+t*this._x,this._y=f*i+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=o*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(s),r*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class M{constructor(e=0,t=0,r=0){M.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(PW.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(PW.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=c*t+o*i-a*r,u=c*r+a*t-s*i,h=c*i+s*r-o*t,d=-s*t-o*r-a*i;return this.x=l*c+d*-s+u*-a-h*-o,this.y=u*c+d*-o+h*-s-l*-a,this.z=h*c+d*-a+l*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return AD.copy(this).projectOnVector(e),this.sub(AD)}reflect(e){return this.sub(AD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Un(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const AD=new M,PW=new Fr;class ko{constructor(e=new M(1/0,1/0,1/0),t=new M(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Ta.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Ta.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Ta.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),af.copy(e.boundingBox),af.applyMatrix4(e.matrixWorld),this.union(af);else{const i=e.geometry;if(void 0!==i)if(t&&void 0!==i.attributes&&void 0!==i.attributes.position){const s=i.attributes.position;for(let o=0,a=s.count;o<a;o++)Ta.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Ta)}else null===i.boundingBox&&i.computeBoundingBox(),af.copy(i.boundingBox),af.applyMatrix4(e.matrixWorld),this.union(af)}const r=e.children;for(let i=0,s=r.length;i<s;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ta),Ta.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(e_),rE.subVectors(this.max,e_),cf.subVectors(e.a,e_),lf.subVectors(e.b,e_),uf.subVectors(e.c,e_),Nc.subVectors(lf,cf),Lc.subVectors(uf,lf),tu.subVectors(cf,uf);let t=[0,-Nc.z,Nc.y,0,-Lc.z,Lc.y,0,-tu.z,tu.y,Nc.z,0,-Nc.x,Lc.z,0,-Lc.x,tu.z,0,-tu.x,-Nc.y,Nc.x,0,-Lc.y,Lc.x,0,-tu.y,tu.x,0];return!(!CD(t,cf,lf,uf,rE)||(t=[1,0,0,0,1,0,0,0,1],!CD(t,cf,lf,uf,rE)))&&(iE.crossVectors(Nc,Lc),t=[iE.x,iE.y,iE.z],CD(t,cf,lf,uf,rE))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ta).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Ta).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ba[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ba[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ba[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ba[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ba[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ba[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ba[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ba[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ba)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ba=[new M,new M,new M,new M,new M,new M,new M,new M],Ta=new M,af=new ko,cf=new M,lf=new M,uf=new M,Nc=new M,Lc=new M,tu=new M,e_=new M,rE=new M,iE=new M,nu=new M;function CD(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){nu.fromArray(n,s);const a=i.x*Math.abs(nu.x)+i.y*Math.abs(nu.y)+i.z*Math.abs(nu.z),c=e.dot(nu),l=t.dot(nu),u=r.dot(nu);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const e_e=new ko,t_=new M,MD=new M;class Ks{constructor(e=new M,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):e_e.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;t_.subVectors(e,this.center);const t=t_.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=.5*(r-this.radius);this.center.addScaledVector(t_,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(MD.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(t_.copy(e.center).add(MD)),this.expandByPoint(t_.copy(e.center).sub(MD))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Sa=new M,ID=new M,sE=new M,Oc=new M,DD=new M,oE=new M,RD=new M;class hf{constructor(e=new M,t=new M(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Sa)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Sa.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Sa.copy(this.origin).addScaledVector(this.direction,t),Sa.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){ID.copy(e).add(t).multiplyScalar(.5),sE.copy(t).sub(e).normalize(),Oc.copy(this.origin).sub(ID);const s=.5*e.distanceTo(t),o=-this.direction.dot(sE),a=Oc.dot(this.direction),c=-Oc.dot(sE),l=Oc.lengthSq(),u=Math.abs(1-o*o);let h,d,f,p;if(u>0)if(h=o*c-a,d=o*a-c,p=s*u,h>=0)if(d>=-p)if(d<=p){const m=1/u;h*=m,d*=m,f=h*(h+o*d+2*a)+d*(o*h+d+2*c)+l}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*c)+l;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*c)+l;else d<=-p?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-c),s),f=-h*h+d*(d+2*c)+l):d<=p?(h=0,d=Math.min(Math.max(-s,-c),s),f=d*(d+2*c)+l):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-c),s),f=-h*h+d*(d+2*c)+l);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(ID).addScaledVector(sE,d),f}intersectSphere(e,t){Sa.subVectors(e.center,this.origin);const r=Sa.dot(this.direction),i=Sa.dot(Sa)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:this.at(a<0?c:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(r=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),r>c||a>i)||((a>r||r!=r)&&(r=a),(c<i||i!=i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Sa)}intersectTriangle(e,t,r,i,s){DD.subVectors(t,e),oE.subVectors(r,e),RD.crossVectors(DD,oE);let a,o=this.direction.dot(RD);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Oc.subVectors(this.origin,e);const c=a*this.direction.dot(oE.crossVectors(Oc,oE));if(c<0)return null;const l=a*this.direction.dot(DD.cross(Oc));if(l<0||c+l>o)return null;const u=-a*Oc.dot(RD);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class tt{constructor(e,t,r,i,s,o,a,c,l,u,h,d,f,p,m,_){tt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,s,o,a,c,l,u,h,d,f,p,m,_)}set(e,t,r,i,s,o,a,c,l,u,h,d,f,p,m,_){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=s,g[5]=o,g[9]=a,g[13]=c,g[2]=l,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=m,g[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new tt).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/df.setFromMatrixColumn(e,0).length(),s=1/df.setFromMatrixColumn(e,1).length(),o=1/df.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const d=o*u,f=o*h,p=a*u,m=a*h;t[0]=c*u,t[4]=-c*h,t[8]=l,t[1]=f+p*l,t[5]=d-m*l,t[9]=-a*c,t[2]=m-d*l,t[6]=p+f*l,t[10]=o*c}else if("YXZ"===e.order){const d=c*u,f=c*h,p=l*u,m=l*h;t[0]=d+m*a,t[4]=p*a-f,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=m+d*a,t[10]=o*c}else if("ZXY"===e.order){const d=c*u,f=c*h,p=l*u,m=l*h;t[0]=d-m*a,t[4]=-o*h,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=m-d*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if("ZYX"===e.order){const d=o*u,f=o*h,p=a*u,m=a*h;t[0]=c*u,t[4]=p*l-f,t[8]=d*l+m,t[1]=c*h,t[5]=m*l+d,t[9]=f*l-p,t[2]=-l,t[6]=a*c,t[10]=o*c}else if("YZX"===e.order){const d=o*c,f=o*l,p=a*c,m=a*l;t[0]=c*u,t[4]=m-d*h,t[8]=p*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=f*h+p,t[10]=d-m*h}else if("XZY"===e.order){const d=o*c,f=o*l,p=a*c,m=a*l;t[0]=c*u,t[4]=-h,t[8]=l*u,t[1]=d*h+m,t[5]=o*u,t[9]=f*h-p,t[2]=p*h-f,t[6]=a*u,t[10]=m*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(t_e,e,n_e)}lookAt(e,t,r){const i=this.elements;return as.subVectors(e,t),0===as.lengthSq()&&(as.z=1),as.normalize(),Fc.crossVectors(r,as),0===Fc.lengthSq()&&(1===Math.abs(r.z)?as.x+=1e-4:as.z+=1e-4,as.normalize(),Fc.crossVectors(r,as)),Fc.normalize(),aE.crossVectors(as,Fc),i[0]=Fc.x,i[4]=aE.x,i[8]=as.x,i[1]=Fc.y,i[5]=aE.y,i[9]=as.y,i[2]=Fc.z,i[6]=aE.z,i[10]=as.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],d=r[9],f=r[13],p=r[2],m=r[6],_=r[10],g=r[14],y=r[3],v=r[7],w=r[11],E=r[15],b=i[0],T=i[4],S=i[8],x=i[12],A=i[1],O=i[5],U=i[9],H=i[13],R=i[2],k=i[6],B=i[10],W=i[14],ne=i[3],q=i[7],ee=i[11],F=i[15];return s[0]=o*b+a*A+c*R+l*ne,s[4]=o*T+a*O+c*k+l*q,s[8]=o*S+a*U+c*B+l*ee,s[12]=o*x+a*H+c*W+l*F,s[1]=u*b+h*A+d*R+f*ne,s[5]=u*T+h*O+d*k+f*q,s[9]=u*S+h*U+d*B+f*ee,s[13]=u*x+h*H+d*W+f*F,s[2]=p*b+m*A+_*R+g*ne,s[6]=p*T+m*O+_*k+g*q,s[10]=p*S+m*U+_*B+g*ee,s[14]=p*x+m*H+_*W+g*F,s[3]=y*b+v*A+w*R+E*ne,s[7]=y*T+v*O+w*k+E*q,s[11]=y*S+v*U+w*B+E*ee,s[15]=y*x+v*H+w*W+E*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],f=e[14];return e[3]*(+s*c*h-i*l*h-s*a*d+r*l*d+i*a*f-r*c*f)+e[7]*(+t*c*f-t*l*d+s*o*d-i*o*f+i*l*u-s*c*u)+e[11]*(+t*l*h-t*a*f-s*o*h+r*o*f+s*a*u-r*l*u)+e[15]*(-i*a*u-t*c*h+t*a*d+i*o*h-r*o*d+r*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],_=e[14],g=e[15],y=h*_*l-m*d*l+m*c*f-a*_*f-h*c*g+a*d*g,v=p*d*l-u*_*l-p*c*f+o*_*f+u*c*g-o*d*g,w=u*m*l-p*h*l+p*a*f-o*m*f-u*a*g+o*h*g,E=p*h*c-u*m*c-p*a*d+o*m*d+u*a*_-o*h*_,b=t*y+r*v+i*w+s*E;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/b;return e[0]=y*T,e[1]=(m*d*s-h*_*s-m*i*f+r*_*f+h*i*g-r*d*g)*T,e[2]=(a*_*s-m*c*s+m*i*l-r*_*l-a*i*g+r*c*g)*T,e[3]=(h*c*s-a*d*s-h*i*l+r*d*l+a*i*f-r*c*f)*T,e[4]=v*T,e[5]=(u*_*s-p*d*s+p*i*f-t*_*f-u*i*g+t*d*g)*T,e[6]=(p*c*s-o*_*s-p*i*l+t*_*l+o*i*g-t*c*g)*T,e[7]=(o*d*s-u*c*s+u*i*l-t*d*l-o*i*f+t*c*f)*T,e[8]=w*T,e[9]=(p*h*s-u*m*s-p*r*f+t*m*f+u*r*g-t*h*g)*T,e[10]=(o*m*s-p*a*s+p*r*l-t*m*l-o*r*g+t*a*g)*T,e[11]=(u*a*s-o*h*s-u*r*l+t*h*l+o*r*f-t*a*f)*T,e[12]=E*T,e[13]=(u*m*i-p*h*i+p*r*d-t*m*d-u*r*_+t*h*_)*T,e[14]=(p*a*i-o*m*i-p*r*c+t*m*c+o*r*_-t*a*_)*T,e[15]=(o*h*i-u*a*i+u*r*c-t*h*c-o*r*d+t*a*d)*T,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,h=a+a,d=s*l,f=s*u,p=s*h,m=o*u,_=o*h,g=a*h,y=c*l,v=c*u,w=c*h,E=r.x,b=r.y,T=r.z;return i[0]=(1-(m+g))*E,i[1]=(f+w)*E,i[2]=(p-v)*E,i[3]=0,i[4]=(f-w)*b,i[5]=(1-(d+g))*b,i[6]=(_+y)*b,i[7]=0,i[8]=(p+v)*T,i[9]=(_-y)*T,i[10]=(1-(d+m))*T,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=df.set(i[0],i[1],i[2]).length();const o=df.set(i[4],i[5],i[6]).length(),a=df.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Qs.copy(this);const l=1/s,u=1/o,h=1/a;return Qs.elements[0]*=l,Qs.elements[1]*=l,Qs.elements[2]*=l,Qs.elements[4]*=u,Qs.elements[5]*=u,Qs.elements[6]*=u,Qs.elements[8]*=h,Qs.elements[9]*=h,Qs.elements[10]*=h,t.setFromRotationMatrix(Qs),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=xa){const c=this.elements,l=2*s/(t-e),u=2*s/(r-i),h=(t+e)/(t-e),d=(r+i)/(r-i);let f,p;if(a===xa)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-o/(o-s),p=-o*s/(o-s)}return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=xa){const c=this.elements,l=1/(t-e),u=1/(r-i),h=1/(o-s),d=(t+e)*l,f=(r+i)*u;let p,m;if(a===xa)p=(o+s)*h,m=-2*h;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=s*h,m=-1*h}return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=m,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const df=new M,Qs=new tt,t_e=new M(0,0,0),n_e=new M(1,1,1),Fc=new M,aE=new M,as=new M,NW=new tt,LW=new Fr;let r_e=(()=>{class n{constructor(t=0,r=0,i=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=r,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,r,i,s=this._order){return this._x=t,this._y=r,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,r=this._order,i=!0){const s=t.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],h=s[9],d=s[2],f=s[6],p=s[10];switch(r){case"XYZ":this._y=Math.asin(Un(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Un(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(Un(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-Un(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Un(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(c,p));break;case"XZY":this._z=Math.asin(-Un(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,r,i){return NW.makeRotationFromQuaternion(t),this.setFromRotationMatrix(NW,r,i)}setFromVector3(t,r=this._order){return this.set(t.x,t.y,t.z,r)}reorder(t){return LW.setFromEuler(this),this.setFromQuaternion(LW,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],r=0){return t[r]=this._x,t[r+1]=this._y,t[r+2]=this._z,t[r+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class PD{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let i_e=0;const OW=new M,ff=new Fr,Aa=new tt,cE=new M,n_=new M,s_e=new M,o_e=new Fr,FW=new M(1,0,0),kW=new M(0,1,0),VW=new M(0,0,1),a_e={type:"added"},c_e={type:"removed"};let Kn=(()=>{class n extends Zl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:i_e++}),this.uuid=os(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new M,r=new r_e,i=new Fr,s=new M(1,1,1);r._onChange(function o(){i.setFromEuler(r,!1)}),i._onChange(function a(){r.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new tt},normalMatrix:{value:new St}}),this.matrix=new tt,this.matrixWorld=new tt,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new PD,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,r){this.quaternion.setFromAxisAngle(t,r)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,r){return ff.setFromAxisAngle(t,r),this.quaternion.multiply(ff),this}rotateOnWorldAxis(t,r){return ff.setFromAxisAngle(t,r),this.quaternion.premultiply(ff),this}rotateX(t){return this.rotateOnAxis(FW,t)}rotateY(t){return this.rotateOnAxis(kW,t)}rotateZ(t){return this.rotateOnAxis(VW,t)}translateOnAxis(t,r){return OW.copy(t).applyQuaternion(this.quaternion),this.position.add(OW.multiplyScalar(r)),this}translateX(t){return this.translateOnAxis(FW,t)}translateY(t){return this.translateOnAxis(kW,t)}translateZ(t){return this.translateOnAxis(VW,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Aa.copy(this.matrixWorld).invert())}lookAt(t,r,i){t.isVector3?cE.copy(t):cE.set(t,r,i);const s=this.parent;this.updateWorldMatrix(!0,!1),n_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Aa.lookAt(n_,cE,this.up):Aa.lookAt(cE,n_,this.up),this.quaternion.setFromRotationMatrix(Aa),s&&(Aa.extractRotation(s.matrixWorld),ff.setFromRotationMatrix(Aa),this.quaternion.premultiply(ff.invert()))}add(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(a_e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(c_e)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Aa.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Aa.multiply(t.parent.matrixWorld)),t.applyMatrix4(Aa),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,r){if(this[t]===r)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,r);if(void 0!==a)return a}}getObjectsByProperty(t,r){let i=[];this[t]===r&&i.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,r);a.length>0&&(i=i.concat(a))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(n_,t,s_e),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(n_,o_e,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return t.set(r[8],r[9],r[10]).normalize()}raycast(){}traverse(t){t(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].traverseVisible(t)}traverseAncestors(t){const r=this.parent;null!==r&&(t(r),r.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const r=this.children;for(let i=0,s=r.length;i<s;i++){const o=r[i];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,r){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===r){const s=this.children;for(let o=0,a=s.length;o<a;o++){const c=s[o];!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!1,!0)}}}toJSON(t){const r=void 0===t||"string"==typeof t,i={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(t)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let u=0,h=l.length;u<h;u++)o(t.shapes,l[u]);else o(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,u=this.material.length;l<u;l++)c.push(o(t.materials,this.material[l]));s.material=c}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++)s.animations.push(o(t.animations,this.animations[c]))}if(r){const c=a(t.geometries),l=a(t.materials),u=a(t.textures),h=a(t.images),d=a(t.shapes),f=a(t.skeletons),p=a(t.animations),m=a(t.nodes);c.length>0&&(i.geometries=c),l.length>0&&(i.materials=l),u.length>0&&(i.textures=u),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(c){const l=[];for(const u in c){const h=c[u];delete h.metadata,l.push(h)}return l}}clone(t){return(new this.constructor).copy(this,t)}copy(t,r=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===r)for(let i=0;i<t.children.length;i++)this.add(t.children[i].clone());return this}}return n.DEFAULT_UP=new M(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const Zs=new M,Ca=new M,ND=new M,Ma=new M,pf=new M,mf=new M,UW=new M,LD=new M,OD=new M,FD=new M;let lE=!1;class cs{constructor(e=new M,t=new M,r=new M){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Zs.subVectors(e,t),i.cross(Zs);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){Zs.subVectors(i,t),Ca.subVectors(r,t),ND.subVectors(e,t);const o=Zs.dot(Zs),a=Zs.dot(Ca),c=Zs.dot(ND),l=Ca.dot(Ca),u=Ca.dot(ND),h=o*l-a*a;if(0===h)return s.set(-2,-1,-1);const d=1/h,f=(l*c-a*u)*d,p=(o*u-a*c)*d;return s.set(1-f-p,p,f)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Ma),Ma.x>=0&&Ma.y>=0&&Ma.x+Ma.y<=1}static getUV(e,t,r,i,s,o,a,c){return!1===lE&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),lE=!0),this.getInterpolation(e,t,r,i,s,o,a,c)}static getInterpolation(e,t,r,i,s,o,a,c){return this.getBarycoord(e,t,r,i,Ma),c.setScalar(0),c.addScaledVector(s,Ma.x),c.addScaledVector(o,Ma.y),c.addScaledVector(a,Ma.z),c}static isFrontFacing(e,t,r,i){return Zs.subVectors(r,t),Ca.subVectors(e,t),Zs.cross(Ca).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Zs.subVectors(this.c,this.b),Ca.subVectors(this.a,this.b),.5*Zs.cross(Ca).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,s){return!1===lE&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),lE=!0),cs.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}getInterpolation(e,t,r,i,s){return cs.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return cs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;pf.subVectors(i,r),mf.subVectors(s,r),LD.subVectors(e,r);const c=pf.dot(LD),l=mf.dot(LD);if(c<=0&&l<=0)return t.copy(r);OD.subVectors(e,i);const u=pf.dot(OD),h=mf.dot(OD);if(u>=0&&h<=u)return t.copy(i);const d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(r).addScaledVector(pf,o);FD.subVectors(e,s);const f=pf.dot(FD),p=mf.dot(FD);if(p>=0&&f<=p)return t.copy(s);const m=f*l-c*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(r).addScaledVector(mf,a);const _=u*p-f*h;if(_<=0&&h-u>=0&&f-p>=0)return UW.subVectors(s,i),a=(h-u)/(h-u+(f-p)),t.copy(i).addScaledVector(UW,a);const g=1/(_+m+d);return o=m*g,a=d*g,t.copy(r).addScaledVector(pf,o).addScaledVector(mf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let l_e=0;class Vi extends Zl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:l_e++}),this.uuid=os(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),0!==this.side&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const BW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kc={h:0,s:0,l:0},uE={h:0,s:0,l:0};function kD(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class J{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const i=e;i&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=an){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,$t.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=$t.workingColorSpace){return this.r=e,this.g=t,this.b=r,$t.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=$t.workingColorSpace){if(e=wD(e,1),t=Un(t,0,1),r=Un(r,0,1),0===t)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=kD(o,s,e+1/3),this.g=kD(o,s,e),this.b=kD(o,s,e-1/3)}return $t.toWorkingColorSpace(this,i),this}setStyle(e,t=an){function r(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[2];switch(i[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=an){const r=BW[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nf(e.r),this.g=nf(e.g),this.b=nf(e.b),this}copyLinearToSRGB(e){return this.r=bD(e.r),this.g=bD(e.g),this.b=bD(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=an){return $t.fromWorkingColorSpace(ii.copy(this),e),65536*Math.round(Un(255*ii.r,0,255))+256*Math.round(Un(255*ii.g,0,255))+Math.round(Un(255*ii.b,0,255))}getHexString(e=an){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=$t.workingColorSpace){$t.fromWorkingColorSpace(ii.copy(this),t);const r=ii.r,i=ii.g,s=ii.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=$t.workingColorSpace){return $t.fromWorkingColorSpace(ii.copy(this),t),e.r=ii.r,e.g=ii.g,e.b=ii.b,e}getStyle(e=an){$t.fromWorkingColorSpace(ii.copy(this),e);const t=ii.r,r=ii.g,i=ii.b;return e!==an?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(kc),this.setHSL(kc.h+e,kc.s+t,kc.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(kc),e.getHSL(uE);const r=Qg(kc.h,uE.h,t),i=Qg(kc.s,uE.s,t),s=Qg(kc.l,uE.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ii=new J;J.NAMES=BW;class _i extends Vi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new J(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ir=new M,hE=new Z;class En{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=Ea,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)hE.fromBufferAttribute(this,t),hE.applyMatrix3(e),this.setXY(t,hE.x,hE.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix3(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=ki(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=wt(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ki(t,this.array)),t}setX(e,t){return this.normalized&&(t=wt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ki(t,this.array)),t}setY(e,t){return this.normalized&&(t=wt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ki(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ki(t,this.array)),t}setW(e,t){return this.normalized&&(t=wt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array),i=wt(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array),i=wt(i,this.array),s=wt(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}class zW extends En{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class HW extends En{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class ze extends En{constructor(e,t,r){super(new Float32Array(e),t,r)}}let h_e=0;const Rs=new tt,VD=new Kn,gf=new M,ls=new ko,i_=new ko,Ar=new M;class Et extends Zl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:h_e++}),this.uuid=os(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(AW(e)?HW:zW)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const s=(new St).getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rs.makeRotationFromQuaternion(e),this.applyMatrix4(Rs),this}rotateX(e){return Rs.makeRotationX(e),this.applyMatrix4(Rs),this}rotateY(e){return Rs.makeRotationY(e),this.applyMatrix4(Rs),this}rotateZ(e){return Rs.makeRotationZ(e),this.applyMatrix4(Rs),this}translate(e,t,r){return Rs.makeTranslation(e,t,r),this.applyMatrix4(Rs),this}scale(e,t,r){return Rs.makeScale(e,t,r),this.applyMatrix4(Rs),this}lookAt(e){return VD.lookAt(e),VD.updateMatrix(),this.applyMatrix4(VD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gf).negate(),this.translate(gf.x,gf.y,gf.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ze(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ko);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new M(-1/0,-1/0,-1/0),new M(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++)ls.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(Ar.addVectors(this.boundingBox.min,ls.min),this.boundingBox.expandByPoint(Ar),Ar.addVectors(this.boundingBox.max,ls.max),this.boundingBox.expandByPoint(Ar)):(this.boundingBox.expandByPoint(ls.min),this.boundingBox.expandByPoint(ls.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ks);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new M,1/0);if(e){const r=this.boundingSphere.center;if(ls.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)i_.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(Ar.addVectors(ls.min,i_.min),ls.expandByPoint(Ar),Ar.addVectors(ls.max,i_.max),ls.expandByPoint(Ar)):(ls.expandByPoint(i_.min),ls.expandByPoint(i_.max));ls.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Ar.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Ar));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ar.fromBufferAttribute(a,l),c&&(gf.fromBufferAttribute(e,l),Ar.add(gf)),i=Math.max(i,r.distanceToSquared(Ar))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,i=t.position.array,s=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new En(new Float32Array(4*a),4));const c=this.getAttribute("tangent").array,l=[],u=[];for(let A=0;A<a;A++)l[A]=new M,u[A]=new M;const h=new M,d=new M,f=new M,p=new Z,m=new Z,_=new Z,g=new M,y=new M;function v(A,O,U){h.fromArray(i,3*A),d.fromArray(i,3*O),f.fromArray(i,3*U),p.fromArray(o,2*A),m.fromArray(o,2*O),_.fromArray(o,2*U),d.sub(h),f.sub(h),m.sub(p),_.sub(p);const H=1/(m.x*_.y-_.x*m.y);isFinite(H)&&(g.copy(d).multiplyScalar(_.y).addScaledVector(f,-m.y).multiplyScalar(H),y.copy(f).multiplyScalar(m.x).addScaledVector(d,-_.x).multiplyScalar(H),l[A].add(g),l[O].add(g),l[U].add(g),u[A].add(y),u[O].add(y),u[U].add(y))}let w=this.groups;0===w.length&&(w=[{start:0,count:r.length}]);for(let A=0,O=w.length;A<O;++A){const U=w[A],H=U.start;for(let k=H,B=H+U.count;k<B;k+=3)v(r[k+0],r[k+1],r[k+2])}const E=new M,b=new M,T=new M,S=new M;function x(A){T.fromArray(s,3*A),S.copy(T);const O=l[A];E.copy(O),E.sub(T.multiplyScalar(T.dot(O))).normalize(),b.crossVectors(S,O);const H=b.dot(u[A])<0?-1:1;c[4*A]=E.x,c[4*A+1]=E.y,c[4*A+2]=E.z,c[4*A+3]=H}for(let A=0,O=w.length;A<O;++A){const U=w[A],H=U.start;for(let k=H,B=H+U.count;k<B;k+=3)x(r[k+0]),x(r[k+1]),x(r[k+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new En(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const i=new M,s=new M,o=new M,a=new M,c=new M,l=new M,u=new M,h=new M;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),m=e.getX(d+1),_=e.getX(d+2);i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,m),o.fromBufferAttribute(t,_),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,m),l.fromBufferAttribute(r,_),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(m,c.x,c.y,c.z),r.setXYZ(_,l.x,l.y,l.z)}else for(let d=0,f=t.count;d<f;d+=3)i.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Ar.fromBufferAttribute(e,t),Ar.normalize(),e.setXYZ(t,Ar.x,Ar.y,Ar.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,d=new l.constructor(c.length*u);let f=0,p=0;for(let m=0,_=c.length;m<_;m++){f=a.isInterleavedBufferAttribute?c[m]*a.data.stride+a.offset:c[m]*u;for(let g=0;g<u;g++)d[p++]=l[f++]}return new En(d,u,h)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Et,r=this.index.array,i=this.attributes;for(const a in i){const l=e(i[a],r);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const f=e(l[u],r);c.push(f)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const l in c)void 0!==c[l]&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const c in r)e.data.attributes[c]=r[c].toJSON(e.data);const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++)u.push(l[h].toJSON(e.data));u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const i=e.attributes;for(const l in i)this.setAttribute(l,i[l].clone(t));const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const GW=new tt,ru=new hf,dE=new Ks,jW=new M,_f=new M,yf=new M,vf=new M,UD=new M,fE=new M,pE=new Z,mE=new Z,gE=new Z,WW=new M,$W=new M,qW=new M,_E=new M,yE=new M;class Kt extends Kn{constructor(e=new Et,t=new _i){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(r.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){fE.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c];0!==u&&(UD.fromBufferAttribute(s[c],e),fE.addScaledVector(o?UD:UD.sub(t),u))}t.add(fE)}return t}raycast(e,t){const r=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===r.boundingSphere&&r.computeBoundingSphere(),dE.copy(r.boundingSphere),dE.applyMatrix4(s),ru.copy(e.ray).recast(e.near),(!1!==dE.containsPoint(ru.origin)||!(null===ru.intersectSphere(dE,jW)||ru.origin.distanceToSquared(jW)>(e.far-e.near)**2))&&(GW.copy(s).invert(),ru.copy(e.ray).applyMatrix4(GW),(null===r.boundingBox||!1!==ru.intersectsBox(r.boundingBox))&&this._computeIntersections(e,t,ru)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(null!==a)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const _=d[p],g=o[_.materialIndex];for(let w=Math.max(_.start,f.start),E=Math.min(a.count,Math.min(_.start+_.count,f.start+f.count));w<E;w+=3)i=vE(this,g,e,r,l,u,h,a.getX(w),a.getX(w+1),a.getX(w+2)),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=_.materialIndex,t.push(i))}else for(let _=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);_<g;_+=3)i=vE(this,o,e,r,l,u,h,a.getX(_),a.getX(_+1),a.getX(_+2)),i&&(i.faceIndex=Math.floor(_/3),t.push(i));else if(void 0!==c)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const _=d[p],g=o[_.materialIndex];for(let w=Math.max(_.start,f.start),E=Math.min(c.count,Math.min(_.start+_.count,f.start+f.count));w<E;w+=3)i=vE(this,g,e,r,l,u,h,w,w+1,w+2),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=_.materialIndex,t.push(i))}else for(let _=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);_<g;_+=3)i=vE(this,o,e,r,l,u,h,_,_+1,_+2),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}function vE(n,e,t,r,i,s,o,a,c,l){n.getVertexPosition(a,_f),n.getVertexPosition(c,yf),n.getVertexPosition(l,vf);const u=function d_e(n,e,t,r,i,s,o,a){let c;if(c=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===c)return null;yE.copy(a),yE.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(yE);return l<t.near||l>t.far?null:{distance:l,point:yE.clone(),object:n}}(n,e,t,r,_f,yf,vf,_E);if(u){i&&(pE.fromBufferAttribute(i,a),mE.fromBufferAttribute(i,c),gE.fromBufferAttribute(i,l),u.uv=cs.getInterpolation(_E,_f,yf,vf,pE,mE,gE,new Z)),s&&(pE.fromBufferAttribute(s,a),mE.fromBufferAttribute(s,c),gE.fromBufferAttribute(s,l),u.uv1=cs.getInterpolation(_E,_f,yf,vf,pE,mE,gE,new Z),u.uv2=u.uv1),o&&(WW.fromBufferAttribute(o,a),$W.fromBufferAttribute(o,c),qW.fromBufferAttribute(o,l),u.normal=cs.getInterpolation(_E,_f,yf,vf,WW,$W,qW,new M),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new M,materialIndex:0};cs.getNormal(_f,yf,vf,h.normal),u.face=h}return u}class Da extends Et{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let d=0,f=0;function p(m,_,g,y,v,w,E,b,T,S,x){const A=w/T,O=E/S,U=w/2,H=E/2,R=b/2,k=T+1,B=S+1;let W=0,ne=0;const q=new M;for(let ee=0;ee<B;ee++){const F=ee*O-H;for(let X=0;X<k;X++)q[m]=(X*A-U)*y,q[_]=F*v,q[g]=R,l.push(q.x,q.y,q.z),q[m]=0,q[_]=0,q[g]=b>0?1:-1,u.push(q.x,q.y,q.z),h.push(X/T),h.push(1-ee/S),W+=1}for(let ee=0;ee<S;ee++)for(let F=0;F<T;F++){const ue=d+F+k*(ee+1),le=d+(F+1)+k*(ee+1),de=d+(F+1)+k*ee;c.push(d+F+k*ee,ue,de),c.push(ue,le,de),ne+=6}a.addGroup(f,ne,x),f+=ne,d+=W}p("z","y","x",-1,-1,r,t,e,o,s,0),p("z","y","x",1,-1,r,t,-e,o,s,1),p("x","z","y",1,1,e,r,t,i,o,2),p("x","z","y",1,-1,e,r,-t,i,o,3),p("x","y","z",1,-1,e,t,r,i,s,4),p("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new ze(l,3)),this.setAttribute("normal",new ze(u,3)),this.setAttribute("uv",new ze(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Da(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wf(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():e[t][r]=Array.isArray(i)?i.slice():i}}return e}function yi(n){const e={};for(let t=0;t<n.length;t++){const r=wf(n[t]);for(const i in r)e[i]=r[i]}return e}function XW(n){return null===n.getRenderTarget()?n.outputColorSpace:$t.workingColorSpace}const p_e={clone:wf,merge:yi};class Vo extends Vi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wf(e.uniforms),this.uniformsGroups=function f_e(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;t.uniforms[i]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)!0===this.extensions[i]&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class BD extends Kn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new tt,this.projectionMatrix=new tt,this.projectionMatrixInverse=new tt,this.coordinateSystem=xa}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Cr extends BD{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Jd*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Jl*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Jd*Math.atan(Math.tan(.5*Jl*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Jl*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class __e extends Kn{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Cr(-90,1,e,t);i.layers=this.layers,this.add(i);const s=new Cr(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Cr(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Cr(-90,1,e,t);a.layers=this.layers,this.add(a);const c=new Cr(-90,1,e,t);c.layers=this.layers,this.add(c);const l=new Cr(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===xa)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,c),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=m,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,d,f),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class wE extends Ds{constructor(e,t,r,i,s,o,a,c,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:Dc,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class y_e extends eu{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];void 0!==t.encoding&&(Jg("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Kl?an:""),this.texture=new wE(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Sn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r_uniforms={tEquirect:{value:null}},r_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new Da(5,5,5),s=new Vo({name:"CubemapFromEquirect",uniforms:wf(r_uniforms),vertexShader:r_vertexShader,fragmentShader:r_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new Kt(i,s),a=t.minFilter;return t.minFilter===wa&&(t.minFilter=Sn),new __e(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}const zD=new M,v_e=new M,w_e=new St;class Ra{constructor(e=new M(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=zD.subVectors(r,t).cross(v_e.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(zD),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||w_e.getNormalMatrix(e),i=this.coplanarPoint(zD).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const iu=new Ks,EE=new M;class HD{constructor(e=new Ra,t=new Ra,r=new Ra,i=new Ra,s=new Ra,o=new Ra){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=xa){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],d=i[7],f=i[8],p=i[9],m=i[10],_=i[11],g=i[12],y=i[13],v=i[14],w=i[15];if(r[0].setComponents(c-s,d-l,_-f,w-g).normalize(),r[1].setComponents(c+s,d+l,_+f,w+g).normalize(),r[2].setComponents(c+o,d+u,_+p,w+y).normalize(),r[3].setComponents(c-o,d-u,_-p,w-y).normalize(),r[4].setComponents(c-a,d-h,_-m,w-v).normalize(),t===xa)r[5].setComponents(c+a,d+h,_+m,w+v).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(a,h,m,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),iu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),iu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(iu)}intersectsSprite(e){return iu.center.set(0,0,0),iu.radius=.7071067811865476,iu.applyMatrix4(e.matrixWorld),this.intersectsSphere(iu)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(EE.x=i.normal.x>0?e.max.x:e.min.x,EE.y=i.normal.y>0?e.max.y:e.min.y,EE.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(EE)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function YW(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==t&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function E_e(n,e){const t=e.isWebGL2,r=new WeakMap;return{get:function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),r.get(l)},remove:function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=r.get(l);u&&(n.deleteBuffer(u.buffer),r.delete(l))},update:function c(l,u){if(l.isGLBufferAttribute){const d=r.get(l);return void((!d||d.version<l.version)&&r.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version}))}l.isInterleavedBufferAttribute&&(l=l.data);const h=r.get(l);void 0===h?r.set(l,function i(l,u){const h=l.array,d=l.usage,f=n.createBuffer();let p;if(n.bindBuffer(u,f),n.bufferData(u,h,d),l.onUploadCallback(),h instanceof Float32Array)p=n.FLOAT;else if(h instanceof Uint16Array)if(l.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=n.HALF_FLOAT}else p=n.UNSIGNED_SHORT;else if(h instanceof Int16Array)p=n.SHORT;else if(h instanceof Uint32Array)p=n.UNSIGNED_INT;else if(h instanceof Int32Array)p=n.INT;else if(h instanceof Int8Array)p=n.BYTE;else if(h instanceof Uint8Array)p=n.UNSIGNED_BYTE;else{if(!(h instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);p=n.UNSIGNED_BYTE}return{buffer:f,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version}}(l,u)):h.version<l.version&&(function s(l,u,h){const d=u.array,f=u.updateRange;n.bindBuffer(h,l),-1===f.count?n.bufferSubData(h,0,d):(t?n.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):n.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}(h.buffer,l,u),h.version=l.version)}}}class bf extends Et{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,d=t/c,f=[],p=[],m=[],_=[];for(let g=0;g<u;g++){const y=g*d-o;for(let v=0;v<l;v++)p.push(v*h-s,-y,0),m.push(0,0,1),_.push(v/a),_.push(1-g/c)}for(let g=0;g<c;g++)for(let y=0;y<a;y++){const w=y+l*(g+1),E=y+1+l*(g+1),b=y+1+l*g;f.push(y+l*g,w,b),f.push(w,E,b)}this.setIndex(f),this.setAttribute("position",new ze(p,3)),this.setAttribute("normal",new ze(m,3)),this.setAttribute("uv",new ze(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bf(e.width,e.height,e.widthSegments,e.heightSegments)}}const bt={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal;\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Se={common:{diffuse:{value:new J(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new St},alphaMap:{value:null},alphaMapTransform:{value:new St},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new St}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new St}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new St}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new St},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new St},normalScale:{value:new Z(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new St},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new St}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new St}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new St}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new J(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new J(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new St},alphaTest:{value:0},uvTransform:{value:new St}},sprite:{diffuse:{value:new J(16777215)},opacity:{value:1},center:{value:new Z(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new St},alphaMap:{value:null},alphaMapTransform:{value:new St},alphaTest:{value:0}}},Uo={basic:{uniforms:yi([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.fog]),vertexShader:bt.meshbasic_vert,fragmentShader:bt.meshbasic_frag},lambert:{uniforms:yi([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,Se.lights,{emissive:{value:new J(0)}}]),vertexShader:bt.meshlambert_vert,fragmentShader:bt.meshlambert_frag},phong:{uniforms:yi([Se.common,Se.specularmap,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,Se.lights,{emissive:{value:new J(0)},specular:{value:new J(1118481)},shininess:{value:30}}]),vertexShader:bt.meshphong_vert,fragmentShader:bt.meshphong_frag},standard:{uniforms:yi([Se.common,Se.envmap,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.roughnessmap,Se.metalnessmap,Se.fog,Se.lights,{emissive:{value:new J(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:bt.meshphysical_vert,fragmentShader:bt.meshphysical_frag},toon:{uniforms:yi([Se.common,Se.aomap,Se.lightmap,Se.emissivemap,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.gradientmap,Se.fog,Se.lights,{emissive:{value:new J(0)}}]),vertexShader:bt.meshtoon_vert,fragmentShader:bt.meshtoon_frag},matcap:{uniforms:yi([Se.common,Se.bumpmap,Se.normalmap,Se.displacementmap,Se.fog,{matcap:{value:null}}]),vertexShader:bt.meshmatcap_vert,fragmentShader:bt.meshmatcap_frag},points:{uniforms:yi([Se.points,Se.fog]),vertexShader:bt.points_vert,fragmentShader:bt.points_frag},dashed:{uniforms:yi([Se.common,Se.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:bt.linedashed_vert,fragmentShader:bt.linedashed_frag},depth:{uniforms:yi([Se.common,Se.displacementmap]),vertexShader:bt.depth_vert,fragmentShader:bt.depth_frag},normal:{uniforms:yi([Se.common,Se.bumpmap,Se.normalmap,Se.displacementmap,{opacity:{value:1}}]),vertexShader:bt.meshnormal_vert,fragmentShader:bt.meshnormal_frag},sprite:{uniforms:yi([Se.sprite,Se.fog]),vertexShader:bt.sprite_vert,fragmentShader:bt.sprite_frag},background:{uniforms:{uvTransform:{value:new St},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:bt.background_vert,fragmentShader:bt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:bt.backgroundCube_vert,fragmentShader:bt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:bt.cube_vert,fragmentShader:bt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:bt.equirect_vert,fragmentShader:bt.equirect_frag},distanceRGBA:{uniforms:yi([Se.common,Se.displacementmap,{referencePosition:{value:new M},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:bt.distanceRGBA_vert,fragmentShader:bt.distanceRGBA_frag},shadow:{uniforms:yi([Se.lights,Se.fog,{color:{value:new J(0)},opacity:{value:1}}]),vertexShader:bt.shadow_vert,fragmentShader:bt.shadow_frag}};Uo.physical={uniforms:yi([Uo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new St},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new St},clearcoatNormalScale:{value:new Z(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new St},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new St},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new St},sheen:{value:0},sheenColor:{value:new J(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new St},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new St},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new St},transmissionSamplerSize:{value:new Z},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new St},attenuationDistance:{value:0},attenuationColor:{value:new J(0)},specularColor:{value:new J(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new St},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new St},anisotropyVector:{value:new Z},anisotropyMap:{value:null},anisotropyMapTransform:{value:new St}}]),vertexShader:bt.meshphysical_vert,fragmentShader:bt.meshphysical_frag};const xE={r:0,b:0,g:0};function vve(n,e,t,r,i,s,o){const a=new J(0);let l,u,c=!0===s?0:1,h=null,d=0,f=null;function m(_,g){_.getRGB(xE,XW(n)),r.buffers.color.setClear(xE.r,xE.g,xE.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(_,g=1){a.set(_),c=g,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(_){c=_,m(a,c)},render:function p(_,g){let y=!1,v=!0===g.isScene?g.background:null;v&&v.isTexture&&(v=(g.backgroundBlurriness>0?t:e).get(v)),null===v?m(a,c):v&&v.isColor&&(m(v,1),y=!0);const w=n.xr.getEnvironmentBlendMode();"additive"===w?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===w&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||y)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),v&&(v.isCubeTexture||v.mapping===$g)?(void 0===u&&(u=new Kt(new Da(1,1,1),new Vo({name:"BackgroundCubeMaterial",uniforms:wf(Uo.backgroundCube.uniforms),vertexShader:Uo.backgroundCube.vertexShader,fragmentShader:Uo.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(E,b,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=v,u.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=$t.getTransfer(v.colorSpace)!==wn,(h!==v||d!==v.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,h=v,d=v.version,f=n.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new Kt(new bf(2,2),new Vo({name:"BackgroundMaterial",uniforms:wf(Uo.background.uniforms),vertexShader:Uo.background.vertexShader,fragmentShader:Uo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=$t.getTransfer(v.colorSpace)!==wn,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),(h!==v||d!==v.version||f!==n.toneMapping)&&(l.material.needsUpdate=!0,h=v,d=v.version,f=n.toneMapping),l.layers.enableAll(),_.unshift(l,l.geometry,l.material,0,0,null))}}}function wve(n,e,t,r){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},c=_(null);let l=c,u=!1;function f(R){return r.isWebGL2?n.bindVertexArray(R):s.bindVertexArrayOES(R)}function p(R){return r.isWebGL2?n.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function _(R){const k=[],B=[],W=[];for(let ne=0;ne<i;ne++)k[ne]=0,B[ne]=0,W[ne]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:B,attributeDivisors:W,object:R,attributes:{},index:null}}function v(){const R=l.newAttributes;for(let k=0,B=R.length;k<B;k++)R[k]=0}function w(R){E(R,0)}function E(R,k){const W=l.enabledAttributes,ne=l.attributeDivisors;l.newAttributes[R]=1,0===W[R]&&(n.enableVertexAttribArray(R),W[R]=1),ne[R]!==k&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,k),ne[R]=k)}function b(){const R=l.newAttributes,k=l.enabledAttributes;for(let B=0,W=k.length;B<W;B++)k[B]!==R[B]&&(n.disableVertexAttribArray(B),k[B]=0)}function T(R,k,B,W,ne,q,ee){!0===ee?n.vertexAttribIPointer(R,k,B,ne,q):n.vertexAttribPointer(R,k,B,W,ne,q)}function U(){H(),u=!0,l!==c&&(l=c,f(l.object))}function H(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function h(R,k,B,W,ne){let q=!1;if(o){const ee=function m(R,k,B){const W=!0===B.wireframe;let ne=a[R.id];void 0===ne&&(ne={},a[R.id]=ne);let q=ne[k.id];void 0===q&&(q={},ne[k.id]=q);let ee=q[W];return void 0===ee&&(ee=_(function d(){return r.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),q[W]=ee),ee}(W,B,k);l!==ee&&(l=ee,f(l.object)),q=function g(R,k,B,W){const ne=l.attributes,q=k.attributes;let ee=0;const F=B.getAttributes();for(const X in F)if(F[X].location>=0){const le=ne[X];let de=q[X];if(void 0===de&&("instanceMatrix"===X&&R.instanceMatrix&&(de=R.instanceMatrix),"instanceColor"===X&&R.instanceColor&&(de=R.instanceColor)),void 0===le||le.attribute!==de||de&&le.data!==de.data)return!0;ee++}return l.attributesNum!==ee||l.index!==W}(R,W,B,ne),q&&function y(R,k,B,W){const ne={},q=k.attributes;let ee=0;const F=B.getAttributes();for(const X in F)if(F[X].location>=0){let le=q[X];void 0===le&&("instanceMatrix"===X&&R.instanceMatrix&&(le=R.instanceMatrix),"instanceColor"===X&&R.instanceColor&&(le=R.instanceColor));const de={};de.attribute=le,le&&le.data&&(de.data=le.data),ne[X]=de,ee++}l.attributes=ne,l.attributesNum=ee,l.index=W}(R,W,B,ne)}else{const ee=!0===k.wireframe;(l.geometry!==W.id||l.program!==B.id||l.wireframe!==ee)&&(l.geometry=W.id,l.program=B.id,l.wireframe=ee,q=!0)}null!==ne&&t.update(ne,n.ELEMENT_ARRAY_BUFFER),(q||u)&&(u=!1,function S(R,k,B,W){if(!1===r.isWebGL2&&(R.isInstancedMesh||W.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;v();const ne=W.attributes,q=B.getAttributes(),ee=k.defaultAttributeValues;for(const F in q){const X=q[F];if(X.location>=0){let ue=ne[F];if(void 0===ue&&("instanceMatrix"===F&&R.instanceMatrix&&(ue=R.instanceMatrix),"instanceColor"===F&&R.instanceColor&&(ue=R.instanceColor)),void 0!==ue){const le=ue.normalized,de=ue.itemSize,Re=t.get(ue);if(void 0===Re)continue;const Ue=Re.buffer,Fe=Re.type,At=Re.bytesPerElement,_t=!0===r.isWebGL2&&(Fe===n.INT||Fe===n.UNSIGNED_INT||1013===ue.gpuType);if(ue.isInterleavedBufferAttribute){const $e=ue.data,N=$e.stride,we=ue.offset;if($e.isInstancedInterleavedBuffer){for(let te=0;te<X.locationSize;te++)E(X.location+te,$e.meshPerAttribute);!0!==R.isInstancedMesh&&void 0===W._maxInstanceCount&&(W._maxInstanceCount=$e.meshPerAttribute*$e.count)}else for(let te=0;te<X.locationSize;te++)w(X.location+te);n.bindBuffer(n.ARRAY_BUFFER,Ue);for(let te=0;te<X.locationSize;te++)T(X.location+te,de/X.locationSize,Fe,le,N*At,(we+de/X.locationSize*te)*At,_t)}else{if(ue.isInstancedBufferAttribute){for(let $e=0;$e<X.locationSize;$e++)E(X.location+$e,ue.meshPerAttribute);!0!==R.isInstancedMesh&&void 0===W._maxInstanceCount&&(W._maxInstanceCount=ue.meshPerAttribute*ue.count)}else for(let $e=0;$e<X.locationSize;$e++)w(X.location+$e);n.bindBuffer(n.ARRAY_BUFFER,Ue);for(let $e=0;$e<X.locationSize;$e++)T(X.location+$e,de/X.locationSize,Fe,le,de*At,de/X.locationSize*$e*At,_t)}}else if(void 0!==ee){const le=ee[F];if(void 0!==le)switch(le.length){case 2:n.vertexAttrib2fv(X.location,le);break;case 3:n.vertexAttrib3fv(X.location,le);break;case 4:n.vertexAttrib4fv(X.location,le);break;default:n.vertexAttrib1fv(X.location,le)}}}}b()}(R,k,B,W),null!==ne&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(ne).buffer))},reset:U,resetDefaultState:H,dispose:function x(){U();for(const R in a){const k=a[R];for(const B in k){const W=k[B];for(const ne in W)p(W[ne].object),delete W[ne];delete k[B]}delete a[R]}},releaseStatesOfGeometry:function A(R){if(void 0===a[R.id])return;const k=a[R.id];for(const B in k){const W=k[B];for(const ne in W)p(W[ne].object),delete W[ne];delete k[B]}delete a[R.id]},releaseStatesOfProgram:function O(R){for(const k in a){const B=a[k];if(void 0===B[R.id])continue;const W=B[R.id];for(const ne in W)p(W[ne].object),delete W[ne];delete B[R.id]}},initAttributes:v,enableAttribute:w,disableUnusedAttributes:b}}function Eve(n,e,t,r){const i=r.isWebGL2;let s;this.setMode=function o(l){s=l},this.render=function a(l,u){n.drawArrays(s,l,u),t.update(u,s,1)},this.renderInstances=function c(l,u,h){if(0===h)return;let d,f;if(i)d=n,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===d)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[f](s,l,u,h),t.update(u,s,h)}}function xve(n,e,t){let r;function s(T){if("highp"===T){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return"mediump"===T&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&"WebGL2RenderingContext"===n.constructor.name;let a=void 0!==t.precision?t.precision:"highp";const c=s(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);const l=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),d=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_TEXTURE_SIZE),p=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),m=n.getParameter(n.MAX_VERTEX_ATTRIBS),_=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),g=n.getParameter(n.MAX_VARYING_VECTORS),y=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),v=d>0,w=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function i(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const T=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:_,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:w,floatVertexTextures:v&&w,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function bve(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new Ra,a=new St,c={value:null,needsUpdate:!1};function u(h,d,f,p){const m=null!==h?h.length:0;let _=null;if(0!==m){if(_=c.value,!0!==p||null===_){const g=f+4*m,y=d.matrixWorldInverse;a.getNormalMatrix(y),(null===_||_.length<g)&&(_=new Float32Array(g));for(let v=0,w=f;v!==m;++v,w+=4)o.copy(h[v]).applyMatrix4(y,a),o.normal.toArray(_,w),_[w+3]=o.constant}c.value=_,c.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,_}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=0!==h.length||d||0!==r||i;return i=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,m=h.clipIntersection,_=h.clipShadows,g=n.get(h);if(!i||null===p||0===p.length||s&&!_)s?u(null):function l(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const y=s?0:r,v=4*y;let w=g.clippingState||null;c.value=w,w=u(p,d,v,f);for(let E=0;E!==v;++E)w[E]=t[E];g.clippingState=w,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}}}function Tve(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=Dc:304===a&&(o.mapping=ql),o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);void 0!==c&&(e.delete(a),c.dispose())}return{get:function r(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const c=o.image;if(c&&c.height>0){const l=new y_e(c.height/2);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",i),t(l.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class bE extends BD{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,c=i-t;if(null!==this.view&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const KW=[.125,.215,.35,.446,.526,.582],GD=new bE,QW=new J;let jD=null;const ou=(1+Math.sqrt(5))/2,Sf=1/ou,ZW=[new M(1,1,1),new M(-1,1,1),new M(1,1,-1),new M(-1,1,-1),new M(0,ou,Sf),new M(0,ou,-Sf),new M(Sf,0,ou),new M(-Sf,0,ou),new M(ou,Sf,0),new M(-ou,Sf,0)];class JW{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){jD=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=n$(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=t$(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(jD),e.scissorTest=!1,TE(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Dc||e.mapping===ql?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),jD=this._renderer.getRenderTarget();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Sn,minFilter:Sn,generateMipmaps:!1,type:Yg,format:Ms,colorSpace:Sr,depthBuffer:!1},i=e$(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=e$(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function Sve(n){const e=[],t=[],r=[];let i=n;const s=n-4+1+KW.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let c=1/a;o>n-4?c=KW[o-n+4-1]:0===o&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,m=3,_=2,g=1,y=new Float32Array(m*p*f),v=new Float32Array(_*p*f),w=new Float32Array(g*p*f);for(let b=0;b<f;b++){const T=b%3*2/3-1,S=b>2?0:-1;y.set([T,S,0,T+2/3,S,0,T+2/3,S+1,0,T,S,0,T+2/3,S+1,0,T,S+1,0],m*p*b),v.set(d,_*p*b),w.set([b,b,b,b,b,b],g*p*b)}const E=new Et;E.setAttribute("position",new En(y,m)),E.setAttribute("uv",new En(v,_)),E.setAttribute("faceIndex",new En(w,g)),e.push(E),i>4&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}(s)),this._blurMaterial=function Ave(n,e,t){const r=new Float32Array(20),i=new M(0,1,0);return new Vo({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return i}_compileMaterial(e){const t=new Kt(this._lodPlanes[0],e);this._renderer.compile(t,GD)}_sceneToCubeUV(e,t,r,i){const a=new Cr(90,1,t,r),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(QW),u.toneMapping=va,u.autoClear=!1;const f=new _i({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new Kt(new Da,f);let m=!1;const _=e.background;_?_.isColor&&(f.color.copy(_),e.background=null,m=!0):(f.color.copy(QW),m=!0);for(let g=0;g<6;g++){const y=g%3;0===y?(a.up.set(0,c[g],0),a.lookAt(l[g],0,0)):1===y?(a.up.set(0,0,c[g]),a.lookAt(0,l[g],0)):(a.up.set(0,c[g],0),a.lookAt(0,0,l[g]));const v=this._cubeSize;TE(i,y*v,g>2?v:0,v,v),u.setRenderTarget(i),m&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=_}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Dc||e.mapping===ql;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=n$()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=t$());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Kt(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;TE(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(o,GD)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]);this._blur(e,i-1,i,s,ZW[(i-1)%ZW.length])}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Kt(this._lodPlanes[i],l),d=l.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,m=s/p,_=isFinite(s)?1+Math.floor(3*m):20;_>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to 20`);const g=[];let y=0;for(let T=0;T<20;++T){const S=T/m,x=Math.exp(-S*S/2);g.push(x),0===T?y+=x:T<_&&(y+=2*x)}for(let T=0;T<g.length;T++)g[T]=g[T]/y;d.envMap.value=e.texture,d.samples.value=_,d.weights.value=g,d.latitudinal.value="latitudinal"===o,a&&(d.poleAxis.value=a);const{_lodMax:v}=this;d.dTheta.value=p,d.mipInt.value=v-r;const w=this._sizeLods[i];TE(t,3*w*(i>v-4?i-v+4:0),4*(this._cubeSize-w),3*w,2*w),c.setRenderTarget(t),c.render(h,GD)}}function e$(n,e,t){const r=new eu(n,e,t);return r.texture.mapping=$g,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function TE(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function t$(){return new Vo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function n$(){return new Vo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Cve(n){let e=new WeakMap,t=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function r(a){if(a&&a.isTexture){const c=a.mapping,l=303===c||304===c,u=c===Dc||c===ql;if(l||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let h=e.get(a);return null===t&&(t=new JW(n)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}if(e.has(a))return e.get(a).texture;{const h=a.image;if(l&&h&&h.height>0||u&&h&&function i(a){let c=0;for(let u=0;u<6;u++)void 0!==a[u]&&c++;return 6===c}(h)){null===t&&(t=new JW(n));const d=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Mve(n){const e={};function t(r){if(void 0!==e[r])return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return null!==t(r)},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Ive(n,e,t,r){const i={},s=new WeakMap;function o(h){const d=h.target;null!==d.index&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);for(const p in d.morphAttributes){const m=d.morphAttributes[p];for(let _=0,g=m.length;_<g;_++)e.remove(m[_])}d.removeEventListener("dispose",o),delete i[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),!0===d.isInstancedBufferGeometry&&delete d._maxInstanceCount,t.memory.geometries--}function l(h){const d=[],f=h.index,p=h.attributes.position;let m=0;if(null!==f){const y=f.array;m=f.version;for(let v=0,w=y.length;v<w;v+=3){const E=y[v+0],b=y[v+1],T=y[v+2];d.push(E,b,b,T,T,E)}}else{if(void 0===p)return;m=p.version;for(let v=0,w=p.array.length/3-1;v<w;v+=3){const E=v+0,b=v+1,T=v+2;d.push(E,b,b,T,T,E)}}const _=new(AW(d)?HW:zW)(d,1);_.version=m;const g=s.get(h);g&&e.remove(g),s.set(h,_)}return{get:function a(h,d){return!0===i[d.id]||(d.addEventListener("dispose",o),i[d.id]=!0,t.memory.geometries++),d},update:function c(h){const d=h.attributes;for(const p in d)e.update(d[p],n.ARRAY_BUFFER);const f=h.morphAttributes;for(const p in f){const m=f[p];for(let _=0,g=m.length;_<g;_++)e.update(m[_],n.ARRAY_BUFFER)}},getWireframeAttribute:function u(h){const d=s.get(h);if(d){const f=h.index;null!==f&&d.version<f.version&&l(h)}else l(h);return s.get(h)}}}function Dve(n,e,t,r){const i=r.isWebGL2;let s,a,c;this.setMode=function o(d){s=d},this.setIndex=function l(d){a=d.type,c=d.bytesPerElement},this.render=function u(d,f){n.drawElements(s,f,a,d*c),t.update(f,s,1)},this.renderInstances=function h(d,f,p){if(0===p)return;let m,_;if(i)m=n,_="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),_="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[_](s,f,a,d*c,p),t.update(f,s,p)}}function Rve(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function Pve(n,e){return n[0]-e[0]}function Nve(n,e){return Math.abs(e[1])-Math.abs(n[1])}function Lve(n,e,t){const r={},i=new Float32Array(8),s=new WeakMap,o=new en,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function c(l,u,h){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==f?f.length:0;let m=s.get(u);if(void 0===m||m.count!==p){let R=function(){U.dispose(),s.delete(u),u.removeEventListener("dispose",R)};void 0!==m&&m.texture.dispose();const y=void 0!==u.morphAttributes.position,v=void 0!==u.morphAttributes.normal,w=void 0!==u.morphAttributes.color,E=u.morphAttributes.position||[],b=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===v&&(S=2),!0===w&&(S=3);let x=u.attributes.position.count*S,A=1;x>e.maxTextureSize&&(A=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const O=new Float32Array(x*A*4*p),U=new SD(O,x,A,p);U.type=Ea,U.needsUpdate=!0;const H=4*S;for(let k=0;k<p;k++){const B=E[k],W=b[k],ne=T[k],q=x*A*4*k;for(let ee=0;ee<B.count;ee++){const F=ee*H;!0===y&&(o.fromBufferAttribute(B,ee),O[q+F+0]=o.x,O[q+F+1]=o.y,O[q+F+2]=o.z,O[q+F+3]=0),!0===v&&(o.fromBufferAttribute(W,ee),O[q+F+4]=o.x,O[q+F+5]=o.y,O[q+F+6]=o.z,O[q+F+7]=0),!0===w&&(o.fromBufferAttribute(ne,ee),O[q+F+8]=o.x,O[q+F+9]=o.y,O[q+F+10]=o.z,O[q+F+11]=4===ne.itemSize?o.w:1)}}m={count:p,texture:U,size:new Z(x,A)},s.set(u,m),u.addEventListener("dispose",R)}let _=0;for(let y=0;y<d.length;y++)_+=d[y];const g=u.morphTargetsRelative?1:1-_;h.getUniforms().setValue(n,"morphTargetBaseInfluence",g),h.getUniforms().setValue(n,"morphTargetInfluences",d),h.getUniforms().setValue(n,"morphTargetsTexture",m.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}else{const f=void 0===d?0:d.length;let p=r[u.id];if(void 0===p||p.length!==f){p=[];for(let v=0;v<f;v++)p[v]=[v,0];r[u.id]=p}for(let v=0;v<f;v++){const w=p[v];w[0]=v,w[1]=d[v]}p.sort(Nve);for(let v=0;v<8;v++)v<f&&p[v][1]?(a[v][0]=p[v][0],a[v][1]=p[v][1]):(a[v][0]=Number.MAX_SAFE_INTEGER,a[v][1]=0);a.sort(Pve);const m=u.morphAttributes.position,_=u.morphAttributes.normal;let g=0;for(let v=0;v<8;v++){const w=a[v],E=w[0],b=w[1];E!==Number.MAX_SAFE_INTEGER&&b?(m&&u.getAttribute("morphTarget"+v)!==m[E]&&u.setAttribute("morphTarget"+v,m[E]),_&&u.getAttribute("morphNormal"+v)!==_[E]&&u.setAttribute("morphNormal"+v,_[E]),i[v]=b,g+=b):(m&&!0===u.hasAttribute("morphTarget"+v)&&u.deleteAttribute("morphTarget"+v),_&&!0===u.hasAttribute("morphNormal"+v)&&u.deleteAttribute("morphNormal"+v),i[v]=0)}const y=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(n,"morphTargetBaseInfluence",y),h.getUniforms().setValue(n,"morphTargetInfluences",i)}}}}function Ove(n,e,t,r){let i=new WeakMap;function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),null!==l.instanceColor&&t.remove(l.instanceColor)}return{update:function s(c){const l=r.render.frame,h=e.get(c,c.geometry);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",a)&&c.addEventListener("dispose",a),i.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),null!==c.instanceColor&&t.update(c.instanceColor,n.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return h},dispose:function o(){i=new WeakMap}}}const r$=new Ds,i$=new SD,s$=new RW,o$=new wE,a$=[],c$=[],l$=new Float32Array(16),u$=new Float32Array(9),h$=new Float32Array(4);function Af(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=a$[i];if(void 0===s&&(s=new Float32Array(i),a$[i]=s),0!==e){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function gr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function _r(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function SE(n,e){let t=c$[e];void 0===t&&(t=new Int32Array(e),c$[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Fve(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function kve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2fv(this.addr,e),_r(t,e)}}function Vve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(gr(t,e))return;n.uniform3fv(this.addr,e),_r(t,e)}}function Uve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4fv(this.addr,e),_r(t,e)}}function Bve(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(gr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),_r(t,e)}else{if(gr(t,r))return;h$.set(r),n.uniformMatrix2fv(this.addr,!1,h$),_r(t,r)}}function zve(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(gr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),_r(t,e)}else{if(gr(t,r))return;u$.set(r),n.uniformMatrix3fv(this.addr,!1,u$),_r(t,r)}}function Hve(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(gr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),_r(t,e)}else{if(gr(t,r))return;l$.set(r),n.uniformMatrix4fv(this.addr,!1,l$),_r(t,r)}}function Gve(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function jve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2iv(this.addr,e),_r(t,e)}}function Wve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gr(t,e))return;n.uniform3iv(this.addr,e),_r(t,e)}}function $ve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4iv(this.addr,e),_r(t,e)}}function qve(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function Xve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2uiv(this.addr,e),_r(t,e)}}function Yve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gr(t,e))return;n.uniform3uiv(this.addr,e),_r(t,e)}}function Kve(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4uiv(this.addr,e),_r(t,e)}}function Qve(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2D(e||r$,i)}function Zve(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||s$,i)}function Jve(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||o$,i)}function e0e(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||i$,i)}function n0e(n,e){n.uniform1fv(this.addr,e)}function r0e(n,e){const t=Af(e,this.size,2);n.uniform2fv(this.addr,t)}function i0e(n,e){const t=Af(e,this.size,3);n.uniform3fv(this.addr,t)}function s0e(n,e){const t=Af(e,this.size,4);n.uniform4fv(this.addr,t)}function o0e(n,e){const t=Af(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function a0e(n,e){const t=Af(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function c0e(n,e){const t=Af(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function l0e(n,e){n.uniform1iv(this.addr,e)}function u0e(n,e){n.uniform2iv(this.addr,e)}function h0e(n,e){n.uniform3iv(this.addr,e)}function d0e(n,e){n.uniform4iv(this.addr,e)}function f0e(n,e){n.uniform1uiv(this.addr,e)}function p0e(n,e){n.uniform2uiv(this.addr,e)}function m0e(n,e){n.uniform3uiv(this.addr,e)}function g0e(n,e){n.uniform4uiv(this.addr,e)}function _0e(n,e,t){const r=this.cache,i=e.length,s=SE(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),_r(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||r$,s[o])}function y0e(n,e,t){const r=this.cache,i=e.length,s=SE(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),_r(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||s$,s[o])}function v0e(n,e,t){const r=this.cache,i=e.length,s=SE(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),_r(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||o$,s[o])}function w0e(n,e,t){const r=this.cache,i=e.length,s=SE(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),_r(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||i$,s[o])}class x0e{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function t0e(n){switch(n){case 5126:return Fve;case 35664:return kve;case 35665:return Vve;case 35666:return Uve;case 35674:return Bve;case 35675:return zve;case 35676:return Hve;case 5124:case 35670:return Gve;case 35667:case 35671:return jve;case 35668:case 35672:return Wve;case 35669:case 35673:return $ve;case 5125:return qve;case 36294:return Xve;case 36295:return Yve;case 36296:return Kve;case 35678:case 36198:case 36298:case 36306:case 35682:return Qve;case 35679:case 36299:case 36307:return Zve;case 35680:case 36300:case 36308:case 36293:return Jve;case 36289:case 36303:case 36311:case 36292:return e0e}}(t.type)}}class b0e{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function E0e(n){switch(n){case 5126:return n0e;case 35664:return r0e;case 35665:return i0e;case 35666:return s0e;case 35674:return o0e;case 35675:return a0e;case 35676:return c0e;case 5124:case 35670:return l0e;case 35667:case 35671:return u0e;case 35668:case 35672:return h0e;case 35669:case 35673:return d0e;case 5125:return f0e;case 36294:return p0e;case 36295:return m0e;case 36296:return g0e;case 35678:case 36198:case 36298:case 36306:case 35682:return _0e;case 35679:case 36299:case 36307:return y0e;case 35680:case 36300:case 36308:case 36293:return v0e;case 36289:case 36303:case 36311:case 36292:return w0e}}(t.type)}}class T0e{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const $D=/(\w+)(\])?(\[|\.)?/g;function d$(n,e){n.seq.push(e),n.map[e.id]=e}function S0e(n,e,t){const r=n.name,i=r.length;for($D.lastIndex=0;;){const s=$D.exec(r);let a=s[1];const l=s[3];if("]"===s[2]&&(a|=0),void 0===l||"["===l&&$D.lastIndex+2===i){d$(t,void 0===l?new x0e(a,n,e):new b0e(a,n,e));break}{let h=t.map[a];void 0===h&&(h=new T0e(a),d$(t,h)),t=h}}}class AE{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i);S0e(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,r,i){const s=this.map[t];void 0!==s&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=r[a.id];!1!==c.needsUpdate&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function f$(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}let A0e=0;function p$(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+i+"\n\n"+function C0e(n,e){const t=n.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join("\n")}(n.getShaderSource(e),o)}return i}function I0e(n,e){const t=function M0e(n){const e=$t.getPrimaries($t.workingColorSpace),t=$t.getPrimaries(n);let r;switch(e===t?r="":e===Zw&&t===Qw?r="LinearDisplayP3ToLinearSRGB":e===Qw&&t===Zw&&(r="LinearSRGBToLinearDisplayP3"),n){case Sr:case Yw:return[r,"LinearTransferOETF"];case an:case _D:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function D0e(n,e){let t;switch(e){case Uj:t="Linear";break;case Bj:t="Reinhard";break;case zj:t="OptimizedCineon";break;case oD:t="ACESFilmic";break;case Hj:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function s_(n){return""!==n}function m$(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function g$(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const L0e=/^[ \t]*#include +<([\w\d./]+)>/gm;function qD(n){return n.replace(L0e,F0e)}const O0e=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function F0e(n,e){let t=bt[e];if(void 0===t){const r=O0e.get(e);if(void 0===r)throw new Error("Can not resolve #include <"+e+">");t=bt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r)}return qD(t)}const k0e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _$(n){return n.replace(k0e,V0e)}function V0e(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function y$(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function j0e(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=function U0e(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Dj?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Rj?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===_a&&(e="SHADOWMAP_TYPE_VSM"),e}(t),l=function B0e(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Dc:case ql:e="ENVMAP_TYPE_CUBE";break;case $g:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function z0e(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===ql&&(e="ENVMAP_MODE_REFRACTION"),e}(t),h=function H0e(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Gw:e="ENVMAP_BLENDING_MULTIPLY";break;case cge:e="ENVMAP_BLENDING_MIX";break;case lge:e="ENVMAP_BLENDING_ADD"}return e}(t),d=function G0e(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}(t),f=t.isWebGL2?"":function R0e(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(s_).join("\n")}(t),p=function P0e(n){const e=[];for(const t in n){const r=n[t];!1!==r&&e.push("#define "+t+" "+r)}return e.join("\n")}(s),m=i.createProgram();let _,g,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(s_).join("\n"),_.length>0&&(_+="\n"),g=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(s_).join("\n"),g.length>0&&(g+="\n")):(_=[y$(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(s_).join("\n"),g=[f,y$(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==va?"#define TONE_MAPPING":"",t.toneMapping!==va?bt.tonemapping_pars_fragment:"",t.toneMapping!==va?D0e("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",bt.colorspace_pars_fragment,I0e("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(s_).join("\n")),o=qD(o),o=m$(o,t),o=g$(o,t),a=qD(a),a=m$(a,t),a=g$(a,t),o=_$(o),a=_$(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(y="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,g=["#define varying in",t.glslVersion===bW?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===bW?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const w=y+g+a,E=f$(i,i.VERTEX_SHADER,y+_+o),b=f$(i,i.FRAGMENT_SHADER,w);if(i.attachShader(m,E),i.attachShader(m,b),void 0!==t.index0AttributeName?i.bindAttribLocation(m,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),n.debug.checkShaderErrors){const x=i.getProgramInfoLog(m).trim(),A=i.getShaderInfoLog(E).trim(),O=i.getShaderInfoLog(b).trim();let U=!0,H=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(U=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(i,m,E,b);else{const R=p$(i,E,"vertex"),k=p$(i,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+x+"\n"+R+"\n"+k)}else""!==x?console.warn("THREE.WebGLProgram: Program Info Log:",x):(""===A||""===O)&&(H=!1);H&&(this.diagnostics={runnable:U,programLog:x,vertexShader:{log:A,prefix:_},fragmentShader:{log:O,prefix:g}})}let T,S;return i.deleteShader(E),i.deleteShader(b),this.getUniforms=function(){return void 0===T&&(T=new AE(i,m)),T},this.getAttributes=function(){return void 0===S&&(S=function N0e(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(i,m)),S},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=A0e++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=E,this.fragmentShader=b,this}let W0e=0;class $0e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const r=e.fragmentShader,i=this._getShaderStage(e.vertexShader),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new q0e(e),t.set(e,r)),r}}class q0e{constructor(e){this.id=W0e++,this.code=e,this.usedTimes=0}}function X0e(n,e,t,r,i,s,o){const a=new PD,c=new $0e,l=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(x){return 0===x?"uv":`uv${x}`}return{getParameters:function _(x,A,O,U,H){const R=U.fog,k=H.geometry,W=(x.isMeshStandardMaterial?t:e).get(x.envMap||(x.isMeshStandardMaterial?U.environment:null)),ne=W&&W.mapping===$g?W.image.height:null,q=p[x.type];null!==x.precision&&(f=i.getMaxPrecision(x.precision),f!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",f,"instead."));const ee=k.morphAttributes.position||k.morphAttributes.normal||k.morphAttributes.color,F=void 0!==ee?ee.length:0;let ue,le,de,Re,X=0;if(void 0!==k.morphAttributes.position&&(X=1),void 0!==k.morphAttributes.normal&&(X=2),void 0!==k.morphAttributes.color&&(X=3),q){const xn=Uo[q];ue=xn.vertexShader,le=xn.fragmentShader}else ue=x.vertexShader,le=x.fragmentShader,c.update(x),de=c.getVertexShaderID(x),Re=c.getFragmentShaderID(x);const Ue=n.getRenderTarget(),Fe=!0===H.isInstancedMesh,At=!!x.map,$e=!!W,N=!!x.aoMap,we=!!x.lightMap,te=!!x.bumpMap,me=!!x.normalMap,oe=!!x.displacementMap,Ye=!!x.emissiveMap,Ne=!!x.metalnessMap,ke=!!x.roughnessMap,nt=x.anisotropy>0,It=x.clearcoat>0,An=x.iridescence>0,D=x.sheen>0,C=x.transmission>0,$=nt&&!!x.anisotropyMap,fe=It&&!!x.clearcoatMap,ce=It&&!!x.clearcoatNormalMap,ge=It&&!!x.clearcoatRoughnessMap,We=An&&!!x.iridescenceMap,_e=An&&!!x.iridescenceThicknessMap,Ie=D&&!!x.sheenColorMap,L=D&&!!x.sheenRoughnessMap,ye=!!x.specularMap,ie=!!x.specularColorMap,st=!!x.specularIntensityMap,Ke=C&&!!x.transmissionMap,Qe=C&&!!x.thicknessMap,P=!!x.alphaMap,Me=!!x.extensions,xe=!!k.attributes.uv1,ae=!!k.attributes.uv2,He=!!k.attributes.uv3;let at=va;return x.toneMapped&&(null===Ue||!0===Ue.isXRRenderTarget)&&(at=n.toneMapping),{isWebGL2:u,shaderID:q,shaderType:x.type,shaderName:x.name,vertexShader:ue,fragmentShader:le,defines:x.defines,customVertexShaderID:de,customFragmentShaderID:Re,isRawShaderMaterial:!0===x.isRawShaderMaterial,glslVersion:x.glslVersion,precision:f,instancing:Fe,instancingColor:Fe&&null!==H.instanceColor,supportsVertexTextures:d,outputColorSpace:null===Ue?n.outputColorSpace:!0===Ue.isXRRenderTarget?Ue.texture.colorSpace:Sr,map:At,matcap:!!x.matcap,envMap:$e,envMapMode:$e&&W.mapping,envMapCubeUVHeight:ne,aoMap:N,lightMap:we,bumpMap:te,normalMap:me,displacementMap:d&&oe,emissiveMap:Ye,normalMapObjectSpace:me&&1===x.normalMapType,normalMapTangentSpace:me&&0===x.normalMapType,metalnessMap:Ne,roughnessMap:ke,anisotropy:nt,anisotropyMap:$,clearcoat:It,clearcoatMap:fe,clearcoatNormalMap:ce,clearcoatRoughnessMap:ge,iridescence:An,iridescenceMap:We,iridescenceThicknessMap:_e,sheen:D,sheenColorMap:Ie,sheenRoughnessMap:L,specularMap:ye,specularColorMap:ie,specularIntensityMap:st,transmission:C,transmissionMap:Ke,thicknessMap:Qe,gradientMap:!!x.gradientMap,opaque:!1===x.transparent&&1===x.blending,alphaMap:P,alphaTest:x.alphaTest>0,alphaHash:!!x.alphaHash,combine:x.combine,mapUv:At&&m(x.map.channel),aoMapUv:N&&m(x.aoMap.channel),lightMapUv:we&&m(x.lightMap.channel),bumpMapUv:te&&m(x.bumpMap.channel),normalMapUv:me&&m(x.normalMap.channel),displacementMapUv:oe&&m(x.displacementMap.channel),emissiveMapUv:Ye&&m(x.emissiveMap.channel),metalnessMapUv:Ne&&m(x.metalnessMap.channel),roughnessMapUv:ke&&m(x.roughnessMap.channel),anisotropyMapUv:$&&m(x.anisotropyMap.channel),clearcoatMapUv:fe&&m(x.clearcoatMap.channel),clearcoatNormalMapUv:ce&&m(x.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ge&&m(x.clearcoatRoughnessMap.channel),iridescenceMapUv:We&&m(x.iridescenceMap.channel),iridescenceThicknessMapUv:_e&&m(x.iridescenceThicknessMap.channel),sheenColorMapUv:Ie&&m(x.sheenColorMap.channel),sheenRoughnessMapUv:L&&m(x.sheenRoughnessMap.channel),specularMapUv:ye&&m(x.specularMap.channel),specularColorMapUv:ie&&m(x.specularColorMap.channel),specularIntensityMapUv:st&&m(x.specularIntensityMap.channel),transmissionMapUv:Ke&&m(x.transmissionMap.channel),thicknessMapUv:Qe&&m(x.thicknessMap.channel),alphaMapUv:P&&m(x.alphaMap.channel),vertexTangents:!!k.attributes.tangent&&(me||nt),vertexColors:x.vertexColors,vertexAlphas:!0===x.vertexColors&&!!k.attributes.color&&4===k.attributes.color.itemSize,vertexUv1s:xe,vertexUv2s:ae,vertexUv3s:He,pointsUvs:!0===H.isPoints&&!!k.attributes.uv&&(At||P),fog:!!R,useFog:!0===x.fog,fogExp2:R&&R.isFogExp2,flatShading:!0===x.flatShading,sizeAttenuation:!0===x.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===H.isSkinnedMesh,morphTargets:void 0!==k.morphAttributes.position,morphNormals:void 0!==k.morphAttributes.normal,morphColors:void 0!==k.morphAttributes.color,morphTargetsCount:F,morphTextureStride:X,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:n.shadowMap.enabled&&O.length>0,shadowMapType:n.shadowMap.type,toneMapping:at,useLegacyLights:n._useLegacyLights,decodeVideoTexture:At&&!0===x.map.isVideoTexture&&$t.getTransfer(x.map.colorSpace)===wn,premultipliedAlpha:x.premultipliedAlpha,doubleSided:2===x.side,flipSided:1===x.side,useDepthPacking:x.depthPacking>=0,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionDerivatives:Me&&!0===x.extensions.derivatives,extensionFragDepth:Me&&!0===x.extensions.fragDepth,extensionDrawBuffers:Me&&!0===x.extensions.drawBuffers,extensionShaderTextureLOD:Me&&!0===x.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}},getProgramCacheKey:function g(x){const A=[];if(x.shaderID?A.push(x.shaderID):(A.push(x.customVertexShaderID),A.push(x.customFragmentShaderID)),void 0!==x.defines)for(const O in x.defines)A.push(O),A.push(x.defines[O]);return!1===x.isRawShaderMaterial&&(function y(x,A){x.push(A.precision),x.push(A.outputColorSpace),x.push(A.envMapMode),x.push(A.envMapCubeUVHeight),x.push(A.mapUv),x.push(A.alphaMapUv),x.push(A.lightMapUv),x.push(A.aoMapUv),x.push(A.bumpMapUv),x.push(A.normalMapUv),x.push(A.displacementMapUv),x.push(A.emissiveMapUv),x.push(A.metalnessMapUv),x.push(A.roughnessMapUv),x.push(A.anisotropyMapUv),x.push(A.clearcoatMapUv),x.push(A.clearcoatNormalMapUv),x.push(A.clearcoatRoughnessMapUv),x.push(A.iridescenceMapUv),x.push(A.iridescenceThicknessMapUv),x.push(A.sheenColorMapUv),x.push(A.sheenRoughnessMapUv),x.push(A.specularMapUv),x.push(A.specularColorMapUv),x.push(A.specularIntensityMapUv),x.push(A.transmissionMapUv),x.push(A.thicknessMapUv),x.push(A.combine),x.push(A.fogExp2),x.push(A.sizeAttenuation),x.push(A.morphTargetsCount),x.push(A.morphAttributeCount),x.push(A.numDirLights),x.push(A.numPointLights),x.push(A.numSpotLights),x.push(A.numSpotLightMaps),x.push(A.numHemiLights),x.push(A.numRectAreaLights),x.push(A.numDirLightShadows),x.push(A.numPointLightShadows),x.push(A.numSpotLightShadows),x.push(A.numSpotLightShadowsWithMaps),x.push(A.numLightProbes),x.push(A.shadowMapType),x.push(A.toneMapping),x.push(A.numClippingPlanes),x.push(A.numClipIntersection),x.push(A.depthPacking)}(A,x),function v(x,A){a.disableAll(),A.isWebGL2&&a.enable(0),A.supportsVertexTextures&&a.enable(1),A.instancing&&a.enable(2),A.instancingColor&&a.enable(3),A.matcap&&a.enable(4),A.envMap&&a.enable(5),A.normalMapObjectSpace&&a.enable(6),A.normalMapTangentSpace&&a.enable(7),A.clearcoat&&a.enable(8),A.iridescence&&a.enable(9),A.alphaTest&&a.enable(10),A.vertexColors&&a.enable(11),A.vertexAlphas&&a.enable(12),A.vertexUv1s&&a.enable(13),A.vertexUv2s&&a.enable(14),A.vertexUv3s&&a.enable(15),A.vertexTangents&&a.enable(16),A.anisotropy&&a.enable(17),x.push(a.mask),a.disableAll(),A.fog&&a.enable(0),A.useFog&&a.enable(1),A.flatShading&&a.enable(2),A.logarithmicDepthBuffer&&a.enable(3),A.skinning&&a.enable(4),A.morphTargets&&a.enable(5),A.morphNormals&&a.enable(6),A.morphColors&&a.enable(7),A.premultipliedAlpha&&a.enable(8),A.shadowMapEnabled&&a.enable(9),A.useLegacyLights&&a.enable(10),A.doubleSided&&a.enable(11),A.flipSided&&a.enable(12),A.useDepthPacking&&a.enable(13),A.dithering&&a.enable(14),A.transmission&&a.enable(15),A.sheen&&a.enable(16),A.opaque&&a.enable(17),A.pointsUvs&&a.enable(18),A.decodeVideoTexture&&a.enable(19),x.push(a.mask)}(A,x),A.push(n.outputColorSpace)),A.push(x.customProgramCacheKey),A.join()},getUniforms:function w(x){const A=p[x.type];let O;return O=A?p_e.clone(Uo[A].uniforms):x.uniforms,O},acquireProgram:function E(x,A){let O;for(let U=0,H=l.length;U<H;U++){const R=l[U];if(R.cacheKey===A){O=R,++O.usedTimes;break}}return void 0===O&&(O=new j0e(n,A,x,s),l.push(O)),O},releaseProgram:function b(x){if(0==--x.usedTimes){const A=l.indexOf(x);l[A]=l[l.length-1],l.pop(),x.destroy()}},releaseShaderCache:function T(x){c.remove(x)},programs:l,dispose:function S(){c.dispose()}}}function Y0e(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function r(s,o,a){n.get(s)[o]=a},dispose:function i(){n=new WeakMap}}}function K0e(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function v$(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function w$(){const n=[];let e=0;const t=[],r=[],i=[];function o(h,d,f,p,m,_){let g=n[e];return void 0===g?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:m,group:_},n[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=m,g.group=_),e++,g}return{opaque:t,transmissive:r,transparent:i,init:function s(){e=0,t.length=0,r.length=0,i.length=0},push:function a(h,d,f,p,m,_){const g=o(h,d,f,p,m,_);f.transmission>0?r.push(g):!0===f.transparent?i.push(g):t.push(g)},unshift:function c(h,d,f,p,m,_){const g=o(h,d,f,p,m,_);f.transmission>0?r.unshift(g):!0===f.transparent?i.unshift(g):t.unshift(g)},finish:function u(){for(let h=e,d=n.length;h<d;h++){const f=n[h];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function l(h,d){t.length>1&&t.sort(h||K0e),r.length>1&&r.sort(d||v$),i.length>1&&i.sort(d||v$)}}}function Q0e(){let n=new WeakMap;return{get:function e(r,i){const s=n.get(r);let o;return void 0===s?(o=new w$,n.set(r,[o])):i>=s.length?(o=new w$,s.push(o)):o=s[i],o},dispose:function t(){n=new WeakMap}}}function Z0e(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new M,color:new J};break;case"SpotLight":t={position:new M,direction:new M,color:new J,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new M,color:new J,distance:0,decay:0};break;case"HemisphereLight":t={direction:new M,skyColor:new J,groundColor:new J};break;case"RectAreaLight":t={color:new J,position:new M,halfWidth:new M,halfHeight:new M}}return n[e.id]=t,t}}}let ewe=0;function twe(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function nwe(n,e){const t=new Z0e,r=function J0e(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Z};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Z,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new M);const s=new M,o=new tt,a=new tt;return{setup:function c(u,h){let d=0,f=0,p=0;for(let U=0;U<9;U++)i.probe[U].set(0,0,0);let m=0,_=0,g=0,y=0,v=0,w=0,E=0,b=0,T=0,S=0,x=0;u.sort(twe);const A=!0===h?Math.PI:1;for(let U=0,H=u.length;U<H;U++){const R=u[U],k=R.color,B=R.intensity,W=R.distance,ne=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=k.r*B*A,f+=k.g*B*A,p+=k.b*B*A;else if(R.isLightProbe){for(let q=0;q<9;q++)i.probe[q].addScaledVector(R.sh.coefficients[q],B);x++}else if(R.isDirectionalLight){const q=t.get(R);if(q.color.copy(R.color).multiplyScalar(R.intensity*A),R.castShadow){const ee=R.shadow,F=r.get(R);F.shadowBias=ee.bias,F.shadowNormalBias=ee.normalBias,F.shadowRadius=ee.radius,F.shadowMapSize=ee.mapSize,i.directionalShadow[m]=F,i.directionalShadowMap[m]=ne,i.directionalShadowMatrix[m]=R.shadow.matrix,w++}i.directional[m]=q,m++}else if(R.isSpotLight){const q=t.get(R);q.position.setFromMatrixPosition(R.matrixWorld),q.color.copy(k).multiplyScalar(B*A),q.distance=W,q.coneCos=Math.cos(R.angle),q.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),q.decay=R.decay,i.spot[g]=q;const ee=R.shadow;if(R.map&&(i.spotLightMap[T]=R.map,T++,ee.updateMatrices(R),R.castShadow&&S++),i.spotLightMatrix[g]=ee.matrix,R.castShadow){const F=r.get(R);F.shadowBias=ee.bias,F.shadowNormalBias=ee.normalBias,F.shadowRadius=ee.radius,F.shadowMapSize=ee.mapSize,i.spotShadow[g]=F,i.spotShadowMap[g]=ne,b++}g++}else if(R.isRectAreaLight){const q=t.get(R);q.color.copy(k).multiplyScalar(B),q.halfWidth.set(.5*R.width,0,0),q.halfHeight.set(0,.5*R.height,0),i.rectArea[y]=q,y++}else if(R.isPointLight){const q=t.get(R);if(q.color.copy(R.color).multiplyScalar(R.intensity*A),q.distance=R.distance,q.decay=R.decay,R.castShadow){const ee=R.shadow,F=r.get(R);F.shadowBias=ee.bias,F.shadowNormalBias=ee.normalBias,F.shadowRadius=ee.radius,F.shadowMapSize=ee.mapSize,F.shadowCameraNear=ee.camera.near,F.shadowCameraFar=ee.camera.far,i.pointShadow[_]=F,i.pointShadowMap[_]=ne,i.pointShadowMatrix[_]=R.shadow.matrix,E++}i.point[_]=q,_++}else if(R.isHemisphereLight){const q=t.get(R);q.skyColor.copy(R.color).multiplyScalar(B*A),q.groundColor.copy(R.groundColor).multiplyScalar(B*A),i.hemi[v]=q,v++}}y>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=Se.LTC_FLOAT_1,i.rectAreaLTC2=Se.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Se.LTC_HALF_1,i.rectAreaLTC2=Se.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=f,i.ambient[2]=p;const O=i.hash;(O.directionalLength!==m||O.pointLength!==_||O.spotLength!==g||O.rectAreaLength!==y||O.hemiLength!==v||O.numDirectionalShadows!==w||O.numPointShadows!==E||O.numSpotShadows!==b||O.numSpotMaps!==T||O.numLightProbes!==x)&&(i.directional.length=m,i.spot.length=g,i.rectArea.length=y,i.point.length=_,i.hemi.length=v,i.directionalShadow.length=w,i.directionalShadowMap.length=w,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=b,i.spotShadowMap.length=b,i.directionalShadowMatrix.length=w,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=b+T-S,i.spotLightMap.length=T,i.numSpotLightShadowsWithMaps=S,i.numLightProbes=x,O.directionalLength=m,O.pointLength=_,O.spotLength=g,O.rectAreaLength=y,O.hemiLength=v,O.numDirectionalShadows=w,O.numPointShadows=E,O.numSpotShadows=b,O.numSpotMaps=T,O.numLightProbes=x,i.version=ewe++)},setupView:function l(u,h){let d=0,f=0,p=0,m=0,_=0;const g=h.matrixWorldInverse;for(let y=0,v=u.length;y<v;y++){const w=u[y];if(w.isDirectionalLight){const E=i.directional[d];E.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(g),d++}else if(w.isSpotLight){const E=i.spot[p];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(g),E.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(g),p++}else if(w.isRectAreaLight){const E=i.rectArea[m];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(g),a.identity(),o.copy(w.matrixWorld),o.premultiply(g),a.extractRotation(o),E.halfWidth.set(.5*w.width,0,0),E.halfHeight.set(0,.5*w.height,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),m++}else if(w.isPointLight){const E=i.point[f];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(g),f++}else if(w.isHemisphereLight){const E=i.hemi[_];E.direction.setFromMatrixPosition(w.matrixWorld),E.direction.transformDirection(g),_++}}},state:i}}function E$(n,e){const t=new nwe(n,e),r=[],i=[];return{init:function s(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:function c(h){t.setup(r,h)},setupLightsView:function l(h){t.setupView(r,h)},pushLight:function o(h){r.push(h)},pushShadow:function a(h){i.push(h)}}}function rwe(n,e){let t=new WeakMap;return{get:function r(s,o=0){const a=t.get(s);let c;return void 0===a?(c=new E$(n,e),t.set(s,[c])):o>=a.length?(c=new E$(n,e),a.push(c)):c=a[o],c},dispose:function i(){t=new WeakMap}}}class x$ extends Vi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class b$ extends Vi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function owe(n,e,t){let r=new HD;const i=new Z,s=new Z,o=new en,a=new x$({depthPacking:3201}),c=new b$,l={},u=t.maxTextureSize,h={0:1,1:0,2:2},d=new Vo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Z},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Et;p.setAttribute("position",new En(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Kt(p,d),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Dj;let g=this.type;function y(E,b){const T=e.update(m);d.defines.VSM_SAMPLES!==E.blurSamples&&(d.defines.VSM_SAMPLES=E.blurSamples,f.defines.VSM_SAMPLES=E.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===E.mapPass&&(E.mapPass=new eu(i.x,i.y)),d.uniforms.shadow_pass.value=E.map.texture,d.uniforms.resolution.value=E.mapSize,d.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(b,null,T,d,m,null),f.uniforms.shadow_pass.value=E.mapPass.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(b,null,T,f,m,null)}function v(E,b,T,S){let x=null;const A=!0===T.isPointLight?E.customDistanceMaterial:E.customDepthMaterial;if(void 0!==A)x=A;else if(x=!0===T.isPointLight?c:a,n.localClippingEnabled&&!0===b.clipShadows&&Array.isArray(b.clippingPlanes)&&0!==b.clippingPlanes.length||b.displacementMap&&0!==b.displacementScale||b.alphaMap&&b.alphaTest>0||b.map&&b.alphaTest>0){const O=x.uuid,U=b.uuid;let H=l[O];void 0===H&&(H={},l[O]=H);let R=H[U];void 0===R&&(R=x.clone(),H[U]=R),x=R}return x.visible=b.visible,x.wireframe=b.wireframe,x.side=S===_a?null!==b.shadowSide?b.shadowSide:b.side:null!==b.shadowSide?b.shadowSide:h[b.side],x.alphaMap=b.alphaMap,x.alphaTest=b.alphaTest,x.map=b.map,x.clipShadows=b.clipShadows,x.clippingPlanes=b.clippingPlanes,x.clipIntersection=b.clipIntersection,x.displacementMap=b.displacementMap,x.displacementScale=b.displacementScale,x.displacementBias=b.displacementBias,x.wireframeLinewidth=b.wireframeLinewidth,x.linewidth=b.linewidth,!0===T.isPointLight&&!0===x.isMeshDistanceMaterial&&(n.properties.get(x).light=T),x}function w(E,b,T,S,x){if(!1===E.visible)return;if(E.layers.test(b.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&x===_a)&&(!E.frustumCulled||r.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,E.matrixWorld);const U=e.update(E),H=E.material;if(Array.isArray(H)){const R=U.groups;for(let k=0,B=R.length;k<B;k++){const W=R[k],ne=H[W.materialIndex];if(ne&&ne.visible){const q=v(E,ne,S,x);n.renderBufferDirect(T,null,U,q,E,W)}}}else if(H.visible){const R=v(E,H,S,x);n.renderBufferDirect(T,null,U,R,E,null)}}const O=E.children;for(let U=0,H=O.length;U<H;U++)w(O[U],b,T,S,x)}this.render=function(E,b,T){if(!1===_.enabled||!1===_.autoUpdate&&!1===_.needsUpdate||0===E.length)return;const S=n.getRenderTarget(),x=n.getActiveCubeFace(),A=n.getActiveMipmapLevel(),O=n.state;O.setBlending(0),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const U=g!==_a&&this.type===_a,H=g===_a&&this.type!==_a;for(let R=0,k=E.length;R<k;R++){const B=E[R],W=B.shadow;if(void 0===W){console.warn("THREE.WebGLShadowMap:",B,"has no shadow.");continue}if(!1===W.autoUpdate&&!1===W.needsUpdate)continue;i.copy(W.mapSize);const ne=W.getFrameExtents();if(i.multiply(ne),s.copy(W.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/ne.x),i.x=s.x*ne.x,W.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/ne.y),i.y=s.y*ne.y,W.mapSize.y=s.y)),null===W.map||!0===U||!0===H){const ee=this.type!==_a?{minFilter:Yn,magFilter:Yn}:{};null!==W.map&&W.map.dispose(),W.map=new eu(i.x,i.y,ee),W.map.texture.name=B.name+".shadowMap",W.camera.updateProjectionMatrix()}n.setRenderTarget(W.map),n.clear();const q=W.getViewportCount();for(let ee=0;ee<q;ee++){const F=W.getViewport(ee);o.set(s.x*F.x,s.y*F.y,s.x*F.z,s.y*F.w),O.viewport(o),W.updateMatrices(B,ee),r=W.getFrustum(),w(b,T,W.camera,B,this.type)}!0!==W.isPointLightShadow&&this.type===_a&&y(W,T),W.needsUpdate=!1}g=this.type,_.needsUpdate=!1,n.setRenderTarget(S,x,A)}}function awe(n,e,t){const r=t.isWebGL2,a=new function i(){let P=!1;const Ee=new en;let ve=null;const Me=new en(0,0,0,0);return{setMask:function(xe){ve!==xe&&!P&&(n.colorMask(xe,xe,xe,xe),ve=xe)},setLocked:function(xe){P=xe},setClear:function(xe,ae,He,at,sr){!0===sr&&(xe*=at,ae*=at,He*=at),Ee.set(xe,ae,He,at),!1===Me.equals(Ee)&&(n.clearColor(xe,ae,He,at),Me.copy(Ee))},reset:function(){P=!1,ve=null,Me.set(-1,0,0,0)}}},c=new function s(){let P=!1,Ee=null,ve=null,Me=null;return{setTest:function(xe){xe?Ue(n.DEPTH_TEST):Fe(n.DEPTH_TEST)},setMask:function(xe){Ee!==xe&&!P&&(n.depthMask(xe),Ee=xe)},setFunc:function(xe){if(ve!==xe){switch(xe){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}ve=xe}},setLocked:function(xe){P=xe},setClear:function(xe){Me!==xe&&(n.clearDepth(xe),Me=xe)},reset:function(){P=!1,Ee=null,ve=null,Me=null}}},l=new function o(){let P=!1,Ee=null,ve=null,Me=null,xe=null,ae=null,He=null,at=null,sr=null;return{setTest:function(xn){P||(xn?Ue(n.STENCIL_TEST):Fe(n.STENCIL_TEST))},setMask:function(xn){Ee!==xn&&!P&&(n.stencilMask(xn),Ee=xn)},setFunc:function(xn,Go,Ei){(ve!==xn||Me!==Go||xe!==Ei)&&(n.stencilFunc(xn,Go,Ei),ve=xn,Me=Go,xe=Ei)},setOp:function(xn,Go,Ei){(ae!==xn||He!==Go||at!==Ei)&&(n.stencilOp(xn,Go,Ei),ae=xn,He=Go,at=Ei)},setLocked:function(xn){P=xn},setClear:function(xn){sr!==xn&&(n.clearStencil(xn),sr=xn)},reset:function(){P=!1,Ee=null,ve=null,Me=null,xe=null,ae=null,He=null,at=null,sr=null}}},u=new WeakMap,h=new WeakMap;let d={},f={},p=new WeakMap,m=[],_=null,g=!1,y=null,v=null,w=null,E=null,b=null,T=null,S=null,x=!1,A=null,O=null,U=null,H=null,R=null;const k=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let B=!1,W=0;const ne=n.getParameter(n.VERSION);-1!==ne.indexOf("WebGL")?(W=parseFloat(/^WebGL (\d)/.exec(ne)[1]),B=W>=1):-1!==ne.indexOf("OpenGL ES")&&(W=parseFloat(/^OpenGL ES (\d)/.exec(ne)[1]),B=W>=2);let q=null,ee={};const F=n.getParameter(n.SCISSOR_BOX),X=n.getParameter(n.VIEWPORT),ue=(new en).fromArray(F),le=(new en).fromArray(X);function de(P,Ee,ve,Me){const xe=new Uint8Array(4),ae=n.createTexture();n.bindTexture(P,ae),n.texParameteri(P,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(P,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let He=0;He<ve;He++)!r||P!==n.TEXTURE_3D&&P!==n.TEXTURE_2D_ARRAY?n.texImage2D(Ee+He,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,xe):n.texImage3D(Ee,0,n.RGBA,1,1,Me,0,n.RGBA,n.UNSIGNED_BYTE,xe);return ae}const Re={};function Ue(P){!0!==d[P]&&(n.enable(P),d[P]=!0)}function Fe(P){!1!==d[P]&&(n.disable(P),d[P]=!1)}Re[n.TEXTURE_2D]=de(n.TEXTURE_2D,n.TEXTURE_2D,1),Re[n.TEXTURE_CUBE_MAP]=de(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(Re[n.TEXTURE_2D_ARRAY]=de(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Re[n.TEXTURE_3D]=de(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),Ue(n.DEPTH_TEST),c.setFunc(3),oe(!1),Ye(1),Ue(n.CULL_FACE),te(0);const N={100:n.FUNC_ADD,101:n.FUNC_SUBTRACT,102:n.FUNC_REVERSE_SUBTRACT};if(r)N[103]=n.MIN,N[104]=n.MAX;else{const P=e.get("EXT_blend_minmax");null!==P&&(N[103]=P.MIN_EXT,N[104]=P.MAX_EXT)}const we={200:n.ZERO,201:n.ONE,202:n.SRC_COLOR,204:n.SRC_ALPHA,210:n.SRC_ALPHA_SATURATE,208:n.DST_COLOR,206:n.DST_ALPHA,203:n.ONE_MINUS_SRC_COLOR,205:n.ONE_MINUS_SRC_ALPHA,209:n.ONE_MINUS_DST_COLOR,207:n.ONE_MINUS_DST_ALPHA};function te(P,Ee,ve,Me,xe,ae,He,at){if(0!==P){if(!1===g&&(Ue(n.BLEND),g=!0),5===P)xe=xe||Ee,ae=ae||ve,He=He||Me,(Ee!==v||xe!==b)&&(n.blendEquationSeparate(N[Ee],N[xe]),v=Ee,b=xe),(ve!==w||Me!==E||ae!==T||He!==S)&&(n.blendFuncSeparate(we[ve],we[Me],we[ae],we[He]),w=ve,E=Me,T=ae,S=He),y=P,x=!1;else if(P!==y||at!==x){if((100!==v||100!==b)&&(n.blendEquation(n.FUNC_ADD),v=100,b=100),at)switch(P){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",P)}else switch(P){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",P)}w=null,E=null,T=null,S=null,y=P,x=at}}else!0===g&&(Fe(n.BLEND),g=!1)}function oe(P){A!==P&&(n.frontFace(P?n.CW:n.CCW),A=P)}function Ye(P){0!==P?(Ue(n.CULL_FACE),P!==O&&n.cullFace(1===P?n.BACK:2===P?n.FRONT:n.FRONT_AND_BACK)):Fe(n.CULL_FACE),O=P}function ke(P,Ee,ve){P?(Ue(n.POLYGON_OFFSET_FILL),(H!==Ee||R!==ve)&&(n.polygonOffset(Ee,ve),H=Ee,R=ve)):Fe(n.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:c,stencil:l},enable:Ue,disable:Fe,bindFramebuffer:function At(P,Ee){return f[P]!==Ee&&(n.bindFramebuffer(P,Ee),f[P]=Ee,r&&(P===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=Ee),P===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=Ee)),!0)},drawBuffers:function _t(P,Ee){let ve=m,Me=!1;if(P)if(ve=p.get(Ee),void 0===ve&&(ve=[],p.set(Ee,ve)),P.isWebGLMultipleRenderTargets){const xe=P.texture;if(ve.length!==xe.length||ve[0]!==n.COLOR_ATTACHMENT0){for(let ae=0,He=xe.length;ae<He;ae++)ve[ae]=n.COLOR_ATTACHMENT0+ae;ve.length=xe.length,Me=!0}}else ve[0]!==n.COLOR_ATTACHMENT0&&(ve[0]=n.COLOR_ATTACHMENT0,Me=!0);else ve[0]!==n.BACK&&(ve[0]=n.BACK,Me=!0);Me&&(t.isWebGL2?n.drawBuffers(ve):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ve))},useProgram:function $e(P){return _!==P&&(n.useProgram(P),_=P,!0)},setBlending:te,setMaterial:function me(P,Ee){2===P.side?Fe(n.CULL_FACE):Ue(n.CULL_FACE);let ve=1===P.side;Ee&&(ve=!ve),oe(ve),1===P.blending&&!1===P.transparent?te(0):te(P.blending,P.blendEquation,P.blendSrc,P.blendDst,P.blendEquationAlpha,P.blendSrcAlpha,P.blendDstAlpha,P.premultipliedAlpha),c.setFunc(P.depthFunc),c.setTest(P.depthTest),c.setMask(P.depthWrite),a.setMask(P.colorWrite);const Me=P.stencilWrite;l.setTest(Me),Me&&(l.setMask(P.stencilWriteMask),l.setFunc(P.stencilFunc,P.stencilRef,P.stencilFuncMask),l.setOp(P.stencilFail,P.stencilZFail,P.stencilZPass)),ke(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits),!0===P.alphaToCoverage?Ue(n.SAMPLE_ALPHA_TO_COVERAGE):Fe(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:oe,setCullFace:Ye,setLineWidth:function Ne(P){P!==U&&(B&&n.lineWidth(P),U=P)},setPolygonOffset:ke,setScissorTest:function nt(P){P?Ue(n.SCISSOR_TEST):Fe(n.SCISSOR_TEST)},activeTexture:function It(P){void 0===P&&(P=n.TEXTURE0+k-1),q!==P&&(n.activeTexture(P),q=P)},bindTexture:function An(P,Ee,ve){void 0===ve&&(ve=null===q?n.TEXTURE0+k-1:q);let Me=ee[ve];void 0===Me&&(Me={type:void 0,texture:void 0},ee[ve]=Me),(Me.type!==P||Me.texture!==Ee)&&(q!==ve&&(n.activeTexture(ve),q=ve),n.bindTexture(P,Ee||Re[P]),Me.type=P,Me.texture=Ee)},unbindTexture:function D(){const P=ee[q];void 0!==P&&void 0!==P.type&&(n.bindTexture(P.type,null),P.type=void 0,P.texture=void 0)},compressedTexImage2D:function C(){try{n.compressedTexImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexImage3D:function $(){try{n.compressedTexImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texImage2D:function L(){try{n.texImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texImage3D:function ye(){try{n.texImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},updateUBOMapping:function Ke(P,Ee){let ve=h.get(Ee);void 0===ve&&(ve=new WeakMap,h.set(Ee,ve));let Me=ve.get(P);void 0===Me&&(Me=n.getUniformBlockIndex(Ee,P.name),ve.set(P,Me))},uniformBlockBinding:function Qe(P,Ee){const Me=h.get(Ee).get(P);u.get(Ee)!==Me&&(n.uniformBlockBinding(Ee,Me,P.__bindingPointIndex),u.set(Ee,Me))},texStorage2D:function _e(){try{n.texStorage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texStorage3D:function Ie(){try{n.texStorage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texSubImage2D:function fe(){try{n.texSubImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},texSubImage3D:function ce(){try{n.texSubImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexSubImage2D:function ge(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},compressedTexSubImage3D:function We(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(P){console.error("THREE.WebGLState:",P)}},scissor:function ie(P){!1===ue.equals(P)&&(n.scissor(P.x,P.y,P.z,P.w),ue.copy(P))},viewport:function st(P){!1===le.equals(P)&&(n.viewport(P.x,P.y,P.z,P.w),le.copy(P))},reset:function qe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),!0===r&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),d={},q=null,ee={},f={},p=new WeakMap,m=[],_=null,g=!1,y=null,v=null,w=null,E=null,b=null,T=null,S=null,x=!1,A=null,O=null,U=null,H=null,R=null,ue.set(0,0,n.canvas.width,n.canvas.height),le.set(0,0,n.canvas.width,n.canvas.height),a.reset(),c.reset(),l.reset()}}}function cwe(n,e,t,r,i,s,o){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const _=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(D,C){return g?new OffscreenCanvas(D,C):Zg("canvas")}function v(D,C,$,fe){let ce=1;if((D.width>fe||D.height>fe)&&(ce=fe/Math.max(D.width,D.height)),ce<1||!0===C){if(typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&D instanceof ImageBitmap){const ge=C?tE:Math.floor,We=ge(ce*D.width),_e=ge(ce*D.height);void 0===m&&(m=y(We,_e));const Ie=$?y(We,_e):m;return Ie.width=We,Ie.height=_e,Ie.getContext("2d").drawImage(D,0,0,We,_e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+D.width+"x"+D.height+") to ("+We+"x"+_e+")."),Ie}return"data"in D&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+D.width+"x"+D.height+")."),D}return D}function w(D){return ED(D.width)&&ED(D.height)}function b(D,C){return D.generateMipmaps&&C&&D.minFilter!==Yn&&D.minFilter!==Sn}function T(D){n.generateMipmap(D)}function S(D,C,$,fe,ce=!1){if(!1===a)return C;if(null!==D){if(void 0!==n[D])return n[D];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+D+"'")}let ge=C;if(C===n.RED&&($===n.FLOAT&&(ge=n.R32F),$===n.HALF_FLOAT&&(ge=n.R16F),$===n.UNSIGNED_BYTE&&(ge=n.R8)),C===n.RED_INTEGER&&($===n.UNSIGNED_BYTE&&(ge=n.R8UI),$===n.UNSIGNED_SHORT&&(ge=n.R16UI),$===n.UNSIGNED_INT&&(ge=n.R32UI),$===n.BYTE&&(ge=n.R8I),$===n.SHORT&&(ge=n.R16I),$===n.INT&&(ge=n.R32I)),C===n.RG&&($===n.FLOAT&&(ge=n.RG32F),$===n.HALF_FLOAT&&(ge=n.RG16F),$===n.UNSIGNED_BYTE&&(ge=n.RG8)),C===n.RGBA){const We=ce?Kw:$t.getTransfer(fe);$===n.FLOAT&&(ge=n.RGBA32F),$===n.HALF_FLOAT&&(ge=n.RGBA16F),$===n.UNSIGNED_BYTE&&(ge=We===wn?n.SRGB8_ALPHA8:n.RGBA8),$===n.UNSIGNED_SHORT_4_4_4_4&&(ge=n.RGBA4),$===n.UNSIGNED_SHORT_5_5_5_1&&(ge=n.RGB5_A1)}return(ge===n.R16F||ge===n.R32F||ge===n.RG16F||ge===n.RG32F||ge===n.RGBA16F||ge===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ge}function x(D,C,$){return!0===b(D,$)||D.isFramebufferTexture&&D.minFilter!==Yn&&D.minFilter!==Sn?Math.log2(Math.max(C.width,C.height))+1:void 0!==D.mipmaps&&D.mipmaps.length>0?D.mipmaps.length:D.isCompressedTexture&&Array.isArray(D.image)?C.mipmaps.length:1}function A(D){return D===Yn||1004===D||1005===D?n.NEAREST:n.LINEAR}function O(D){const C=D.target;C.removeEventListener("dispose",O),function H(D){const C=r.get(D);if(void 0===C.__webglInit)return;const $=D.source,fe=_.get($);if(fe){const ce=fe[C.__cacheKey];ce.usedTimes--,0===ce.usedTimes&&R(D),0===Object.keys(fe).length&&_.delete($)}r.remove(D)}(C),C.isVideoTexture&&p.delete(C)}function U(D){const C=D.target;C.removeEventListener("dispose",U),function k(D){const C=D.texture,$=r.get(D),fe=r.get(C);if(void 0!==fe.__webglTexture&&(n.deleteTexture(fe.__webglTexture),o.memory.textures--),D.depthTexture&&D.depthTexture.dispose(),D.isWebGLCubeRenderTarget)for(let ce=0;ce<6;ce++){if(Array.isArray($.__webglFramebuffer[ce]))for(let ge=0;ge<$.__webglFramebuffer[ce].length;ge++)n.deleteFramebuffer($.__webglFramebuffer[ce][ge]);else n.deleteFramebuffer($.__webglFramebuffer[ce]);$.__webglDepthbuffer&&n.deleteRenderbuffer($.__webglDepthbuffer[ce])}else{if(Array.isArray($.__webglFramebuffer))for(let ce=0;ce<$.__webglFramebuffer.length;ce++)n.deleteFramebuffer($.__webglFramebuffer[ce]);else n.deleteFramebuffer($.__webglFramebuffer);if($.__webglDepthbuffer&&n.deleteRenderbuffer($.__webglDepthbuffer),$.__webglMultisampledFramebuffer&&n.deleteFramebuffer($.__webglMultisampledFramebuffer),$.__webglColorRenderbuffer)for(let ce=0;ce<$.__webglColorRenderbuffer.length;ce++)$.__webglColorRenderbuffer[ce]&&n.deleteRenderbuffer($.__webglColorRenderbuffer[ce]);$.__webglDepthRenderbuffer&&n.deleteRenderbuffer($.__webglDepthRenderbuffer)}if(D.isWebGLMultipleRenderTargets)for(let ce=0,ge=C.length;ce<ge;ce++){const We=r.get(C[ce]);We.__webglTexture&&(n.deleteTexture(We.__webglTexture),o.memory.textures--),r.remove(C[ce])}r.remove(C),r.remove(D)}(C)}function R(D){const C=r.get(D);n.deleteTexture(C.__webglTexture),delete _.get(D.source)[C.__cacheKey],o.memory.textures--}let B=0;function ee(D,C){const $=r.get(D);if(D.isVideoTexture&&function It(D){const C=o.render.frame;p.get(D)!==C&&(p.set(D,C),D.update())}(D),!1===D.isRenderTargetTexture&&D.version>0&&$.__version!==D.version){const fe=D.image;if(null===fe)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==fe.complete)return void At($,D,C);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,$.__webglTexture,n.TEXTURE0+C)}const le={[ss]:n.REPEAT,[ni]:n.CLAMP_TO_EDGE,1002:n.MIRRORED_REPEAT},de={[Yn]:n.NEAREST,1004:n.NEAREST_MIPMAP_NEAREST,1005:n.NEAREST_MIPMAP_LINEAR,[Sn]:n.LINEAR,1007:n.LINEAR_MIPMAP_NEAREST,[wa]:n.LINEAR_MIPMAP_LINEAR},Re={512:n.NEVER,519:n.ALWAYS,513:n.LESS,515:n.LEQUAL,514:n.EQUAL,518:n.GEQUAL,516:n.GREATER,517:n.NOTEQUAL};function Ue(D,C,$){if($?(n.texParameteri(D,n.TEXTURE_WRAP_S,le[C.wrapS]),n.texParameteri(D,n.TEXTURE_WRAP_T,le[C.wrapT]),(D===n.TEXTURE_3D||D===n.TEXTURE_2D_ARRAY)&&n.texParameteri(D,n.TEXTURE_WRAP_R,le[C.wrapR]),n.texParameteri(D,n.TEXTURE_MAG_FILTER,de[C.magFilter]),n.texParameteri(D,n.TEXTURE_MIN_FILTER,de[C.minFilter])):(n.texParameteri(D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(D===n.TEXTURE_3D||D===n.TEXTURE_2D_ARRAY)&&n.texParameteri(D,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(C.wrapS!==ni||C.wrapT!==ni)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(D,n.TEXTURE_MAG_FILTER,A(C.magFilter)),n.texParameteri(D,n.TEXTURE_MIN_FILTER,A(C.minFilter)),C.minFilter!==Yn&&C.minFilter!==Sn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),C.compareFunction&&(n.texParameteri(D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(D,n.TEXTURE_COMPARE_FUNC,Re[C.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const fe=e.get("EXT_texture_filter_anisotropic");if(C.magFilter===Yn||1005!==C.minFilter&&C.minFilter!==wa||C.type===Ea&&!1===e.has("OES_texture_float_linear")||!1===a&&C.type===Yg&&!1===e.has("OES_texture_half_float_linear"))return;(C.anisotropy>1||r.get(C).__currentAnisotropy)&&(n.texParameterf(D,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,i.getMaxAnisotropy())),r.get(C).__currentAnisotropy=C.anisotropy)}}function Fe(D,C){let $=!1;void 0===D.__webglInit&&(D.__webglInit=!0,C.addEventListener("dispose",O));const fe=C.source;let ce=_.get(fe);void 0===ce&&(ce={},_.set(fe,ce));const ge=function q(D){const C=[];return C.push(D.wrapS),C.push(D.wrapT),C.push(D.wrapR||0),C.push(D.magFilter),C.push(D.minFilter),C.push(D.anisotropy),C.push(D.internalFormat),C.push(D.format),C.push(D.type),C.push(D.generateMipmaps),C.push(D.premultiplyAlpha),C.push(D.flipY),C.push(D.unpackAlignment),C.push(D.colorSpace),C.join()}(C);if(ge!==D.__cacheKey){void 0===ce[ge]&&(ce[ge]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,$=!0),ce[ge].usedTimes++;const We=ce[D.__cacheKey];void 0!==We&&(ce[D.__cacheKey].usedTimes--,0===We.usedTimes&&R(C)),D.__cacheKey=ge,D.__webglTexture=ce[ge].texture}return $}function At(D,C,$){let fe=n.TEXTURE_2D;(C.isDataArrayTexture||C.isCompressedArrayTexture)&&(fe=n.TEXTURE_2D_ARRAY),C.isData3DTexture&&(fe=n.TEXTURE_3D);const ce=Fe(D,C),ge=C.source;t.bindTexture(fe,D.__webglTexture,n.TEXTURE0+$);const We=r.get(ge);if(ge.version!==We.__version||!0===ce){t.activeTexture(n.TEXTURE0+$);const _e=$t.getPrimaries($t.workingColorSpace),Ie=""===C.colorSpace?null:$t.getPrimaries(C.colorSpace),L=""===C.colorSpace||_e===Ie?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,L);const ye=function E(D){return!a&&(D.wrapS!==ni||D.wrapT!==ni||D.minFilter!==Yn&&D.minFilter!==Sn)}(C)&&!1===w(C.image);let ie=v(C.image,ye,!1,u);ie=An(C,ie);const st=w(ie)||a,Ke=s.convert(C.format,C.colorSpace);let P,Qe=s.convert(C.type),qe=S(C.internalFormat,Ke,Qe,C.colorSpace,C.isVideoTexture);Ue(fe,C,st);const Ee=C.mipmaps,ve=a&&!0!==C.isVideoTexture,Me=void 0===We.__version||!0===ce,xe=x(C,ie,st);if(C.isDepthTexture)qe=n.DEPTH_COMPONENT,a?qe=C.type===Ea?n.DEPTH_COMPONENT32F:C.type===Pc?n.DEPTH_COMPONENT24:C.type===Xl?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT16:C.type===Ea&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),C.format===Yl&&qe===n.DEPTH_COMPONENT&&1012!==C.type&&C.type!==Pc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),C.type=Pc,Qe=s.convert(C.type)),C.format===Yd&&qe===n.DEPTH_COMPONENT&&(qe=n.DEPTH_STENCIL,C.type!==Xl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),C.type=Xl,Qe=s.convert(C.type))),Me&&(ve?t.texStorage2D(n.TEXTURE_2D,1,qe,ie.width,ie.height):t.texImage2D(n.TEXTURE_2D,0,qe,ie.width,ie.height,0,Ke,Qe,null));else if(C.isDataTexture)if(Ee.length>0&&st){ve&&Me&&t.texStorage2D(n.TEXTURE_2D,xe,qe,Ee[0].width,Ee[0].height);for(let ae=0,He=Ee.length;ae<He;ae++)P=Ee[ae],ve?t.texSubImage2D(n.TEXTURE_2D,ae,0,0,P.width,P.height,Ke,Qe,P.data):t.texImage2D(n.TEXTURE_2D,ae,qe,P.width,P.height,0,Ke,Qe,P.data);C.generateMipmaps=!1}else ve?(Me&&t.texStorage2D(n.TEXTURE_2D,xe,qe,ie.width,ie.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,ie.width,ie.height,Ke,Qe,ie.data)):t.texImage2D(n.TEXTURE_2D,0,qe,ie.width,ie.height,0,Ke,Qe,ie.data);else if(C.isCompressedTexture)if(C.isCompressedArrayTexture){ve&&Me&&t.texStorage3D(n.TEXTURE_2D_ARRAY,xe,qe,Ee[0].width,Ee[0].height,ie.depth);for(let ae=0,He=Ee.length;ae<He;ae++)P=Ee[ae],C.format!==Ms?null!==Ke?ve?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ae,0,0,0,P.width,P.height,ie.depth,Ke,P.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ae,qe,P.width,P.height,ie.depth,0,P.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ve?t.texSubImage3D(n.TEXTURE_2D_ARRAY,ae,0,0,0,P.width,P.height,ie.depth,Ke,Qe,P.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ae,qe,P.width,P.height,ie.depth,0,Ke,Qe,P.data)}else{ve&&Me&&t.texStorage2D(n.TEXTURE_2D,xe,qe,Ee[0].width,Ee[0].height);for(let ae=0,He=Ee.length;ae<He;ae++)P=Ee[ae],C.format!==Ms?null!==Ke?ve?t.compressedTexSubImage2D(n.TEXTURE_2D,ae,0,0,P.width,P.height,Ke,P.data):t.compressedTexImage2D(n.TEXTURE_2D,ae,qe,P.width,P.height,0,P.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ve?t.texSubImage2D(n.TEXTURE_2D,ae,0,0,P.width,P.height,Ke,Qe,P.data):t.texImage2D(n.TEXTURE_2D,ae,qe,P.width,P.height,0,Ke,Qe,P.data)}else if(C.isDataArrayTexture)ve?(Me&&t.texStorage3D(n.TEXTURE_2D_ARRAY,xe,qe,ie.width,ie.height,ie.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ie.width,ie.height,ie.depth,Ke,Qe,ie.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,qe,ie.width,ie.height,ie.depth,0,Ke,Qe,ie.data);else if(C.isData3DTexture)ve?(Me&&t.texStorage3D(n.TEXTURE_3D,xe,qe,ie.width,ie.height,ie.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ie.width,ie.height,ie.depth,Ke,Qe,ie.data)):t.texImage3D(n.TEXTURE_3D,0,qe,ie.width,ie.height,ie.depth,0,Ke,Qe,ie.data);else if(C.isFramebufferTexture){if(Me)if(ve)t.texStorage2D(n.TEXTURE_2D,xe,qe,ie.width,ie.height);else{let ae=ie.width,He=ie.height;for(let at=0;at<xe;at++)t.texImage2D(n.TEXTURE_2D,at,qe,ae,He,0,Ke,Qe,null),ae>>=1,He>>=1}}else if(Ee.length>0&&st){ve&&Me&&t.texStorage2D(n.TEXTURE_2D,xe,qe,Ee[0].width,Ee[0].height);for(let ae=0,He=Ee.length;ae<He;ae++)P=Ee[ae],ve?t.texSubImage2D(n.TEXTURE_2D,ae,0,0,Ke,Qe,P):t.texImage2D(n.TEXTURE_2D,ae,qe,Ke,Qe,P);C.generateMipmaps=!1}else ve?(Me&&t.texStorage2D(n.TEXTURE_2D,xe,qe,ie.width,ie.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ke,Qe,ie)):t.texImage2D(n.TEXTURE_2D,0,qe,Ke,Qe,ie);b(C,st)&&T(fe),We.__version=ge.version,C.onUpdate&&C.onUpdate(C)}D.__version=C.version}function $e(D,C,$,fe,ce,ge){const We=s.convert($.format,$.colorSpace),_e=s.convert($.type),Ie=S($.internalFormat,We,_e,$.colorSpace);if(!r.get(C).__hasExternalTextures){const ye=Math.max(1,C.width>>ge),ie=Math.max(1,C.height>>ge);ce===n.TEXTURE_3D||ce===n.TEXTURE_2D_ARRAY?t.texImage3D(ce,ge,Ie,ye,ie,C.depth,0,We,_e,null):t.texImage2D(ce,ge,Ie,ye,ie,0,We,_e,null)}t.bindFramebuffer(n.FRAMEBUFFER,D),nt(C)?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,fe,ce,r.get($).__webglTexture,0,ke(C)):(ce===n.TEXTURE_2D||ce>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ce<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,fe,ce,r.get($).__webglTexture,ge),t.bindFramebuffer(n.FRAMEBUFFER,null)}function N(D,C,$){if(n.bindRenderbuffer(n.RENDERBUFFER,D),C.depthBuffer&&!C.stencilBuffer){let fe=!0===a?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if($||nt(C)){const ce=C.depthTexture;ce&&ce.isDepthTexture&&(ce.type===Ea?fe=n.DEPTH_COMPONENT32F:ce.type===Pc&&(fe=n.DEPTH_COMPONENT24));const ge=ke(C);nt(C)?d.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ge,fe,C.width,C.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,ge,fe,C.width,C.height)}else n.renderbufferStorage(n.RENDERBUFFER,fe,C.width,C.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,D)}else if(C.depthBuffer&&C.stencilBuffer){const fe=ke(C);$&&!1===nt(C)?n.renderbufferStorageMultisample(n.RENDERBUFFER,fe,n.DEPTH24_STENCIL8,C.width,C.height):nt(C)?d.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,fe,n.DEPTH24_STENCIL8,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,C.width,C.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,D)}else{const fe=!0===C.isWebGLMultipleRenderTargets?C.texture:[C.texture];for(let ce=0;ce<fe.length;ce++){const ge=fe[ce],We=s.convert(ge.format,ge.colorSpace),_e=s.convert(ge.type),Ie=S(ge.internalFormat,We,_e,ge.colorSpace),L=ke(C);$&&!1===nt(C)?n.renderbufferStorageMultisample(n.RENDERBUFFER,L,Ie,C.width,C.height):nt(C)?d.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,L,Ie,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,Ie,C.width,C.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function te(D){const C=r.get(D),$=!0===D.isWebGLCubeRenderTarget;if(D.depthTexture&&!C.__autoAllocateDepthBuffer){if($)throw new Error("target.depthTexture not supported in Cube render targets");!function we(D,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,D),!C.depthTexture||!C.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),ee(C.depthTexture,0);const fe=r.get(C.depthTexture).__webglTexture,ce=ke(C);if(C.depthTexture.format===Yl)nt(C)?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,fe,0,ce):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,fe,0);else{if(C.depthTexture.format!==Yd)throw new Error("Unknown depthTexture format");nt(C)?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,fe,0,ce):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,fe,0)}}(C.__webglFramebuffer,D)}else if($){C.__webglDepthbuffer=[];for(let fe=0;fe<6;fe++)t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer[fe]),C.__webglDepthbuffer[fe]=n.createRenderbuffer(),N(C.__webglDepthbuffer[fe],D,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer),C.__webglDepthbuffer=n.createRenderbuffer(),N(C.__webglDepthbuffer,D,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function ke(D){return Math.min(h,D.samples)}function nt(D){const C=r.get(D);return a&&D.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==C.__useRenderToTexture}function An(D,C){const $=D.colorSpace,fe=D.format,ce=D.type;return!0===D.isCompressedTexture||!0===D.isVideoTexture||1035===D.format||$!==Sr&&""!==$&&($t.getTransfer($)===wn?!1===a?!0===e.has("EXT_sRGB")&&fe===Ms?(D.format=1035,D.minFilter=Sn,D.generateMipmaps=!1):C=DW.sRGBToLinear(C):(fe!==Ms||ce!==Rc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",$)),C}this.allocateTextureUnit=function ne(){const D=B;return D>=c&&console.warn("THREE.WebGLTextures: Trying to use "+D+" texture units while this GPU supports only "+c),B+=1,D},this.resetTextureUnits=function W(){B=0},this.setTexture2D=ee,this.setTexture2DArray=function F(D,C){const $=r.get(D);D.version>0&&$.__version!==D.version?At($,D,C):t.bindTexture(n.TEXTURE_2D_ARRAY,$.__webglTexture,n.TEXTURE0+C)},this.setTexture3D=function X(D,C){const $=r.get(D);D.version>0&&$.__version!==D.version?At($,D,C):t.bindTexture(n.TEXTURE_3D,$.__webglTexture,n.TEXTURE0+C)},this.setTextureCube=function ue(D,C){const $=r.get(D);D.version>0&&$.__version!==D.version?function _t(D,C,$){if(6!==C.image.length)return;const fe=Fe(D,C),ce=C.source;t.bindTexture(n.TEXTURE_CUBE_MAP,D.__webglTexture,n.TEXTURE0+$);const ge=r.get(ce);if(ce.version!==ge.__version||!0===fe){t.activeTexture(n.TEXTURE0+$);const We=$t.getPrimaries($t.workingColorSpace),_e=""===C.colorSpace?null:$t.getPrimaries(C.colorSpace),Ie=""===C.colorSpace||We===_e?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ie);const L=C.isCompressedTexture||C.image[0].isCompressedTexture,ye=C.image[0]&&C.image[0].isDataTexture,ie=[];for(let ae=0;ae<6;ae++)ie[ae]=L||ye?ye?C.image[ae].image:C.image[ae]:v(C.image[ae],!1,!0,l),ie[ae]=An(C,ie[ae]);const st=ie[0],Ke=w(st)||a,Qe=s.convert(C.format,C.colorSpace),qe=s.convert(C.type),P=S(C.internalFormat,Qe,qe,C.colorSpace),Ee=a&&!0!==C.isVideoTexture,ve=void 0===ge.__version||!0===fe;let xe,Me=x(C,st,Ke);if(Ue(n.TEXTURE_CUBE_MAP,C,Ke),L){Ee&&ve&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Me,P,st.width,st.height);for(let ae=0;ae<6;ae++){xe=ie[ae].mipmaps;for(let He=0;He<xe.length;He++){const at=xe[He];C.format!==Ms?null!==Qe?Ee?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He,0,0,at.width,at.height,Qe,at.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He,P,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ee?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He,0,0,at.width,at.height,Qe,qe,at.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He,P,at.width,at.height,0,Qe,qe,at.data)}}}else{xe=C.mipmaps,Ee&&ve&&(xe.length>0&&Me++,t.texStorage2D(n.TEXTURE_CUBE_MAP,Me,P,ie[0].width,ie[0].height));for(let ae=0;ae<6;ae++)if(ye){Ee?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,0,0,ie[ae].width,ie[ae].height,Qe,qe,ie[ae].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,P,ie[ae].width,ie[ae].height,0,Qe,qe,ie[ae].data);for(let He=0;He<xe.length;He++){const sr=xe[He].image[ae].image;Ee?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He+1,0,0,sr.width,sr.height,Qe,qe,sr.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He+1,P,sr.width,sr.height,0,Qe,qe,sr.data)}}else{Ee?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,0,0,Qe,qe,ie[ae]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,P,Qe,qe,ie[ae]);for(let He=0;He<xe.length;He++){const at=xe[He];Ee?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He+1,0,0,Qe,qe,at.image[ae]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,He+1,P,Qe,qe,at.image[ae])}}}b(C,Ke)&&T(n.TEXTURE_CUBE_MAP),ge.__version=ce.version,C.onUpdate&&C.onUpdate(C)}D.__version=C.version}($,D,C):t.bindTexture(n.TEXTURE_CUBE_MAP,$.__webglTexture,n.TEXTURE0+C)},this.rebindTextures=function me(D,C,$){const fe=r.get(D);void 0!==C&&$e(fe.__webglFramebuffer,D,D.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),void 0!==$&&te(D)},this.setupRenderTarget=function oe(D){const C=D.texture,$=r.get(D),fe=r.get(C);D.addEventListener("dispose",U),!0!==D.isWebGLMultipleRenderTargets&&(void 0===fe.__webglTexture&&(fe.__webglTexture=n.createTexture()),fe.__version=C.version,o.memory.textures++);const ce=!0===D.isWebGLCubeRenderTarget,ge=!0===D.isWebGLMultipleRenderTargets,We=w(D)||a;if(ce){$.__webglFramebuffer=[];for(let _e=0;_e<6;_e++)if(a&&C.mipmaps&&C.mipmaps.length>0){$.__webglFramebuffer[_e]=[];for(let Ie=0;Ie<C.mipmaps.length;Ie++)$.__webglFramebuffer[_e][Ie]=n.createFramebuffer()}else $.__webglFramebuffer[_e]=n.createFramebuffer()}else{if(a&&C.mipmaps&&C.mipmaps.length>0){$.__webglFramebuffer=[];for(let _e=0;_e<C.mipmaps.length;_e++)$.__webglFramebuffer[_e]=n.createFramebuffer()}else $.__webglFramebuffer=n.createFramebuffer();if(ge)if(i.drawBuffers){const _e=D.texture;for(let Ie=0,L=_e.length;Ie<L;Ie++){const ye=r.get(_e[Ie]);void 0===ye.__webglTexture&&(ye.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&D.samples>0&&!1===nt(D)){const _e=ge?C:[C];$.__webglMultisampledFramebuffer=n.createFramebuffer(),$.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,$.__webglMultisampledFramebuffer);for(let Ie=0;Ie<_e.length;Ie++){const L=_e[Ie];$.__webglColorRenderbuffer[Ie]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,$.__webglColorRenderbuffer[Ie]);const ye=s.convert(L.format,L.colorSpace),ie=s.convert(L.type),st=S(L.internalFormat,ye,ie,L.colorSpace,!0===D.isXRRenderTarget),Ke=ke(D);n.renderbufferStorageMultisample(n.RENDERBUFFER,Ke,st,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ie,n.RENDERBUFFER,$.__webglColorRenderbuffer[Ie])}n.bindRenderbuffer(n.RENDERBUFFER,null),D.depthBuffer&&($.__webglDepthRenderbuffer=n.createRenderbuffer(),N($.__webglDepthRenderbuffer,D,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ce){t.bindTexture(n.TEXTURE_CUBE_MAP,fe.__webglTexture),Ue(n.TEXTURE_CUBE_MAP,C,We);for(let _e=0;_e<6;_e++)if(a&&C.mipmaps&&C.mipmaps.length>0)for(let Ie=0;Ie<C.mipmaps.length;Ie++)$e($.__webglFramebuffer[_e][Ie],D,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ie);else $e($.__webglFramebuffer[_e],D,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0);b(C,We)&&T(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ge){const _e=D.texture;for(let Ie=0,L=_e.length;Ie<L;Ie++){const ye=_e[Ie],ie=r.get(ye);t.bindTexture(n.TEXTURE_2D,ie.__webglTexture),Ue(n.TEXTURE_2D,ye,We),$e($.__webglFramebuffer,D,ye,n.COLOR_ATTACHMENT0+Ie,n.TEXTURE_2D,0),b(ye,We)&&T(n.TEXTURE_2D)}t.unbindTexture()}else{let _e=n.TEXTURE_2D;if((D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(a?_e=D.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(_e,fe.__webglTexture),Ue(_e,C,We),a&&C.mipmaps&&C.mipmaps.length>0)for(let Ie=0;Ie<C.mipmaps.length;Ie++)$e($.__webglFramebuffer[Ie],D,C,n.COLOR_ATTACHMENT0,_e,Ie);else $e($.__webglFramebuffer,D,C,n.COLOR_ATTACHMENT0,_e,0);b(C,We)&&T(_e),t.unbindTexture()}D.depthBuffer&&te(D)},this.updateRenderTargetMipmap=function Ye(D){const C=w(D)||a,$=!0===D.isWebGLMultipleRenderTargets?D.texture:[D.texture];for(let fe=0,ce=$.length;fe<ce;fe++){const ge=$[fe];if(b(ge,C)){const We=D.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,_e=r.get(ge).__webglTexture;t.bindTexture(We,_e),T(We),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Ne(D){if(a&&D.samples>0&&!1===nt(D)){const C=D.isWebGLMultipleRenderTargets?D.texture:[D.texture],$=D.width,fe=D.height;let ce=n.COLOR_BUFFER_BIT;const ge=[],We=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,_e=r.get(D),Ie=!0===D.isWebGLMultipleRenderTargets;if(Ie)for(let L=0;L<C.length;L++)t.bindFramebuffer(n.FRAMEBUFFER,_e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+L,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,_e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+L,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,_e.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,_e.__webglFramebuffer);for(let L=0;L<C.length;L++){ge.push(n.COLOR_ATTACHMENT0+L),D.depthBuffer&&ge.push(We);const ye=void 0!==_e.__ignoreDepthValues&&_e.__ignoreDepthValues;if(!1===ye&&(D.depthBuffer&&(ce|=n.DEPTH_BUFFER_BIT),D.stencilBuffer&&(ce|=n.STENCIL_BUFFER_BIT)),Ie&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,_e.__webglColorRenderbuffer[L]),!0===ye&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[We]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[We])),Ie){const ie=r.get(C[L]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ie,0)}n.blitFramebuffer(0,0,$,fe,0,0,$,fe,ce,n.NEAREST),f&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,ge)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ie)for(let L=0;L<C.length;L++){t.bindFramebuffer(n.FRAMEBUFFER,_e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+L,n.RENDERBUFFER,_e.__webglColorRenderbuffer[L]);const ye=r.get(C[L]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,_e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+L,n.TEXTURE_2D,ye,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,_e.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=$e,this.useMultisampledRTT=nt}function lwe(n,e,t){const r=t.isWebGL2;return{convert:function i(s,o=""){let a;const c=$t.getTransfer(o);if(s===Rc)return n.UNSIGNED_BYTE;if(1017===s)return n.UNSIGNED_SHORT_4_4_4_4;if(1018===s)return n.UNSIGNED_SHORT_5_5_5_1;if(1010===s)return n.BYTE;if(1011===s)return n.SHORT;if(1012===s)return n.UNSIGNED_SHORT;if(1013===s)return n.INT;if(s===Pc)return n.UNSIGNED_INT;if(s===Ea)return n.FLOAT;if(s===Yg)return r?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return n.ALPHA;if(s===Ms)return n.RGBA;if(1024===s)return n.LUMINANCE;if(1025===s)return n.LUMINANCE_ALPHA;if(s===Yl)return n.DEPTH_COMPONENT;if(s===Yd)return n.DEPTH_STENCIL;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===s)return n.RED;if(1029===s)return n.RED_INTEGER;if(1030===s)return n.RG;if(1031===s)return n.RG_INTEGER;if(1033===s)return n.RGBA_INTEGER;if(33776===s||33777===s||33778===s||33779===s)if(c===wn){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return c===wn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return c===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s||36494===s||36495===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return c===wn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===s)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===s)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===s||36284===s||36285===s||36286===s){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(36492===s)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===s)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===s)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===s)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===Xl?r?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class uwe extends Cr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Js extends Kn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const hwe={type:"move"};class XD{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Js,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Js,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new M,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new M),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Js,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new M,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new M),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const m of e.hand.values()){const _=t.getJointPose(m,r),g=this._getHandJoint(l,m);null!==_&&(g.matrix.fromArray(_.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=_.radius),g.visible=null!==_}const d=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),f=.02,p=.005;l.inputState.pinching&&d>f+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=f-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),null!==s&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,r),null===i&&null!==s&&(i=s),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(hwe)))}return null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==s),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const r=new Js;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class dwe extends Ds{constructor(e,t,r,i,s,o,a,c,l,u){if((u=void 0!==u?u:Yl)!==Yl&&u!==Yd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===Yl&&(r=Pc),void 0===r&&u===Yd&&(r=Xl),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Yn,this.minFilter=void 0!==c?c:Yn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class fwe extends Zl{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,d=null,f=null,p=null;const m=t.getContextAttributes();let _=null,g=null;const y=[],v=[],w=new Cr;w.layers.enable(1),w.viewport=new en;const E=new Cr;E.layers.enable(2),E.viewport=new en;const b=[w,E],T=new uwe;T.layers.enable(1),T.layers.enable(2);let S=null,x=null;function A(F){const X=v.indexOf(F.inputSource);if(-1===X)return;const ue=y[X];void 0!==ue&&(ue.update(F.inputSource,F.frame,l||o),ue.dispatchEvent({type:F.type,data:F.inputSource}))}function O(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",O),i.removeEventListener("inputsourceschange",U);for(let F=0;F<y.length;F++){const X=v[F];null!==X&&(v[F]=null,y[F].disconnect(X))}S=null,x=null,e.setRenderTarget(_),f=null,d=null,h=null,i=null,g=null,ee.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function U(F){for(let X=0;X<F.removed.length;X++){const ue=F.removed[X],le=v.indexOf(ue);le>=0&&(v[le]=null,y[le].disconnect(ue))}for(let X=0;X<F.added.length;X++){const ue=F.added[X];let le=v.indexOf(ue);if(-1===le){for(let Re=0;Re<y.length;Re++){if(Re>=v.length){v.push(ue),le=Re;break}if(null===v[Re]){v[Re]=ue,le=Re;break}}if(-1===le)break}const de=y[le];de&&de.connect(ue)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(F){let X=y[F];return void 0===X&&(X=new XD,y[F]=X),X.getTargetRaySpace()},this.getControllerGrip=function(F){let X=y[F];return void 0===X&&(X=new XD,y[F]=X),X.getGripSpace()},this.getHand=function(F){let X=y[F];return void 0===X&&(X=new XD,y[F]=X),X.getHandSpace()},this.setFramebufferScaleFactor=function(F){s=F,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(F){a=F,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(F){l=F},this.getBaseLayer=function(){return null!==d?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=function(){var F=Pe(function*(X){if(i=X,null!==i){if(_=e.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",O),i.addEventListener("inputsourceschange",U),!0!==m.xrCompatible&&(yield t.makeXRCompatible()),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2)f=new XRWebGLLayer(i,t,{antialias:void 0!==i.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s}),i.updateRenderState({baseLayer:f}),g=new eu(f.framebufferWidth,f.framebufferHeight,{format:Ms,type:Rc,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil});else{let ue=null,le=null,de=null;m.depth&&(de=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ue=m.stencil?Yd:Yl,le=m.stencil?Xl:Pc);const Re={colorFormat:t.RGBA8,depthFormat:de,scaleFactor:s};h=new XRWebGLBinding(i,t),d=h.createProjectionLayer(Re),i.updateRenderState({layers:[d]}),g=new eu(d.textureWidth,d.textureHeight,{format:Ms,type:Rc,depthTexture:new dwe(d.textureWidth,d.textureHeight,le,void 0,void 0,void 0,void 0,void 0,void 0,ue),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield i.requestReferenceSpace(a),ee.setContext(i),ee.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}});return function(X){return F.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const H=new M,R=new M;function B(F,X){null===X?F.matrixWorld.copy(F.matrix):F.matrixWorld.multiplyMatrices(X.matrixWorld,F.matrix),F.matrixWorldInverse.copy(F.matrixWorld).invert()}this.updateCamera=function(F){if(null===i)return;T.near=E.near=w.near=F.near,T.far=E.far=w.far=F.far,(S!==T.near||x!==T.far)&&(i.updateRenderState({depthNear:T.near,depthFar:T.far}),S=T.near,x=T.far);const X=F.parent,ue=T.cameras;B(T,X);for(let le=0;le<ue.length;le++)B(ue[le],X);2===ue.length?function k(F,X,ue){H.setFromMatrixPosition(X.matrixWorld),R.setFromMatrixPosition(ue.matrixWorld);const le=H.distanceTo(R),de=X.projectionMatrix.elements,Re=ue.projectionMatrix.elements,Ue=de[14]/(de[10]-1),Fe=de[14]/(de[10]+1),At=(de[9]+1)/de[5],_t=(de[9]-1)/de[5],$e=(de[8]-1)/de[0],N=(Re[8]+1)/Re[0],we=Ue*$e,te=Ue*N,me=le/(-$e+N),oe=me*-$e;X.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.translateX(oe),F.translateZ(me),F.matrixWorld.compose(F.position,F.quaternion,F.scale),F.matrixWorldInverse.copy(F.matrixWorld).invert();const Ye=Ue+me,Ne=Fe+me;F.projectionMatrix.makePerspective(we-oe,te+(le-oe),At*Fe/Ne*Ye,_t*Fe/Ne*Ye,Ye,Ne),F.projectionMatrixInverse.copy(F.projectionMatrix).invert()}(T,w,E):T.projectionMatrix.copy(w.projectionMatrix),function W(F,X,ue){null===ue?F.matrix.copy(X.matrixWorld):(F.matrix.copy(ue.matrixWorld),F.matrix.invert(),F.matrix.multiply(X.matrixWorld)),F.matrix.decompose(F.position,F.quaternion,F.scale),F.updateMatrixWorld(!0),F.projectionMatrix.copy(X.projectionMatrix),F.projectionMatrixInverse.copy(X.projectionMatrixInverse),F.isPerspectiveCamera&&(F.fov=2*Jd*Math.atan(1/F.projectionMatrix.elements[5]),F.zoom=1)}(F,T,X)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==d||null!==f)return c},this.setFoveation=function(F){c=F,null!==d&&(d.fixedFoveation=F),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=F)};let ne=null;const ee=new YW;ee.setAnimationLoop(function q(F,X){if(u=X.getViewerPose(l||o),p=X,null!==u){const ue=u.views;null!==f&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let le=!1;ue.length!==T.cameras.length&&(T.cameras.length=0,le=!0);for(let de=0;de<ue.length;de++){const Re=ue[de];let Ue=null;if(null!==f)Ue=f.getViewport(Re);else{const At=h.getViewSubImage(d,Re);Ue=At.viewport,0===de&&(e.setRenderTargetTextures(g,At.colorTexture,d.ignoreDepthValues?void 0:At.depthStencilTexture),e.setRenderTarget(g))}let Fe=b[de];void 0===Fe&&(Fe=new Cr,Fe.layers.enable(de),Fe.viewport=new en,b[de]=Fe),Fe.matrix.fromArray(Re.transform.matrix),Fe.matrix.decompose(Fe.position,Fe.quaternion,Fe.scale),Fe.projectionMatrix.fromArray(Re.projectionMatrix),Fe.projectionMatrixInverse.copy(Fe.projectionMatrix).invert(),Fe.viewport.set(Ue.x,Ue.y,Ue.width,Ue.height),0===de&&(T.matrix.copy(Fe.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===le&&T.cameras.push(Fe)}}for(let ue=0;ue<y.length;ue++){const le=v[ue],de=y[ue];null!==le&&void 0!==de&&de.update(le,X,l||o)}ne&&ne(F,X),X.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:X}),p=null}),this.setAnimationLoop=function(F){ne=F},this.dispose=function(){}}}function pwe(n,e){function t(_,g){!0===_.matrixAutoUpdate&&_.updateMatrix(),g.value.copy(_.matrix)}function s(_,g){_.opacity.value=g.opacity,g.color&&_.diffuse.value.copy(g.color),g.emissive&&_.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(_.map.value=g.map,t(g.map,_.mapTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.bumpMap&&(_.bumpMap.value=g.bumpMap,t(g.bumpMap,_.bumpMapTransform),_.bumpScale.value=g.bumpScale,1===g.side&&(_.bumpScale.value*=-1)),g.normalMap&&(_.normalMap.value=g.normalMap,t(g.normalMap,_.normalMapTransform),_.normalScale.value.copy(g.normalScale),1===g.side&&_.normalScale.value.negate()),g.displacementMap&&(_.displacementMap.value=g.displacementMap,t(g.displacementMap,_.displacementMapTransform),_.displacementScale.value=g.displacementScale,_.displacementBias.value=g.displacementBias),g.emissiveMap&&(_.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,_.emissiveMapTransform)),g.specularMap&&(_.specularMap.value=g.specularMap,t(g.specularMap,_.specularMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest);const y=e.get(g).envMap;if(y&&(_.envMap.value=y,_.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,_.reflectivity.value=g.reflectivity,_.ior.value=g.ior,_.refractionRatio.value=g.refractionRatio),g.lightMap){_.lightMap.value=g.lightMap;const v=!0===n._useLegacyLights?Math.PI:1;_.lightMapIntensity.value=g.lightMapIntensity*v,t(g.lightMap,_.lightMapTransform)}g.aoMap&&(_.aoMap.value=g.aoMap,_.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,_.aoMapTransform))}return{refreshFogUniforms:function r(_,g){g.color.getRGB(_.fogColor.value,XW(n)),g.isFog?(_.fogNear.value=g.near,_.fogFar.value=g.far):g.isFogExp2&&(_.fogDensity.value=g.density)},refreshMaterialUniforms:function i(_,g,y,v,w){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(_,g):g.isMeshToonMaterial?(s(_,g),function h(_,g){g.gradientMap&&(_.gradientMap.value=g.gradientMap)}(_,g)):g.isMeshPhongMaterial?(s(_,g),function u(_,g){_.specular.value.copy(g.specular),_.shininess.value=Math.max(g.shininess,1e-4)}(_,g)):g.isMeshStandardMaterial?(s(_,g),function d(_,g){_.metalness.value=g.metalness,g.metalnessMap&&(_.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,_.metalnessMapTransform)),_.roughness.value=g.roughness,g.roughnessMap&&(_.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,_.roughnessMapTransform)),e.get(g).envMap&&(_.envMapIntensity.value=g.envMapIntensity)}(_,g),g.isMeshPhysicalMaterial&&function f(_,g,y){_.ior.value=g.ior,g.sheen>0&&(_.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),_.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(_.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,_.sheenColorMapTransform)),g.sheenRoughnessMap&&(_.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,_.sheenRoughnessMapTransform))),g.clearcoat>0&&(_.clearcoat.value=g.clearcoat,_.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(_.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,_.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(_.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),1===g.side&&_.clearcoatNormalScale.value.negate())),g.iridescence>0&&(_.iridescence.value=g.iridescence,_.iridescenceIOR.value=g.iridescenceIOR,_.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(_.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,_.iridescenceMapTransform)),g.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),g.transmission>0&&(_.transmission.value=g.transmission,_.transmissionSamplerMap.value=y.texture,_.transmissionSamplerSize.value.set(y.width,y.height),g.transmissionMap&&(_.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,_.transmissionMapTransform)),_.thickness.value=g.thickness,g.thicknessMap&&(_.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=g.attenuationDistance,_.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(_.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(_.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=g.specularIntensity,_.specularColor.value.copy(g.specularColor),g.specularColorMap&&(_.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,_.specularColorMapTransform)),g.specularIntensityMap&&(_.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,_.specularIntensityMapTransform))}(_,g,w)):g.isMeshMatcapMaterial?(s(_,g),function p(_,g){g.matcap&&(_.matcap.value=g.matcap)}(_,g)):g.isMeshDepthMaterial?s(_,g):g.isMeshDistanceMaterial?(s(_,g),function m(_,g){const y=e.get(g).light;_.referencePosition.value.setFromMatrixPosition(y.matrixWorld),_.nearDistance.value=y.shadow.camera.near,_.farDistance.value=y.shadow.camera.far}(_,g)):g.isMeshNormalMaterial?s(_,g):g.isLineBasicMaterial?(function o(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,g.map&&(_.map.value=g.map,t(g.map,_.mapTransform))}(_,g),g.isLineDashedMaterial&&function a(_,g){_.dashSize.value=g.dashSize,_.totalSize.value=g.dashSize+g.gapSize,_.scale.value=g.scale}(_,g)):g.isPointsMaterial?function c(_,g,y,v){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.size.value=g.size*y,_.scale.value=.5*v,g.map&&(_.map.value=g.map,t(g.map,_.uvTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest)}(_,g,y,v):g.isSpriteMaterial?function l(_,g){_.diffuse.value.copy(g.color),_.opacity.value=g.opacity,_.rotation.value=g.rotation,g.map&&(_.map.value=g.map,t(g.map,_.mapTransform)),g.alphaMap&&(_.alphaMap.value=g.alphaMap,t(g.alphaMap,_.alphaMapTransform)),g.alphaTest>0&&(_.alphaTest.value=g.alphaTest)}(_,g):g.isShadowMaterial?(_.color.value.copy(g.color),_.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function mwe(n,e,t,r){let i={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function f(y,v,w){const E=y.value;if(void 0===w[v]){if("number"==typeof E)w[v]=E;else{const b=Array.isArray(E)?E:[E],T=[];for(let S=0;S<b.length;S++)T.push(b[S].clone());w[v]=T}return!0}if("number"==typeof E){if(w[v]!==E)return w[v]=E,!0}else{const b=Array.isArray(w[v])?w[v]:[w[v]],T=Array.isArray(E)?E:[E];for(let S=0;S<b.length;S++){const x=b[S];if(!1===x.equals(T[S]))return x.copy(T[S]),!0}}return!1}function m(y){const v={boundary:0,storage:0};return"number"==typeof y?(v.boundary=4,v.storage=4):y.isVector2?(v.boundary=8,v.storage=8):y.isVector3||y.isColor?(v.boundary=16,v.storage=12):y.isVector4?(v.boundary=16,v.storage=16):y.isMatrix3?(v.boundary=48,v.storage=48):y.isMatrix4?(v.boundary=64,v.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),v}function _(y){const v=y.target;v.removeEventListener("dispose",_);const w=o.indexOf(v.__bindingPointIndex);o.splice(w,1),n.deleteBuffer(i[v.id]),delete i[v.id],delete s[v.id]}return{bind:function c(y,v){r.uniformBlockBinding(y,v.program)},update:function l(y,v){let w=i[y.id];void 0===w&&(function p(y){const v=y.uniforms;let w=0;let b=0;for(let T=0,S=v.length;T<S;T++){const x=v[T],A={boundary:0,storage:0},O=Array.isArray(x.value)?x.value:[x.value];for(let U=0,H=O.length;U<H;U++){const k=m(O[U]);A.boundary+=k.boundary,A.storage+=k.storage}x.__data=new Float32Array(A.storage/Float32Array.BYTES_PER_ELEMENT),x.__offset=w,T>0&&(b=w%16,0!==b&&16-b-A.boundary<0&&(w+=16-b,x.__offset=w)),w+=A.storage}b=w%16,b>0&&(w+=16-b),y.__size=w,y.__cache={}}(y),w=function u(y){const v=function h(){for(let y=0;y<a;y++)if(-1===o.indexOf(y))return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();y.__bindingPointIndex=v;const w=n.createBuffer(),E=y.__size,b=y.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,E,b),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,v,w),w}(y),i[y.id]=w,y.addEventListener("dispose",_)),r.updateUBOMapping(y,v.program);const b=e.render.frame;s[y.id]!==b&&(function d(y){const w=y.uniforms,E=y.__cache;n.bindBuffer(n.UNIFORM_BUFFER,i[y.id]);for(let b=0,T=w.length;b<T;b++){const S=w[b];if(!0===f(S,b,E)){const x=S.__offset,A=Array.isArray(S.value)?S.value:[S.value];let O=0;for(let U=0;U<A.length;U++){const H=A[U],R=m(H);"number"==typeof H?(S.__data[0]=H,n.bufferSubData(n.UNIFORM_BUFFER,x+O,S.__data)):H.isMatrix3?(S.__data[0]=H.elements[0],S.__data[1]=H.elements[1],S.__data[2]=H.elements[2],S.__data[3]=H.elements[0],S.__data[4]=H.elements[3],S.__data[5]=H.elements[4],S.__data[6]=H.elements[5],S.__data[7]=H.elements[0],S.__data[8]=H.elements[6],S.__data[9]=H.elements[7],S.__data[10]=H.elements[8],S.__data[11]=H.elements[0]):(H.toArray(S.__data,O),O+=R.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,x,S.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(y),s[y.id]=b)},dispose:function g(){for(const y in i)n.deleteBuffer(i[y]);o=[],i={},s={}}}}class T${constructor(e={}){const{canvas:t=Yge(),context:r=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==r?r.getContextAttributes().alpha:o;const f=new Uint32Array(4),p=new Int32Array(4);let m=null,_=null;const g=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=an,this._useLegacyLights=!1,this.toneMapping=va,this.toneMappingExposure=1;const v=this;let w=!1,E=0,b=0,T=null,S=-1,x=null;const A=new en,O=new en;let U=null;const H=new J(0);let R=0,k=t.width,B=t.height,W=1,ne=null,q=null;const ee=new en(0,0,k,B),F=new en(0,0,k,B);let X=!1;const ue=new HD;let le=!1,de=!1,Re=null;const Ue=new tt,Fe=new Z,At=new M,_t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $e(){return null===T?W:1}let te,me,oe,Ye,Ne,ke,nt,It,An,D,C,$,fe,ce,ge,We,_e,Ie,L,ye,ie,st,Ke,Qe,N=r;function we(I,z){for(let K=0;K<I.length;K++){const Q=t.getContext(I[K],z);if(null!==Q)return Q}return null}try{const I={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r157"),t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",ve,!1),t.addEventListener("webglcontextcreationerror",Me,!1),null===N){const z=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&z.shift(),N=we(z,I),null===N)throw we(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&N instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===N.getShaderPrecisionFormat&&(N.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}function qe(){te=new Mve(N),me=new xve(N,te,e),te.init(me),st=new lwe(N,te,me),oe=new awe(N,te,me),Ye=new Rve(N),Ne=new Y0e,ke=new cwe(N,te,oe,Ne,me,st,Ye),nt=new Tve(v),It=new Cve(v),An=new E_e(N,me),Ke=new wve(N,te,An,me),D=new Ive(N,An,Ye,Ke),C=new Ove(N,D,An,Ye),L=new Lve(N,me,ke),We=new bve(Ne),$=new X0e(v,nt,It,te,me,Ke,We),fe=new pwe(v,Ne),ce=new Q0e,ge=new rwe(te,me),Ie=new vve(v,nt,It,oe,C,d,c),_e=new owe(v,C,me),Qe=new mwe(N,Ye,me,oe),ye=new Eve(N,te,Ye,me),ie=new Dve(N,te,Ye,me),Ye.programs=$.programs,v.capabilities=me,v.extensions=te,v.properties=Ne,v.renderLists=ce,v.shadowMap=_e,v.state=oe,v.info=Ye}qe();const P=new fwe(v,N);function Ee(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const I=Ye.autoReset,z=_e.enabled,K=_e.autoUpdate,j=_e.needsUpdate,Q=_e.type;qe(),Ye.autoReset=I,_e.enabled=z,_e.autoUpdate=K,_e.needsUpdate=j,_e.type=Q}function Me(I){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",I.statusMessage)}function xe(I){const z=I.target;z.removeEventListener("dispose",xe),function ae(I){(function He(I){const z=Ne.get(I).programs;void 0!==z&&(z.forEach(function(K){$.releaseProgram(K)}),I.isShaderMaterial&&$.releaseShaderCache(I))})(I),Ne.remove(I)}(z)}this.xr=P,this.getContext=function(){return N},this.getContextAttributes=function(){return N.getContextAttributes()},this.forceContextLoss=function(){const I=te.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){const I=te.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(I){void 0!==I&&(W=I,this.setSize(k,B,!1))},this.getSize=function(I){return I.set(k,B)},this.setSize=function(I,z,K=!0){P.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=I,B=z,t.width=Math.floor(I*W),t.height=Math.floor(z*W),!0===K&&(t.style.width=I+"px",t.style.height=z+"px"),this.setViewport(0,0,I,z))},this.getDrawingBufferSize=function(I){return I.set(k*W,B*W).floor()},this.setDrawingBufferSize=function(I,z,K){k=I,B=z,W=K,t.width=Math.floor(I*K),t.height=Math.floor(z*K),this.setViewport(0,0,I,z)},this.getCurrentViewport=function(I){return I.copy(A)},this.getViewport=function(I){return I.copy(ee)},this.setViewport=function(I,z,K,j){I.isVector4?ee.set(I.x,I.y,I.z,I.w):ee.set(I,z,K,j),oe.viewport(A.copy(ee).multiplyScalar(W).floor())},this.getScissor=function(I){return I.copy(F)},this.setScissor=function(I,z,K,j){I.isVector4?F.set(I.x,I.y,I.z,I.w):F.set(I,z,K,j),oe.scissor(O.copy(F).multiplyScalar(W).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(I){oe.setScissorTest(X=I)},this.setOpaqueSort=function(I){ne=I},this.setTransparentSort=function(I){q=I},this.getClearColor=function(I){return I.copy(Ie.getClearColor())},this.setClearColor=function(){Ie.setClearColor.apply(Ie,arguments)},this.getClearAlpha=function(){return Ie.getClearAlpha()},this.setClearAlpha=function(){Ie.setClearAlpha.apply(Ie,arguments)},this.clear=function(I=!0,z=!0,K=!0){let j=0;if(I){let Q=!1;if(null!==T){const Ve=T.texture.format;Q=1033===Ve||1031===Ve||1029===Ve}if(Q){const Ve=T.texture.type,Ze=Ve===Rc||Ve===Pc||1012===Ve||Ve===Xl||1017===Ve||1018===Ve,pt=Ie.getClearColor(),mt=Ie.getClearAlpha(),Dt=pt.r,lt=pt.g,Tt=pt.b;Ze?(f[0]=Dt,f[1]=lt,f[2]=Tt,f[3]=mt,N.clearBufferuiv(N.COLOR,0,f)):(p[0]=Dt,p[1]=lt,p[2]=Tt,p[3]=mt,N.clearBufferiv(N.COLOR,0,p))}else j|=N.COLOR_BUFFER_BIT}z&&(j|=N.DEPTH_BUFFER_BIT),K&&(j|=N.STENCIL_BUFFER_BIT),N.clear(j)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",ve,!1),t.removeEventListener("webglcontextcreationerror",Me,!1),ce.dispose(),ge.dispose(),Ne.dispose(),nt.dispose(),It.dispose(),C.dispose(),Ke.dispose(),Qe.dispose(),$.dispose(),P.dispose(),P.removeEventListener("sessionstart",xn),P.removeEventListener("sessionend",Go),Re&&(Re.dispose(),Re=null),Ei.stop()},this.renderBufferDirect=function(I,z,K,j,Q,Ve){null===z&&(z=_t);const Ze=Q.isMesh&&Q.matrixWorld.determinant()<0,pt=function Dbe(I,z,K,j,Q){!0!==z.isScene&&(z=_t),ke.resetTextureUnits();const Ve=z.fog,pt=null===T?v.outputColorSpace:!0===T.isXRRenderTarget?T.texture.colorSpace:Sr,mt=(j.isMeshStandardMaterial?It:nt).get(j.envMap||(j.isMeshStandardMaterial?z.environment:null)),Dt=!0===j.vertexColors&&!!K.attributes.color&&4===K.attributes.color.itemSize,lt=!!K.attributes.tangent&&(!!j.normalMap||j.anisotropy>0),Tt=!!K.morphAttributes.position,zn=!!K.morphAttributes.normal,Zn=!!K.morphAttributes.color;let Ns=va;j.toneMapped&&(null===T||!0===T.isXRRenderTarget)&&(Ns=v.toneMapping);const Oa=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,or=void 0!==Oa?Oa.length:0,Lt=Ne.get(j),vP=_.state.lights;!0!==le||!0!==de&&I===x||We.setState(j,I,I===x&&j.id===S);let ar=!1;j.version===Lt.__version?(Lt.needsLights&&Lt.lightsStateVersion!==vP.state.version||Lt.outputColorSpace!==pt||Q.isInstancedMesh&&!1===Lt.instancing||!Q.isInstancedMesh&&!0===Lt.instancing||Q.isSkinnedMesh&&!1===Lt.skinning||!Q.isSkinnedMesh&&!0===Lt.skinning||Q.isInstancedMesh&&!0===Lt.instancingColor&&null===Q.instanceColor||Q.isInstancedMesh&&!1===Lt.instancingColor&&null!==Q.instanceColor||Lt.envMap!==mt||!0===j.fog&&Lt.fog!==Ve||void 0!==Lt.numClippingPlanes&&(Lt.numClippingPlanes!==We.numPlanes||Lt.numIntersection!==We.numIntersection)||Lt.vertexAlphas!==Dt||Lt.vertexTangents!==lt||Lt.morphTargets!==Tt||Lt.morphNormals!==zn||Lt.morphColors!==Zn||Lt.toneMapping!==Ns||!0===me.isWebGL2&&Lt.morphTargetsCount!==or)&&(ar=!0):(ar=!0,Lt.__version=j.version);let xu=Lt.currentProgram;!0===ar&&(xu=Ax(j,z,Q));let U8=!1,D_=!1,wP=!1;const xi=xu.getUniforms(),bu=Lt.uniforms;if(oe.useProgram(xu.program)&&(U8=!0,D_=!0,wP=!0),j.id!==S&&(S=j.id,D_=!0),U8||x!==I){xi.setValue(N,"projectionMatrix",I.projectionMatrix),xi.setValue(N,"viewMatrix",I.matrixWorldInverse);const ds=xi.map.cameraPosition;void 0!==ds&&ds.setValue(N,At.setFromMatrixPosition(I.matrixWorld)),me.logarithmicDepthBuffer&&xi.setValue(N,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),(j.isMeshPhongMaterial||j.isMeshToonMaterial||j.isMeshLambertMaterial||j.isMeshBasicMaterial||j.isMeshStandardMaterial||j.isShaderMaterial)&&xi.setValue(N,"isOrthographic",!0===I.isOrthographicCamera),x!==I&&(x=I,D_=!0,wP=!0)}if(Q.isSkinnedMesh){xi.setOptional(N,Q,"bindMatrix"),xi.setOptional(N,Q,"bindMatrixInverse");const ds=Q.skeleton;ds&&(me.floatVertexTextures?(null===ds.boneTexture&&ds.computeBoneTexture(),xi.setValue(N,"boneTexture",ds.boneTexture,ke),xi.setValue(N,"boneTextureSize",ds.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const EP=K.morphAttributes;if((void 0!==EP.position||void 0!==EP.normal||void 0!==EP.color&&!0===me.isWebGL2)&&L.update(Q,K,xu),(D_||Lt.receiveShadow!==Q.receiveShadow)&&(Lt.receiveShadow=Q.receiveShadow,xi.setValue(N,"receiveShadow",Q.receiveShadow)),j.isMeshGouraudMaterial&&null!==j.envMap&&(bu.envMap.value=mt,bu.flipEnvMap.value=mt.isCubeTexture&&!1===mt.isRenderTargetTexture?-1:1),D_&&(xi.setValue(N,"toneMappingExposure",v.toneMappingExposure),Lt.needsLights&&function Rbe(I,z){I.ambientLightColor.needsUpdate=z,I.lightProbe.needsUpdate=z,I.directionalLights.needsUpdate=z,I.directionalLightShadows.needsUpdate=z,I.pointLights.needsUpdate=z,I.pointLightShadows.needsUpdate=z,I.spotLights.needsUpdate=z,I.spotLightShadows.needsUpdate=z,I.rectAreaLights.needsUpdate=z,I.hemisphereLights.needsUpdate=z}(bu,wP),Ve&&!0===j.fog&&fe.refreshFogUniforms(bu,Ve),fe.refreshMaterialUniforms(bu,j,W,B,Re),AE.upload(N,Lt.uniformsList,bu,ke)),j.isShaderMaterial&&!0===j.uniformsNeedUpdate&&(AE.upload(N,Lt.uniformsList,bu,ke),j.uniformsNeedUpdate=!1),j.isSpriteMaterial&&xi.setValue(N,"center",Q.center),xi.setValue(N,"modelViewMatrix",Q.modelViewMatrix),xi.setValue(N,"normalMatrix",Q.normalMatrix),xi.setValue(N,"modelMatrix",Q.matrixWorld),j.isShaderMaterial||j.isRawShaderMaterial){const ds=j.uniformsGroups;for(let xP=0,Nbe=ds.length;xP<Nbe;xP++)if(me.isWebGL2){const B8=ds[xP];Qe.update(B8,xu),Qe.bind(B8,xu)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return xu}(I,z,K,j,Q);oe.setMaterial(j,Ze);let mt=K.index,Dt=1;if(!0===j.wireframe){if(mt=D.getWireframeAttribute(K),void 0===mt)return;Dt=2}const lt=K.drawRange,Tt=K.attributes.position;let zn=lt.start*Dt,Zn=(lt.start+lt.count)*Dt;null!==Ve&&(zn=Math.max(zn,Ve.start*Dt),Zn=Math.min(Zn,(Ve.start+Ve.count)*Dt)),null!==mt?(zn=Math.max(zn,0),Zn=Math.min(Zn,mt.count)):null!=Tt&&(zn=Math.max(zn,0),Zn=Math.min(Zn,Tt.count));const Ns=Zn-zn;if(Ns<0||Ns===1/0)return;Ke.setup(Q,j,pt,K,mt);let Oa,or=ye;if(null!==mt&&(Oa=An.get(mt),or=ie,or.setIndex(Oa)),Q.isMesh)!0===j.wireframe?(oe.setLineWidth(j.wireframeLinewidth*$e()),or.setMode(N.LINES)):or.setMode(N.TRIANGLES);else if(Q.isLine){let Lt=j.linewidth;void 0===Lt&&(Lt=1),oe.setLineWidth(Lt*$e()),or.setMode(Q.isLineSegments?N.LINES:Q.isLineLoop?N.LINE_LOOP:N.LINE_STRIP)}else Q.isPoints?or.setMode(N.POINTS):Q.isSprite&&or.setMode(N.TRIANGLES);if(Q.isInstancedMesh)or.renderInstances(zn,Ns,Q.count);else if(K.isInstancedBufferGeometry){const vP=Math.min(K.instanceCount,void 0!==K._maxInstanceCount?K._maxInstanceCount:1/0);or.renderInstances(zn,Ns,vP)}else or.render(zn,Ns)},this.compile=function(I,z){function K(j,Q,Ve){!0===j.transparent&&2===j.side&&!1===j.forceSinglePass?(j.side=1,j.needsUpdate=!0,Ax(j,Q,Ve),j.side=0,j.needsUpdate=!0,Ax(j,Q,Ve),j.side=2):Ax(j,Q,Ve)}_=ge.get(I),_.init(),y.push(_),I.traverseVisible(function(j){j.isLight&&j.layers.test(z.layers)&&(_.pushLight(j),j.castShadow&&_.pushShadow(j))}),_.setupLights(v._useLegacyLights),I.traverse(function(j){const Q=j.material;if(Q)if(Array.isArray(Q))for(let Ve=0;Ve<Q.length;Ve++)K(Q[Ve],I,j);else K(Q,I,j)}),y.pop(),_=null};let at=null;function xn(){Ei.stop()}function Go(){Ei.start()}const Ei=new YW;function O8(I,z,K,j){if(!1===I.visible)return;if(I.layers.test(z.layers))if(I.isGroup)K=I.renderOrder;else if(I.isLOD)!0===I.autoUpdate&&I.update(z);else if(I.isLight)_.pushLight(I),I.castShadow&&_.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||ue.intersectsSprite(I)){j&&At.setFromMatrixPosition(I.matrixWorld).applyMatrix4(Ue);const Ze=C.update(I),pt=I.material;pt.visible&&m.push(I,Ze,pt,K,At.z,null)}}else if((I.isMesh||I.isLine||I.isPoints)&&(!I.frustumCulled||ue.intersectsObject(I))){const Ze=C.update(I),pt=I.material;if(j&&(void 0!==I.boundingSphere?(null===I.boundingSphere&&I.computeBoundingSphere(),At.copy(I.boundingSphere.center)):(null===Ze.boundingSphere&&Ze.computeBoundingSphere(),At.copy(Ze.boundingSphere.center)),At.applyMatrix4(I.matrixWorld).applyMatrix4(Ue)),Array.isArray(pt)){const mt=Ze.groups;for(let Dt=0,lt=mt.length;Dt<lt;Dt++){const Tt=mt[Dt],zn=pt[Tt.materialIndex];zn&&zn.visible&&m.push(I,Ze,zn,K,At.z,Tt)}}else pt.visible&&m.push(I,Ze,pt,K,At.z,null)}const Ve=I.children;for(let Ze=0,pt=Ve.length;Ze<pt;Ze++)O8(Ve[Ze],z,K,j)}function F8(I,z,K,j){const Q=I.opaque,Ve=I.transmissive,Ze=I.transparent;_.setupLightsView(K),!0===le&&We.setGlobalState(v.clippingPlanes,K),Ve.length>0&&function Ibe(I,z,K,j){const Q=me.isWebGL2;null===Re&&(Re=new eu(1,1,{generateMipmaps:!0,type:te.has("EXT_color_buffer_half_float")?Yg:Rc,minFilter:wa,samples:Q?4:0})),v.getDrawingBufferSize(Fe),Q?Re.setSize(Fe.x,Fe.y):Re.setSize(tE(Fe.x),tE(Fe.y));const Ve=v.getRenderTarget();v.setRenderTarget(Re),v.getClearColor(H),R=v.getClearAlpha(),R<1&&v.setClearColor(16777215,.5),v.clear();const Ze=v.toneMapping;v.toneMapping=va,Sx(I,K,j),ke.updateMultisampleRenderTarget(Re),ke.updateRenderTargetMipmap(Re);let pt=!1;for(let mt=0,Dt=z.length;mt<Dt;mt++){const lt=z[mt],Tt=lt.object,zn=lt.geometry,Zn=lt.material,Ns=lt.group;if(2===Zn.side&&Tt.layers.test(j.layers)){const Oa=Zn.side;Zn.side=1,Zn.needsUpdate=!0,k8(Tt,K,j,zn,Zn,Ns),Zn.side=Oa,Zn.needsUpdate=!0,pt=!0}}!0===pt&&(ke.updateMultisampleRenderTarget(Re),ke.updateRenderTargetMipmap(Re)),v.setRenderTarget(Ve),v.setClearColor(H,R),v.toneMapping=Ze}(Q,Ve,z,K),j&&oe.viewport(A.copy(j)),Q.length>0&&Sx(Q,z,K),Ve.length>0&&Sx(Ve,z,K),Ze.length>0&&Sx(Ze,z,K),oe.buffers.depth.setTest(!0),oe.buffers.depth.setMask(!0),oe.buffers.color.setMask(!0),oe.setPolygonOffset(!1)}function Sx(I,z,K){const j=!0===z.isScene?z.overrideMaterial:null;for(let Q=0,Ve=I.length;Q<Ve;Q++){const Ze=I[Q],pt=Ze.object,mt=Ze.geometry,Dt=null===j?Ze.material:j,lt=Ze.group;pt.layers.test(K.layers)&&k8(pt,z,K,mt,Dt,lt)}}function k8(I,z,K,j,Q,Ve){I.onBeforeRender(v,z,K,j,Q,Ve),I.modelViewMatrix.multiplyMatrices(K.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),Q.onBeforeRender(v,z,K,j,I,Ve),!0===Q.transparent&&2===Q.side&&!1===Q.forceSinglePass?(Q.side=1,Q.needsUpdate=!0,v.renderBufferDirect(K,z,j,Q,I,Ve),Q.side=0,Q.needsUpdate=!0,v.renderBufferDirect(K,z,j,Q,I,Ve),Q.side=2):v.renderBufferDirect(K,z,j,Q,I,Ve),I.onAfterRender(v,z,K,j,Q,Ve)}function Ax(I,z,K){!0!==z.isScene&&(z=_t);const j=Ne.get(I),Q=_.state.lights,Ze=Q.state.version,pt=$.getParameters(I,Q.state,_.state.shadowsArray,z,K),mt=$.getProgramCacheKey(pt);let Dt=j.programs;j.environment=I.isMeshStandardMaterial?z.environment:null,j.fog=z.fog,j.envMap=(I.isMeshStandardMaterial?It:nt).get(I.envMap||j.environment),void 0===Dt&&(I.addEventListener("dispose",xe),Dt=new Map,j.programs=Dt);let lt=Dt.get(mt);if(void 0!==lt){if(j.currentProgram===lt&&j.lightsStateVersion===Ze)return V8(I,pt),lt}else pt.uniforms=$.getUniforms(I),I.onBuild(K,pt,v),I.onBeforeCompile(pt,v),lt=$.acquireProgram(pt,mt),Dt.set(mt,lt),j.uniforms=pt.uniforms;const Tt=j.uniforms;(!I.isShaderMaterial&&!I.isRawShaderMaterial||!0===I.clipping)&&(Tt.clippingPlanes=We.uniform),V8(I,pt),j.needsLights=function Pbe(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&!0===I.lights}(I),j.lightsStateVersion=Ze,j.needsLights&&(Tt.ambientLightColor.value=Q.state.ambient,Tt.lightProbe.value=Q.state.probe,Tt.directionalLights.value=Q.state.directional,Tt.directionalLightShadows.value=Q.state.directionalShadow,Tt.spotLights.value=Q.state.spot,Tt.spotLightShadows.value=Q.state.spotShadow,Tt.rectAreaLights.value=Q.state.rectArea,Tt.ltc_1.value=Q.state.rectAreaLTC1,Tt.ltc_2.value=Q.state.rectAreaLTC2,Tt.pointLights.value=Q.state.point,Tt.pointLightShadows.value=Q.state.pointShadow,Tt.hemisphereLights.value=Q.state.hemi,Tt.directionalShadowMap.value=Q.state.directionalShadowMap,Tt.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,Tt.spotShadowMap.value=Q.state.spotShadowMap,Tt.spotLightMatrix.value=Q.state.spotLightMatrix,Tt.spotLightMap.value=Q.state.spotLightMap,Tt.pointShadowMap.value=Q.state.pointShadowMap,Tt.pointShadowMatrix.value=Q.state.pointShadowMatrix);const zn=lt.getUniforms(),Zn=AE.seqWithValue(zn.seq,Tt);return j.currentProgram=lt,j.uniformsList=Zn,lt}function V8(I,z){const K=Ne.get(I);K.outputColorSpace=z.outputColorSpace,K.instancing=z.instancing,K.instancingColor=z.instancingColor,K.skinning=z.skinning,K.morphTargets=z.morphTargets,K.morphNormals=z.morphNormals,K.morphColors=z.morphColors,K.morphTargetsCount=z.morphTargetsCount,K.numClippingPlanes=z.numClippingPlanes,K.numIntersection=z.numClipIntersection,K.vertexAlphas=z.vertexAlphas,K.vertexTangents=z.vertexTangents,K.toneMapping=z.toneMapping}Ei.setAnimationLoop(function sr(I){at&&at(I)}),typeof self<"u"&&Ei.setContext(self),this.setAnimationLoop=function(I){at=I,P.setAnimationLoop(I),null===I?Ei.stop():Ei.start()},P.addEventListener("sessionstart",xn),P.addEventListener("sessionend",Go),this.render=function(I,z){if(void 0===z||!0===z.isCamera){if(!0!==w){if(!0===I.matrixWorldAutoUpdate&&I.updateMatrixWorld(),null===z.parent&&!0===z.matrixWorldAutoUpdate&&z.updateMatrixWorld(),!0===P.enabled&&!0===P.isPresenting&&(!0===P.cameraAutoUpdate&&P.updateCamera(z),z=P.getCamera()),!0===I.isScene&&I.onBeforeRender(v,I,z,T),_=ge.get(I,y.length),_.init(),y.push(_),Ue.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),ue.setFromProjectionMatrix(Ue),de=this.localClippingEnabled,le=We.init(this.clippingPlanes,de),m=ce.get(I,g.length),m.init(),g.push(m),O8(I,z,0,v.sortObjects),m.finish(),!0===v.sortObjects&&m.sort(ne,q),this.info.render.frame++,!0===le&&We.beginShadows(),_e.render(_.state.shadowsArray,I,z),!0===le&&We.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ie.render(m,I),_.setupLights(v._useLegacyLights),z.isArrayCamera){const j=z.cameras;for(let Q=0,Ve=j.length;Q<Ve;Q++){const Ze=j[Q];F8(m,I,Ze,Ze.viewport)}}else F8(m,I,z);null!==T&&(ke.updateMultisampleRenderTarget(T),ke.updateRenderTargetMipmap(T)),!0===I.isScene&&I.onAfterRender(v,I,z),Ke.resetDefaultState(),S=-1,x=null,y.pop(),_=y.length>0?y[y.length-1]:null,g.pop(),m=g.length>0?g[g.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(I,z,K){Ne.get(I.texture).__webglTexture=z,Ne.get(I.depthTexture).__webglTexture=K;const j=Ne.get(I);j.__hasExternalTextures=!0,j.__hasExternalTextures&&(j.__autoAllocateDepthBuffer=void 0===K,j.__autoAllocateDepthBuffer||!0===te.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),j.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(I,z){const K=Ne.get(I);K.__webglFramebuffer=z,K.__useDefaultFramebuffer=void 0===z},this.setRenderTarget=function(I,z=0,K=0){T=I,E=z,b=K;let j=!0,Q=null,Ve=!1,Ze=!1;if(I){const mt=Ne.get(I);void 0!==mt.__useDefaultFramebuffer?(oe.bindFramebuffer(N.FRAMEBUFFER,null),j=!1):void 0===mt.__webglFramebuffer?ke.setupRenderTarget(I):mt.__hasExternalTextures&&ke.rebindTextures(I,Ne.get(I.texture).__webglTexture,Ne.get(I.depthTexture).__webglTexture);const Dt=I.texture;(Dt.isData3DTexture||Dt.isDataArrayTexture||Dt.isCompressedArrayTexture)&&(Ze=!0);const lt=Ne.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(Q=Array.isArray(lt[z])?lt[z][K]:lt[z],Ve=!0):Q=me.isWebGL2&&I.samples>0&&!1===ke.useMultisampledRTT(I)?Ne.get(I).__webglMultisampledFramebuffer:Array.isArray(lt)?lt[K]:lt,A.copy(I.viewport),O.copy(I.scissor),U=I.scissorTest}else A.copy(ee).multiplyScalar(W).floor(),O.copy(F).multiplyScalar(W).floor(),U=X;if(oe.bindFramebuffer(N.FRAMEBUFFER,Q)&&me.drawBuffers&&j&&oe.drawBuffers(I,Q),oe.viewport(A),oe.scissor(O),oe.setScissorTest(U),Ve){const mt=Ne.get(I.texture);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+z,mt.__webglTexture,K)}else if(Ze){const mt=Ne.get(I.texture);N.framebufferTextureLayer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,mt.__webglTexture,K||0,z||0)}S=-1},this.readRenderTargetPixels=function(I,z,K,j,Q,Ve,Ze){if(!I||!I.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let pt=Ne.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&void 0!==Ze&&(pt=pt[Ze]),pt){oe.bindFramebuffer(N.FRAMEBUFFER,pt);try{const mt=I.texture,Dt=mt.format,lt=mt.type;if(Dt!==Ms&&st.convert(Dt)!==N.getParameter(N.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Tt=lt===Yg&&(te.has("EXT_color_buffer_half_float")||me.isWebGL2&&te.has("EXT_color_buffer_float"));if(!(lt===Rc||st.convert(lt)===N.getParameter(N.IMPLEMENTATION_COLOR_READ_TYPE)||lt===Ea&&(me.isWebGL2||te.has("OES_texture_float")||te.has("WEBGL_color_buffer_float"))||Tt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");z>=0&&z<=I.width-j&&K>=0&&K<=I.height-Q&&N.readPixels(z,K,j,Q,st.convert(Dt),st.convert(lt),Ve)}finally{const mt=null!==T?Ne.get(T).__webglFramebuffer:null;oe.bindFramebuffer(N.FRAMEBUFFER,mt)}}},this.copyFramebufferToTexture=function(I,z,K=0){const j=Math.pow(2,-K),Q=Math.floor(z.image.width*j),Ve=Math.floor(z.image.height*j);ke.setTexture2D(z,0),N.copyTexSubImage2D(N.TEXTURE_2D,K,0,0,I.x,I.y,Q,Ve),oe.unbindTexture()},this.copyTextureToTexture=function(I,z,K,j=0){const Q=z.image.width,Ve=z.image.height,Ze=st.convert(K.format),pt=st.convert(K.type);ke.setTexture2D(K,0),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,K.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),N.pixelStorei(N.UNPACK_ALIGNMENT,K.unpackAlignment),z.isDataTexture?N.texSubImage2D(N.TEXTURE_2D,j,I.x,I.y,Q,Ve,Ze,pt,z.image.data):z.isCompressedTexture?N.compressedTexSubImage2D(N.TEXTURE_2D,j,I.x,I.y,z.mipmaps[0].width,z.mipmaps[0].height,Ze,z.mipmaps[0].data):N.texSubImage2D(N.TEXTURE_2D,j,I.x,I.y,Ze,pt,z.image),0===j&&K.generateMipmaps&&N.generateMipmap(N.TEXTURE_2D),oe.unbindTexture()},this.copyTextureToTexture3D=function(I,z,K,j,Q=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Ve=I.max.x-I.min.x+1,Ze=I.max.y-I.min.y+1,pt=I.max.z-I.min.z+1,mt=st.convert(j.format),Dt=st.convert(j.type);let lt;if(j.isData3DTexture)ke.setTexture3D(j,0),lt=N.TEXTURE_3D;else{if(!j.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ke.setTexture2DArray(j,0),lt=N.TEXTURE_2D_ARRAY}N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,j.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),N.pixelStorei(N.UNPACK_ALIGNMENT,j.unpackAlignment);const Tt=N.getParameter(N.UNPACK_ROW_LENGTH),zn=N.getParameter(N.UNPACK_IMAGE_HEIGHT),Zn=N.getParameter(N.UNPACK_SKIP_PIXELS),Ns=N.getParameter(N.UNPACK_SKIP_ROWS),Oa=N.getParameter(N.UNPACK_SKIP_IMAGES),or=K.isCompressedTexture?K.mipmaps[0]:K.image;N.pixelStorei(N.UNPACK_ROW_LENGTH,or.width),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,or.height),N.pixelStorei(N.UNPACK_SKIP_PIXELS,I.min.x),N.pixelStorei(N.UNPACK_SKIP_ROWS,I.min.y),N.pixelStorei(N.UNPACK_SKIP_IMAGES,I.min.z),K.isDataTexture||K.isData3DTexture?N.texSubImage3D(lt,Q,z.x,z.y,z.z,Ve,Ze,pt,mt,Dt,or.data):K.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),N.compressedTexSubImage3D(lt,Q,z.x,z.y,z.z,Ve,Ze,pt,mt,or.data)):N.texSubImage3D(lt,Q,z.x,z.y,z.z,Ve,Ze,pt,mt,Dt,or),N.pixelStorei(N.UNPACK_ROW_LENGTH,Tt),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,zn),N.pixelStorei(N.UNPACK_SKIP_PIXELS,Zn),N.pixelStorei(N.UNPACK_SKIP_ROWS,Ns),N.pixelStorei(N.UNPACK_SKIP_IMAGES,Oa),0===Q&&j.generateMipmaps&&N.generateMipmap(lt),oe.unbindTexture()},this.initTexture=function(I){I.isCubeTexture?ke.setTextureCube(I,0):I.isData3DTexture?ke.setTexture3D(I,0):I.isDataArrayTexture||I.isCompressedArrayTexture?ke.setTexture2DArray(I,0):ke.setTexture2D(I,0),oe.unbindTexture()},this.resetState=function(){E=0,b=0,T=null,oe.reset(),Ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return xa}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===_D?"display-p3":"srgb",t.unpackColorSpace=$t.workingColorSpace===Yw?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===an?Kl:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Kl?an:Sr}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class gwe extends T${}).prototype.isWebGL1Renderer=!0;class CE{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new J(e),this.near=t,this.far=r}clone(){return new CE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class S$ extends Kn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class KD{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=os()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=os()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=os()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const vi=new M;class au{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.applyMatrix4(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.applyNormalMatrix(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.transformDirection(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}setX(e,t){return this.normalized&&(t=wt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=wt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=wt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=wt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ki(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ki(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ki(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ki(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array),i=wt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=wt(t,this.array),r=wt(r,this.array),i=wt(i,this.array),s=wt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new En(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new au(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const R$=new M,P$=new en,N$=new en,vwe=new M,L$=new tt,Rf=new M,ZD=new Ks,O$=new tt,JD=new hf;class F$ extends Kt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tt,this.bindMatrixInverse=new tt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new ko),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)Rf.fromBufferAttribute(t,r),this.applyBoneTransform(r,Rf),this.boundingBox.expandByPoint(Rf)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Ks),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)Rf.fromBufferAttribute(t,r),this.applyBoneTransform(r,Rf),this.boundingSphere.expandByPoint(Rf)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ZD.copy(this.boundingSphere),ZD.applyMatrix4(i),!1!==e.ray.intersectsSphere(ZD)&&(O$.copy(i).invert(),JD.copy(e.ray).applyMatrix4(O$),(null===this.boundingBox||!1!==JD.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,JD)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new en,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,i=this.geometry;P$.fromBufferAttribute(i.attributes.skinIndex,e),N$.fromBufferAttribute(i.attributes.skinWeight,e),R$.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=N$.getComponent(s);if(0!==o){const a=P$.getComponent(s);L$.multiplyMatrices(r.bones[a].matrixWorld,r.boneInverses[a]),t.addScaledVector(vwe.copy(R$).applyMatrix4(L$),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class eR extends Kn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class l_ extends Ds{constructor(e=null,t=1,r=1,i,s,o,a,c,l=Yn,u=Yn,h,d){super(null,o,a,c,l,u,i,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const k$=new tt,wwe=new tt;class PE{constructor(e=[],t=[]){this.uuid=os(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new tt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new tt;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let s=0,o=e.length;s<o;s++)k$.multiplyMatrices(e[s]?e[s].matrixWorld:wwe,t[s]),k$.toArray(r,16*s);null!==i&&(i.needsUpdate=!0)}clone(){return new PE(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=SW(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new l_(t,e,e,Ms,Ea);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const s=e.bones[r];let o=t[s];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new eR),this.bones.push(o),this.boneInverses.push((new tt).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let i=0,s=t.length;i<s;i++)e.bones.push(t[i].uuid),e.boneInverses.push(r[i].toArray());return e}}class u_ extends En{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Pf=new tt,V$=new tt,NE=[],U$=new ko,Ewe=new tt,h_=new Kt,d_=new Ks;class B$ extends Kt{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new u_(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,Ewe)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new ko),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Pf),U$.copy(e.boundingBox).applyMatrix4(Pf),this.boundingBox.union(U$)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Ks),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Pf),d_.copy(e.boundingSphere).applyMatrix4(Pf),this.boundingSphere.union(d_)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,i=this.count;if(h_.geometry=this.geometry,h_.material=this.material,void 0!==h_.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),d_.copy(this.boundingSphere),d_.applyMatrix4(r),!1!==e.ray.intersectsSphere(d_)))for(let s=0;s<i;s++){this.getMatrixAt(s,Pf),V$.multiplyMatrices(r,Pf),h_.matrixWorld=V$,h_.raycast(e,NE);for(let o=0,a=NE.length;o<a;o++){const c=NE[o];c.instanceId=s,c.object=this,t.push(c)}NE.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new u_(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class wi extends Vi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new J(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const z$=new M,H$=new M,G$=new tt,tR=new hf,LE=new Ks;class cu extends Kn{constructor(e=new Et,t=new wi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)z$.fromBufferAttribute(t,i-1),H$.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=z$.distanceTo(H$);e.setAttribute("lineDistance",new ze(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),LE.copy(r.boundingSphere),LE.applyMatrix4(i),LE.radius+=s,!1===e.ray.intersectsSphere(LE))return;G$.copy(i).invert(),tR.copy(e.ray).applyMatrix4(G$);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=new M,u=new M,h=new M,d=new M,f=this.isLineSegments?2:1,p=r.index,_=r.attributes.position;if(null!==p)for(let v=Math.max(0,o.start),w=Math.min(p.count,o.start+o.count)-1;v<w;v+=f){const E=p.getX(v),b=p.getX(v+1);if(l.fromBufferAttribute(_,E),u.fromBufferAttribute(_,b),tR.distanceSqToSegment(l,u,d,h)>c)continue;d.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(d);S<e.near||S>e.far||t.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(let v=Math.max(0,o.start),w=Math.min(_.count,o.start+o.count)-1;v<w;v+=f){if(l.fromBufferAttribute(_,v),u.fromBufferAttribute(_,v+1),tR.distanceSqToSegment(l,u,d,h)>c)continue;d.applyMatrix4(this.matrixWorld);const b=e.ray.origin.distanceTo(d);b<e.near||b>e.far||t.push({distance:b,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const j$=new M,W$=new M;class OE extends cu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)j$.fromBufferAttribute(t,i),W$.fromBufferAttribute(t,i+1),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+j$.distanceTo(W$);e.setAttribute("lineDistance",new ze(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $$ extends cu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class nR extends Vi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new J(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const q$=new tt,rR=new hf,FE=new Ks,kE=new M;class X$ extends Kn{constructor(e=new Et,t=new nR){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),FE.copy(r.boundingSphere),FE.applyMatrix4(i),FE.radius+=s,!1===e.ray.intersectsSphere(FE))return;q$.copy(i).invert(),rR.copy(e.ray).applyMatrix4(q$);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(null!==l)for(let p=Math.max(0,o.start),m=Math.min(l.count,o.start+o.count);p<m;p++){const _=l.getX(p);kE.fromBufferAttribute(h,_),Y$(kE,_,c,i,e,t,this)}else for(let p=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);p<m;p++)kE.fromBufferAttribute(h,p),Y$(kE,p,c,i,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Y$(n,e,t,r,i,s,o){const a=rR.distanceSqToPoint(n);if(a<t){const c=new M;rR.closestPointToPoint(n,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}class bwe extends Ds{constructor(e,t,r,i,s,o,a,c,l){super(e,t,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Bo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)r=this.getPoint(o/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const s=r.length;let o;o=t||e*r[s-1];let l,a=0,c=s-1;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),l=r[i]-o,l<0)a=i+1;else{if(!(l>0)){c=i;break}c=i-1}if(i=c,r[i]===o)return i/(s-1);const u=r[i];return(i+(o-u)/(r[i+1]-u))/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const o=this.getPoint(i),a=this.getPoint(s),c=t||(o.isVector2?new Z:new M);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new M,i=[],s=[],o=[],a=new M,c=new tt;for(let f=0;f<=e;f++)i[f]=this.getTangentAt(f/e,new M);s[0]=new M,o[0]=new M;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),h=Math.abs(i[0].y),d=Math.abs(i[0].z);u<=l&&(l=u,r.set(1,0,0)),h<=l&&(l=h,r.set(0,1,0)),d<=l&&r.set(0,0,1),a.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],a),o[0].crossVectors(i[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(Un(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(c.makeRotationAxis(a,p))}o[f].crossVectors(i[f],s[f])}if(!0===t){let f=Math.acos(Un(s[0].dot(s[e]),-1,1));f/=e,i[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(c.makeRotationAxis(i[p],f*p)),o[p].crossVectors(i[p],s[p])}return{tangents:i,normals:s,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class iR extends Bo{constructor(e=0,t=0,r=1,i=1,s=0,o=2*Math.PI,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(e,t){const r=t||new Z,i=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(s=o?0:i),!0===this.aClockwise&&!o&&(s===i?s=-i:s-=i);const a=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=c-this.aX,f=l-this.aY;c=d*u-f*h+this.aX,l=d*h+f*u+this.aY}return r.set(c,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function sR(){let n=0,e=0,t=0,r=0;function i(s,o,a,c){n=s,e=a,t=-3*s+3*o-2*a-c,r=2*s-2*o+a+c}return{initCatmullRom:function(s,o,a,c,l){i(o,a,l*(a-s),l*(c-o))},initNonuniformCatmullRom:function(s,o,a,c,l,u,h){let d=(o-s)/l-(a-s)/(l+u)+(a-o)/u,f=(a-o)/u-(c-o)/(u+h)+(c-a)/h;d*=u,f*=u,i(o,a,d,f)},calc:function(s){const o=s*s;return n+e*s+t*o+r*(o*s)}}}const VE=new M,oR=new sR,aR=new sR,cR=new sR;function K$(n,e,t,r,i){const s=.5*(r-e),o=.5*(i-t),a=n*n;return(2*t-2*r+s+o)*(n*a)+(-3*t+3*r-2*s-o)*a+s*n+t}function f_(n,e,t,r){return function Awe(n,e){const t=1-n;return t*t*e}(n,e)+function Cwe(n,e){return 2*(1-n)*n*e}(n,t)+function Mwe(n,e){return n*n*e}(n,r)}function p_(n,e,t,r,i){return function Iwe(n,e){const t=1-n;return t*t*t*e}(n,e)+function Dwe(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function Rwe(n,e){return 3*(1-n)*n*n*e}(n,r)+function Pwe(n,e){return n*n*n*e}(n,i)}class Q$ extends Bo{constructor(e=new Z,t=new Z,r=new Z,i=new Z){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Z){const r=t,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return r.set(p_(e,i.x,s.x,o.x,a.x),p_(e,i.y,s.y,o.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Z$ extends Bo{constructor(e=new Z,t=new Z){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Z){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Z){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class J$ extends Bo{constructor(e=new Z,t=new Z,r=new Z){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Z){const r=t,i=this.v0,s=this.v1,o=this.v2;return r.set(f_(e,i.x,s.x,o.x),f_(e,i.y,s.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class t6 extends Bo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Z){const r=t,i=this.points,s=(i.length-1)*e,o=Math.floor(s),a=s-o,c=i[0===o?o:o-1],l=i[o],u=i[o>i.length-2?i.length-1:o+1],h=i[o>i.length-3?i.length-1:o+2];return r.set(K$(a,c.x,l.x,u.x,h.x),K$(a,c.y,l.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push((new Z).fromArray(i))}return this}}var UE=Object.freeze({__proto__:null,ArcCurve:class Twe extends iR{constructor(e,t,r,i,s,o){super(e,t,r,r,i,s,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class Swe extends Bo{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new M){const r=t,i=this.points,s=i.length,o=(s-(this.closed?0:1))*e;let l,u,a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===c&&a===s-1&&(a=s-2,c=1),this.closed||a>0?l=i[(a-1)%s]:(VE.subVectors(i[0],i[1]).add(i[0]),l=VE);const h=i[a%s],d=i[(a+1)%s];if(this.closed||a+2<s?u=i[(a+2)%s]:(VE.subVectors(i[s-1],i[s-2]).add(i[s-1]),u=VE),"centripetal"===this.curveType||"chordal"===this.curveType){const f="chordal"===this.curveType?.5:.25;let p=Math.pow(l.distanceToSquared(h),f),m=Math.pow(h.distanceToSquared(d),f),_=Math.pow(d.distanceToSquared(u),f);m<1e-4&&(m=1),p<1e-4&&(p=m),_<1e-4&&(_=m),oR.initNonuniformCatmullRom(l.x,h.x,d.x,u.x,p,m,_),aR.initNonuniformCatmullRom(l.y,h.y,d.y,u.y,p,m,_),cR.initNonuniformCatmullRom(l.z,h.z,d.z,u.z,p,m,_)}else"catmullrom"===this.curveType&&(oR.initCatmullRom(l.x,h.x,d.x,u.x,this.tension),aR.initCatmullRom(l.y,h.y,d.y,u.y,this.tension),cR.initCatmullRom(l.z,h.z,d.z,u.z,this.tension));return r.set(oR.calc(c),aR.calc(c),cR.calc(c)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push((new M).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Q$,CubicBezierCurve3:class Nwe extends Bo{constructor(e=new M,t=new M,r=new M,i=new M){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new M){const r=t,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return r.set(p_(e,i.x,s.x,o.x,a.x),p_(e,i.y,s.y,o.y,a.y),p_(e,i.z,s.z,o.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:iR,LineCurve:Z$,LineCurve3:class Lwe extends Bo{constructor(e=new M,t=new M){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new M){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new M){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:J$,QuadraticBezierCurve3:class e6 extends Bo{constructor(e=new M,t=new M,r=new M){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new M){const r=t,i=this.v0,s=this.v1,o=this.v2;return r.set(f_(e,i.x,s.x,o.x),f_(e,i.y,s.y,o.y),f_(e,i.z,s.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:t6});class Owe extends Bo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);return e.equals(t)||this.curves.push(new UE[!0===e.isVector2?"LineCurve":"LineCurve3"](t,e)),this}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const o=i[s]-r,a=this.curves[s],c=a.getLength();return a.getPointAt(0===c?0:1-o/c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const o=s[i],c=o.getPoints(o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e);for(let l=0;l<c.length;l++){const u=c[l];r&&r.equals(u)||(t.push(u),r=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push((new UE[i.type]).fromJSON(i))}return this}}class BE extends Owe{constructor(e){super(),this.type="Path",this.currentPoint=new Z,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new Z$(this.currentPoint.clone(),new Z(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const s=new J$(this.currentPoint.clone(),new Z(e,t),new Z(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,s,o){const a=new Q$(this.currentPoint.clone(),new Z(e,t),new Z(r,i),new Z(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new t6(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,s,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,r,i,s,o),this}absarc(e,t,r,i,s,o){return this.absellipse(e,t,r,r,i,s,o),this}ellipse(e,t,r,i,s,o,a,c){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,r,i,s,o,a,c),this}absellipse(e,t,r,i,s,o,a,c){const l=new iR(e,t,r,i,s,o,a,c);if(this.curves.length>0){const h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class lu extends Et{constructor(e=1,t=1,r=1,i=32,s=1,o=!1,a=0,c=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const l=this;i=Math.floor(i),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const m=[],_=r/2;let g=0;function v(w){const E=p,b=new Z,T=new M;let S=0;const x=!0===w?e:t,A=!0===w?1:-1;for(let U=1;U<=i;U++)h.push(0,_*A,0),d.push(0,A,0),f.push(.5,.5),p++;const O=p;for(let U=0;U<=i;U++){const R=U/i*c+a,k=Math.cos(R),B=Math.sin(R);T.x=x*B,T.y=_*A,T.z=x*k,h.push(T.x,T.y,T.z),d.push(0,A,0),b.x=.5*k+.5,b.y=.5*B*A+.5,f.push(b.x,b.y),p++}for(let U=0;U<i;U++){const H=E+U,R=O+U;!0===w?u.push(R,R+1,H):u.push(R+1,R,H),S+=3}l.addGroup(g,S,!0===w?1:2),g+=S}(function y(){const w=new M,E=new M;let b=0;const T=(t-e)/r;for(let S=0;S<=s;S++){const x=[],A=S/s,O=A*(t-e)+e;for(let U=0;U<=i;U++){const H=U/i,R=H*c+a,k=Math.sin(R),B=Math.cos(R);E.x=O*k,E.y=-A*r+_,E.z=O*B,h.push(E.x,E.y,E.z),w.set(k,T,B).normalize(),d.push(w.x,w.y,w.z),f.push(H,1-A),x.push(p++)}m.push(x)}for(let S=0;S<i;S++)for(let x=0;x<s;x++){const O=m[x+1][S],U=m[x+1][S+1],H=m[x][S+1];u.push(m[x][S],O,H),u.push(O,U,H),b+=6}l.addGroup(g,b,0),g+=b})(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new ze(h,3)),this.setAttribute("normal",new ze(d,3)),this.setAttribute("uv",new ze(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uu extends Et{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const s=[],o=[];function c(y,v,w,E){const b=E+1,T=[];for(let S=0;S<=b;S++){T[S]=[];const x=y.clone().lerp(w,S/b),A=v.clone().lerp(w,S/b),O=b-S;for(let U=0;U<=O;U++)T[S][U]=0===U&&S===b?x:x.clone().lerp(A,U/O)}for(let S=0;S<b;S++)for(let x=0;x<2*(b-S)-1;x++){const A=Math.floor(x/2);x%2==0?(d(T[S][A+1]),d(T[S+1][A]),d(T[S][A])):(d(T[S][A+1]),d(T[S+1][A+1]),d(T[S+1][A]))}}function d(y){s.push(y.x,y.y,y.z)}function f(y,v){const w=3*y;v.x=e[w+0],v.y=e[w+1],v.z=e[w+2]}function m(y,v,w,E){E<0&&1===y.x&&(o[v]=y.x-1),0===w.x&&0===w.z&&(o[v]=E/2/Math.PI+.5)}function _(y){return Math.atan2(y.z,-y.x)}function g(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}(function a(y){const v=new M,w=new M,E=new M;for(let b=0;b<t.length;b+=3)f(t[b+0],v),f(t[b+1],w),f(t[b+2],E),c(v,w,E,y)})(i),function l(y){const v=new M;for(let w=0;w<s.length;w+=3)v.x=s[w+0],v.y=s[w+1],v.z=s[w+2],v.normalize().multiplyScalar(y),s[w+0]=v.x,s[w+1]=v.y,s[w+2]=v.z}(r),function u(){const y=new M;for(let v=0;v<s.length;v+=3){y.x=s[v+0],y.y=s[v+1],y.z=s[v+2];const w=_(y)/2/Math.PI+.5,E=g(y)/Math.PI+.5;o.push(w,1-E)}(function p(){const y=new M,v=new M,w=new M,E=new M,b=new Z,T=new Z,S=new Z;for(let x=0,A=0;x<s.length;x+=9,A+=6){y.set(s[x+0],s[x+1],s[x+2]),v.set(s[x+3],s[x+4],s[x+5]),w.set(s[x+6],s[x+7],s[x+8]),b.set(o[A+0],o[A+1]),T.set(o[A+2],o[A+3]),S.set(o[A+4],o[A+5]),E.copy(y).add(v).add(w).divideScalar(3);const O=_(E);m(b,A+0,y,O),m(T,A+2,v,O),m(S,A+4,w,O)}})(),function h(){for(let y=0;y<o.length;y+=6){const v=o[y+0],w=o[y+2],E=o[y+4],b=Math.max(v,w,E),T=Math.min(v,w,E);b>.9&&T<.1&&(v<.2&&(o[y+0]+=1),w<.2&&(o[y+2]+=1),E<.2&&(o[y+4]+=1))}}()}(),this.setAttribute("position",new ze(s,3)),this.setAttribute("normal",new ze(s.slice(),3)),this.setAttribute("uv",new ze(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uu(e.vertices,e.indices,e.radius,e.details)}}const HE=new M,GE=new M,fR=new M,jE=new cs;class n6 extends Et{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const i=Math.pow(10,4),s=Math.cos(Jl*t),o=e.getIndex(),a=e.getAttribute("position"),c=o?o.count:a.count,l=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let p=0;p<c;p+=3){o?(l[0]=o.getX(p),l[1]=o.getX(p+1),l[2]=o.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:m,b:_,c:g}=jE;if(m.fromBufferAttribute(a,l[0]),_.fromBufferAttribute(a,l[1]),g.fromBufferAttribute(a,l[2]),jE.getNormal(fR),h[0]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,h[1]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,h[2]=`${Math.round(g.x*i)},${Math.round(g.y*i)},${Math.round(g.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let y=0;y<3;y++){const v=(y+1)%3,w=h[y],E=h[v],b=jE[u[y]],T=jE[u[v]],S=`${w}_${E}`,x=`${E}_${w}`;x in d&&d[x]?(fR.dot(d[x].normal)<=s&&(f.push(b.x,b.y,b.z),f.push(T.x,T.y,T.z)),d[x]=null):S in d||(d[S]={index0:l[y],index1:l[v],normal:fR.clone()})}}for(const p in d)if(d[p]){const{index0:m,index1:_}=d[p];HE.fromBufferAttribute(a,m),GE.fromBufferAttribute(a,_),f.push(HE.x,HE.y,HE.z),f.push(GE.x,GE.y,GE.z)}this.setAttribute("position",new ze(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Vc extends BE{constructor(e){super(e),this.uuid=os(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push((new BE).fromJSON(i))}return this}}function r6(n,e,t,r,i){let s,o;if(i===function Zwe(n,e,t,r){let i=0;for(let s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}(n,e,t,r)>0)for(s=e;s<t;s+=r)o=o6(s,n[s],n[s+1],o);else for(s=t-r;s>=e;s-=r)o=o6(s,n[s],n[s+1],o);return o&&WE(o,o.next)&&(__(o),o=o.next),o}function hu(n,e){if(!n)return n;e||(e=n);let r,t=n;do{if(r=!1,t.steiner||!WE(t,t.next)&&0!==Pn(t.prev,t,t.next))t=t.next;else{if(__(t),t=e=t.prev,t===t.next)break;r=!0}}while(r||t!==e);return e}function m_(n,e,t,r,i,s,o){if(!n)return;!o&&s&&function $we(n,e,t,r){let i=n;do{0===i.z&&(i.z=pR(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function qwe(n){let e,t,r,i,s,o,a,c,l=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,r=t,a=0,e=0;e<l&&(a++,r=r.nextZ,r);e++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||t.z<=r.z)?(i=t,t=t.nextZ,a--):(i=r,r=r.nextZ,c--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,l*=2}while(o>1)}(i)}(n,r,i,s);let c,l,a=n;for(;n.prev!==n.next;)if(c=n.prev,l=n.next,s?Vwe(n,r,i,s):kwe(n))e.push(c.i/t|0),e.push(n.i/t|0),e.push(l.i/t|0),__(n),n=l.next,a=l.next;else if((n=l)===a){o?1===o?m_(n=Uwe(hu(n),e,t),e,t,r,i,s,2):2===o&&Bwe(n,e,t,r,i,s):m_(hu(n),e,t,r,i,s,1);break}}function kwe(n){const e=n.prev,t=n,r=n.next;if(Pn(e,t,r)>=0)return!1;const i=e.x,s=t.x,o=r.x,a=e.y,c=t.y,l=r.y,u=i<s?i<o?i:o:s<o?s:o,h=a<c?a<l?a:l:c<l?c:l,d=i>s?i>o?i:o:s>o?s:o,f=a>c?a>l?a:l:c>l?c:l;let p=r.next;for(;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Nf(i,a,s,c,o,l,p.x,p.y)&&Pn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Vwe(n,e,t,r){const i=n.prev,s=n,o=n.next;if(Pn(i,s,o)>=0)return!1;const a=i.x,c=s.x,l=o.x,u=i.y,h=s.y,d=o.y,f=a<c?a<l?a:l:c<l?c:l,p=u<h?u<d?u:d:h<d?h:d,m=a>c?a>l?a:l:c>l?c:l,_=u>h?u>d?u:d:h>d?h:d,g=pR(f,p,e,t,r),y=pR(m,_,e,t,r);let v=n.prevZ,w=n.nextZ;for(;v&&v.z>=g&&w&&w.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==i&&v!==o&&Nf(a,u,c,h,l,d,v.x,v.y)&&Pn(v.prev,v,v.next)>=0||(v=v.prevZ,w.x>=f&&w.x<=m&&w.y>=p&&w.y<=_&&w!==i&&w!==o&&Nf(a,u,c,h,l,d,w.x,w.y)&&Pn(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=g;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=_&&v!==i&&v!==o&&Nf(a,u,c,h,l,d,v.x,v.y)&&Pn(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=y;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=_&&w!==i&&w!==o&&Nf(a,u,c,h,l,d,w.x,w.y)&&Pn(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Uwe(n,e,t){let r=n;do{const i=r.prev,s=r.next.next;!WE(i,s)&&i6(i,r,r.next,s)&&g_(i,s)&&g_(s,i)&&(e.push(i.i/t|0),e.push(r.i/t|0),e.push(s.i/t|0),__(r),__(r.next),r=n=s),r=r.next}while(r!==n);return hu(r)}function Bwe(n,e,t,r,i,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Ywe(o,a)){let c=s6(o,a);return o=hu(o,o.next),c=hu(c,c.next),m_(o,e,t,r,i,s,0),void m_(c,e,t,r,i,s,0)}a=a.next}o=o.next}while(o!==n)}function Hwe(n,e){return n.x-e.x}function Gwe(n,e){const t=function jwe(n,e){let i,t=e,r=-1/0;const s=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const d=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=s&&d>r&&(r=d,i=t.x<t.next.x?t:t.next,d===s))return i}t=t.next}while(t!==e);if(!i)return null;const a=i,c=i.x,l=i.y;let h,u=1/0;t=i;do{s>=t.x&&t.x>=c&&s!==t.x&&Nf(o<l?s:r,o,c,l,o<l?r:s,o,t.x,t.y)&&(h=Math.abs(o-t.y)/(s-t.x),g_(t,n)&&(h<u||h===u&&(t.x>i.x||t.x===i.x&&Wwe(i,t)))&&(i=t,u=h)),t=t.next}while(t!==a);return i}(n,e);if(!t)return e;const r=s6(t,n);return hu(r,r.next),hu(t,t.next)}function Wwe(n,e){return Pn(n.prev,n,e.prev)<0&&Pn(e.next,n,n.next)<0}function pR(n,e,t,r,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xwe(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function Nf(n,e,t,r,i,s,o,a){return(i-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(r-a)}function Ywe(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function Kwe(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&i6(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(g_(n,e)&&g_(e,n)&&function Qwe(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do{t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==n);return r}(n,e)&&(Pn(n.prev,n,e.prev)||Pn(n,e.prev,e))||WE(n,e)&&Pn(n.prev,n,n.next)>0&&Pn(e.prev,e,e.next)>0)}function Pn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function WE(n,e){return n.x===e.x&&n.y===e.y}function i6(n,e,t,r){const i=qE(Pn(n,e,t)),s=qE(Pn(n,e,r)),o=qE(Pn(t,r,n)),a=qE(Pn(t,r,e));return!!(i!==s&&o!==a||0===i&&$E(n,t,e)||0===s&&$E(n,r,e)||0===o&&$E(t,n,r)||0===a&&$E(t,e,r))}function $E(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function qE(n){return n>0?1:n<0?-1:0}function g_(n,e){return Pn(n.prev,n,n.next)<0?Pn(n,e,n.next)>=0&&Pn(n,n.prev,e)>=0:Pn(n,e,n.prev)<0||Pn(n,n.next,e)<0}function s6(n,e){const t=new mR(n.i,n.x,n.y),r=new mR(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function o6(n,e,t,r){const i=new mR(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function __(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function mR(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Pa{static area(e){const t=e.length;let r=0;for(let i=t-1,s=0;s<t;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return.5*r}static isClockWise(e){return Pa.area(e)<0}static triangulateShape(e,t){const r=[],i=[],s=[];a6(e),c6(r,e);let o=e.length;t.forEach(a6);for(let c=0;c<t.length;c++)i.push(o),o+=t[c].length,c6(r,t[c]);const a=function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=r6(n,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l,u,h,d,f;if(r&&(s=function zwe(n,e,t,r){const i=[];let s,o,a,c,l;for(s=0,o=e.length;s<o;s++)a=e[s]*r,c=s<o-1?e[s+1]*r:n.length,l=r6(n,a,c,r,!1),l===l.next&&(l.steiner=!0),i.push(Xwe(l));for(i.sort(Hwe),s=0;s<i.length;s++)t=Gwe(i[s],t);return t}(n,e,s,t)),n.length>80*t){a=l=n[0],c=u=n[1];for(let p=t;p<i;p+=t)h=n[p],d=n[p+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);f=Math.max(l-a,u-c),f=0!==f?32767/f:0}return m_(s,o,t,a,c,f,0),o}(r,i);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}}function a6(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function c6(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class XE extends Et{constructor(e=new Vc([new Z(.5,.5),new Z(-.5,.5),new Z(-.5,-.5),new Z(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let a=0,c=e.length;a<c;a++)o(e[a]);function o(a){const c=[],l=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1,h=void 0!==t.depth?t.depth:1;let d=void 0===t.bevelEnabled||t.bevelEnabled,f=void 0!==t.bevelThickness?t.bevelThickness:.2,p=void 0!==t.bevelSize?t.bevelSize:f-.1,m=void 0!==t.bevelOffset?t.bevelOffset:0,_=void 0!==t.bevelSegments?t.bevelSegments:3;const g=t.extrudePath,y=void 0!==t.UVGenerator?t.UVGenerator:Jwe;let v,E,b,T,S,w=!1;g&&(v=g.getSpacedPoints(u),w=!0,d=!1,E=g.computeFrenetFrames(u,!1),b=new M,T=new M,S=new M),d||(_=0,f=0,p=0,m=0);const x=a.extractPoints(l);let A=x.shape;const O=x.holes;if(!Pa.isClockWise(A)){A=A.reverse();for(let N=0,we=O.length;N<we;N++){const te=O[N];Pa.isClockWise(te)&&(O[N]=te.reverse())}}const H=Pa.triangulateShape(A,O),R=A;for(let N=0,we=O.length;N<we;N++)A=A.concat(O[N]);function k(N,we,te){return we||console.error("THREE.ExtrudeGeometry: vec does not exist"),N.clone().addScaledVector(we,te)}const B=A.length,W=H.length;function ne(N,we,te){let me,oe,Ye;const Ne=N.x-we.x,ke=N.y-we.y,nt=te.x-N.x,It=te.y-N.y,An=Ne*Ne+ke*ke;if(Math.abs(Ne*It-ke*nt)>Number.EPSILON){const C=Math.sqrt(An),$=Math.sqrt(nt*nt+It*It),fe=we.x-ke/C,ce=we.y+Ne/C,_e=((te.x-It/$-fe)*It-(te.y+nt/$-ce)*nt)/(Ne*It-ke*nt);me=fe+Ne*_e-N.x,oe=ce+ke*_e-N.y;const Ie=me*me+oe*oe;if(Ie<=2)return new Z(me,oe);Ye=Math.sqrt(Ie/2)}else{let C=!1;Ne>Number.EPSILON?nt>Number.EPSILON&&(C=!0):Ne<-Number.EPSILON?nt<-Number.EPSILON&&(C=!0):Math.sign(ke)===Math.sign(It)&&(C=!0),C?(me=-ke,oe=Ne,Ye=Math.sqrt(An)):(me=Ne,oe=ke,Ye=Math.sqrt(An/2))}return new Z(me/Ye,oe/Ye)}const q=[];for(let N=0,we=R.length,te=we-1,me=N+1;N<we;N++,te++,me++)te===we&&(te=0),me===we&&(me=0),q[N]=ne(R[N],R[te],R[me]);const ee=[];let F,X=q.concat();for(let N=0,we=O.length;N<we;N++){const te=O[N];F=[];for(let me=0,oe=te.length,Ye=oe-1,Ne=me+1;me<oe;me++,Ye++,Ne++)Ye===oe&&(Ye=0),Ne===oe&&(Ne=0),F[me]=ne(te[me],te[Ye],te[Ne]);ee.push(F),X=X.concat(F)}for(let N=0;N<_;N++){const we=N/_,te=f*Math.cos(we*Math.PI/2),me=p*Math.sin(we*Math.PI/2)+m;for(let oe=0,Ye=R.length;oe<Ye;oe++){const Ne=k(R[oe],q[oe],me);Ue(Ne.x,Ne.y,-te)}for(let oe=0,Ye=O.length;oe<Ye;oe++){const Ne=O[oe];F=ee[oe];for(let ke=0,nt=Ne.length;ke<nt;ke++){const It=k(Ne[ke],F[ke],me);Ue(It.x,It.y,-te)}}}const ue=p+m;for(let N=0;N<B;N++){const we=d?k(A[N],X[N],ue):A[N];w?(T.copy(E.normals[0]).multiplyScalar(we.x),b.copy(E.binormals[0]).multiplyScalar(we.y),S.copy(v[0]).add(T).add(b),Ue(S.x,S.y,S.z)):Ue(we.x,we.y,0)}for(let N=1;N<=u;N++)for(let we=0;we<B;we++){const te=d?k(A[we],X[we],ue):A[we];w?(T.copy(E.normals[N]).multiplyScalar(te.x),b.copy(E.binormals[N]).multiplyScalar(te.y),S.copy(v[N]).add(T).add(b),Ue(S.x,S.y,S.z)):Ue(te.x,te.y,h/u*N)}for(let N=_-1;N>=0;N--){const we=N/_,te=f*Math.cos(we*Math.PI/2),me=p*Math.sin(we*Math.PI/2)+m;for(let oe=0,Ye=R.length;oe<Ye;oe++){const Ne=k(R[oe],q[oe],me);Ue(Ne.x,Ne.y,h+te)}for(let oe=0,Ye=O.length;oe<Ye;oe++){const Ne=O[oe];F=ee[oe];for(let ke=0,nt=Ne.length;ke<nt;ke++){const It=k(Ne[ke],F[ke],me);w?Ue(It.x,It.y+v[u-1].y,v[u-1].x+te):Ue(It.x,It.y,h+te)}}}function Re(N,we){let te=N.length;for(;--te>=0;){const me=te;let oe=te-1;oe<0&&(oe=N.length-1);for(let Ye=0,Ne=u+2*_;Ye<Ne;Ye++){const ke=B*Ye,nt=B*(Ye+1);At(we+me+ke,we+oe+ke,we+oe+nt,we+me+nt)}}}function Ue(N,we,te){c.push(N),c.push(we),c.push(te)}function Fe(N,we,te){_t(N),_t(we),_t(te);const me=i.length/3,oe=y.generateTopUV(r,i,me-3,me-2,me-1);$e(oe[0]),$e(oe[1]),$e(oe[2])}function At(N,we,te,me){_t(N),_t(we),_t(me),_t(we),_t(te),_t(me);const oe=i.length/3,Ye=y.generateSideWallUV(r,i,oe-6,oe-3,oe-2,oe-1);$e(Ye[0]),$e(Ye[1]),$e(Ye[3]),$e(Ye[1]),$e(Ye[2]),$e(Ye[3])}function _t(N){i.push(c[3*N+0]),i.push(c[3*N+1]),i.push(c[3*N+2])}function $e(N){s.push(N.x),s.push(N.y)}(function le(){const N=i.length/3;if(d){let we=0,te=B*we;for(let me=0;me<W;me++){const oe=H[me];Fe(oe[2]+te,oe[1]+te,oe[0]+te)}we=u+2*_,te=B*we;for(let me=0;me<W;me++){const oe=H[me];Fe(oe[0]+te,oe[1]+te,oe[2]+te)}}else{for(let we=0;we<W;we++){const te=H[we];Fe(te[2],te[1],te[0])}for(let we=0;we<W;we++){const te=H[we];Fe(te[0]+B*u,te[1]+B*u,te[2]+B*u)}}r.addGroup(N,i.length/3-N,0)})(),function de(){const N=i.length/3;let we=0;Re(R,we),we+=R.length;for(let te=0,me=O.length;te<me;te++){const oe=O[te];Re(oe,we),we+=oe.length}r.addGroup(N,i.length/3-N,1)}()}this.setAttribute("position",new ze(i,3)),this.setAttribute("uv",new ze(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function eEe(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++)t.shapes.push(n[r].uuid);else t.shapes.push(n.uuid);return t.options=Object.assign({},e),void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let s=0,o=e.shapes.length;s<o;s++)r.push(t[e.shapes[s]]);const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new UE[i.type]).fromJSON(i)),new XE(r,e.options)}}const Jwe={generateTopUV:function(n,e,t,r,i){const a=e[3*r],c=e[3*r+1],l=e[3*i],u=e[3*i+1];return[new Z(e[3*t],e[3*t+1]),new Z(a,c),new Z(l,u)]},generateSideWallUV:function(n,e,t,r,i,s){const o=e[3*t],a=e[3*t+1],c=e[3*t+2],l=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],f=e[3*i+1],p=e[3*i+2],m=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(a-u)<Math.abs(o-l)?[new Z(o,1-c),new Z(l,1-h),new Z(d,1-p),new Z(m,1-g)]:[new Z(a,1-c),new Z(u,1-h),new Z(f,1-p),new Z(_,1-g)]}};class YE extends uu{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new YE(e.radius,e.detail)}}class QE extends Et{constructor(e=.5,t=1,r=32,i=1,s=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:o},r=Math.max(3,r);const a=[],c=[],l=[],u=[];let h=e;const d=(t-e)/(i=Math.max(1,i)),f=new M,p=new Z;for(let m=0;m<=i;m++){for(let _=0;_<=r;_++){const g=s+_/r*o;f.x=h*Math.cos(g),f.y=h*Math.sin(g),c.push(f.x,f.y,f.z),l.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,u.push(p.x,p.y)}h+=d}for(let m=0;m<i;m++){const _=m*(r+1);for(let g=0;g<r;g++){const y=g+_,w=y+r+1,E=y+r+2,b=y+1;a.push(y,w,b),a.push(w,E,b)}}this.setIndex(a),this.setAttribute("position",new ze(c,3)),this.setAttribute("normal",new ze(l,3)),this.setAttribute("uv",new ze(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QE(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Lf extends Et{constructor(e=1,t=32,r=16,i=0,s=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const c=Math.min(o+a,Math.PI);let l=0;const u=[],h=new M,d=new M,f=[],p=[],m=[],_=[];for(let g=0;g<=r;g++){const y=[],v=g/r;let w=0;0===g&&0===o?w=.5/t:g===r&&c===Math.PI&&(w=-.5/t);for(let E=0;E<=t;E++){const b=E/t;h.x=-e*Math.cos(i+b*s)*Math.sin(o+v*a),h.y=e*Math.cos(o+v*a),h.z=e*Math.sin(i+b*s)*Math.sin(o+v*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),_.push(b+w,1-v),y.push(l++)}u.push(y)}for(let g=0;g<r;g++)for(let y=0;y<t;y++){const w=u[g][y],E=u[g+1][y],b=u[g+1][y+1];(0!==g||o>0)&&f.push(u[g][y+1],w,b),(g!==r-1||c<Math.PI)&&f.push(w,E,b)}this.setIndex(f),this.setAttribute("position",new ze(p,3)),this.setAttribute("normal",new ze(m,3)),this.setAttribute("uv",new ze(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lf(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Uc extends Vi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new J(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new J(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eo extends Uc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Z(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Un(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new J(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new J(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new J(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Na extends Vi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new J(16777215),this.specular=new J(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new J(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class h6 extends Vi{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class ZE extends Vi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new J(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new J(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Z(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function du(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function f6(n){const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(function e(i,s){return n[i]-n[s]}),r}function ER(n,e,t){const r=n.length,i=new n.constructor(r);for(let s=0,o=0;o!==r;++s){const a=t[s]*e;for(let c=0;c!==e;++c)i[o++]=n[a+c]}return i}function xR(n,e,t,r){let i=1,s=n[0];for(;void 0!==s&&void 0===s[r];)s=n[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),t.push(o)),s=n[i++]}while(void 0!==s)}class y_{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let o;n:{r:if(!(e<i)){for(let a=r+2;;){if(void 0===i){if(e<s)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(s=i,i=t[++r],e<i)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(r=2,s=a);for(let c=r-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(r===c)break;if(i=s,s=t[--r-1],e>=s)break t}o=r,r=0}}for(;r<o;){const a=r+o>>>1;e<t[a]?o=a:r=a+1}if(i=t[r],s=t[r-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let o=0;o!==i;++o)t[o]=r[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class uEe extends y_{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,o=e+1,a=i[s],c=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-r;break;case 2402:s=i.length-2,a=t+i[s]-i[s+1];break;default:s=e,a=r}if(void 0===c)switch(this.getSettings_().endingEnd){case 2401:o=e,c=2*r-t;break;case 2402:o=1,c=r+i[1]-i[0];break;default:o=e-1,c=t}const l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-r),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(r-t)/(i-t),m=p*p,_=m*p,g=-d*_+2*d*m-d*p,y=(1+d)*_+(-1.5-2*d)*m+(-.5+d)*p+1,v=(-1-f)*_+(1.5+f)*m+.5*p,w=f*_-f*m;for(let E=0;E!==a;++E)s[E]=g*o[u+E]+y*o[l+E]+v*o[c+E]+w*o[h+E];return s}}class p6 extends y_{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(r-t)/(i-t),h=1-u;for(let d=0;d!==a;++d)s[d]=o[l+d]*h+o[c+d]*u;return s}}class hEe extends y_{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class zo{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=du(t,this.TimeBufferType),this.values=du(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:du(e.times,Array),values:du(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new hEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new p6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uEe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Kg:t=this.InterpolantFactoryMethodDiscrete;break;case Kd:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Kg;case this.InterpolantFactoryMethodLinear:return Kd;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,o=i-1;for(;s!==i&&r[s]<e;)++s;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==s||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=r.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=r[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(null!==o&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(void 0!==i&&function d6(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}(i))for(let a=0,c=i.length;a!==c;++a){const l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(i)c=!0;else{const h=a*r,d=h-r,f=h+r;for(let p=0;p!==r;++p){const m=t[h+p];if(m!==t[d+p]||m!==t[f+p]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const h=a*r,d=o*r;for(let f=0;f!==r;++f)t[d+f]=t[h+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*r,c=o*r,l=0;l!==r;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}zo.prototype.TimeBufferType=Float32Array,zo.prototype.ValueBufferType=Float32Array,zo.prototype.DefaultInterpolation=Kd;class Of extends zo{}Of.prototype.ValueTypeName="bool",Of.prototype.ValueBufferType=Array,Of.prototype.DefaultInterpolation=Kg,Of.prototype.InterpolantFactoryMethodLinear=void 0,Of.prototype.InterpolantFactoryMethodSmooth=void 0;class m6 extends zo{}m6.prototype.ValueTypeName="color";class Ff extends zo{}Ff.prototype.ValueTypeName="number";class dEe extends y_{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(r-t)/(i-t);let l=e*a;for(let u=l+a;l!==u;l+=4)Fr.slerpFlat(s,0,o,l-a,o,l,c);return s}}class fu extends zo{InterpolantFactoryMethodLinear(e){return new dEe(this.times,this.values,this.getValueSize(),e)}}fu.prototype.ValueTypeName="quaternion",fu.prototype.DefaultInterpolation=Kd,fu.prototype.InterpolantFactoryMethodSmooth=void 0;class kf extends zo{}kf.prototype.ValueTypeName="string",kf.prototype.ValueBufferType=Array,kf.prototype.DefaultInterpolation=Kg,kf.prototype.InterpolantFactoryMethodLinear=void 0,kf.prototype.InterpolantFactoryMethodSmooth=void 0;class Vf extends zo{}Vf.prototype.ValueTypeName="vector";class v_{constructor(e,t=-1,r,i=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=os(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let o=0,a=r.length;o!==a;++o)t.push(pEe(r[o]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=r.length;s!==o;++s)t.push(zo.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const s=t.length,o=[];for(let a=0;a<s;a++){let c=[],l=[];c.push((a+s-1)%s,a,(a+1)%s),l.push(0,1,0);const u=f6(c);c=ER(c,1,u),l=ER(l,1,u),!i&&0===c[0]&&(c.push(s),l.push(l[0])),o.push(new Ff(".morphTargetInfluences["+t[a].name+"]",c,l).scale(1/r))}return new this(e,-1,o)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const l=e[a],u=l.name.match(s);if(u&&u.length>1){const h=u[1];let d=i[h];d||(i[h]=d=[]),d.push(l)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],t,r));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,p,m){if(0!==f.length){const _=[],g=[];xR(f,_,g,p),0!==_.length&&m.push(new h(d,_,g))}},i=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let c=e.length||-1;const l=e.hierarchy||[];for(let h=0;h<l.length;h++){const d=l[h].keys;if(d&&0!==d.length)if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let m=0;m<d[p].morphTargets.length;m++)f[d[p].morphTargets[m]]=-1;for(const m in f){const _=[],g=[];for(let y=0;y!==d[p].morphTargets.length;++y){const v=d[p];_.push(v.time),g.push(v.morphTarget===m?1:0)}i.push(new Ff(".morphTargetInfluence["+m+"]",_,g))}c=f.length*o}else{const f=".bones["+t[h].name+"]";r(Vf,f+".position",d,"pos",i),r(fu,f+".quaternion",d,"rot",i),r(Vf,f+".scale",d,"scl",i)}}return 0===i.length?null:new this(s,c,i,a)}resetDuration(){let t=0;for(let r=0,i=this.tracks.length;r!==i;++r){const s=this.tracks[r];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function pEe(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function fEe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ff;case"vector":case"vector2":case"vector3":case"vector4":return Vf;case"color":return m6;case"quaternion":return fu;case"bool":case"boolean":return Of;case"string":return kf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],r=[];xR(n.keys,t,r,"value"),n.times=t,n.values=r}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Uf={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class g6{constructor(e,t,r){const i=this;let c,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,!1===s&&void 0!==i.onStart&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==i.onProgress&&i.onProgress(u,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(u){void 0!==i.onError&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return-1!==h&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){const f=l[h],p=l[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const mEe=new g6;let pu=(()=>{class n{constructor(t){this.manager=void 0!==t?t:mEe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,r){const i=this;return new Promise(function(s,o){i.load(t,s,r,o)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return n.DEFAULT_MATERIAL_NAME="__DEFAULT",n})();const La={};class gEe extends Error{constructor(e,t){super(e),this.response=t}}class us extends pu{constructor(e){super(e)}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Uf.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==La[e])return void La[e].push({onLoad:t,onProgress:r,onError:i});La[e]=[],La[e].push({onLoad:t,onProgress:r,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(200===l.status||0===l.status){if(0===l.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===l.body||void 0===l.body.getReader)return l;const u=La[e],h=l.body.getReader(),d=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),f=d?parseInt(d):0,p=0!==f;let m=0;const _=new ReadableStream({start(g){!function y(){h.read().then(({done:v,value:w})=>{if(v)g.close();else{m+=w.byteLength;const E=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:f});for(let b=0,T=u.length;b<T;b++){const S=u[b];S.onProgress&&S.onProgress(E)}g.enqueue(w),y()}})}()}});return new Response(_)}throw new gEe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>(new DOMParser).parseFromString(u,a));case"json":return l.json();default:if(void 0===a)return l.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return l.arrayBuffer().then(p=>f.decode(p))}}}).then(l=>{Uf.add(e,l);const u=La[e];delete La[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(l)}}).catch(l=>{const u=La[e];if(void 0===u)throw this.manager.itemError(e),l;delete La[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class JE extends pu{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Uf.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Zg("img");function c(){u(),Uf.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class bR extends pu{constructor(e){super(e)}load(e,t,r,i){const s=new Ds,o=new JE(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},r,i),s}}class ex extends Kn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new J(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class TR extends ex{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Kn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new J(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const SR=new tt,_6=new M,y6=new M;class AR{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Z(512,512),this.map=null,this.mapPass=null,this.matrix=new tt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new HD,this._frameExtents=new Z(1,1),this._viewportCount=1,this._viewports=[new en(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;_6.setFromMatrixPosition(e.matrixWorld),t.position.copy(_6),y6.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(y6),t.updateMatrixWorld(),SR.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(SR),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(SR)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class _Ee extends AR{constructor(){super(new Cr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*Jd*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class CR extends ex{constructor(e,t,r=0,i=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Kn.DEFAULT_UP),this.updateMatrix(),this.target=new Kn,this.distance=r,this.angle=i,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new _Ee}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const v6=new tt,w_=new M,MR=new M;class yEe extends AR{constructor(){super(new Cr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Z(4,2),this._viewportCount=6,this._viewports=[new en(2,1,1,1),new en(0,1,1,1),new en(3,1,1,1),new en(1,1,1,1),new en(3,0,1,1),new en(1,0,1,1)],this._cubeDirections=[new M(1,0,0),new M(-1,0,0),new M(0,0,1),new M(0,0,-1),new M(0,1,0),new M(0,-1,0)],this._cubeUps=[new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,0,1),new M(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),w_.setFromMatrixPosition(e.matrixWorld),r.position.copy(w_),MR.copy(r.position),MR.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(MR),r.updateMatrixWorld(),i.makeTranslation(-w_.x,-w_.y,-w_.z),v6.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(v6)}}class IR extends ex{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new yEe}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class vEe extends AR{constructor(){super(new bE(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class tx extends ex{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Kn.DEFAULT_UP),this.updateMatrix(),this.target=new Kn,this.shadow=new vEe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class E_{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class TEe extends Et{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class w6 extends pu{constructor(e){super(e)}load(e,t,r,i){const s=this,o=new us(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},r,i)}parse(e){const t={},r={};function i(f,p){if(void 0!==t[p])return t[p];const _=f.interleavedBuffers[p],g=function s(f,p){if(void 0!==r[p])return r[p];const g=new Uint32Array(f.arrayBuffers[p]).buffer;return r[p]=g,g}(f,_.buffer),y=tf(_.type,g),v=new KD(y,_.stride);return v.uuid=_.uuid,t[p]=v,v}const o=e.isInstancedBufferGeometry?new TEe:new Et,a=e.data.index;if(void 0!==a){const f=tf(a.type,a.array);o.setIndex(new En(f,1))}const c=e.data.attributes;for(const f in c){const p=c[f];let m;if(p.isInterleavedBufferAttribute){const _=i(e.data,p.data);m=new au(_,p.itemSize,p.offset,p.normalized)}else{const _=tf(p.type,p.array);m=new(p.isInstancedBufferAttribute?u_:En)(_,p.itemSize,p.normalized)}void 0!==p.name&&(m.name=p.name),void 0!==p.usage&&m.setUsage(p.usage),void 0!==p.updateRange&&(m.updateRange.offset=p.updateRange.offset,m.updateRange.count=p.updateRange.count),o.setAttribute(f,m)}const l=e.data.morphAttributes;if(l)for(const f in l){const p=l[f],m=[];for(let _=0,g=p.length;_<g;_++){const y=p[_];let v;if(y.isInterleavedBufferAttribute){const w=i(e.data,y.data);v=new au(w,y.itemSize,y.offset,y.normalized)}else{const w=tf(y.type,y.array);v=new En(w,y.itemSize,y.normalized)}void 0!==y.name&&(v.name=y.name),m.push(v)}o.morphAttributes[f]=m}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h)for(let f=0,p=h.length;f!==p;++f){const m=h[f];o.addGroup(m.start,m.count,m.materialIndex)}const d=e.data.boundingSphere;if(void 0!==d){const f=new M;void 0!==d.center&&f.fromArray(d.center),o.boundingSphere=new Ks(f,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class AEe extends pu{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Uf.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){Uf.add(e,c),t&&t(c),s.manager.itemEnd(e)}).catch(function(c){i&&i(c),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}class A6{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=C6(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=C6();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function C6(){return(typeof performance>"u"?Date:performance).now()}const RR="\\[\\]\\.:\\/",DEe=new RegExp("["+RR+"]","g"),PR="[^"+RR+"]",REe="[^"+RR.replace("\\.","")+"]",FEe=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",PR)+/(WCOD+)?/.source.replace("WCOD",REe)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PR)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PR)+"$"),kEe=["material","materials","bones","map"];class VEe{constructor(e,t,r){const i=r||mn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}let mn=(()=>{class n{constructor(t,r,i){this.path=r,this.parsedPath=i||n.parseTrackName(r),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,r,i){return t&&t.isAnimationObjectGroup?new n.Composite(t,r,i):new n(t,r,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(DEe,"")}static parseTrackName(t){const r=FEe.exec(t);if(null===r)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=i.nodeName.substring(s+1);-1!==kEe.indexOf(o)&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=o)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,r){if(void 0===r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(r);if(void 0!==i)return i}if(t.children){const i=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===r||c.uuid===r)return c;const l=i(c.children);if(l)return l}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,r){t[r]=this.targetObject[this.propertyName]}_getValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)t[r++]=i[s]}_getValue_arrayElement(t,r){t[r]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,r){this.resolvedProperty.toArray(t,r)}_setValue_direct(t,r){this.targetObject[this.propertyName]=t[r]}_setValue_direct_setNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++]}_setValue_array_setNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,r){this.resolvedProperty[this.propertyIndex]=t[r]}_setValue_arrayElement_setNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,r){this.resolvedProperty.fromArray(t,r)}_setValue_fromArray_setNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,r){this.bind(),this.getValue(t,r)}_setValue_unbound(t,r){this.bind(),this.setValue(t,r)}bind(){let t=this.node;const r=this.parsedPath,i=r.objectName,s=r.propertyName;let o=r.propertyIndex;if(t||(t=n.findNode(this.rootNode,r.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let u=r.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===u){u=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+s+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=VEe,n})();mn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},mn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},mn.prototype.GetterByBindingType=[mn.prototype._getValue_direct,mn.prototype._getValue_array,mn.prototype._getValue_arrayElement,mn.prototype._getValue_toArray],mn.prototype.SetterByBindingTypeAndVersioning=[[mn.prototype._setValue_direct,mn.prototype._setValue_direct_setNeedsUpdate,mn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_array,mn.prototype._setValue_array_setNeedsUpdate,mn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_arrayElement,mn.prototype._setValue_arrayElement_setNeedsUpdate,mn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_fromArray,mn.prototype._setValue_fromArray_setNeedsUpdate,mn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class NR{constructor(e,t,r=0,i=1/0){this.ray=new hf(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new PD,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return LR(e,this,r,t),r.sort(R6),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)LR(e[i],this,r,t);return r.sort(R6),r}}function R6(n,e){return n.distance-e.distance}function LR(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===r){const i=n.children;for(let s=0,o=i.length;s<o;s++)LR(i[s],e,t,!0)}}class P6{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Un(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}function x_(n){return(x_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}function xt(n,e,t){return(e=function jEe(n){var e=function GEe(n,e){if("object"!==x_(n)||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e||"default");if("object"!==x_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"===x_(e)?e:String(e)}(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"157"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="157");var H6=class{constructor(e,t){xt(this,"target",void 0),xt(this,"name",void 0),xt(this,"intersected",void 0),xt(this,"wasIntersected",!1),xt(this,"distance",void 0),this.target=e,this.name=t,this.intersected=!1,this.distance=0}},Bi=class{constructor(e,t=null){xt(this,"type",void 0),xt(this,"cancelBubble",void 0),xt(this,"originalEvent",void 0),xt(this,"coords",new Z(0,0)),xt(this,"distance",0),xt(this,"intersected",!1),this.cancelBubble=!1,this.type=e,this.originalEvent=t}stopPropagation(){this.cancelBubble=!0}},WEe=class{constructor(e,t,r,i){xt(this,"renderer",void 0),xt(this,"camera",void 0),xt(this,"domElement",void 0),xt(this,"bindEventsOnBodyElement",void 0),xt(this,"autoAdd",void 0),xt(this,"scene",void 0),xt(this,"mouse",void 0),xt(this,"supportsPointerEvents",void 0),xt(this,"interactiveObjects",void 0),xt(this,"closestObject",void 0),xt(this,"raycaster",void 0),xt(this,"treatTouchEventsAsMouseEvents",void 0),xt(this,"dispose",()=>{this.domElement.removeEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("pointermove",this.onDocumentPointerMove):this.domElement.removeEventListener("pointermove",this.onDocumentPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("mousemove",this.onDocumentMouseMove):this.domElement.removeEventListener("mousemove",this.onDocumentMouseMove),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("touchstart",this.onTouchStart),this.domElement.removeEventListener("touchmove",this.onTouchMove),this.domElement.removeEventListener("touchend",this.onTouchEnd)}),xt(this,"add",(s,o=[])=>{if(s&&!this.interactiveObjects.find(a=>a.target===s))if(o.length>0)o.forEach(a=>{let c=s.getObjectByName(a);if(c){let l=new H6(c,a);this.interactiveObjects.push(l)}});else{let a=new H6(s,s.name);this.interactiveObjects.push(a)}}),xt(this,"remove",(s,o=[])=>{!s||(o.length>0?o.forEach(a=>{let c=s.getObjectByName(a);c&&(this.interactiveObjects=this.interactiveObjects.filter(l=>l.target!==c))}):this.interactiveObjects=this.interactiveObjects.filter(a=>a.target!==s))}),xt(this,"update",()=>{this.raycaster.setFromCamera(this.mouse,this.camera),this.interactiveObjects.forEach(c=>{c.target&&this.checkIntersection(c)}),this.interactiveObjects.sort(function(c,l){return c.distance-l.distance});let o,a,s=this.interactiveObjects.find(c=>c.intersected)??null;if(s!=this.closestObject){if(this.closestObject){let c=new Bi("mouseout");this.dispatch(this.closestObject,c)}if(s){let c=new Bi("mouseover");this.dispatch(s,c)}this.closestObject=s}this.interactiveObjects.forEach(c=>{!c.intersected&&c.wasIntersected&&(o||(o=new Bi("mouseleave")),this.dispatch(c,o))}),this.interactiveObjects.forEach(c=>{c.intersected&&!c.wasIntersected&&(a||(a=new Bi("mouseenter")),this.dispatch(c,a))})}),xt(this,"checkIntersection",s=>{let o=this.raycaster.intersectObjects([s.target],!0);if(s.wasIntersected=s.intersected,o.length>0){let a=o[0].distance;o.forEach(c=>{c.distance<a&&(a=c.distance)}),s.intersected=!0,s.distance=a}else s.intersected=!1}),xt(this,"onDocumentMouseMove",s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY);let o=new Bi("mousemove",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"onDocumentPointerMove",s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY);let o=new Bi("pointermove",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"onTouchMove",s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY);let o=new Bi(this.treatTouchEventsAsMouseEvents?"mousemove":"touchmove",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"onMouseClick",s=>{this.update();let o=new Bi("click",s);this.interactiveObjects.forEach(a=>{a.intersected&&this.dispatch(a,o)})}),xt(this,"onMouseDown",s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY),this.update();let o=new Bi("mousedown",s);this.interactiveObjects.forEach(a=>{a.intersected&&this.dispatch(a,o)})}),xt(this,"onPointerDown",s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY),this.update();let o=new Bi("pointerdown",s);this.interactiveObjects.forEach(a=>{a.intersected&&this.dispatch(a,o)})}),xt(this,"onTouchStart",s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY),this.update();let o=new Bi(this.treatTouchEventsAsMouseEvents?"mousedown":"touchstart",s);this.interactiveObjects.forEach(a=>{a.intersected&&this.dispatch(a,o)})}),xt(this,"onMouseUp",s=>{let o=new Bi("mouseup",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"onPointerUp",s=>{let o=new Bi("pointerup",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"onTouchEnd",s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY),this.update();let o=new Bi(this.treatTouchEventsAsMouseEvents?"mouseup":"touchend",s);this.interactiveObjects.forEach(a=>{this.dispatch(a,o)})}),xt(this,"dispatch",(s,o)=>{s.target&&!o.cancelBubble&&(o.coords=this.mouse,o.distance=s.distance,o.intersected=s.intersected,s.target.dispatchEvent(o))}),xt(this,"mapPositionToPoint",(s,o,a)=>{let c=this.renderer.domElement.getBoundingClientRect();s.x=(o-c.left)/c.width*2-1,s.y=-(a-c.top)/c.height*2+1}),this.renderer=e,this.camera=t,this.domElement=r,this.bindEventsOnBodyElement=!(i&&typeof i.bindEventsOnBodyElement<"u")||i.bindEventsOnBodyElement,this.scene=i&&typeof i.scene<"u"?i.scene:null,this.scene&&(this.scene.onBeforeRender=()=>{this.autoAdd&&null!==this.scene&&this.scene.traverse(s=>{this.add(s),s.addEventListener("removed",o=>{this.remove(o.target)})}),this.update()}),this.autoAdd=!!(i&&typeof i.autoAdd<"u")&&i.autoAdd,this.autoAdd&&null===this.scene&&console.error("Attention: Options.scene needs to be set when using options.autoAdd"),this.mouse=new Z(-1,1),this.supportsPointerEvents=!!window.PointerEvent,this.interactiveObjects=[],this.closestObject=null,this.raycaster=new NR,r.addEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?r.ownerDocument.addEventListener("pointermove",this.onDocumentPointerMove):r.addEventListener("pointermove",this.onDocumentPointerMove),r.addEventListener("pointerdown",this.onPointerDown),r.addEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?r.ownerDocument.addEventListener("mousemove",this.onDocumentMouseMove):r.addEventListener("mousemove",this.onDocumentMouseMove),r.addEventListener("mousedown",this.onMouseDown),r.addEventListener("mouseup",this.onMouseUp),r.addEventListener("touchstart",this.onTouchStart,{passive:!0}),r.addEventListener("touchmove",this.onTouchMove,{passive:!0}),r.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this.treatTouchEventsAsMouseEvents=!0}};let lx=(()=>{var n;class e{constructor(){this.colliders={},this.ui={},this.pointer=new Z,this.colliderOptions={name:"object",mesh:null,cb:r=>{console.log("Collided ",r)}},this.intersectedObjects=[],this.raycasterOptions={origin:new M(0,0,0),direction:null,near:0,far:10},this.raycaster=new NR,this.tempMatrix=new tt}initInteractionManager(r,i,s){return this.interactionManager=new WEe(r,i,s),this.interactionManager.update.bind(this)}addToInteractions(r){this.interactionManager.add(r)}raycast(){return this.intersectedObjects.reduce((i,s)=>{const o=this.raycaster.intersectObject(s,!0);return o[0]&&(!i||o[0].distance<i.distance)?(o[0].object=s,o[0]):i},null)}intersectObjects(r){let i;return r.pointer&&null!==r.pointer.x&&null!==r.pointer.y?this.raycaster.setFromCamera(r.pointer,r.camera):(console.log("setting the ray from controller"),this.tempMatrix.identity().extractRotation(r.controller.matrixWorld),this.raycaster.ray.origin.setFromMatrixPosition(r.controller.matrixWorld),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(this.tempMatrix)),i=this.raycast(),i&&this.colliders[i.object.uuid]()}removeFromColliders(r){this.colliders=this.colliders.filter(i=>i.name!==r)}setRay(r){this.raycaster.setFromCamera(r.pointer,r.camera)}addToColliders(r){this.intersectedObjects.push(r.mesh),Object.assign({},this.colliderOptions,r),this.colliders[r.mesh.uuid]=r.cb}update(){this.interactionManager.update()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();class Ho{constructor(e,t,r,i,s="div"){this.parent=e,this.object=t,this.property=r,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),Ho.nextNameID=Ho.nextNameID||0,this.$name.id="lil-gui-name-"+ ++Ho.nextNameID,this.$widget=document.createElement(s),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",o=>o.stopPropagation()),this.domElement.addEventListener("keyup",o=>o.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(r)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class $Ee extends Ho{constructor(e,t,r){super(e,t,r,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function kR(n){let e,t;return(e=n.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=n.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=n.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!t&&"#"+t}const qEe={isPrimitive:!0,match:n=>"string"==typeof n,fromHexString:kR,toHexString:kR},b_={isPrimitive:!0,match:n=>"number"==typeof n,fromHexString:n=>parseInt(n.substring(1),16),toHexString:n=>"#"+n.toString(16).padStart(6,0)},XEe=[qEe,b_,{isPrimitive:!1,match:n=>Array.isArray(n),fromHexString(n,e,t=1){const r=b_.fromHexString(n);e[0]=(r>>16&255)/255*t,e[1]=(r>>8&255)/255*t,e[2]=(255&r)/255*t},toHexString:([n,e,t],r=1)=>b_.toHexString(n*(r=255/r)<<16^e*r<<8^t*r<<0)},{isPrimitive:!1,match:n=>Object(n)===n,fromHexString(n,e,t=1){const r=b_.fromHexString(n);e.r=(r>>16&255)/255*t,e.g=(r>>8&255)/255*t,e.b=(255&r)/255*t},toHexString:({r:n,g:e,b:t},r=1)=>b_.toHexString(n*(r=255/r)<<16^e*r<<8^t*r<<0)}];class KEe extends Ho{constructor(e,t,r,i){super(e,t,r,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=function YEe(n){return XEe.find(e=>e.match(n))}(this.initialValue),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const s=kR(this.$text.value);s&&this._setValueFromHexString(s)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class VR extends Ho{constructor(e,t,r){super(e,t,r,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",i=>{i.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class QEe extends Ho{constructor(e,t,r,i,s,o){super(e,t,r,"number"),this._initInput(),this.min(i),this.max(s);const a=void 0!==o;this.step(a?o:this._getImplicitStep(),a),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=100*t+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const r=y=>{const v=parseFloat(this.$input.value);isNaN(v)||(this._snapClampSetValue(v+y),this.$input.value=this.getValue())};let a,c,l,u,h,o=!1;const p=y=>{if(o){const v=y.clientX-a;Math.abs(y.clientY-c)>5?(y.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(v)>5&&m()}o||(h-=(y.clientY-l)*this._step*this._arrowKeyMultiplier(y),u+h>this._max?h=this._max-u:u+h<this._min&&(h=this._min-u),this._snapClampSetValue(u+h)),l=y.clientY},m=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)};this.$input.addEventListener("input",()=>{let y=parseFloat(this.$input.value);isNaN(y)||(this._stepExplicit&&(y=this._snap(y)),this.setValue(this._clamp(y)))}),this.$input.addEventListener("keydown",y=>{"Enter"===y.key&&this.$input.blur(),"ArrowUp"===y.code&&(y.preventDefault(),r(this._step*this._arrowKeyMultiplier(y))),"ArrowDown"===y.code&&(y.preventDefault(),r(this._step*this._arrowKeyMultiplier(y)*-1))}),this.$input.addEventListener("wheel",y=>{this._inputFocused&&(y.preventDefault(),r(this._step*this._normalizeMouseWheel(y)))},{passive:!1}),this.$input.addEventListener("mousedown",y=>{a=y.clientX,c=l=y.clientY,o=!0,u=this.getValue(),h=0,window.addEventListener("mousemove",p),window.addEventListener("mouseup",m)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=g=>{const y=this.$slider.getBoundingClientRect();let v=((g,y,v,w,E)=>(g-y)/(v-y)*(this._max-w)+w)(g,y.left,y.right,this._min);this._snapClampSetValue(v)},i=g=>{t(g.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)};let a,c,o=!1;const l=g=>{g.preventDefault(),this._setDraggingStyle(!0),t(g.touches[0].clientX),o=!1},h=g=>{if(o){const v=g.touches[0].clientY-c;Math.abs(g.touches[0].clientX-a)>Math.abs(v)?l(g):(window.removeEventListener("touchmove",h),window.removeEventListener("touchend",d))}else g.preventDefault(),t(g.touches[0].clientX)},d=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",d)},f=this._callOnFinishChange.bind(this);let m;this.$slider.addEventListener("mousedown",g=>{this._setDraggingStyle(!0),t(g.clientX),window.addEventListener("mousemove",i),window.addEventListener("mouseup",s)}),this.$slider.addEventListener("touchstart",g=>{g.touches.length>1||(this._hasScrollBar?(a=g.touches[0].clientX,c=g.touches[0].clientY,o=!0):l(g),window.addEventListener("touchmove",h,{passive:!1}),window.addEventListener("touchend",d))},{passive:!1}),this.$slider.addEventListener("wheel",g=>{if(Math.abs(g.deltaX)<Math.abs(g.deltaY)&&this._hasScrollBar)return;g.preventDefault();const v=this._normalizeMouseWheel(g)*this._step;this._snapClampSetValue(this.getValue()+v),this.$input.value=this.getValue(),clearTimeout(m),m=setTimeout(f,400)},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle(`lil-gui-${t}`,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:r}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,r=-e.wheelDelta/120,r*=this._stepExplicit?1:10),t+-r}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class ZEe extends Ho{constructor(e,t,r,i){super(e,t,r,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(i)?i:Object.values(i),this._names=Array.isArray(i)?i:Object.keys(i),this._names.forEach(s=>{const o=document.createElement("option");o.innerHTML=s,this.$select.appendChild(o)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=-1===t?e:this._names[t],this}}class JEe extends Ho{constructor(e,t,r){super(e,t,r,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",i=>{"Enter"===i.code&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let G6=!1;class UR{constructor({parent:e,autoPlace:t=void 0===e,container:r,width:i,title:s="Controls",closeFolders:o=!1,injectStyles:a=!0,touchStyles:c=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",l=>{("Enter"===l.code||"Space"===l.code)&&(l.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),c&&this.domElement.classList.add("allow-touch-styles"),!G6&&a&&(function txe(n){const e=document.createElement("style");e.innerHTML=n;const t=document.querySelector("head link[rel=stylesheet], head style");t?document.head.insertBefore(e,t):document.head.appendChild(e)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  background-color: var(--background-color);\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean .widget {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "\u2195";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background-color: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background-color: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background-color: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "\u25be";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "\u25b8";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui input {\n  -webkit-tap-highlight-color: transparent;\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input::-webkit-outer-spin-button,\n.lil-gui input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.lil-gui input[type=number] {\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  -webkit-appearance: none;\n  height: var(--checkbox-size);\n  width: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "\u2713";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: 1px solid var(--widget-color);\n  text-align: center;\n  line-height: calc(var(--widget-height) - 4px);\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n    border-color: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    border-color: var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),G6=!0),r?r.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this._closeFolders=o}add(e,t,r,i,s){if(Object(r)===r)return new ZEe(this,e,t,r);const o=e[t];switch(typeof o){case"number":return new QEe(this,e,t,r,i,s);case"boolean":return new $Ee(this,e,t);case"string":return new JEe(this,e,t);case"function":return new VR(this,e,t)}console.error("gui.add failed\n\tproperty:",t,"\n\tobject:",e,"\n\tvalue:",o)}addColor(e,t,r=1){return new KEe(this,e,t,r)}addFolder(e){const t=new UR({parent:this,title:e});return this.root._closeFolders&&t.close(),t}load(e,t=!0){return e.controllers&&this.controllers.forEach(r=>{r instanceof VR||r._name in e.controllers&&r.load(e.controllers[r._name])}),t&&e.folders&&this.folders.forEach(r=>{r._title in e.folders&&r.load(e.folders[r._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(r=>{if(!(r instanceof VR)){if(r._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${r._name}"`);t.controllers[r._name]=r.save()}}),e&&this.folders.forEach(r=>{if(r._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${r._title}"`);t.folders[r._title]=r.save()}),t}open(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(e){this._closed!==e&&(this._closed=e,this._callOnOpenClose(this))}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{this.$children.style.height=this.$children.clientHeight+"px",this.domElement.classList.add("transition");const r=s=>{s.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",r))};this.$children.addEventListener("transitionend",r);const i=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=i+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(r=>r.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),void 0!==this._onChange&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onOpenClose(e){return this._onOpenClose=e,this}_callOnOpenClose(e){this.parent&&this.parent._callOnOpenClose(e),void 0!==this._onOpenClose&&this._onOpenClose.call(this,e)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}const nxe=UR;let wu=(()=>{var n;class e{constructor(){this.positionOptions={min:-20,max:20},this.intensityOptions={min:0,max:10,precision:1}}addToDebug(r){this.gui||(this.gui=new nxe({closeFolders:!0}),this.gui.open(!1));const i=this.gui.addFolder(`${r.name||r.obj.name}`);for(const[s,o]of Object.entries(r.properties))switch(s){case"Position":this.addPosition(r,i,o);break;case"Color":this.addColor(r,i,o);break;case"Intensity":this.addIntensity(r,i,o);break;case"Rotation":this.addRotation(r,i,o);break;case"Scale":this.addScale(r,i,o);break;case"LookAt":const a=i.addFolder("LookAt");this.addPosition(r,a,o);break;default:i.add(r.obj,s,r.min,r.max,r.precision)}}addScale(r,i,s){const o=i.addFolder("Scale"),a=Object.assign({},{min:0,max:100,precision:1},s);o.add(r.obj.scale,"x",a.min,a.max,a.precision),o.add(r.obj.scale,"y",a.min,a.max,a.precision),o.add(r.obj.scale,"z",a.min,a.max,a.precision)}addRotation(r,i,s){const o=i.addFolder("Rotation"),a=Object.assign({},{min:0,max:360,precision:1},s);o.add(r.obj.rotation,"x",a.min,a.max,a.precision),o.add(r.obj.rotation,"y",a.min,a.max,a.precision),o.add(r.obj.rotation,"z",a.min,a.max,a.precision)}addIntensity(r,i,s){const o=i.addFolder("Intensity"),a=Object.assign({},this.intensityOptions,s);o.add(r.obj,"intensity",a.min,a.max,a.precision)}addColor(r,i,s){const o=i.addFolder("Color");o.addColor(r.obj,"color").onChange(a=>{r.obj.color.set(a)}),o.open()}addPosition(r,i,s){const o=i.addFolder("Position"),a=Object.assign({},this.positionOptions,s);o.add(r.obj.position,"x",a.min,a.max,a.precision).onChange(c=>{r.obj.position.x=c}),o.add(r.obj.position,"y",a.min,a.max,a.precision).onChange(c=>{}),o.add(r.obj.position,"z",a.min,a.max,a.precision).onChange(c=>{}),o.open()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})(),BR=(()=>{var n;class e{constructor(r){this.debugService=r,this.meshBasicMaterial=new _i,this.normalMaterial=new h6,this.meshLambert=new ZE,this.standardMaterial=new Uc({roughness:.05,metalness:1}),this.materials={matte:new Na({specular:4802889,shininess:1}),flat:new ZE({}),colors:new Na({color:16777215,specular:16777215,shininess:2,vertexColors:!0}),multiColors:new Na({shininess:2,vertexColors:!0}),plastic:new Na({specular:12698049,shininess:250})},this.params={color:16777215,transmission:1,opacity:1,metalness:0,roughness:0,ior:1.5,thickness:.01,attenuationDistance:1,specularIntensity:1,envMapIntensity:1}}createFloorMaterial(r){return new Uc({roughness:.8,color:16777215,metalness:.2,bumpScale:5e-4})}getMaterial(r){return new eo(this.params)}getStandardMaterial(){return this.standardMaterial.clone()}getMeshPhysicalMaterial(r){return new eo({clearcoatRoughness:.1,roughness:.9,color:5505051})}getMaterialByName(r){return this.materials[r]}getBasicMaterial(){return this.standardMaterial}getRandomColoredMaterial(){return new Uc({color:16777215*Math.random()})}}return(n=e).\u0275fac=function(r){return new(r||n)(De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})(),j6=(()=>{var n;class e{constructor(r,i,s){this.interactions=r,this.materials=i,this.debug=s,this.boxGeometry=new Da(1,1,1),this.sphereGeometry=new Lf(15,32,16),this.basicMaterial=new _i({color:16776960}),this.material=this.materials.getRandomColoredMaterial(),this.boxDefaultOptions={scale:1,position:{x:0,y:1.6,z:2},name:"box",material:this.material,cb:o=>{console.log("Collided with a box ",o)}},this.sphereDefaultOptions={name:"sphere",interactive:!0}}createReticle(){const r=new Kt(new QE(.15,.2,32).rotateX(-Math.PI/2),new _i);return r.matrixAutoUpdate=!1,r.visible=!1,this.reticle=r,this.reticle}createIcosahedron(r){const i=Object.assign({radius:1.5,detail:0},r);this.materials.getRandomColoredMaterial(),i.material&&this.materials.getMaterial(i.material);const o=new Kt(new YE(i.radius,i.detail),this.materials.getRandomColoredMaterial());return o.scale.x=1.3,o}createGround(){const r=new bf(1e4,1e4),i=new ZE({color:16777215});i.color.setHSL(.095,1,.75);const s=new Kt(r,i);return s.position.y=-33,s.rotation.x=-Math.PI/2,s.receiveShadow=!0,s}createSkyDom(r){const i=document.getElementById("vertexShader").textContent,s=document.getElementById("fragmentShader").textContent,o={topColor:{value:new J(30719)},bottomColor:{value:new J(16777215)},offset:{value:33},exponent:{value:.6}};o.topColor.value.copy(r.color);const a=new Lf(4e3,32,15),c=new Vo({uniforms:o,vertexShader:i,fragmentShader:s,side:1});return new Kt(a,c)}createBackground(r){}createSphere(r){const i=Object.assign({},this.sphereDefaultOptions,r),s=new Kt(this.sphereGeometry,i.material||this.materials.getRandomColoredMaterial());return s.name=i.name,s}createFrame(){new lu(3,3,20,32)}createHeart(){const o=(new Vc).moveTo(25,25).bezierCurveTo(25,25,20,0,0,0).bezierCurveTo(-30,0,-30,35,-30,35).bezierCurveTo(-30,55,-10,77,25,95).bezierCurveTo(60,77,80,55,80,35).bezierCurveTo(80,35,80,0,50,0).bezierCurveTo(35,0,25,25,25,25);return this.addShape(o,{depth:8,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1},15728640,60,100,0,0,0,Math.PI,.003)}createRoundedRect(r){const s=new Vc;return s.moveTo(r.x,r.y+r.radius),s.lineTo(r.x,r.y+r.height-r.radius),s.quadraticCurveTo(r.x,r.y+r.height,r.x+r.radius,r.y+r.height),s.lineTo(r.x+r.width-r.radius,r.y+r.height),s.quadraticCurveTo(r.x+r.width,r.y+r.height,r.x+r.width,r.y+r.height-r.radius),s.lineTo(r.x+r.width,r.y+r.radius),s.quadraticCurveTo(r.x+r.width,r.y,r.x+r.width-r.radius,r.y),s.lineTo(r.x+r.radius,r.y),s.quadraticCurveTo(r.x,r.y,r.x,r.y+r.radius),this.addShape(s,{depth:1,bevelEnabled:!0,bevelSegments:3,steps:3,bevelSize:2,bevelThickness:.5},16777215,r.width/2,0,0,0,0,0,1)}addShape(r,i,s,o,a,c,l,u,h,d){let f=new XE(r,i),p=new Kt(f,new Na({color:s}));return p.position.set(o,a,c),p.rotation.set(l,u,h),p.scale.set(d,d,d),p}createBox(r){const i=Object.assign({},this.boxDefaultOptions,r),s=new Kt(this.boxGeometry,i.material||this.materials.getRandomColoredMaterial());return s.position.set(i.position.x,i.position.y,i.position.z),s.name=i.name,s}createNav(r){const i=new Js,s=new Da(5,5,5),o=new Na({color:11184674}),a=new n6(s),c=new OE(a,new wi({color:0,linewidth:2}));for(let l=-100;l<100;l+=10)for(let u=-100;u<100;u+=10){if(0==l&&0==u)continue;const h=new Kt(s,o);h.position.set(l,2.5,u);const d=c.clone();d.position.copy(h.position),i.add(h),i.add(d)}return i.name="nav",i}createBoxes(r){const i=r.number||1e3,s=r.position||40,o=[];for(let a=0;a<i;a++){const c=new Kt(this.boxGeometry,this.materials.getRandomColoredMaterial());c.position.x=40*Math.random()-20,c.position.y=1.6*Math.random(),c.position.z=Math.random()*s-20,c.rotation.x=2*Math.random()*Math.PI,c.rotation.y=2*Math.random()*Math.PI,c.rotation.z=2*Math.random()*Math.PI,c.scale.x=Math.random()+.5,c.scale.y=Math.random()+.5,c.scale.z=Math.random()+.5,c.name="box"+a,o.push(c)}return o}}return(n=e).\u0275fac=function(r){return new(r||n)(De(lx),De(BR),De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})(),W6=(()=>{var n;class e{constructor(){this.dirLight=new tx(16777215,4),this.spotLight=new CR(16777215,30,30,Math.PI/4,.5)}createSpotLight(r){const i=this.spotLight.clone();return i.castShadow=!0,i.shadow.bias=-.001,i.shadow.mapSize.width=512,i.shadow.mapSize.height=512,i.shadow.camera.near=.1,i.shadow.camera.far=100,i.shadow.camera.fov=30,[i]}createHemLight(r){const i=new TR(16165226,10470393,.8);return i.color.setHSL(.6,1,.6),i.groundColor.setHSL(.095,1,.75),i.position.set(-.6,-2,-6),[i]}createPointLight(){const r=new IR(16777215,3,13,1);return r.castShadow=!0,r.shadow.bias=-.005,r}createDirLight(r){const s=new tx(16777215,r?.intensity||2);return s.castShadow=!0,s.color.setHSL(.1,1,.95),s.color.convertLinearToSRGB(),s.position.set(-0,12,-15),s.castShadow=!0,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.camera.left=-50,s.shadow.camera.right=50,s.shadow.camera.top=50,s.shadow.camera.bottom=-50,s.shadow.camera.far=100,s.shadow.bias=-1e-4,s.target.position.set(0,0,-2),[s,s.target]}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();const zR=new WeakMap;class rxe extends pu{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const s=new us(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{this.parse(o,t,i)},r,i)}parse(e,t,r){this.decodeDracoFile(e,t,null,null,an).catch(r)}decodeDracoFile(e,t,r,i,s=Sr){return this.decodeGeometry(e,{attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:s}).then(t)}decodeGeometry(e,t){const r=JSON.stringify(t);if(zR.has(e)){const c=zR.get(e);if(c.key===r)return c.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=this._getWorker(s,e.byteLength).then(c=>(i=c,new Promise((l,u)=>{i._callbacks[s]={resolve:l,reject:u},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),zR.set(e,{key:r,promise:a}),a}_createGeometry(e){const t=new Et;e.index&&t.setIndex(new En(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,o=i.array,c=new En(o,i.itemSize);"color"===s&&(this._assignVertexColorSpace(c,i.vertexColorSpace),c.normalized=!(o instanceof Float32Array)),t.setAttribute(s,c)}return t}_assignVertexColorSpace(e,t){if(t!==an)return;const r=new J;for(let i=0,s=e.count;i<s;i++)r.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new us(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=ixe.toString(),o=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const o=s.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function ixe(){let n,e;function i(o,a,c,l,u,h){const d=h.num_components(),p=c.num_points()*d,m=p*u.BYTES_PER_ELEMENT,_=function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}(o,u),g=o._malloc(m);a.GetAttributeDataArrayForAllPoints(c,h,_,m,g);const y=new u(o.HEAPF32.buffer,g,p).slice();return o._free(g),{name:l,array:y,itemSize:d}}onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(n)});break;case"decode":const c=a.buffer,l=a.taskConfig;e.then(u=>{const h=u.draco,d=new h.Decoder;try{const f=function t(o,a,c,l){const u=l.attributeIDs,h=l.attributeTypes;let d,f;const p=a.GetEncodedGeometryType(c);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,f=a.DecodeArrayToMesh(c,c.byteLength,d);else{if(p!==o.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");d=new o.PointCloud,f=a.DecodeArrayToPointCloud(c,c.byteLength,d)}if(!f.ok()||0===d.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const m={index:null,attributes:[]};for(const _ in u){const g=self[h[_]];let y,v;if(l.useUniqueIDs)v=u[_],y=a.GetAttributeByUniqueId(d,v);else{if(v=a.GetAttributeId(d,o[u[_]]),-1===v)continue;y=a.GetAttribute(d,v)}const w=i(o,a,d,_,g,y);"color"===_&&(w.vertexColorSpace=l.vertexColorSpace),m.attributes.push(w)}return p===o.TRIANGULAR_MESH&&(m.index=function r(o,a,c){const u=3*c.num_faces(),h=4*u,d=o._malloc(h);a.GetTrianglesUInt32Array(c,h,d);const f=new Uint32Array(o.HEAPF32.buffer,d,u).slice();return o._free(d),{array:f,itemSize:1}}(o,a,d)),o.destroy(d),m}(h,d,new Int8Array(c),l),p=f.attributes.map(m=>m.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{h.destroy(d)}})}}}function $6(n,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(2===e||1===e){let t=n.getIndex();if(null===t){const o=[],a=n.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),t=n.getIndex()}const r=t.count-2,i=[];if(2===e)for(let o=1;o<=r;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<r;o++)o%2==0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class oxe extends pu{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new hxe(t)}),this.register(function(t){return new vxe(t)}),this.register(function(t){return new wxe(t)}),this.register(function(t){return new Exe(t)}),this.register(function(t){return new fxe(t)}),this.register(function(t){return new pxe(t)}),this.register(function(t){return new mxe(t)}),this.register(function(t){return new gxe(t)}),this.register(function(t){return new uxe(t)}),this.register(function(t){return new _xe(t)}),this.register(function(t){return new dxe(t)}),this.register(function(t){return new yxe(t)}),this.register(function(t){return new cxe(t)}),this.register(function(t){return new xxe(t)}),this.register(function(t){return new bxe(t)})}load(e,t,r,i){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:E_.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){i?i(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},c=new us(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{s.parse(l,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let s;const o={},a={},c=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===q6){try{o[kt.KHR_BINARY_GLTF]=new Txe(e)}catch(h){return void(i&&i(h))}s=JSON.parse(o[kt.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new kxe(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](l);a[h.name]=h,o[h.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const h=s.extensionsUsed[u],d=s.extensionsRequired||[];switch(h){case kt.KHR_MATERIALS_UNLIT:o[h]=new lxe;break;case kt.KHR_DRACO_MESH_COMPRESSION:o[h]=new Sxe(s,this.dracoLoader);break;case kt.KHR_TEXTURE_TRANSFORM:o[h]=new Axe;break;case kt.KHR_MESH_QUANTIZATION:o[h]=new Cxe;break;default:d.indexOf(h)>=0&&void 0===a[h]&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(r,i)}parseAsync(e,t){const r=this;return new Promise(function(i,s){r.parse(e,t,i,s)})}}function axe(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const kt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class cxe{constructor(e){this.parser=e,this.name=kt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){const s=t[r];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const u=new J(16777215);void 0!==c.color&&u.setRGB(c.color[0],c.color[1],c.color[2],Sr);const h=void 0!==c.range?c.range:0;switch(c.type){case"directional":l=new tx(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new IR(u),l.distance=h;break;case"spot":l=new CR(u),l.distance=h,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,Hc(l,c),void 0!==c.intensity&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),i=Promise.resolve(l),t.cache.add(r,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(c){return r._getNodeRef(t.cache,a,c)})}}class lxe{constructor(){this.name=kt.KHR_MATERIALS_UNLIT}getMaterialType(){return _i}extendParams(e,t,r){const i=[];e.color=new J(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Sr),e.opacity=o[3]}void 0!==s.baseColorTexture&&i.push(r.assignTexture(e,"map",s.baseColorTexture,an))}return Promise.all(i)}}class uxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class hxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Z(a,a)}return Promise.all(s)}}class dxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(r.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(r.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class fxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new J(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(void 0!==o.sheenColorFactor){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Sr)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,an)),void 0!==o.sheenRoughnessTexture&&s.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class pxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(r.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class mxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=(new J).setRGB(a[0],a[1],a[2],Sr),Promise.all(s)}}class gxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class _xe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=(new J).setRGB(a[0],a[1],a[2],Sr),void 0!==o.specularColorTexture&&s.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,an)),Promise.all(s)}}class yxe{constructor(e){this.parser=e,this.name=kt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?eo:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&s.push(r.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class vxe{constructor(e){this.parser=e,this.name=kt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class wxe{constructor(e){this.parser=e,this.name=kt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=i.images[o.source];let c=r.textureLoader;if(a.uri){const l=r.options.manager.getHandler(a.uri);null!==l&&(c=l)}return this.detectSupport().then(function(l){if(l)return r.loadTextureImage(e,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Exe{constructor(e){this.parser=e,this.name=kt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=i.images[o.source];let c=r.textureLoader;if(a.uri){const l=r.options.manager.getHandler(a.uri);null!==l&&(c=l)}return this.detectSupport().then(function(l){if(l)return r.loadTextureImage(e,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class xxe{constructor(e){this.name=kt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const u=i.count,h=i.byteStride,d=new Uint8Array(a,i.byteOffset||0,i.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,d,i.mode,i.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(f),u,h,d,i.mode,i.filter),f})})}return null}}class bxe{constructor(e){this.name=kt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const i=t.meshes[r.mesh];for(const l of i.primitives)if(l.mode!==Ps.TRIANGLES&&l.mode!==Ps.TRIANGLE_STRIP&&l.mode!==Ps.TRIANGLE_FAN&&void 0!==l.mode)return null;const o=r.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),h=u.isGroup?u.children:[u],d=l[0].count,f=[];for(const p of h){const m=new tt,_=new M,g=new Fr,y=new M(1,1,1),v=new B$(p.geometry,p.material,d);for(let w=0;w<d;w++)c.TRANSLATION&&_.fromBufferAttribute(c.TRANSLATION,w),c.ROTATION&&g.fromBufferAttribute(c.ROTATION,w),c.SCALE&&y.fromBufferAttribute(c.SCALE,w),v.setMatrixAt(w,m.compose(_,g,y));for(const w in c)"TRANSLATION"!==w&&"ROTATION"!==w&&"SCALE"!==w&&p.geometry.setAttribute(w,c[w]);Kn.prototype.copy.call(v,p),this.parser.assignFinalMaterial(v),f.push(v)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const q6="glTF";class Txe{constructor(e){this.name=kt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==q6)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<i;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c){const l=new Uint8Array(e,12+o,a);this.content=r.decode(l)}else if(5130562===c){const l=12+o;this.body=e.slice(l,l+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Sxe{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=kt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const u in o){const h=WR[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=WR[u]||u.toLowerCase();if(void 0!==o[u]){const d=r.accessors[e.attributes[u]];l[h]=Bf[d.componentType].name,c[h]=!0===d.normalized}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(h){i.decodeDracoFile(u,function(d){for(const f in d.attributes){const m=c[f];void 0!==m&&(d.attributes[f].normalized=m)}h(d)},a,l)})})}}class Axe{constructor(){this.name=kt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Cxe{constructor(){this.name=kt.KHR_MESH_QUANTIZATION}}class Y6 extends y_{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let o=0;o!==i;o++)t[o]=r[s+o];return t}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=2*a,l=3*a,u=i-t,h=(r-t)/u,d=h*h,f=d*h,p=e*l,m=p-l,_=-2*f+3*d,g=f-d,y=1-_,v=g-d+h;for(let w=0;w!==a;w++)s[w]=y*o[m+w+a]+v*(o[m+w+c]*u)+_*o[p+w+a]+g*(o[p+w]*u);return s}}const Mxe=new Fr;class Ixe extends Y6{interpolate_(e,t,r,i){const s=super.interpolate_(e,t,r,i);return Mxe.fromArray(s).normalize().toArray(s),s}}const Ps={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Bf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K6={9728:Yn,9729:Sn,9984:1004,9985:1007,9986:1005,9987:wa},Q6={33071:ni,33648:1002,10497:ss},jR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},WR={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},zc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Dxe={CUBICSPLINE:void 0,LINEAR:Kd,STEP:Kg};function Rxe(n){return void 0===n.DefaultMaterial&&(n.DefaultMaterial=new Uc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),n.DefaultMaterial}function Eu(n,e,t){for(const r in t.extensions)void 0===n[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function Hc(n,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Nxe(n,e){if(n.updateMorphTargets(),void 0!==e.weights)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Lxe(n){let e;const t=n.extensions&&n.extensions[kt.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+qR(t.attributes):n.indices+":"+qR(n.attributes)+":"+n.mode,void 0!==n.targets)for(let r=0,i=n.targets.length;r<i;r++)e+=":"+qR(n.targets[r]);return e}function qR(n){let e="";const t=Object.keys(n).sort();for(let r=0,i=t.length;r<i;r++)e+=t[r]+":"+n[t[r]]+";";return e}function XR(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Fxe=new tt;class kxe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new axe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;typeof navigator<"u"&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||r||i&&s<98?new bR(this.options.manager):new AEe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new us(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:r,userData:{}};return Eu(s,a,i),Hc(a,i),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const o=e[i];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(r[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),s=(o,a)=>{const c=this.associations.get(o);null!=c&&this.associations.set(a,c);for(const[l,u]of o.children.entries())s(u,a.children[l])};return s(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&r.push(s)}return r}getDependency(e,t){const r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return r.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[kt.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){r.load(E_.resolveURL(t.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const s=t.byteOffset||0;return r.slice(s,s+(t.byteLength||0))})}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const o=jR[i.type],c=!0===i.normalized,l=new(0,Bf[i.componentType])(i.count*o);return Promise.resolve(new En(l,o,c))}const s=[];return s.push(void 0!==i.bufferView?this.getDependency("bufferView",i.bufferView):null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],c=jR[i.type],l=Bf[i.componentType],u=l.BYTES_PER_ELEMENT,d=i.byteOffset||0,f=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;let m,_;if(f&&f!==u*c){const g=Math.floor(d/f),y="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+g+":"+i.count;let v=t.cache.get(y);v||(m=new l(a,g*f,i.count*f/u),v=new KD(m,f/u),t.cache.add(y,v)),_=new au(v,c,d%f/u,p)}else m=null===a?new l(i.count*c):new l(a,d,i.count*c),_=new En(m,c,p);if(void 0!==i.sparse){const w=i.sparse.values.byteOffset||0,E=new(0,Bf[i.sparse.indices.componentType])(o[1],i.sparse.indices.byteOffset||0,i.sparse.count*jR.SCALAR),b=new l(o[2],w,i.sparse.count*c);null!==a&&(_=new En(_.array.slice(),_.itemSize,_.normalized));for(let T=0,S=E.length;T<S;T++){const x=E[T];if(_.setX(x,b[T*c]),c>=2&&_.setY(x,b[T*c+1]),c>=3&&_.setZ(x,b[T*c+2]),c>=4&&_.setW(x,b[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _})}loadTexture(e){const t=this.json,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const c=this.options.manager.getHandler(o.uri);null!==c&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,r){const i=this,s=this.json,o=s.textures[e],a=s.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,r).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",""===u.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(u.name=a.uri);const d=(s.samplers||{})[o.sampler]||{};return u.magFilter=K6[d.magFilter]||Sn,u.minFilter=K6[d.minFilter]||wa,u.wrapS=Q6[d.wrapS]||ss,u.wrapT=Q6[d.wrapT]||ss,i.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const i=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(h=>h.clone());const o=i.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(void 0!==o.bufferView)c=this.getDependency("bufferView",o.bufferView).then(function(h){l=!0;const d=new Blob([h],{type:o.mimeType});return c=a.createObjectURL(d),c});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(h){return new Promise(function(d,f){let p=d;!0===t.isImageBitmapLoader&&(p=function(m){const _=new Ds(m);_.needsUpdate=!0,d(_)}),t.load(E_.resolveURL(h,s.path),p,void 0,f)})}).then(function(h){return!0===l&&a.revokeObjectURL(c),h.userData.mimeType=o.mimeType||function Oxe(n){return n.search(/\.jpe?g($|\?)/i)>0||0===n.search(/^data\:image\/jpeg/)?"image/jpeg":n.search(/\.webp($|\?)/i)>0||0===n.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),h});return this.sourceCache[e]=u,u}assignTexture(e,t,r,i){const s=this;return this.getDependency("texture",r.index).then(function(o){if(!o)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((o=o.clone()).channel=r.texCoord),s.extensions[kt.KHR_TEXTURE_TRANSFORM]){const a=void 0!==r.extensions?r.extensions[kt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(o);o=s.extensions[kt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,c)}}return void 0!==i&&(o.colorSpace=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+r.uuid;let c=this.cache.get(a);c||(c=new nR,Vi.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(a,c)),r=c}else if(e.isLine){const a="LineBasicMaterial:"+r.uuid;let c=this.cache.get(a);c||(c=new wi,Vi.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,this.cache.add(a,c)),r=c}if(i||s||o){let a="ClonedMaterial:"+r.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=r.clone(),s&&(c.vertexColors=!0),o&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(r))),r=c}e.material=r}getMaterialType(){return Uc}loadMaterial(e){const t=this,i=this.extensions,s=this.json.materials[e];let o;const a={},l=[];if((s.extensions||{})[kt.KHR_MATERIALS_UNLIT]){const h=i[kt.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),l.push(h.extendParams(a,s,t))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new J(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Sr),a.opacity=d[3]}void 0!==h.baseColorTexture&&l.push(t.assignTexture(a,"map",h.baseColorTexture,an)),a.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,a.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=2);const u=s.alphaMode||"OPAQUE";if("BLEND"===u?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===u&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==_i&&(l.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Z(1,1),void 0!==s.normalTexture.scale)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(void 0!==s.occlusionTexture&&o!==_i&&(l.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==_i){const h=s.emissiveFactor;a.emissive=(new J).setRGB(h[0],h[1],h[2],Sr)}return void 0!==s.emissiveTexture&&o!==_i&&l.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,an)),Promise.all(l).then(function(){const h=new o(a);return s.name&&(h.name=s.name),Hc(h,s),t.associations.set(h,{materials:e}),s.extensions&&Eu(i,h,s),h})}createUniqueName(e){const t=mn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function s(a){return r[kt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Z6(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=Lxe(l),h=i[u];if(h)o.push(h.promise);else{let d;d=l.extensions&&l.extensions[kt.KHR_DRACO_MESH_COMPRESSION]?s(l):Z6(new Et,l,t),i[u]={primitive:l,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const u=void 0===o[c].material?Rxe(this.cache):this.getDependency("material",o[c].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],h=[];for(let f=0,p=u.length;f<p;f++){const m=u[f],_=o[f];let g;const y=l[f];if(_.mode===Ps.TRIANGLES||_.mode===Ps.TRIANGLE_STRIP||_.mode===Ps.TRIANGLE_FAN||void 0===_.mode)g=!0===s.isSkinnedMesh?new F$(m,y):new Kt(m,y),!0===g.isSkinnedMesh&&g.normalizeSkinWeights(),_.mode===Ps.TRIANGLE_STRIP?g.geometry=$6(g.geometry,1):_.mode===Ps.TRIANGLE_FAN&&(g.geometry=$6(g.geometry,2));else if(_.mode===Ps.LINES)g=new OE(m,y);else if(_.mode===Ps.LINE_STRIP)g=new cu(m,y);else if(_.mode===Ps.LINE_LOOP)g=new $$(m,y);else{if(_.mode!==Ps.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_.mode);g=new X$(m,y)}Object.keys(g.geometry.morphAttributes).length>0&&Nxe(g,s),g.name=t.createUniqueName(s.name||"mesh_"+e),Hc(g,s),_.extensions&&Eu(i,g,_),t.assignFinalMaterial(g),h.push(g)}for(let f=0,p=h.length;f<p;f++)t.associations.set(h[f],{meshes:e,primitives:f});if(1===h.length)return s.extensions&&Eu(i,h[0],s),h[0];const d=new Js;s.extensions&&Eu(i,d,s),t.associations.set(d,{meshes:e});for(let f=0,p=h.length;f<p;f++)d.add(h[f]);return d})}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new Cr(ef_radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new bE(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Hc(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r=[];for(let i=0,s=t.joints.length;i<s;i++)r.push(this._loadNodeShallow(t.joints[i]));return r.push(void 0!==t.inverseBindMatrices?this.getDependency("accessor",t.inverseBindMatrices):null),Promise.all(r).then(function(i){const s=i.pop(),o=i,a=[],c=[];for(let l=0,u=o.length;l<u;l++){const h=o[l];if(h){a.push(h);const d=new tt;null!==s&&d.fromArray(s.array,16*l),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new PE(a,c)})}loadAnimation(e){const r=this,i=this.json.animations[e],s=i.name?i.name:"animation_"+e,o=[],a=[],c=[],l=[],u=[];for(let h=0,d=i.channels.length;h<d;h++){const f=i.channels[h],p=i.samplers[f.sampler],m=f.target,g=void 0!==i.parameters?i.parameters[p.input]:p.input,y=void 0!==i.parameters?i.parameters[p.output]:p.output;void 0!==m.node&&(o.push(this.getDependency("node",m.node)),a.push(this.getDependency("accessor",g)),c.push(this.getDependency("accessor",y)),l.push(p),u.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(h){const d=h[0],f=h[1],p=h[2],m=h[3],_=h[4],g=[];for(let y=0,v=d.length;y<v;y++){const w=d[y],E=f[y],b=p[y],T=m[y],S=_[y];if(void 0===w)continue;w.updateMatrix&&w.updateMatrix();const x=r._createAnimationTracks(w,E,b,T,S);if(x)for(let A=0;A<x.length;A++)g.push(x[A])}return new v_(s,void 0,g)})}createNodeMesh(e){const r=this,i=this.json.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(s){const o=r._getNodeRef(r.meshCache,i.mesh,s);return void 0!==i.weights&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=i.weights.length;c<l;c++)a.morphTargetInfluences[c]=i.weights[c]}),o})}loadNode(e){const r=this,i=this.json.nodes[e],s=r._loadNodeShallow(e),o=[],a=i.children||[];for(let l=0,u=a.length;l<u;l++)o.push(r.getDependency("node",a[l]));const c=void 0===i.skin?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(o),c]).then(function(l){const u=l[0],h=l[1],d=l[2];null!==d&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(d,Fxe)});for(let f=0,p=h.length;f<p;f++)u.add(h[f]);return u})}_loadNodeShallow(e){const r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=this.json.nodes[e],o=s.name?i.createUniqueName(s.name):"",a=[],c=i._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),void 0!==s.camera&&a.push(i.getDependency("camera",s.camera).then(function(l){return i._getNodeRef(i.cameraCache,s.camera,l)})),i._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let u;if(u=!0===s.isBone?new eR:l.length>1?new Js:1===l.length?l[0]:new Kn,u!==l[0])for(let h=0,d=l.length;h<d;h++)u.add(l[h]);if(s.name&&(u.userData.name=s.name,u.name=o),Hc(u,s),s.extensions&&Eu(r,u,s),void 0!==s.matrix){const h=new tt;h.fromArray(s.matrix),u.applyMatrix4(h)}else void 0!==s.translation&&u.position.fromArray(s.translation),void 0!==s.rotation&&u.quaternion.fromArray(s.rotation),void 0!==s.scale&&u.scale.fromArray(s.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],i=this,s=new Js;r.name&&(s.name=i.createUniqueName(r.name)),Hc(s,r),r.extensions&&Eu(t,s,r);const o=r.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(i.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let u=0,h=c.length;u<h;u++)s.add(c[u]);return i.associations=(u=>{const h=new Map;for(const[d,f]of i.associations)(d instanceof Vi||d instanceof Ds)&&h.set(d,f);return u.traverse(d=>{const f=i.associations.get(d);null!=f&&h.set(d,f)}),h})(s),s})}_createAnimationTracks(e,t,r,i,s){const o=[],a=e.name?e.name:e.uuid,c=[];let l;switch(zc[s.path]===zc.weights?e.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(a),zc[s.path]){case zc.weights:l=Ff;break;case zc.rotation:l=fu;break;case zc.position:case zc.scale:l=Vf;break;default:l=1===r.itemSize?Ff:Vf}const u=void 0!==i.interpolation?Dxe[i.interpolation]:Kd,h=this._getArrayFromAccessor(r);for(let d=0,f=c.length;d<f;d++){const p=new l(c[d]+"."+zc[s.path],t.array,h,u);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=XR(t.constructor),i=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)i[s]=t[s]*r;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){return new(this instanceof fu?Ixe:Y6)(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Z6(n,e,t){const r=e.attributes,i=[];function s(o,a){return t.getDependency("accessor",o).then(function(c){n.setAttribute(a,c)})}for(const o in r){const a=WR[o]||o.toLowerCase();a in n.attributes||i.push(s(r[o],a))}if(void 0!==e.indices&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});i.push(o)}return $t.workingColorSpace!==Sr&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${$t.workingColorSpace}" not supported.`),Hc(n,e),function Vxe(n,e,t){const r=e.attributes,i=new ko;if(void 0===r.POSITION)return;{const a=t.json.accessors[r.POSITION],c=a.min,l=a.max;if(void 0===c||void 0===l)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new M(c[0],c[1],c[2]),new M(l[0],l[1],l[2])),a.normalized){const u=XR(Bf[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}const s=e.targets;if(void 0!==s){const a=new M,c=new M;for(let l=0,u=s.length;l<u;l++){const h=s[l];if(void 0!==h.POSITION){const d=t.json.accessors[h.POSITION],f=d.min,p=d.max;if(void 0!==f&&void 0!==p){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=XR(Bf[d.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const o=new Ks;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}(n,e,t),Promise.all(i).then(function(){return void 0!==e.targets?function Pxe(n,e,t){let r=!1,i=!1,s=!1;for(let l=0,u=e.length;l<u;l++){const h=e[l];if(void 0!==h.POSITION&&(r=!0),void 0!==h.NORMAL&&(i=!0),void 0!==h.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(n);const o=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const h=e[l];if(r){const d=void 0!==h.POSITION?t.getDependency("accessor",h.POSITION):n.attributes.position;o.push(d)}if(i){const d=void 0!==h.NORMAL?t.getDependency("accessor",h.NORMAL):n.attributes.normal;a.push(d)}if(s){const d=void 0!==h.COLOR_0?t.getDependency("accessor",h.COLOR_0):n.attributes.color;c.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[1],d=l[2];return r&&(n.morphAttributes.position=l[0]),i&&(n.morphAttributes.normal=h),s&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}(n,e.targets,t):n})}let YR=(()=>{var n;class e{constructor(r,i){this.debugService=r,this.materialsService=i,this.gltfLoader=new oxe,this.bufferLoader=new w6,this.textureLoader=new bR,this.dracoLoader=new rxe,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setDecoderConfig({type:"js"}),this.dracoLoader.preload(),this.gltfLoader.setDRACOLoader(this.dracoLoader)}loadModel(r){new Z(20,15),this.gltfLoader.load(r.path,s=>{const o=s.scene;o.position.z=-0,o.scale.set(3,3,3),o.traverse(c=>{let l=this.materialsService.getMeshPhysicalMaterial();c.isMesh&&(console.log("Mesh is ",c.name,c),"Floor"==c.name&&(l=this.createFloor()),c.material=l,c.castShadow=!0,c.receiveShadow=!0,c.castShadow=!0,c.receiveShadow=!0,c.material.map&&(c.material.map.anisotropy=16)),c.isLight&&(c.visible=visible)}),r.scene.add(o),r.onLoadCB()},s=>{r.onLoadProgress(s)},s=>{console.error("Error loading model")})}createFloor(){const r=new Uc({roughness:.8,color:16777215,metalness:.2,bumpScale:5e-4});return this.textureLoader.load("assets/textures/hardwood_diffuse.jpg",i=>{i.wrapS=ss,i.wrapT=ss,i.anisotropy=16,i.repeat.set(10,24),i.colorSpace=an,r.map=i,r.needsUpdate=!0}),this.textureLoader.load("assets/textures/hardwood_bump.jpg",function(i){i.wrapS=ss,i.wrapT=ss,i.anisotropy=4,i.repeat.set(10,24),r.bumpMap=i,r.needsUpdate=!0}),this.textureLoader.load("assets/textures/hardwood_roughness.jpg",function(i){i.wrapS=ss,i.wrapT=ss,i.anisotropy=4,i.repeat.set(10,24),r.roughnessMap=i,r.needsUpdate=!0}),r}createScene(r,i,s){const o=new Kt(r,s);return o.position.y=-.5,o.scale.set(i,i,i),o.castShadow=!0,o.receiveShadow=!0,o}loadTexture(r){return this.textureLoader.load(r)}}return(n=e).\u0275fac=function(r){return new(r||n)(De(wu),De(BR))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var kr={d:(n,e)=>{for(var t in e)kr.o(e,t)&&!kr.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e),r:n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},hs={};kr.d(hs,{g1:()=>hx,gO:()=>I_,km:()=>ux,zV:()=>C_,ol:()=>mP,uM:()=>dx,N1:()=>S8,xv:()=>pP,PH:()=>px,UH:()=>fx,ZP:()=>dbe,Vx:()=>A8});var ux={};kr.r(ux),kr.d(ux,{COLUMN:()=>mx,COLUMN_REVERSE:()=>e8,ROW:()=>S_,ROW_REVERSE:()=>J6,contentDirection:()=>t8});var hx={};kr.r(hx),kr.d(hx,{CENTER:()=>QR,END:()=>ZR,START:()=>KR,STRETCH:()=>n8,alignItems:()=>r8,warnAboutDeprecatedAlignItems:()=>i8});var dx={};kr.r(dx),kr.d(dx,{CENTER:()=>eP,END:()=>tP,SPACE_AROUND:()=>nP,SPACE_BETWEEN:()=>rP,SPACE_EVENLY:()=>iP,START:()=>JR,justifyContent:()=>s8});var fx={};kr.r(fx),kr.d(fx,{NORMAL:()=>A_,NOWRAP:()=>zf,PRE:()=>gx,PRE_LINE:()=>Hf,PRE_WRAP:()=>_x,WHITE_CHARS:()=>oP,collapseWhitespaceOnInlines:()=>l8,collapseWhitespaceOnString:()=>o8,newlineBreakability:()=>a8,shouldBreak:()=>c8});var px={};kr.r(px),kr.d(px,{CENTER:()=>aP,JUSTIFY:()=>cP,JUSTIFY_CENTER:()=>g8,JUSTIFY_LEFT:()=>m8,JUSTIFY_RIGHT:()=>yx,LEFT:()=>f8,RIGHT:()=>p8,textAlign:()=>_8});const Nt=(n=>{var e={};return kr.d(e,n),e})({BufferAttribute:()=>En,BufferGeometry:()=>Et,CanvasTexture:()=>bwe,Color:()=>J,FileLoader:()=>us,LinearFilter:()=>Sn,Mesh:()=>Kt,Object3D:()=>Kn,Plane:()=>Ra,PlaneGeometry:()=>bf,ShaderMaterial:()=>Vo,TextureLoader:()=>bR,Vector2:()=>Z,Vector3:()=>M}),S_="row",J6="row-reverse",mx="column",e8="column-reverse";function t8(n,e,t,r){let i=t,s="getWidth",o="x",a="y";0===e.indexOf(mx)&&(s="getHeight",o="y",a="x");for(let c=0;c<n.childrenBoxes.length;c++){const l=n.childrenBoxes[c],u=l.id,h=l[s](),d=l.margin||0;i+=d*r,n.childrenPos[u]={[o]:i+h/2*r,[a]:0},i+=r*(h+d)}}const KR="start",QR="center",ZR="end",n8="stretch";function r8(n,e){const t=n.getAlignItems();-1===Bxe.indexOf(t)&&console.warn(`alignItems === '${t}' is not supported`);let r="getWidth",i="x";0===e.indexOf(S_)&&(r="getHeight",i="y");const s=n[r]()/2-(n.padding||0);n.childrenBoxes.forEach(o=>{let a;switch(t){case ZR:case"right":case"bottom":a=0===e.indexOf(S_)?-s+o[r]()/2+(o.margin||0):s-o[r]()/2-(o.margin||0);break;case KR:case"left":case"top":a=0===e.indexOf(S_)?s-o[r]()/2-(o.margin||0):-s+o[r]()/2+(o.margin||0)}n.childrenPos[o.id][i]=a||0})}function i8(n){-1!==zxe.indexOf(n)&&console.warn(`alignItems === '${n}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const Bxe=[KR,QR,ZR,n8,"top","right","bottom","left"],zxe=["top","right","bottom","left"],JR="start",eP="center",tP="end",nP="space-around",rP="space-between",iP="space-evenly";function s8(n,e,t,r){const i=n.getJustifyContent();-1===Hxe.indexOf(i)&&console.warn(`justifyContent === '${i}' is not supported`);const s=0===e.indexOf("row")?"width":"height",o=n.getChildrenSideSum(s),c=("width"===s?n.getInnerWidth():n.getInnerHeight())-o,u=function Gxe(n,e){switch(n){case tP:return e;case eP:return e/2}return 0}(i,2*t-o*Math.sign(t)),h=function jxe(n,e,t,r){const i=Array(n.length).fill(0);if(e>0)switch(t){case rP:if(n.length>1){const s=e/(n.length-1)*r;i[0]=0;for(let o=1;o<n.length;o++)i[o]=s*o}break;case iP:if(n.length>1){const s=e/(n.length+1)*r;for(let o=0;o<n.length;o++)i[o]=s*(o+1)}break;case nP:if(n.length>1){const s=e/n.length*r,o=s/2;i[0]=o;for(let a=1;a<n.length;a++)i[a]=o+s*a}}return i}(n.childrenBoxes,c,i,r),d=0===e.indexOf("row")?"x":"y";n.childrenBoxes.forEach((f,p)=>{n.childrenPos[f.id][d]-=u-h[p]})}const Hxe=[JR,eP,tP,nP,rP,iP];function sP(n){return class extends n{constructor(t){super(t),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(2*this.padding||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`)}}getInnerHeight(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(2*this.padding||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`)}}getChildrenSideSum(t){return this.childrenBoxes.reduce((r,i)=>{const s=2*i.margin||0;return r+("width"===t?i.getWidth()+s:i.getHeight()+s)},0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const t=this.getContentDirection();let r;switch(t){case S_:r=-this.getInnerWidth()/2;break;case J6:r=this.getInnerWidth()/2;break;case mx:r=this.getInnerHeight()/2;break;case e8:r=-this.getInnerHeight()/2}const i=-Math.sign(r);t8(this,t,r,i),s8(this,t,r,i),r8(this,t)}}getHighestChildSizeOn(t){return this.childrenBoxes.reduce((r,i)=>{const s=i.margin||0,o="width"===t?i.getWidth()+2*s:i.getHeight()+2*s;return Math.max(r,o)},0)}getWidth(){return this.parentUI&&"stretch"===this.parentUI.getAlignItems()&&-1!==this.parentUI.getContentDirection().indexOf("column")?this.parentUI.getWidth()-(2*this.parentUI.padding||0):this.width||this.getInnerWidth()+(2*this.padding||0)}getHeight(){return this.parentUI&&"stretch"===this.parentUI.getAlignItems()&&-1!==this.parentUI.getContentDirection().indexOf("row")?this.parentUI.getHeight()-(2*this.parentUI.padding||0):this.height||this.getInnerHeight()+(2*this.padding||0)}}}const oP={"\t":"\t","\n":"\n","\r":"\r"," ":" "},A_="normal",zf="nowrap",gx="pre",Hf="pre-line",_x="pre-wrap",o8=function(n,e){switch(e){case zf:case A_:n=n.replace(/\n/g," ");case Hf:n=n.replace(/[ ]{2,}/g," ")}return n},a8=function(n){switch(n){case gx:case _x:case Hf:return"mandatory"}},c8=function(n,e,t,r){const i=n[e];switch(r.WHITESPACE){case A_:case Hf:case _x:if("mandatory"===i.lineBreak)return!0;if(t+(i.xadvance?i.xadvance:i.width)+(i.xoffset?i.xoffset:0)+(i.kerning?i.kerning:0)>r.INNER_WIDTH)return!0;const c=d8(n,e,r);return function Wxe(n,e,t,r){return!(!n||!n.glyph||e+t<r.INNER_WIDTH)&&r.BREAKON.indexOf(n.glyph)>-1}(n[e-1],t,c,r);case gx:return"mandatory"===i.lineBreak;default:return!1}},l8=function(n,e){const t=n[0],r=n[n.length-1];switch(e){case _x:t.glyph&&"\n"===t.glyph&&n.length>1&&h8([t],n[1]),r.glyph&&"\n"===r.glyph&&n.length>1&&u8([r],n[n.length-2]);break;case Hf:case zf:case A_:let s,i=[];for(let o=0;o<n.length;o++){const a=n[o];if(!(a.glyph&&oP[a.glyph]&&n.length>o))break;i.push(a),s=n[o+1]}h8(i,s),i=[],s=null;for(let o=n.length-1;o>0;o--){const a=n[o];if(!(a.glyph&&oP[a.glyph]&&o>0))break;i.push(a),s=n[o-1]}u8(i,s);break;case gx:break;default:return console.warn(`whiteSpace: '${e}' is not valid`),0}return t.offsetX};function u8(n,e){if(e)for(let t=0;t<n.length;t++){const r=n[t];r.width=0,r.height=0,r.offsetX=e.offsetX+e.width}}function h8(n,e){if(e)for(let t=0;t<n.length;t++){const r=n[t];r.width=0,r.height=0,r.offsetX=e.offsetX}}function d8(n,e,t,r){if(r=r||0,!n[e])return r;const i=n[e],a=i.xadvance?i.xadvance:i.width;return i.lineBreak?r+a:d8(n,e+1,t,r+a+t.LETTERSPACING+(i.xoffset?i.xoffset:0)+(i.kerning?i.kerning:0))}const f8="left",p8="right",aP="center",cP="justify",m8="justify-left",yx="justify-right",g8="justify-center";function _8(n,e,t){for(let r=0;r<n.length;r++){const i=n[r],s=$xe(i,e,t,r===n.length-1);for(let o=0;o<i.length;o++)i[o].offsetX+=s;i.x=s}if(0===e.indexOf(cP))for(let r=0;r<n.length;r++){const i=n[r];if(-1!==e.indexOf("-")&&r===n.length-1)return;const s=t-i.width;if(s<=0)return;let o=0;for(let u=1;u<i.length-1;u++)o+=" "===i[u].glyph?1:0;const a=s/o;let c=1;e===yx&&(i.reverse(),c=-1);let l=0;for(let u=1;u<=i.length-1;u++){const h=i[u];h.offsetX+=l*c,l+=" "===h.glyph?a:0}e===yx&&i.reverse()}}const $xe=(n,e,t,r)=>{switch(e){case m8:case cP:case f8:return-t/2;case yx:case p8:return t/2-n.width;case aP:return-n.width/2;case g8:return r?-n.width/2:-t/2;default:console.warn(`textAlign: '${e}' is not valid`)}};function y8(n){return class extends n{computeInlinesPosition(){const t=this.getWidth()-(2*this.padding||0),r=this.getHeight()-(2*this.padding||0),i=this.getJustifyContent(),s=this.getTextAlign(),o=this.getInterLine(),a=this.computeLines();a.interLine=o;const c=Math.abs(a.height),l=(()=>{switch(i){case"start":return r/2;case"end":return c-r/2;case"center":return c/2;default:console.warn(`justifyContent: '${i}' is not valid`)}})();a.forEach(u=>{u.y+=l,u.forEach(h=>{h.offsetY+=l})}),_8(a,s,t),this.lines=a}calculateBestFit(t){if(0!==this.childrenInlines.length)switch(t){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit()}}calculateGrowFit(){const t=this.getHeight()-(2*this.padding||0);let r=1;const s=this.childrenInlines.find(u=>u.isText);let l,o=1,a=2,c=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(l=this.calculateHeight(c),l>t){if(c<=o){this.childrenInlines.forEach(u=>{u.isInlineBlock||(u._fitFontSize=u.getFontSize())});break}a=c,c-=(a-o)/2}else{if(Math.abs(t-l)<.075)break;Math.abs(c-a)<5e-10&&(a*=2),o=c,c+=(a-o)/2}}while(++r<=10)}calculateShrinkFit(){const t=this.getHeight()-(2*this.padding||0);let r=1;const s=this.childrenInlines.find(u=>u.isText);let l,o=0,a=1,c=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(l=this.calculateHeight(c),l>t)a=c,c-=(a-o)/2;else{if(c>=a){this.childrenInlines.forEach(u=>{u.isInlineBlock||(u._fitFontSize=u.getFontSize())});break}if(Math.abs(t-l)<.075)break;o=c,c+=(a-o)/2}}while(++r<=10)}calculateAutoFit(){const t=this.getHeight()-(2*this.padding||0);let r=1;const s=this.childrenInlines.find(u=>u.isText);let l,o=0,a=2,c=s._fitFontSize?s._fitFontSize/s.getFontSize():1;do{if(l=this.calculateHeight(c),l>t)a=c,c-=(a-o)/2;else{if(Math.abs(t-l)<.075)break;Math.abs(c-a)<5e-10&&(a*=2),o=c,c+=(a-o)/2}}while(++r<=10)}computeLines(){const t=this.getWidth()-(2*this.padding||0),r=[[]];r.height=0;const i=this.getInterLine();this.childrenInlines.reduce((c,l)=>{if(!l.inlines)return;const u=l._fitFontSize||l.getFontSize(),h=l.isText?l.getLetterSpacing()*u:0,d=l.getWhiteSpace(),f=l.getBreakOn(),p={WHITESPACE:d,LETTERSPACING:h,BREAKON:f,INNER_WIDTH:t};return l.inlines.reduce((_,g,y,v)=>{const w=g.kerning?g.kerning:0,E=g.xoffset?g.xoffset:0,b=g.xadvance?g.xadvance:g.width;return c8(v,y,_,p)?(r.push([g]),g.offsetX=E,0===g.width?0:b+h):(r[r.length-1].push(g),g.offsetX=_+E+w,_+b+w+h)},c)},0);let s=0,o=0,a=-i/2;return r.forEach(c=>{if(c.lineHeight=c.reduce((u,h)=>Math.max(u,void 0!==h.lineHeight?h.lineHeight:h.height),0),c.lineBase=c.reduce((u,h)=>Math.max(u,void 0!==h.lineBase?h.lineBase:h.height),0),c.width=0,c.height=c.lineHeight,c[0]){const u=this.getWhiteSpace(),h=l8(c,u);c.forEach(d=>{d.offsetX-=h}),c.width=this.computeLineWidth(c),c.width>s&&(s=c.width),c.forEach(d=>{d.offsetY=a-d.height-d.anchor,d.lineHeight<c.lineHeight&&(d.offsetY-=c.lineBase-d.lineBase)}),c.y=a,o+=c.lineHeight+i,a-=c.lineHeight+i}}),r.height=o,r.width=s,r}calculateHeight(t){this.childrenInlines.forEach(i=>{i.isInlineBlock||(i._fitFontSize=i.getFontSize()*t,i.calculateInlines(i._fitFontSize))});const r=this.computeLines();return Math.abs(r.height)}computeLineWidth(t){const i=t[t.length-1];return i.offsetX+i.width+t[0].offsetX}}}const qxe=new Nt.FileLoader,lP=[],vx={},Xxe=new Nt.TextureLoader,uP=[],wx={},si={};function hP(n){if(n._kernings)return;const e={};for(let t=0;t<n.kernings.length;t++){const r=n.kernings[t];0!==r.amount&&(e[String.fromCharCode(r.first,r.second)]=r.amount)}n._kernings=e}const C_={setFontFamily:function Yxe(n,e){"string"==typeof e?function Qxe(n,e){-1===lP.indexOf(e)&&(lP.push(e),qxe.load(e,t=>{const r=JSON.parse(t);hP(r),vx[e]=r;for(const i of Object.keys(si))e===si[i].jsonURL&&si[i].component._updateFontFamily(r)})),si[n.id]||(si[n.id]={component:n}),si[n.id].jsonURL=e,vx[e]&&n._updateFontFamily(vx[e])}(n,e):(si[n.id]||(si[n.id]={component:n}),hP(e),si[n.id].json=e,n._updateFontFamily(e))},setFontTexture:function Kxe(n,e){-1===uP.indexOf(e)&&(uP.push(e),Xxe.load(e,t=>{t.generateMipmaps=!1,t.minFilter=Nt.LinearFilter,t.magFilter=Nt.LinearFilter,wx[e]=t;for(const r of Object.keys(si))e===si[r].textureURL&&si[r].component._updateFontTexture(t)})),si[n.id]||(si[n.id]={component:n}),si[n.id].textureURL=e,wx[e]&&n._updateFontTexture(wx[e])},getFontOf:function v8(n){const e=si[n.id];return!e&&n.parentUI?v8(n.parentUI):e},addFont:function Zxe(n,e,t){t.generateMipmaps=!1,t.minFilter=Nt.LinearFilter,t.magFilter=Nt.LinearFilter,lP.push(n),vx[n]=e,hP(e),t&&(uP.push(n),wx[n]=t)}};let M_=(()=>{class n{static requestUpdate(t,r,i,s){t.traverse(o=>{o.isUI&&(this.requestedUpdates[o.id]?(r&&(this.requestedUpdates[o.id].updateParsing=!0),i&&(this.requestedUpdates[o.id].updateLayout=!0),s&&(this.requestedUpdates[o.id].updateInner=!0)):this.requestedUpdates[o.id]={updateParsing:r,updateLayout:i,updateInner:s,needCallback:r||i||s})})}static register(t){this.components.includes(t)||this.components.push(t)}static disposeOf(t){const r=this.components.indexOf(t);r>-1&&this.components.splice(r,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const t=this.components.filter(r=>!r.parentUI);t.forEach(r=>this.traverseParsing(r)),t.forEach(r=>this.traverseUpdates(r))}}static traverseParsing(t){const r=this.requestedUpdates[t.id];r&&r.updateParsing&&(t.parseParams(),r.updateParsing=!1),t.childrenUIs.forEach(i=>this.traverseParsing(i))}static traverseUpdates(t){const r=this.requestedUpdates[t.id];delete this.requestedUpdates[t.id],r&&r.updateLayout&&(r.updateLayout=!1,t.updateLayout()),r&&r.updateInner&&(r.updateInner=!1,t.updateInner()),t.childrenUIs.forEach(i=>{this.traverseUpdates(i)}),r&&r.needCallback&&t.onAfterUpdate()}}return n.components=[],n.requestedUpdates={},n})();const Vr={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",bestFit:"none",offset:.01,interLine:.01,breakOn:"- ,.:?!\n",whiteSpace:Hf,contentDirection:mx,alignItems:QR,justifyContent:JR,textAlign:aP,textType:"MSDF",fontColor:new Nt.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new Nt.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new Nt.Color(2236962),backgroundWhiteColor:new Nt.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,getDefaultTexture:function Jxe(){if(!Ex){const n=document.createElement("canvas").getContext("2d");n.canvas.width=1,n.canvas.height=1,n.fillStyle="#ffffff",n.fillRect(0,0,1,1),Ex=new Nt.CanvasTexture(n.canvas),Ex.isDefault=!0}return Ex},hiddenOverflow:!1,letterSpacing:0};let Ex;function xx(n){return class extends n{constructor(t){super(t),xt(this,"_rebuildParentUI",()=>{this.parentUI=this.parent&&this.parent.isUI?this.parent:null}),this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const t=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const r=this.parentUI.getHeight()/2-(this.parentUI.padding||0),i=this.parentUI.getWidth()/2-(this.parentUI.padding||0),s=[new Nt.Plane(new Nt.Vector3(0,1,0),r),new Nt.Plane(new Nt.Vector3(0,-1,0),r),new Nt.Plane(new Nt.Vector3(1,0,0),i),new Nt.Plane(new Nt.Vector3(-1,0,0),i)];s.forEach(o=>{o.applyMatrix4(this.parent.matrixWorld)}),t.push(...s)}this.parentUI.parentUI&&t.push(...this.parentUI.getClippingPlanes())}return t}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(t){return void 0===this[t]&&this.parentUI?this.parent._getProperty(t):void 0!==this[t]?this[t]:Vr[t]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return void 0===this.fontTexture&&this.parentUI?this.parent._getProperty("fontTexture"):void 0!==this.fontTexture?this.fontTexture:Vr.getDefaultTexture()}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:Vr.container}getParentsNumber(t){return t=t||0,this.parentUI?this.parentUI.getParentsNumber(t+1):t}getBackgroundOpacity(){return this.backgroundOpacity||0===this.backgroundOpacity?this.backgroundOpacity:Vr.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||Vr.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||Vr.getDefaultTexture()}getAlignContent(){return this.alignContent||Vr.alignContent}getAlignItems(){return this.alignItems||Vr.alignItems}getContentDirection(){return this.contentDirection||Vr.contentDirection}getJustifyContent(){return this.justifyContent||Vr.justifyContent}getInterLine(){return void 0===this.interLine?Vr.interLine:this.interLine}getOffset(){return void 0===this.offset?Vr.offset:this.offset}getBackgroundSize(){return void 0===this.backgroundSize?Vr.backgroundSize:this.backgroundSize}getHiddenOverflow(){return void 0===this.hiddenOverflow?Vr.hiddenOverflow:this.hiddenOverflow}getBestFit(){return void 0===this.bestFit?Vr.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter(t=>t.isUI),this.childrenBoxes=this.children.filter(t=>t.isBoxComponent),this.childrenInlines=this.children.filter(t=>t.isInline),this.childrenTexts=this.children.filter(t=>t.isText)}add(){for(const r of Object.keys(arguments))arguments[r].isInline&&this.update(null,!0);const t=super.add(...arguments);return this._rebuildChildrenLists(),t}remove(){for(const r of Object.keys(arguments))arguments[r].isInline&&this.update(null,!0);const t=super.remove(...arguments);return this._rebuildChildrenLists(),t}update(t,r,i){M_.requestUpdate(this,t,r,i)}onAfterUpdate(){}_updateFontFamily(t){this.fontFamily=t,this.traverse(r=>{r.isUI&&r.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(t){this.fontTexture=t,this.getHighestParent().update(!1,!0,!1)}set(t){let r,i,s;if(M_.register(this),t&&JSON.stringify(t)!==JSON.stringify({})){t.alignContent&&(t.alignItems=t.alignContent,t.textAlign||(t.textAlign=t.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete t.alignContent),t.alignItems&&i8(t.alignItems);for(const o of Object.keys(t))if(this[o]!=t[o])switch(o){case"content":case"fontSize":case"fontKerning":case"breakOn":case"whiteSpace":this.isText&&(r=!0),i=!0,this[o]=t[o];break;case"bestFit":this.isBlock&&(r=!0,i=!0),this[o]=t[o];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&"none"!=this.getBestFit())&&(r=!0),i=!0,this[o]=t[o];break;case"letterSpacing":case"interLine":this.isBlock&&"none"!=this.getBestFit()&&(r=!0),i=!0,this[o]=t[o];break;case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":i=!0,this[o]=t[o];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":s=!0,this[o]=t[o];break;case"hiddenOverflow":this[o]=t[o]}t.fontFamily&&C_.setFontFamily(this,t.fontFamily),t.fontTexture&&C_.setFontTexture(this,t.fontTexture),this.parentUI&&"none"!=this.parentUI.getBestFit()&&this.parentUI.update(!0,!0,!1),this.update(r,i,s),i&&this.getHighestParent().update(!1,!0,!1)}}setupState(t){this.states[t.state]={attributes:t.attributes,onSet:t.onSet}}setState(t){const r=this.states[t];r?t!==this.currentState&&(this.currentState=t,r.onSet&&r.onSet(),r.attributes&&this.set(r.attributes)):console.warn(`state "${t}" does not exist within this component:`,this.name)}clear(){this.traverse(t=>{M_.disposeOf(t),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()})}}}function dP(n){return class extends n{constructor(t){super(t),this.textUniforms={u_texture:{value:this.getFontTexture()},u_color:{value:this.getFontColor()},u_opacity:{value:this.getFontOpacity()},u_pxRange:{value:this.getFontPXRange()},u_useRGSS:{value:this.getFontSupersampling()}},this.backgroundUniforms={u_texture:{value:this.getBackgroundTexture()},u_color:{value:this.getBackgroundColor()},u_opacity:{value:this.getBackgroundOpacity()},u_backgroundMapping:{value:this.getBackgroundSize()},u_borderWidth:{value:this.getBorderWidth()},u_borderColor:{value:this.getBorderColor()},u_borderRadiusTopLeft:{value:this.getBorderRadius()},u_borderRadiusTopRight:{value:this.getBorderRadius()},u_borderRadiusBottomRight:{value:this.getBorderRadius()},u_borderRadiusBottomLeft:{value:this.getBorderRadius()},u_borderOpacity:{value:this.getBorderOpacity()},u_size:{value:new Nt.Vector2(1,1)},u_tSize:{value:new Nt.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||Vr.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=this.backgroundOpacity||0===this.backgroundOpacity?this.backgroundOpacity:Vr.backgroundOpaqueOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const t=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(t)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=t[0],this.backgroundUniforms.u_borderRadiusTopRight.value=t[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=t[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=t[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=t,this.backgroundUniforms.u_borderRadiusTopRight.value=t,this.backgroundUniforms.u_borderRadiusBottomRight.value=t,this.backgroundUniforms.u_borderRadiusBottomLeft.value=t)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return(!this.backgroundMaterial||!this.backgroundUniforms)&&(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return(!this.fontMaterial||!this.textUniforms)&&(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new Nt.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:ebe,fragmentShader:tbe,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new Nt.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:nbe,fragmentShader:rbe,extensions:{derivatives:!0}})}updateClippingPlanes(t){const r=void 0!==t?t:this.getClippingPlanes();JSON.stringify(r)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=r,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const ebe="\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvUv = uv;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\tgl_Position.z -= 0.00001;\n\n\t#include <clipping_planes_vertex>\n\n}\n",tbe="\n\nuniform sampler2D u_texture;\nuniform vec3 u_color;\nuniform float u_opacity;\nuniform float u_pxRange;\nuniform bool u_useRGSS;\n\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_fragment>\n\n// functions from the original msdf repo:\n// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field\n\nfloat median(float r, float g, float b) {\n\treturn max(min(r, g), min(max(r, g), b));\n}\n\nfloat screenPxRange() {\n\tvec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));\n\tvec2 screenTexSize = vec2(1.0)/fwidth(vUv);\n\treturn max(0.5*dot(unitRange, screenTexSize), 1.0);\n}\n\nfloat tap(vec2 offsetUV) {\n\tvec3 msd = texture( u_texture, offsetUV ).rgb;\n\tfloat sd = median(msd.r, msd.g, msd.b);\n\tfloat screenPxDistance = screenPxRange() * (sd - 0.5);\n\tfloat alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\treturn alpha;\n}\n\nvoid main() {\n\n\tfloat alpha;\n\n\tif ( u_useRGSS ) {\n\n\t\t// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec\n\t\t// per pixel partial derivatives\n\t\tvec2 dx = dFdx(vUv);\n\t\tvec2 dy = dFdy(vUv);\n\n\t\t// rotated grid uv offsets\n\t\tvec2 uvOffsets = vec2(0.125, 0.375);\n\t\tvec2 offsetUV = vec2(0.0, 0.0);\n\n\t\t// supersampled using 2x2 rotated grid\n\t\talpha = 0.0;\n\t\toffsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;\n\t\talpha += tap(offsetUV);\n\t\toffsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;\n\t\talpha += tap(offsetUV);\n\t\talpha *= 0.25;\n\n\t} else {\n\n\t\talpha = tap( vUv );\n\n\t}\n\n\n\t// apply the opacity\n\talpha *= u_opacity;\n\n\t// this is useful to avoid z-fighting when quads overlap because of kerning\n\tif ( alpha < 0.02) discard;\n\n\n\tgl_FragColor = vec4( u_color, alpha );\n\n\t#include <clipping_planes_fragment>\n\n}\n",nbe="\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvUv = uv;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <clipping_planes_vertex>\n\n}\n",rbe="\n\nuniform sampler2D u_texture;\nuniform vec3 u_color;\nuniform float u_opacity;\n\nuniform float u_borderRadiusTopLeft;\nuniform float u_borderRadiusTopRight;\nuniform float u_borderRadiusBottomLeft;\nuniform float u_borderRadiusBottomRight;\nuniform float u_borderWidth;\nuniform vec3 u_borderColor;\nuniform float u_borderOpacity;\nuniform vec2 u_size;\nuniform vec2 u_tSize;\nuniform int u_backgroundMapping;\n\nvarying vec2 vUv;\n\n#include <clipping_planes_pars_fragment>\n\nfloat getEdgeDist() {\n\tvec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );\n\tvec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );\n\tvec2 corner = u_size * 0.5;\n\tvec2 offsetCorner = corner - abs( planeSpaceCoord );\n\tfloat innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;\n\tif (vUv.x < 0.5 && vUv.y >= 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x >= 0.5 && vUv.y >= 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusTopRight );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x >= 0.5 && vUv.y < 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n\tif (vUv.x < 0.5 && vUv.y < 0.5) {\n\t\tfloat roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;\n\t\tfloat s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );\n\t\treturn mix( innerRadDist, roundedDist, s );\n\t}\n}\n\nvec4 sampleTexture() {\n\tfloat textureRatio = u_tSize.x / u_tSize.y;\n\tfloat panelRatio = u_size.x / u_size.y;\n\tvec2 uv = vUv;\n\tif ( u_backgroundMapping == 1 ) { // contain\n\t\tif ( textureRatio < panelRatio ) { // repeat on X\n\t\t\tfloat newX = uv.x * ( panelRatio / textureRatio );\n\t\t\tnewX += 0.5 - 0.5 * ( panelRatio / textureRatio );\n\t\t\tuv.x = newX;\n\t\t} else { // repeat on Y\n\t\t\tfloat newY = uv.y * ( textureRatio / panelRatio );\n\t\t\tnewY += 0.5 - 0.5 * ( textureRatio / panelRatio );\n\t\t\tuv.y = newY;\n\t\t}\n\t} else if ( u_backgroundMapping == 2 ) { // cover\n\t\tif ( textureRatio < panelRatio ) { // stretch on Y\n\t\t\tfloat newY = uv.y * ( textureRatio / panelRatio );\n\t\t\tnewY += 0.5 - 0.5 * ( textureRatio / panelRatio );\n\t\t\tuv.y = newY;\n\t\t} else { // stretch on X\n\t\t\tfloat newX = uv.x * ( panelRatio / textureRatio );\n\t\t\tnewX += 0.5 - 0.5 * ( panelRatio / textureRatio );\n\t\t\tuv.x = newX;\n\t\t}\n\t}\n\treturn texture2D( u_texture, uv ).rgba;\n}\n\nvoid main() {\n\n\tfloat edgeDist = getEdgeDist();\n\tfloat change = fwidth( edgeDist );\n\n\tvec4 textureSample = sampleTexture();\n\tvec3 blendedColor = textureSample.rgb * u_color;\n\n\tfloat alpha = smoothstep( change, 0.0, edgeDist );\n\tfloat blendedOpacity = u_opacity * textureSample.a * alpha;\n\n\tvec4 frameColor = vec4( blendedColor, blendedOpacity );\n\n\tif ( u_borderWidth <= 0.0 ) {\n\t\tgl_FragColor = frameColor;\n\t} else {\n\t\tvec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );\n\t\tfloat stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );\n\t\tgl_FragColor = mix( frameColor, borderColor, stp );\n\t}\n\n\t#include <clipping_planes_fragment>\n}\n";class w8 extends Nt.Mesh{constructor(e){super(new Nt.PlaneGeometry,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let bx=null;function Gf(...n){if(!bx)throw new Error("Cannot use mixins with Base null");let e=bx;bx=null;let r,t=n.length;for(;--t>=0;)r=n[t],e=r(e);return e}Gf.withBase=n=>(bx=n,Gf);class I_ extends(Gf.withBase(Nt.Object3D)(sP,y8,dP,xx)){constructor(e){super(e),this.isBlock=!0,this.size=new Nt.Vector2(1,1),this.frame=new w8(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();"none"!=e&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach(t=>{t._fitFontSize=void 0})}updateLayout(){const e=this.getWidth(),t=this.getHeight();e&&t?(this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())):console.warn("Block got no dimension from its parameters or from children parameters")}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function E8(n){return class extends n{constructor(t){super(t),this.isInline=!0}}}function x8(n){let e,t,r,i=0;for(let a=0;a<n.length;++a){const c=n[a];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=c.array.constructor),e!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===t&&(t=c.itemSize),t!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=c.normalized),r!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=c.array.length}const s=new e(i);let o=0;for(let a=0;a<n.length;++a)s.set(n[a].array,o),o+=n[a].array.length;return new Nt.BufferAttribute(s,t,r)}class sbe extends Nt.PlaneGeometry{constructor(e,t){const r=e.glyph,i=e.fontSize;super(e.width,e.height),null===r.match(/\s/g)?(-1===t.info.charset.indexOf(r)&&console.error(`The character '${r}' is not included in the font characters set.`),this.mapUVs(t,r),this.transformGeometry(e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){const r=e.chars.find(u=>u.char===t),i=e.common,s=r.x/i.scaleW,o=(r.x+r.width)/i.scaleW,a=1-(r.y+r.height)/i.scaleH,c=1-r.y/i.scaleH,l=this.attributes.uv;for(let u=0;u<l.count;u++){let h=l.getX(u),d=l.getY(u);[h,d]=(()=>{switch(u){case 0:return[s,c];case 1:return[o,c];case 2:return[s,a];case 3:return[o,a]}})(),l.setXY(u,h,d)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e){this.translate(e.width/2,e.height/2,0)}}const fP={getGlyphDimensions:function obe(n){const e=n.font,t=n.fontSize,r=n.glyph,i=t/e.info.size,s=e.chars.find(h=>h.char===r);let o=s?s.width*i:t/3,a=s?s.height*i:0;return 0===o&&(o=s?s.xadvance*i:t),0===a&&(a=.7*t),"\n"===r&&(o=0),{width:o,height:a,anchor:s?s.yoffset*i:0,xadvance:s?s.xadvance*i:o,xoffset:s?s.xoffset*i:0}},getGlyphPairKerning:function abe(n,e){const t=n._kernings;return t[e]?t[e]:0},buildText:function cbe(){const n=[];this.inlines.forEach((r,i)=>{n[i]=new sbe(r,this.getFontFamily()),n[i].translate(r.offsetX,r.offsetY,0)});const e=function ibe(n,e=!1){const t=null!==n[0].index,r=new Set(Object.keys(n[0].attributes)),i=new Set(Object.keys(n[0].morphAttributes)),s={},o={},a=n[0].morphTargetsRelative,c=new Nt.BufferGeometry;let l=0;for(let u=0;u<n.length;++u){const h=n[u];let d=0;if(t!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in h.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[f]&&(s[f]=[]),s[f].push(h.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in h.morphAttributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[f]&&(o[f]=[]),o[f].push(h.morphAttributes[f])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(h.userData),e){let f;if(t)f=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;f=h.attributes.position.count}c.addGroup(l,f,u),l+=f}}if(t){let u=0;const h=[];for(let d=0;d<n.length;++d){const f=n[d].index;for(let p=0;p<f.count;++p)h.push(f.getX(p)+u);u+=n[d].attributes.position.count}c.setIndex(h)}for(const u in s){const h=x8(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;c.setAttribute(u,h)}for(const u in o){const h=o[u][0].length;if(0===h)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[u]=[];for(let d=0;d<h;++d){const f=[];for(let m=0;m<o[u].length;++m)f.push(o[u][m][d]);const p=x8(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;c.morphAttributes[u].push(p)}}return c}(n);return new Nt.Mesh(e,this.getFontMaterial())}};function lbe(n){return class extends n{createText(){const t=this,r=(()=>{if("MSDF"===this.getTextType())return fP.buildText.call(this);console.warn(`'${this.getTextType()}' is not a supported text type.\nSee https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`)})();return r.renderOrder=1/0,r.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},r}getGlyphDimensions(t){if("MSDF"===t.textType)return fP.getGlyphDimensions(t);console.warn(`'${t.textType}' is not a supported text type.\nSee https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`)}getGlyphPairKerning(t,r,i){if("MSDF"===t)return fP.getGlyphPairKerning(r,i);console.warn(`'${t}' is not a supported text type.\nSee https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`)}}}const ube=function T8(n){n.children.forEach(e=>{e.children.length>0&&T8(e),n.remove(e),M_.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),n.children=[]};class pP extends(Gf.withBase(Nt.Object3D)(E8,lbe,dP,xx)){constructor(e){super(e),this.isText=!0,this.set(e)}parseParams(){this.calculateInlines(this._fitFontSize||this.getFontSize())}updateLayout(){ube(this),this.inlines&&(this.textContent=this.createText(),this.updateTextMaterial(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){const t=this.content,r=this.getFontFamily(),i=this.getBreakOn(),s=this.getTextType(),o=this.getWhiteSpace();if(!r||"string"==typeof r)return void(C_.getFontOf(this)||console.warn("no font was found"));if(!this.content)return void(this.inlines=null);if(!s)return void console.error("You must provide a 'textType' attribute so three-mesh-ui knows how to render your text.\n See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type");const a=o8(t,o),c=Array.from?Array.from(a):String(a).split(""),l=e/r.info.size,u=r.common.lineHeight*l,h=r.common.base*l,d=c.map(f=>{const p=this.getGlyphDimensions({textType:s,glyph:f,font:r,fontSize:e});let m=null;return o!==zf&&(i.includes(f)||f.match(/\s/g))&&(m="possible"),f.match(/\n/g)&&(m=a8(o)),{height:p.height,width:p.width,anchor:p.anchor,xadvance:p.xadvance,xoffset:p.xoffset,lineBreak:m,glyph:f,fontSize:e,lineHeight:u,lineBase:h}});if("none"!==this.getFontKerning())for(let f=1;f<d.length;f++){const p=d[f],_=this.getGlyphPairKerning(s,r,d[f-1].glyph+d[f].glyph);p.kerning=_*(e/r.info.size)}this.inlines=d}}class mP extends(Gf.withBase(Nt.Object3D)(E8,sP,y8,dP,xx)){constructor(e){super(e),this.isInlineBlock=!0,this.size=new Nt.Vector2(1,1),this.frame=new w8(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const r=this.inlines[0];this.position.set(r.width/2,r.height/2,0),this.position.x+=r.offsetX,this.position.y+=r.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const Gc_fr=[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_eng=[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_ru=[[[{width:1/12,chars:[{lowerCase:"\u0439",upperCase:"\u0419"},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"\u0446",upperCase:"\u0426"},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"\u0443",upperCase:"\u0423"},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"\u043a",upperCase:"\u041a"},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"\u0435",upperCase:"\u0415"},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"\u043d",upperCase:"\u041d"},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"\u0433",upperCase:"\u0413"},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"\u0448",upperCase:"\u0428"},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"\u0449",upperCase:"\u0429"},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"\u0437",upperCase:"\u0417"},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"\u0445",upperCase:"\u0425"},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"\u044a",upperCase:"\u042a"},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"\u0444",upperCase:"\u0424"},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"\u044b",upperCase:"\u042b"},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"\u0432",upperCase:"\u0412"},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"\u0430",upperCase:"\u0410"},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"\u043f",upperCase:"\u041f"},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"\u0440",upperCase:"\u0420"},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"\u043e",upperCase:"\u041e"},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"\u043b",upperCase:"\u041b"},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"\u0434",upperCase:"\u0414"},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"\u0436",upperCase:"\u0416"},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"\u044d",upperCase:"\u042d"},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"\u0451",upperCase:"\u0401"},{lowerCase:"|",upperCase:"\\"}]}],[{width:.125,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"\u044f",upperCase:"\u042f"},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"\u0447",upperCase:"\u0427"},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"\u0441",upperCase:"\u0421"},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"\u043c",upperCase:"\u041c"},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"\u0438",upperCase:"\u0418"},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"\u0442",upperCase:"\u0422"},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"\u044c",upperCase:"\u042c"},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"\u0431",upperCase:"\u0411"},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"\u044e",upperCase:"\u042e"},{lowerCase:".",upperCase:""}]},{width:.125,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:"\u0410\u0411\u0412"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_de=[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xfc",upperCase:"\xdc"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xf6",upperCase:"\xd6"}]},{width:1/11,chars:[{lowerCase:"\xe4",upperCase:"\xc4"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_es=[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"\xf1",upperCase:"\xd1"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_el=[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"\u03c2",upperCase:"\u03c2"},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"\u03b5",upperCase:"\u0395"},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"\u03c1",upperCase:"\u03a1"},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"\u03c4",upperCase:"\u03a4"},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"\u03c5",upperCase:"\u03a5"},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"\u03b8",upperCase:"\u0398"},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"\u03b9",upperCase:"\u0399"},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"\u03bf",upperCase:"\u039f"},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"\u03c0",upperCase:"\u03a0"},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"\u03b1",upperCase:"\u0391"},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"\u03c3",upperCase:"\u03a3"},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"\u03b4",upperCase:"\u0394"},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"\u03c6",upperCase:"\u03a6"},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"\u03b3",upperCase:"\u0393"},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"\u03b7",upperCase:"\u0397"},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"\u03be",upperCase:"\u039e"},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"\u03ba",upperCase:"\u039a"},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"\u03bb",upperCase:"\u039b"},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"\u03b6",upperCase:"\u0396"},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"\u03c7",upperCase:"\u03a7"},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"\u03c8",upperCase:"\u03a8"},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"\u03c9",upperCase:"\u03a9"},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"\u03b2",upperCase:"\u0392"},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"\u03bd",upperCase:"\u039d"},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"\u03bc",upperCase:"\u039c"},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],Gc_nord=[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xe5",upperCase:"\xc5"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xe6",upperCase:"\xc6"}]},{width:1/11,chars:[{lowerCase:"\xf8",upperCase:"\xd8"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],hbe=new Nt.TextureLoader;class S8 extends(Gf.withBase(Nt.Object3D)(sP,xx)){constructor(e){let t;if(e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1,e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Gc_fr;break;case"ru":this.charsetCount=2,t=Gc_ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=Gc_de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=Gc_es;break;case"el":this.charsetCount=2,t=Gc_el;break;case"nord":t=Gc_nord;break;default:t=Gc_eng}else t=Gc_eng;this.keys=[],this.panels=t.map(r=>{const i=e.height/r.length-2*e.margin,s=new I_({width:e.width+2*e.padding,height:e.height+2*e.padding,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return s.charset=0,s.add(...r.map(o=>{const a=new I_({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});a.frame.visible=!1;const c=[];return o.forEach(l=>{const u=new I_({width:e.width*l.width-2*e.margin,height:i,margin:e.margin,justifyContent:"center",offset:0}),h=l.chars[s.charset].lowerCase||l.chars[s.charset].icon||"undif";if("enter"===h&&e.enterTexture||"shift"===h&&e.shiftTexture||"backspace"===h&&e.backspaceTexture){const d=(()=>{switch(h){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();hbe.load(d,f=>{u.add(new mP({width:.65*u.width,height:.65*u.height,backgroundSize:"contain",backgroundTexture:f}))})}else u.add(new pP({content:h,offset:0}));u.type="Key",u.info=l,u.info.input=h,u.panel=s,c.push(u),this.keys.push(u)}),a.add(...c),a})),s}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const r=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!r.upperCase?r.lowerCase:r.upperCase;if(!e.childrenTexts.length)return;const s=e.childrenTexts[0];e.info.input=i,s.set({content:i}),s.update(!0,!0,!0)})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],r=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const i=e.childrenTexts[0];e.info.input=r,i.set({content:r}),i.update(!0,!0,!0)})}parseParams(){}updateLayout(){}updateInner(){}}const A8=()=>M_.update(),C8={Block:I_,Text:pP,InlineBlock:mP,Keyboard:S8,FontLibrary:C_,update:A8,TextAlign:px,Whitespace:fx,JustifyContent:dx,AlignItems:hx,ContentDirection:ux};typeof global<"u"&&(global.ThreeMeshUI=C8);const dbe=C8;var jf=hs.gO,gP=hs.xv,fbe=hs.Vx;let _P=(()=>{var n;class e{constructor(r,i){this.interactions=r,this.debug=i,this.FontJSON="assets/fonts/Roboto-msdf.json",this.FontImage="assets/fonts/Roboto-msdf.png",this.selectState=!1,this.buttonOptions={width:.4,height:.15,justifyContent:"center",offset:.05,margin:.02,borderRadius:.075},this.defaultOptions={name:"Button Panel Container",buttons:[{name:"Next Button",text:"Next",onClick:s=>{console.log("Next Button is clicked")},onHover:s=>{console.log("Next Button is hovered")},buttonOptions:{width:.4,height:.15,justifyContent:"center",offset:.05,margin:.02,borderRadius:.075}},{name:"Prev Button",text:"Previous",onClick:s=>{console.log("Previous Button is clicked")},onHover:s=>{console.log("Previous Button is hovered")},buttonOptions:{width:.4,height:.15,justifyContent:"center",offset:.05,margin:.02,borderRadius:.075}}]},this.idleStateAttributes={state:"idle",attributes:{width:.4,height:.15,offset:.035,backgroundColor:new J(6710886),backgroundOpacity:.3,fontColor:new J(16777215)},onSet:s=>{}},this.hoveredStateAttributes={state:"hovered",attributes:{width:.4,height:.15,offset:.035,backgroundColor:new J(10066329),backgroundOpacity:1,fontColor:new J(16777215)},onSet:s=>{}},this.selectedAttributes={offset:.02,backgroundColor:new J(7829367),fontColor:new J(2236962)},this.hemLight=new TR(8421504,6316128),this.selected=0,this.selection=[1,2,3]}createMoreInfoPanels(r){const i=new jf({ref:"container",padding:.02,fontFamily:this.FontJSON,fontTexture:this.FontImage,fontColor:new J(16777215),fontSize:.3,backgroundOpacity:.5,width:1,height:2});i.rotation.y=-.5,i.name=`More Info Panel ${r.id}`;const s=new jf({height:.2,width:.9,margin:.05,justifyContent:"center",fontSize:.15}),o=new gP({content:`${r.title} `});o.name=`${r.id} Text`,s.add(o),s.name=`Painting ${r.id} title`,this.title=s,i.add(this.title);const a=new jf({height:1.6,width:.9,margin:.01,padding:.02,fontSize:.15,alignItems:"start",textAlign:"justify",backgroundOpacity:0,bestFit:"auto"}).add(new gP({content:r.description}));a.name="Artwork Description";const c=new jf({padding:.02,margin:.025,backgroundOpacity:.2,height:1.6,width:.9,justifyContent:"center",bestFit:"grow",fontSize:5});return c.name="Content Container",this.description=a,c.add(this.description),i.add(c),i}updateInfoPanel(r){this.description.children[1].set({content:String(r.description)}),console.log("updating Panel title",r.title,r.votes),this.title.children[1].set({content:`${r.title}: ${r.votes} likes`})}updateVote(r){const i=`${r.text.content.split(":")[0]} : ${r.votes} likes`;r.text.set({content:i})}createInteractiveButtons(r){const i=Object.assign({},this.defaultOptions,r),s=new jf({justifyContent:"center",contentDirection:"row-reverse",fontFamily:this.FontJSON,fontTexture:this.FontImage,fontSize:.1,padding:.02,borderRadius:.11,height:.2,width:r.buttons.length/2});return s.name=i.name,this.container=s,i.buttons.forEach((o,a)=>{const c=this.createButton(i.id,o);this.container.add(c)}),s}createButton(r,i){const s=new jf(this.buttonOptions);return s.name=`Frame ${r} ${i.name}`,s.add(new gP({content:i.text,name:`${i.name} Text`})),s.setupState({state:"selected",attributes:this.selectedAttributes}),s.setupState(this.idleStateAttributes),s.setupState(this.hoveredStateAttributes),s.position.set(-.5,0,0),this.interactions.addToInteractions(s),this.interactions.addToColliders({mesh:s,name:i.name,cb:()=>{i.onClick(r)}}),s.addEventListener("click",()=>{i.onClick(r)}),s}update(){fbe()}}return(n=e).\u0275fac=function(r){return new(r||n)(De(lx),De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:null}),e})(),M8=(()=>{var n;class e{constructor(r,i,s,o,a,c,l){this.objectsService=r,this.interactionsService=i,this.lightsService=s,this.loadersService=o,this.materialsService=a,this.uiService=c,this.debug=l,this.frameDistance=7,this.angle=0,this.frames=[],this.locations=[],this.focusFactor=4,this.framesGroup=new Js,this.frameButton=this.objectsService.createIcosahedron({radius:.12,detail:0})}createFrames(r=[],i=[],s){return this.framesGroup.name="Frames Group",this.angle=2*Math.PI/r.length,this.frames=r.map((o,a)=>this.placeFrame(this.createFrame(o,i,a),a)),this.framesGroup.add(...this.frames),this.framesGroup.position.set(0,1.6,0),this.focusFrame(0),this.framesGroup}placeFrame(r,i=0){const s=i*this.angle,o=Math.sin(s)*this.frameDistance,a=-Math.cos(s)*this.frameDistance;r.position.set(o,0,a),r.scale.set(1.3,1.3,1.3),r.rotation.y=s,r.userData.originalPosition=r.position.clone();const c=this.lightsService.createDirLight({intensity:.4})[0];return c.castShadow=!0,c.position.set(Math.sin(s),2,Math.cos(s)),c.name=`${r.name} dir light`,c.target.position.set(o,0,a),c.target.updateWorldMatrix(),r}createFrame(r,i=[],s){const o=new Js;o.name=` ${r.title} frame group`;const a=new lu(.8,.7,.1,36,5);a.rotateX(Math.PI/2);const c=new Da(r?.width/100,r?.height/100,.15),l=this.loadersService.loadTexture(r.textureUrl);l.colorSpace=an,l.minFilter=l.magFilter=Sn,l.mapping=300;const u=new Na({map:l,color:16777215}),h=new Na({color:16777215}),d=new Kt(a,h),f=new Kt(c,u);d.name=` ${r.title} frame mesh`||"frame",f.name=` ${r.title} canvas mesh`||"frame canvas";const p=this.lightsService.createSpotLight();p[0].target=f,o.add(d,f,...p),o.rotateY(Math.PI);const m=this.uiService.createInteractiveButtons({buttons:i,id:r.id}),_=this.uiService.createMoreInfoPanels({id:r.id,title:r.title,description:r.description,votes:r.votes});return _.quaternion.copy(d.quaternion),m.position.x=0,m.position.y=-1.2,m.rotateY(Math.PI),m.rotateX(-.55),_.position.x=1.3,_.rotateY(-72),o.add(_,m),o}createButton(r,i){let s;return s=this.frameButton.clone(),s.name=`Frame ${i} ${r.name}`,s.position.set(r.position.x,r.position.y,r.position.z),this.interactionsService.addToInteractions(s),this.interactionsService.addToColliders({mesh:s,name:r.name,cb:()=>{r.onClick(i)}}),s.addEventListener("click",o=>{r.onClick(i)}),s}focusFrame(r){const i=this.frames[r],a=new M(i.position.x/this.frameDistance*this.focusFactor,i.position.y,i.position.z/this.frameDistance*this.focusFactor);this.moveFrame(i,a)}resetPosition(r){const i=this.frames[r];this.moveFrame(i,i.userData.originalPosition)}animateFrameColors(r,i){console.log(r.material),$d.to(r.material.color,{r:144,g:140,b:209,duration:2})}moveFrame(r,i){$d.to(r.position,{x:i.x,y:i.y,z:i.z,duration:2.5})}rotateFrames(r=72){const i=ef_degToRad(r)+this.framesGroup.rotation.y;$d.to(this.framesGroup.rotation,{y:i,duration:1})}}return(n=e).\u0275fac=function(r){return new(r||n)(De(j6),De(lx),De(W6),De(YR),De(BR),De(_P),De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();new J(7837819),new J(8280859),new J(4612974),new J(8295294),new J(9547681),new J(3233839),new J(3568944),new J(16442160),new J(8832927),new J(1131367),new J(6382612),new J(12295171),new J(9061405),new J(10199343),new J(14799969);const jc={white:new J(16777215),black:new J(0),grey:new J(8421504),background:new J(0),bg:new J(10526880),gray:new J(7829367),darkGreen:new J(25600),midGreen:new J(941139),lightGreen:new J(557426),red:new J(12063238),buttonBackground:new J(7829367),buttonFontColor:new J(2236962),hoveredBackground:new J(10066329),hoveredFontColor:new J(16777215)},I8=(new J(16711680),new J(16759552),new J(16776960),new J(65280),new J(255),new J(9699517),new J(13107435),{camera:{name:"Default Camera",type:"Perspective",near:.1,far:200,fov:30,width:window.innerWidth||500,height:window.innerHeight||700,position:{x:0,y:1.6,z:0},rotation:{x:0,y:0,z:0}},width:window.innerWidth||400,height:window.innerHeight||700,lights:{name:"Default Light",type:"directional",x:2,y:10,z:-2,color:16777215,intensity:2,width:10,near:.1,far:30,castShadow:!0,useHelpers:!1,helper:!0},xrMode:"inline",controls:{type:"orbit"},background:jc.background,fog:{color:0,near:1500,far:4e3}});class _be{static createButton(e){const t=document.createElement("button");function r(c){let l=null;function u(f){return h.apply(this,arguments)}function h(){return(h=Pe(function*(f){f.addEventListener("end",d),yield e.xr.setSession(f),t.textContent="STOP XR",l=f})).apply(this,arguments)}function d(){l.removeEventListener("end",d),t.textContent="START XR",l=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="START XR",t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){null===l?navigator.xr.requestSession(c,{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(u):l.end()}}function i(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function o(c){i(),console.warn("Exception when trying to call xr.isSessionSupported",c),t.textContent="XR NOT ALLOWED"}function a(c){c.style.position="absolute",c.style.bottom="20px",c.style.padding="12px 6px",c.style.border="1px solid #fff",c.style.borderRadius="4px",c.style.background="rgba(0,0,0,0.1)",c.style.color="#fff",c.style.font="normal 13px sans-serif",c.style.textAlign="center",c.style.opacity="0.5",c.style.outline="none",c.style.zIndex="999"}if("xr"in navigator)return t.id="XRButton",t.style.display="none",a(t),navigator.xr.isSessionSupported("immersive-ar").then(function(c){c?r("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?r("immersive-vr"):function s(){i(),t.textContent="XR NOT SUPPORTED"}()}).catch(o)}).catch(o),t;{const c=document.createElement("a");return!1===window.isSecureContext?(c.href=document.location.href.replace(/^http:/,"https:"),c.innerHTML="WEBXR NEEDS HTTPS"):(c.href="https://immersiveweb.dev/",c.innerHTML="WEBXR NOT AVAILABLE"),c.style.left="calc(50% - 90px)",c.style.width="180px",c.style.textDecoration="none",a(c),c}}}let D8=(()=>{var n;class e{constructor(){this.dummyCamera=new Kn,this.dolly=new Kn,this.theta=0,this.radius=5}createCamera(r){return this.camera=new Cr(r.fov,r.width/r.height,r.near,r.far),this.camera.position.set(r.position.x,r.position.y,24),this.camera.rotation.set(0,0,0),this.camera.name=r.name,this.camera}addDolly(){return this.dolly.add(this.camera),this.camera?.add(this.dummyCamera),this.dolly}moveDolly(r,i,s){}moveCamera(r,i,s,o){$d.to(this.camera.position,{x:r,y:i,z:s,duration:o})}rotateCamera(r,i,s){$d.to(this.camera.rotation,{x:r,y:i,z:s,duration:3.2})}animateCamera(r){this.theta+=.1,r.camera.position.x=this.radius*Math.sin(ef_degToRad(this.theta)),r.camera.position.y=this.radius*Math.sin(ef_degToRad(this.theta)),r.camera.position.z=this.radius*Math.cos(ef_degToRad(this.theta)),r.camera.lookAt(r.look)}updateCamera(r){r.look&&r.lookAt(r.look),r.camera.updateMatrixWorld()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})();const R8={type:"change"},yP={type:"start"},P8={type:"end"},Tx=new hf,N8=new Ra,ybe=Math.cos(70*ef_DEG2RAD);class vbe extends Zl{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(L){L.addEventListener("keydown",C),this._domElementKeyEvents=L},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",C),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(R8),r.update(),s=i.NONE},this.update=function(){const L=new M,ye=(new Fr).setFromUnitVectors(e.up,new M(0,1,0)),ie=ye.clone().invert(),st=new M,Ke=new Fr,Qe=new M,qe=2*Math.PI;return function(Ee=null){const ve=r.object.position;L.copy(ve).sub(r.target),L.applyQuaternion(ye),a.setFromVector3(L),r.autoRotate&&s===i.NONE&&O(function x(L){return null!==L?2*Math.PI/60*r.autoRotateSpeed*L:2*Math.PI/60/60*r.autoRotateSpeed}(Ee)),r.enableDamping?(a.theta+=c.theta*r.dampingFactor,a.phi+=c.phi*r.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let Me=r.minAzimuthAngle,xe=r.maxAzimuthAngle;isFinite(Me)&&isFinite(xe)&&(Me<-Math.PI?Me+=qe:Me>Math.PI&&(Me-=qe),xe<-Math.PI?xe+=qe:xe>Math.PI&&(xe-=qe),a.theta=Me<=xe?Math.max(Me,Math.min(xe,a.theta)):a.theta>(Me+xe)/2?Math.max(Me,a.theta):Math.min(xe,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(u,r.dampingFactor):r.target.add(u),a.radius=q(r.zoomToCursor&&b||r.object.isOrthographicCamera?a.radius:a.radius*l),L.setFromSpherical(a),L.applyQuaternion(ie),ve.copy(r.target).add(L),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,u.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),u.set(0,0,0));let ae=!1;if(r.zoomToCursor&&b){let He=null;if(r.object.isPerspectiveCamera){const at=L.length();He=q(at*l),r.object.position.addScaledVector(w,at-He),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const at=new M(E.x,E.y,0);at.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/l)),r.object.updateProjectionMatrix(),ae=!0;const sr=new M(E.x,E.y,0);sr.unproject(r.object),r.object.position.sub(sr).add(at),r.object.updateMatrixWorld(),He=L.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==He&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(He).add(r.object.position):(Tx.origin.copy(r.object.position),Tx.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Tx.direction))<ybe?e.lookAt(r.target):(N8.setFromNormalAndCoplanarPoint(r.object.up,r.target),Tx.intersectPlane(N8,r.target))))}else r.object.isOrthographicCamera&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/l)),r.object.updateProjectionMatrix(),ae=!0);return l=1,b=!1,!!(ae||st.distanceToSquared(r.object.position)>o||8*(1-Ke.dot(r.object.quaternion))>o||Qe.distanceToSquared(r.target)>0)&&(r.dispatchEvent(R8),st.copy(r.object.position),Ke.copy(r.object.quaternion),Qe.copy(r.target),ae=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",ce),r.domElement.removeEventListener("pointerdown",Ne),r.domElement.removeEventListener("pointercancel",nt),r.domElement.removeEventListener("wheel",D),r.domElement.removeEventListener("pointermove",ke),r.domElement.removeEventListener("pointerup",nt),null!==r._domElementKeyEvents&&(r._domElementKeyEvents.removeEventListener("keydown",C),r._domElementKeyEvents=null)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const o=1e-6,a=new P6,c=new P6;let l=1;const u=new M,h=new Z,d=new Z,f=new Z,p=new Z,m=new Z,_=new Z,g=new Z,y=new Z,v=new Z,w=new M,E=new Z;let b=!1;const T=[],S={};function A(){return Math.pow(.95,r.zoomSpeed)}function O(L){c.theta-=L}function U(L){c.phi-=L}const H=function(){const L=new M;return function(ie,st){L.setFromMatrixColumn(st,0),L.multiplyScalar(-ie),u.add(L)}}(),R=function(){const L=new M;return function(ie,st){!0===r.screenSpacePanning?L.setFromMatrixColumn(st,1):(L.setFromMatrixColumn(st,0),L.crossVectors(r.object.up,L)),L.multiplyScalar(ie),u.add(L)}}(),k=function(){const L=new M;return function(ie,st){const Ke=r.domElement;if(r.object.isPerspectiveCamera){L.copy(r.object.position).sub(r.target);let qe=L.length();qe*=Math.tan(r.object.fov/2*Math.PI/180),H(2*ie*qe/Ke.clientHeight,r.object.matrix),R(2*st*qe/Ke.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(H(ie*(r.object.right-r.object.left)/r.object.zoom/Ke.clientWidth,r.object.matrix),R(st*(r.object.top-r.object.bottom)/r.object.zoom/Ke.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function B(L){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?l/=L:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function W(L){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?l*=L:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ne(L){if(!r.zoomToCursor)return;b=!0;const ye=r.domElement.getBoundingClientRect(),st=L.clientY-ye.top,Qe=ye.height;E.x=(L.clientX-ye.left)/ye.width*2-1,E.y=-st/Qe*2+1,w.set(E.x,E.y,1).unproject(r.object).sub(r.object.position).normalize()}function q(L){return Math.max(r.minDistance,Math.min(r.maxDistance,L))}function ee(L){h.set(L.clientX,L.clientY)}function X(L){p.set(L.clientX,L.clientY)}function Fe(){1===T.length?h.set(T[0].pageX,T[0].pageY):h.set(.5*(T[0].pageX+T[1].pageX),.5*(T[0].pageY+T[1].pageY))}function At(){1===T.length?p.set(T[0].pageX,T[0].pageY):p.set(.5*(T[0].pageX+T[1].pageX),.5*(T[0].pageY+T[1].pageY))}function _t(){const L=T[0].pageX-T[1].pageX,ye=T[0].pageY-T[1].pageY,ie=Math.sqrt(L*L+ye*ye);g.set(0,ie)}function we(L){if(1==T.length)d.set(L.pageX,L.pageY);else{const ie=Ie(L);d.set(.5*(L.pageX+ie.x),.5*(L.pageY+ie.y))}f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const ye=r.domElement;O(2*Math.PI*f.x/ye.clientHeight),U(2*Math.PI*f.y/ye.clientHeight),h.copy(d)}function te(L){if(1===T.length)m.set(L.pageX,L.pageY);else{const ye=Ie(L);m.set(.5*(L.pageX+ye.x),.5*(L.pageY+ye.y))}_.subVectors(m,p).multiplyScalar(r.panSpeed),k(_.x,_.y),p.copy(m)}function me(L){const ye=Ie(L),ie=L.pageX-ye.x,st=L.pageY-ye.y,Ke=Math.sqrt(ie*ie+st*st);y.set(0,Ke),v.set(0,Math.pow(y.y/g.y,r.zoomSpeed)),B(v.y),g.copy(y)}function Ne(L){!1!==r.enabled&&(0===T.length&&(r.domElement.setPointerCapture(L.pointerId),r.domElement.addEventListener("pointermove",ke),r.domElement.addEventListener("pointerup",nt)),function ge(L){T.push(L)}(L),"touch"===L.pointerType?function $(L){switch(_e(L),T.length){case 1:switch(r.touches.ONE){case 0:if(!1===r.enableRotate)return;Fe(),s=i.TOUCH_ROTATE;break;case 1:if(!1===r.enablePan)return;At(),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(r.touches.TWO){case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;(function $e(){r.enableZoom&&_t(),r.enablePan&&At()})(),s=i.TOUCH_DOLLY_PAN;break;case 3:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function N(){r.enableZoom&&_t(),r.enableRotate&&Fe()})(),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(yP)}(L):function It(L){let ye;switch(L.button){case 0:ye=r.mouseButtons.LEFT;break;case 1:ye=r.mouseButtons.MIDDLE;break;case 2:ye=r.mouseButtons.RIGHT;break;default:ye=-1}switch(ye){case 1:if(!1===r.enableZoom)return;(function F(L){ne(L),g.set(L.clientX,L.clientY)})(L),s=i.DOLLY;break;case 0:if(L.ctrlKey||L.metaKey||L.shiftKey){if(!1===r.enablePan)return;X(L),s=i.PAN}else{if(!1===r.enableRotate)return;ee(L),s=i.ROTATE}break;case 2:if(L.ctrlKey||L.metaKey||L.shiftKey){if(!1===r.enableRotate)return;ee(L),s=i.ROTATE}else{if(!1===r.enablePan)return;X(L),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(yP)}(L))}function ke(L){!1!==r.enabled&&("touch"===L.pointerType?function fe(L){switch(_e(L),s){case i.TOUCH_ROTATE:if(!1===r.enableRotate)return;we(L),r.update();break;case i.TOUCH_PAN:if(!1===r.enablePan)return;te(L),r.update();break;case i.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;(function oe(L){r.enableZoom&&me(L),r.enablePan&&te(L)})(L),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function Ye(L){r.enableZoom&&me(L),r.enableRotate&&we(L)})(L),r.update();break;default:s=i.NONE}}(L):function An(L){switch(s){case i.ROTATE:if(!1===r.enableRotate)return;!function ue(L){d.set(L.clientX,L.clientY),f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const ye=r.domElement;O(2*Math.PI*f.x/ye.clientHeight),U(2*Math.PI*f.y/ye.clientHeight),h.copy(d),r.update()}(L);break;case i.DOLLY:if(!1===r.enableZoom)return;!function le(L){y.set(L.clientX,L.clientY),v.subVectors(y,g),v.y>0?B(A()):v.y<0&&W(A()),g.copy(y),r.update()}(L);break;case i.PAN:if(!1===r.enablePan)return;!function de(L){m.set(L.clientX,L.clientY),_.subVectors(m,p).multiplyScalar(r.panSpeed),k(_.x,_.y),p.copy(m),r.update()}(L)}}(L))}function nt(L){(function We(L){delete S[L.pointerId];for(let ye=0;ye<T.length;ye++)if(T[ye].pointerId==L.pointerId)return void T.splice(ye,1)})(L),0===T.length&&(r.domElement.releasePointerCapture(L.pointerId),r.domElement.removeEventListener("pointermove",ke),r.domElement.removeEventListener("pointerup",nt)),r.dispatchEvent(P8),s=i.NONE}function D(L){!1===r.enabled||!1===r.enableZoom||s!==i.NONE||(L.preventDefault(),r.dispatchEvent(yP),function Re(L){ne(L),L.deltaY<0?W(A()):L.deltaY>0&&B(A()),r.update()}(L),r.dispatchEvent(P8))}function C(L){!1===r.enabled||!1===r.enablePan||function Ue(L){let ye=!1;switch(L.code){case r.keys.UP:L.ctrlKey||L.metaKey||L.shiftKey?U(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):k(0,r.keyPanSpeed),ye=!0;break;case r.keys.BOTTOM:L.ctrlKey||L.metaKey||L.shiftKey?U(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):k(0,-r.keyPanSpeed),ye=!0;break;case r.keys.LEFT:L.ctrlKey||L.metaKey||L.shiftKey?O(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):k(r.keyPanSpeed,0),ye=!0;break;case r.keys.RIGHT:L.ctrlKey||L.metaKey||L.shiftKey?O(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):k(-r.keyPanSpeed,0),ye=!0}ye&&(L.preventDefault(),r.update())}(L)}function ce(L){!1!==r.enabled&&L.preventDefault()}function _e(L){let ye=S[L.pointerId];void 0===ye&&(ye=new Z,S[L.pointerId]=ye),ye.set(L.pageX,L.pageY)}function Ie(L){return S[(L.pointerId===T[0].pointerId?T[1]:T[0]).pointerId]}r.domElement.addEventListener("contextmenu",ce),r.domElement.addEventListener("pointerdown",Ne),r.domElement.addEventListener("pointercancel",nt),r.domElement.addEventListener("wheel",D,{passive:!1}),this.update()}}let wbe=(()=>{var n;class e{constructor(r){this.debug=r,this.raycaster=new NR,this.tempMatrix=new tt,this.workingMatrix=new tt,this.workingVector=new M,this.origin=new M,this.userData={selectPressed:!1}}createControls(r){if(this.renderer=r.renderer,"orbit"===r.type)return this.createOrbitControls(r);"immersive-vr"===r.xrMode&&this.createControllers()}createOrbitControls(r){return this.controls=new vbe(r.camera,r.canvas),this.controls.target.set(0,1.6,0),this.controls.listenToKeyEvents(window),this.controls.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.controls.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.controls.touches={ONE:0,TWO:2},this.controls.enableDamping=!0,this.controls.dampingFactor=.07,this.controls.screenSpacePanning=!1,this.controls.panSpeed=.5,this.controls.rotateSpeed=.5,this.controls.keyPanSpeed=40,this.controls.minDistance=r.minDistance||-30,this.controls.maxDistance=r.maxDistance||50,this.controls.zoomSpeed=.5,this.controls.maxZoom=30,this.controls.minZoom=-30,this.controls.maxPolarAngle=Math.PI/2,this.controls.screenSpacePanning=!1,this.debug.addToDebug({obj:this.controls,name:"Orbit Controls",properties:{panSpeed:{min:0,max:1,precision:.01},rotateSpeed:{min:0,max:1,precision:.01},zoomSpeed:{min:0,max:1,precision:.01},dampingFactor:{min:0,max:1,precision:.01},minDistance:{min:0,max:5,precision:.01},maxDistance:{min:10,max:500,precision:1},keyPanSpeed:{min:0,max:100,precision:1}}}),this.controls}createControllers(){this.controls.dispose()}handleControllers(r,i){this.controllers?.userData.selectPressed&&console.log("Select Pressed ")}updateControls(r){return this.renderer.xr&&this.renderer.xr?.isPresenting?(this.controls.enabled=!1,this.handleControllers()):this.controls.update(r)}get selectPressed(){return void 0!==this.controllers&&this.controllers[0].userData.selectPressed||this.controllers[1].userData.selectPressed}getControllerIntersections(r,i){return console.log("getIntersections controller ",r),r.updateMatrixWorld(),this.tempMatrix.identity().extractRotation(r.matrixWorld),this.raycaster.ray.origin.setFromMatrixPosition(r.matrixWorld),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(this.tempMatrix),this.raycaster.intersectObjects(i,!1)}onPinchEndLeft(r){console.log("Pinch end Left ",r)}onPinchEndRight(r){console.log("Pinch end Right ",r)}onPinchStartLeft(r){console.log("Pinch start Left ",r)}onPinchStartRight(r){console.log("Pinch start Right ",r)}onSelectStart(r){console.log("SelectStart controller service  ",r),this.userData.selectPressed=!0}onSelectEnd(r){console.log("SelectEnd controller service  ",r),this.userData.selectPressed=!1}}return(n=e).\u0275fac=function(r){return new(r||n)(De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:"platform"}),e})(),L8=(()=>{var n;class e{constructor(r,i,s,o,a,c,l){this.cameraService=r,this.controllerService=i,this.ngZone=s,this.interactionsService=o,this.lightsService=a,this.objectsService=c,this.debug=l,this.scene=new S$,this.renderFunctions=[],this.clock=new A6,this.width=window.innerWidth,this.height=window.innerHeight,this.pointer=new Z,this.toneMappingOptions={None:va,Linear:Uj,Reinhard:Bj,Cineon:zj,ACESFilmic:oD,Custom:Hj},this.params={exposure:1,toneMapping:"ACESFilmic",blurriness:.3,intensity:1}}initScene(r,i){const s=i?Object.assign({},I8,i):I8;this.canvas=r,s.camera.width=this.width,s.camera.height=this.height,this.camera=this.cameraService.createCamera(s.camera),this.dolly=this.cameraService.addDolly(),this.scene.add(this.dolly),this.scene.background=s.background||new J("skyblue"),s.fog&&(this.scene.fog=new CE(s.fog.color,s.fog.near,s.fog.far)),this.renderer=new T$({canvas:r,antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Rj,this.renderer.toneMapping=oD,this.renderer.toneMappingExposure=1.5,this.renderer.xr.enabled=!0,this.scene.backgroundBlurriness=.3,this.rect=this.renderer.domElement.getBoundingClientRect();const o=this.lightsService.createHemLight({intensity:.5});this.spotLights=this.lightsService.createSpotLight(),this.spotlight=this.spotLights[0],this.spotlight.position.set(0,7,1.16),this.spotlight.target.position.set(0,0,-4),this.spotlight=this.spotLights[0];const a=this.lightsService.createSpotLight();a[0].position.set(0,-2,.64),this.camera.add(a[0]),this.debug.addToDebug({obj:a[0],name:"Camera Light",properties:{Position:{},intensity:{min:0,max:20,precision:1},distance:{min:0,max:10,precision:1},angle:{min:0,max:Math.PI,precision:Math.PI/36},penumbra:{min:0,max:1,precision:.01},decay:{min:0,max:10,precision:1}}}),this.scene.add(...o);const c=this.objectsService.createIcosahedron({radius:.3,detail:0,material:"MeshPhysicalMaterial"});c.position.set(0,1,-10),c.material.opacity=.6,this.pointLight=this.lightsService.createPointLight(),this.pointLight.position.y=2.2,c.add(this.pointLight),this.icoLight=c,this.scene.add(this.icoLight),this.controllerService.createControls({type:"orbit",camera:this.camera,renderer:this.renderer,canvas:r});const u=this.interactionsService.initInteractionManager(this.renderer,this.camera,r);return this.renderFunctions.push(u),document.body.appendChild(_be.createButton(this.renderer)),this.ngZone.runOutsideAngular(()=>this.renderer.setAnimationLoop(()=>this.render())),this.afterSceneInit.bind(this)}afterSceneInit(r){this.createCornerLights(),this.cameraService.moveCamera(0,1.6,.001,8),this.interactionsManager=this.interactionsService.initInteractionManager(this.renderer,this.camera,this.canvas);const i=Date.now()-r;console.log(`seconds elapsed = ${Math.floor(i/1e3)}`),window.addEventListener("resize",this.onResize.bind(this)),window.addEventListener("touchstart",this.onTouchStart.bind(this))}render(){const r=this.clock.getDelta();this.controllerService.updateControls(r),this.cameraService.updateCamera({camera:this.camera,scene:this.scene}),this.renderFunctions.forEach(i=>i(r)),this.renderer.render(this.scene,this.camera)}animateLights(r){this.icoLight.rotation.y+=.01,this.icoLight1.rotation.y+=.01,this.icoLight2.rotation.y+=.01}addToScene(r){r instanceof Array?this.scene.add(...r):this.scene.add(r)}createCornerLights(){this.icoLight1=this.icoLight.clone();const r=this.lightsService.createPointLight();this.icoLight1.add(r),this.icoLight1.position.set(-10,1,7.6),this.icoLight2=this.icoLight.clone(),this.icoLight2.add(r),this.icoLight2.position.set(10,1,7.6),this.scene.add(this.icoLight1,this.icoLight2),this.renderFunctions.push(this.animateLights.bind(this))}onTouchStart(r){console.log("Toyuch Start",r),this.pointer.x=(r.touches[0].clientX-this.rect.left)/(this.rect.right-this.rect.left)*2-1,this.pointer.y=-(r.touches[0].clientY-this.rect.top)/(this.rect.bottom-this.rect.top)*2+1}onPointerDown(r){this.pointer.x=(r.clientX-this.rect.left)/(this.rect.right-this.rect.left)*2-1,this.pointer.y=-(r.clientY-this.rect.top)/(this.rect.bottom-this.rect.top)*2+1,this.interactionsService.intersectObjects({pointer:this.pointer,camera:this.camera,scene:this.scene})}onResize(r,i,s){i=i||window.innerWidth,s=s||window.innerHeight,this.camera.aspect=i/s,this.camera.updateProjectionMatrix(),this.renderer.setSize(i,s),this.renderer.setPixelRatio(window.devicePixelRatio)}onDeviceChange(r){}}return(n=e).\u0275fac=function(r){return new(r||n)(De(D8),De(wbe),De(Ht),De(lx),De(W6),De(j6),De(wu))},n.\u0275prov=Le({token:n,factory:n.\u0275fac,providedIn:null}),e})(),Ebe=(()=>{var n;class e{constructor(){this.tweetHref="https://twitter.com/intent/tweet?text=Checkout%20Angular%20WebXR%20Art%20Gallery!&hashtags=Angular,WebXR,AngularSignals&url=https://webxr.art&image=https://raw.githubusercontent.com/ARtist-Devs/a-w-g/main/src/assets/images/thumbnail.png"}onTweet(r){}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=Au({type:n,selectors:[["art-tweet"]],decls:4,vars:1,consts:[["aria-label","Tweet Angular WebXR Gallery","target","_blank","rel","noopener","data-size","large","title","Twitter","appTweet","",1,"twitter-share-button",3,"href","newTweetEvent"],["id","twitter-logo","height","24","data-name","Logo","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 400 400"],["width","400","height","400","fill","none"],["d","M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23","fill","#fff"]],template:function(r,i){1&r&&(Ka(0,"a",0),Jp("newTweetEvent",function(o){return i.onTweet(o)}),function tL(){it.lFrame.currentNamespace="svg"}(),Ka(1,"svg",1),vh(2,"rect",2)(3,"path",3),il()()),2&r&&lS("href",i.tweetHref,cT)},styles:['[_nghost-%COMP%]{display:block;position:fixed;top:0;right:50px;z-index:1005}#twitter-logo[_ngcontent-%COMP%]{height:40px;margin:0 8px}image[_ngcontent-%COMP%]{src:"assets/images/gallery.png"}#twitter-logo[_ngcontent-%COMP%]:hover{opacity:.8}']}),e})();const xbe=["canvas"],bbe=[{path:"",component:(()=>{var n;class e{get canvasEl(){return this.canvas.nativeElement}constructor(r,i,s,o,a){this.artworksService=r,this.framesService=i,this.loadersService=s,this.sceneService=o,this.ui=a,this.artworks=[],this.artworksLength=0,this.selectedIndex=Z_(0),this.loadingProgress=Z_(0),this.focused=0,this.info=function Mq(n,e){const t=Object.create(Iq);t.computation=n,e?.equal&&(t.equal=e.equal);const r=()=>{if(bN(t),xN(t),t.value===Q_)throw t.error;return t.value};return r[Ha]=t,r}(()=>{this.selectedIndex()})}ngOnInit(){const r=Date.now();this.artworks=this.artworksService.getArtworks();const i=this.sceneService.initScene(this.canvasEl);this.loadersService.loadModel({path:"assets/models/VRGallery0110NoFloorTexture.glb",scene:this.sceneService.scene,onLoadProgress:this.onLoadProgress.bind(this),onLoadCB:()=>{i(r),this.sceneService.addToScene(this.frames);const a=Date.now()-r;console.log(`seconds elapsed = ${Math.floor(a/1e3)}`)}}),this.loadersService.loadModel({path:"assets/models/VRGalleryInnerWalls0110Merge.glb",scene:this.sceneService.scene,onLoadProgress:this.onLoadProgress.bind(this),onLoadCB:()=>{i(r),this.sceneService.addToScene(this.frames);const a=Date.now()-r;console.log(`seconds elapsed = ${Math.floor(a/1e3)}`)}}),this.buttons=[{name:"Next Button",text:"Next",onClick:a=>{this.changeSelection(a,1)},position:{x:-.75,y:0,z:-0},rotation:{}},{name:"Upvote Button",text:"Upvote",onClick:a=>{this.upvoteSelection(a)},position:{x:-.8,y:.8,z:-.1},rotation:{}},{name:"Previous Button",text:"Previous",onClick:a=>{this.changeSelection(a,-1)},position:{x:.75,y:0,z:-0},rotation:{}}],this.frames=this.framesService.createFrames(this.artworks,this.buttons,i),this.sceneService.renderFunctions.push(this.ui.update),this.artworksLength=this.artworks.length,this.selectedArtwork=Z_(this.artworks[0],{equal:this.compareSelected})}onLoadProgress(r){console.log(r.loaded/r.total*100+"% loaded"),this.loadingProgress.set(r.loaded/r.total)}compareSelected(r,i){return!r||r.id===i.id}showInfo(r){}onSelectArtwork(r,i){this.framesService.focusFrame(this.selectedArtwork().id)}changeSelection(r,i){let s;this.framesService.resetPosition(this.focused),1===i?(s=r<this.artworksLength-1?r+1:0,this.framesService.rotateFrames(72)):-1===i&&(s=0===r?this.artworksLength-1:r-1,this.framesService.rotateFrames(-72)),this.focused=s,this.framesService.focusFrame(s)}upvoteSelection(r){const s=this.frames.children[r].getObjectByName(`${r} Text`),o=this.artworksService.upvoteArtwork(r);this.ui.updateVote({votes:o,text:s})}onKeyDown(r){}onPointerDown(r){}onTouchStart(r){}onPointerMove(r){}onPointerUp(r){}onCanvasClick(r){}onObjectHover(r){}onDeviceChange(r){}onTouchEnd(r){}}return(n=e).\u0275fac=function(r){return new(r||n)(Xe(Spe),Xe(M8),Xe(YR),Xe(L8),Xe(_P))},n.\u0275cmp=Au({type:n,selectors:[["art-gallery"]],viewQuery:function(r,i){if(1&r&&mV(xbe,7),2&r){let s;AS(s=function CS(){return function tte(n,e){return n[io].queries[e].queryList}(Y(),YN())}())&&(i.canvas=s.first)}},decls:3,vars:1,consts:[[3,"click","pointermove","pointerup","pointerdown","mousemove","mouseenter","touchstart","touchend","ondevicechange","resize","keydown"],["canvas",""]],template:function(r,i){if(1&r&&(vh(0,"art-tweet"),Ka(1,"canvas",0,1),Jp("click",function(o){return i.onCanvasClick(o)})("pointermove",function(o){return i.onPointerMove(o)})("pointerup",function(o){return i.onPointerUp(o)})("pointerdown",function(o){return i.sceneService.onPointerDown(o)})("mousemove",function(o){return i.onPointerMove(o)})("mouseenter",function(o){return i.onObjectHover(o)})("touchstart",function(o){return i.onTouchStart(o)})("touchend",function(o){return i.onTouchEnd(o)})("ondevicechange",function(o){return i.onDeviceChange(o)})("resize",function(o){return i.sceneService.onResize(o)},!1,Bb)("keydown",function(o){return i.onKeyDown(o)},!1,Bb),il()),2&r){const s=function Dk(n){return function Nu(n,e){return n[e]}(function i7(){return it.lFrame.contextLView}(),rt+n)}(2);(function s2(n){o2(Ot(),Y(),ci()+n,!1)})(1),Qy("aria-label",s)}},dependencies:[Ebe],styles:["#canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}mat-progress-bar[_ngcontent-%COMP%]{height:40px}"],changeDetection:0}),e})(),title:"WebXR Gallery"},{path:"**",component:(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=Au({type:n,selectors:[["art-error"]],decls:2,vars:0,template:function(r,i){1&r&&(Ka(0,"p"),function Bk(n,e=""){const t=Y(),r=Ot(),i=n+rt,s=r.firstCreatePass?nh(r,i,1,e,null):r.data[i],o=zk(r,t,s,e,n);t[i]=o,ey()&&My(r,t,o,s),lo(s,!1)}(1,"error works!"),il())}}),e})(),title:"Error Page"}];let Tbe=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=qo({type:n}),n.\u0275inj=no({imports:[c3.forRoot(bbe),c3]}),e})(),Sbe=(()=>{var n;class e{constructor(r,i,s){this.router=r,this.titleService=i,this.document=s,this.handleRouteEvents()}handleRouteEvents(){this.router.events.subscribe(r=>{if(r instanceof Eo){const i=this.getTitle(this.router.routerState,this.router.routerState.root).join("-");this.titleService.setTitle(i),gtag("event","page_view",{page_title:i,page_path:r.urlAfterRedirects,page_location:this.document.location.href})}})}getTitle(r,i){const s=[];return i&&i.snapshot.data&&i.snapshot.data.title&&s.push(i.snapshot.data.title),r&&i&&i.firstChild&&s.push(...this.getTitle(r,i.firstChild)),s}}return(n=e).\u0275fac=function(r){return new(r||n)(Xe(Ki),Xe(EA),Xe(Ii))},n.\u0275cmp=Au({type:n,selectors:[["art-root"]],decls:2,vars:0,consts:[["role","main",1,"content"]],template:function(r,i){1&r&&(Ka(0,"div",0),vh(1,"router-outlet"),il())},dependencies:[HA],styles:['[_nghost-%COMP%] {\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-size: 14px;\n    color: #333;\n    box-sizing: border-box;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    margin: 0;\n  }\n\n  body[_ngcontent-%COMP%] {\n    margin-top: 0;\n  }\n\n  .toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%] {\n    height: 40px;\n    margin: 0 8px;\n  }\n\n  .toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%] {\n    height: 40px;\n    margin: 0 16px;\n  }\n\n  .toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%]:hover, .toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%]:hover {\n    opacity: 0.8;\n  }']}),e})(),Abe=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=qo({type:n}),n.\u0275inj=no({imports:[FU]}),e})(),Cbe=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=qo({type:n}),n.\u0275inj=no({providers:[M8,D8,YR,L8,_P]}),e})(),Mbe=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=qo({type:n,bootstrap:[Sbe]}),n.\u0275inj=no({imports:[sse,Tbe,Abe,Cbe]}),e})();rse().bootstrapModule(Mbe).catch(n=>console.error(n))}},Qt=>{Qt(Qt.s=524)}]);